var $jscomp={scope:{},checkStringArgs:function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""}};
$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var f=a[d];f in c||(c[f]={});c=c[f]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,c){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,c||0)}},"es6-impl","es3");
var PreLoadIndex=-1,CurrentLoadIndex=0,LOAD_STATE_END=9999,LOAD_PAGE_NUM=20,gl_curriculumrecord_List=[],gl_curriculumapply_List=[],gl_curriculum_List=[],gl_curriculumtype_List=[],gl_user_info=[],glCurrentPage=1,glReloadTimes=0,gl_uploadfile_uid="",gl_current_record_id="",gl_NewCurriculumRecord={};check_loading_status();
function check_loading_status(){switch(CurrentLoadIndex){case 0:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,load_CurriculumType());break;case 1:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,load_CurriculumRecords());break;case 2:PreLoadIndex!=CurrentLoadIndex&&
(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,load_Curriculums());break;case 3:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,load_CurriculumApply());break;case 4:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),
PreLoadIndex=CurrentLoadIndex,show_CurriculumRecords(),CurrentLoadIndex+=1);break;case 5:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,load_user_info(),CurrentLoadIndex=LOAD_STATE_END)}CurrentLoadIndex!=LOAD_STATE_END?setTimeout(check_loading_status,100):console.log("check_loading_status() Stop.")}
function load_CurriculumType(){var a=gl_target_server+"/php/curriculum.php";gl_curriculumtype_List=[];$.getJSON(a,"loadcurriculumtype=1&project_id="+project_id,function(a){$.each(a,function(a,b){b.id=parseInt(b.id);gl_curriculumtype_List.push(b)})}).success(function(){CurrentLoadIndex+=1}).error(function(){CurrentLoadIndex+=1}).complete(function(){})}
function load_CurriculumRecords(){var a=gl_target_server+"/php/curriculum.php",b=(glCurrentPage-1)*LOAD_PAGE_NUM,c=LOAD_PAGE_NUM;gl_curriculumrecord_List=[];$.getJSON(a,"loadcurriculumrecord=1&project_id="+project_id+"&offset="+b+"&count="+c,function(a){$.each(a,function(a,b){b.id=parseInt(b.id);b.userid=parseInt(b.userid);b.teacheruserid=parseInt(b.teacheruserid);gl_curriculumrecord_List.push(b)})}).success(function(){CurrentLoadIndex+=1}).error(function(){CurrentLoadIndex+=1}).complete(function(){})}
function load_Curriculums(){var a=gl_target_server+"/php/curriculum.php";gl_curriculum_List=[];$.getJSON(a,"loadusercurriculums=1&project_id="+project_id,function(a){$.each(a,function(a,b){b.id=parseInt(b.id);b.userid=parseInt(b.userid);b.typeid=parseInt(b.typeid);gl_curriculum_List.push(b)})}).success(function(){CurrentLoadIndex+=1}).error(function(){CurrentLoadIndex+=1}).complete(function(){})}
function load_CurriculumApply(){for(var a=gl_target_server+"/php/curriculum.php",b=[],c=0;c<gl_curriculumrecord_List.length;c++)b.push(gl_curriculumrecord_List[c].id);b=b.toString();gl_curriculumapply_List=[];$.getJSON(a,"loadcurriculumapply=1&project_id="+project_id+"&records="+b,function(a){$.each(a,function(a,b){b.id=parseInt(b.id);b.userid=parseInt(b.userid);b.curriculumrecordid=parseInt(b.curriculumrecordid);b.status=parseInt(b.status);gl_curriculumapply_List.push(b)})}).success(function(){CurrentLoadIndex+=
1}).error(function(){CurrentLoadIndex+=1}).complete(function(){})}function show_CurriculumRecords(){for(var a=document.getElementById("CURRICULUM_RECORD_TABLE_BODY");a.firstChild;)a.removeChild(a.firstChild);for(var b=0;b<gl_curriculumrecord_List.length;b++)show_curriculumrecord(a,(glCurrentPage-1)*LOAD_PAGE_NUM+b+1,gl_curriculumrecord_List[b])}
function show_curriculumrecord(a,b,c){var d=0;console.log("show_curriculumrecord() curriculumid:"+c.curriculumid);console.log("show_curriculumrecord() userid:"+c.userid);var f=get_curriculum(c.curriculumid);if(null==f)return 0;var e=document.createElement("tr");e.setAttribute("id",c.id+"_TABLE_ROW");a.appendChild(e);1==b%2&&e.setAttribute("bgcolor","#ebebe0");var g=document.createElement("tr");g.setAttribute("id",c.id+"_TABLE_ROW_EXTRA");a.appendChild(g);e.appendChild(document.createElement("td"));
e.cells[d].appendChild(document.createTextNode(""+b));d++;e.appendChild(document.createElement("td"));a=getCurriculumTypeName(f.typeid)+" ["+f.number+"]";b=document.createElement("div");b.setAttribute("id","curriculum_"+c.id);b.appendChild(document.createTextNode(a));e.cells[d].appendChild(b);d++;e.appendChild(document.createElement("td"));b=document.createElement("div");b.setAttribute("id","curriculumname_"+c.id);b.appendChild(document.createTextNode(c.name));e.cells[d].appendChild(b);d++;e.appendChild(document.createElement("td"));
e.cells[d].appendChild(create_date_picker("\u958b\u59cb:","startdate_"+c.id,c.startdate,!1));e.cells[d].appendChild(create_date_picker("\u7d50\u675f:","enddate_"+c.id,c.enddate,!1));d++;e.appendChild(document.createElement("td"));e.cells[d].appendChild(create_time_select("\u958b\u59cb:","starttime_"+c.id,c.starttime,!1));e.cells[d].appendChild(create_time_select("\u7d50\u675f:","endtime_"+c.id,c.endtime,!1));d++;e.appendChild(document.createElement("td"));a=create_weekday_select("weekday_"+c.id,c.id,
c.weekday,!1);e.cells[d].appendChild(a);d++;e.appendChild(document.createElement("td"));a=document.createElement("div");a.setAttribute("id","text_totalhours_"+c.id);a.appendChild(document.createTextNode(c.totalhours));e.cells[d].appendChild(a);d++;e.appendChild(document.createElement("td"));a=document.createElement("div");a.setAttribute("id","text_location_"+c.id);a.appendChild(document.createTextNode(c.location));e.cells[d].appendChild(a);d++;e.appendChild(document.createElement("td"));a=document.createElement("div");
a.setAttribute("id","text_description_"+c.id);a.appendChild(document.createTextNode(c.description));e.cells[d].appendChild(a);d++;e.appendChild(document.createElement("td"));a=document.createElement("div");b=document.createElement("span");b.setAttribute("class","badge bg-green-active");b.setAttribute("id","teacheruser_name_"+c.id+"_"+c.teacheruserid);b.textContent=getUserName(c.teacheruserid);a.appendChild(b);e.cells[d].appendChild(a);d++;e.appendChild(document.createElement("td"));a=document.createElement("div");
a.setAttribute("id","text_teacher_"+c.id);b=document.createElement("div");b.innerHTML=linkify(c.teacher);a.appendChild(b);e.cells[d].appendChild(a);d++;e.appendChild(document.createElement("td"));a=document.createElement("div");a.setAttribute("id","text_cost_"+c.id);a.appendChild(document.createTextNode(c.cost));e.cells[d].appendChild(a);d++;e.appendChild(document.createElement("td"));a=document.createElement("div");a.setAttribute("id","text_note_"+c.id);a.appendChild(document.createTextNode(c.note));
e.cells[d].appendChild(a);d++;e.appendChild(document.createElement("td"));a=document.createElement("div");a.setAttribute("id","storage_file_"+c.id);0<c.files.length&&fetch_storage_file(c.id,c.files);e.cells[d].appendChild(a);d++;e.appendChild(document.createElement("td"));a=document.createElement("span");a.setAttribute("id","onoffstatus_"+c.id);e.cells[d].appendChild(a);b=document.createElement("span");0==c.status?(b.textContent="\u672c\u8ab2\u7a0b\u66ab\u6642\u505c\u6b62\u63a5\u53d7\u9078\u8ab2\uff0c\u8acb\u5728\u622a\u6b62\u65e5\u524d\u91cd\u65b0\u5617\u8a66\u9078\u8ab2",
b.setAttribute("class","badge bg-red")):1==c.status&&(b.textContent="\u958b\u653e\u9078\u8ab2",b.setAttribute("class","badge bg-green"));a.appendChild(b);d++;e.appendChild(document.createElement("td"));1==c.status&&(a=getApplyStatus(c.id),0==a?(b=document.createElement("span"),b.textContent="\u7b49\u5f85\u5be9\u6838",b.setAttribute("class","badge bg-red"),e.cells[d].appendChild(b)):1==a?(b=document.createElement("span"),b.textContent="\u5df2\u52a0\u5165\u8ab2\u7a0b",b.setAttribute("class","badge bg-green"),
e.cells[d].appendChild(b)):99==a?(b=document.createElement("span"),b.textContent="\u672a\u6838\u51c6",b.setAttribute("class","badge bg-red"),e.cells[d].appendChild(b)):(a=document.createElement("button"),a.setAttribute("id","apply_curriculumrecord_btn_"+c.id),a.setAttribute("title","\u52a0\u5165\u8ab2\u7a0b"),a.setAttribute("href","javascript:;"),a.setAttribute("onclick","confirm_curriculumrecord("+c.id+");return false;"),a.textContent="\u52a0\u5165\u8ab2\u7a0b",e.cells[d].appendChild(a)));return 1}
function load_user_info(){var a=[],b=check_userinfo_existed(parseInt(gl_userid));0==b&&a.push(gl_userid);for(var c=0;c<gl_curriculumrecord_List.length;c++){var d=gl_curriculumrecord_List[c],b=check_userinfo_existed(d.userid);if(0==b&&0<d.userid){for(var b=!1,f=0;f<a.length;f++)if(a[f]==d.userid){b=!0;break}b||a.push(d.userid)}b=check_userinfo_existed(d.teacheruserid);if(0==b&&0<d.userid){b=!1;for(f=0;f<a.length;f++)if(a[f]==d.teacheruserid){b=!0;break}b||a.push(d.teacheruserid)}}for(c=0;c<gl_curriculumapply_List.length;c++)if(d=
gl_curriculumapply_List[c],b=check_userinfo_existed(d.userid),0==b&&0<d.userid){b=!1;for(f=0;f<a.length;f++)if(a[f]==d.userid){b=!0;break}b||a.push(d.userid)}0==a.length?update_user_name():$.getJSON(gl_target_server+"/php/vilsnodes.php","queryusers=1&userid="+a.toString()+"&project_id="+project_id,function(a){$.each(a,function(a,b){b.userid=parseInt(b.userid);gl_user_info.push(b)})}).success(function(){update_user_name()}).error(function(){}).complete(function(){})}
function update_user_name(){for(var a=0;a<gl_curriculumrecord_List.length;a++){var b=gl_curriculumrecord_List[a],c=document.getElementById("teacheruser_name_"+b.id+"_"+b.teacheruserid);void 0!=c&&(c.textContent=getUserName(b.teacheruserid))}}function check_userinfo_existed(a){for(var b=!1,c=0;c<gl_user_info.length;++c)if(gl_user_info[c].userid==a){b=!0;break}return b}function confirm_curriculumrecord(a){confirm("\u662f\u5426\u78ba\u8a8d\u52a0\u5165\u8ab2\u7a0b?")&&apply_curriculumrecord(a)}
function apply_curriculumrecord(a){var b=get_curriculumrecord(a),b=get_curriculum(b.curriculumid),c=getCurriculumTypeName(b.typeid),d={};d.project_id=""+project_id;d.apply_curriculumrecord=1;d.id=a;d.number=b.number;d.curriculumname=c;jQuery.ajax({url:gl_target_server+"/php/curriculum.php",type:"POST",data:d,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a));setTimeout(reload_curriculumrecords,300)},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+
a.responseText)}})}function create_time_item(a){var b=document.createElement("div"),c=document.createElement("span");c.setAttribute("class","badge bg-yellow-active");c.textContent=a;b.appendChild(c);return b}
function create_applyuser_label(a){var b=document.createElement("span");b.setAttribute("style","display:inline;padding:.2em .3em .3em;font-size:95%;font-weight:700;line-height:2;position:relative;top:-1px;color:#fff;border-radius:2px;white-space:nowrap;background-color:#f39c12;");b.textContent=a;return b}function create_input_text(a,b){var c=document.createElement("textarea");c.setAttribute("rows","1");c.setAttribute("id",a);c.setAttribute("style","width: 120px;");c.textContent=b;return c}
function getCurriculumTypeName(a){for(var b="",c=0;c<gl_curriculumtype_List.length;c++){var d=gl_curriculumtype_List[c];if(a==d.id){b=d.name;break}}return b}
function create_date_picker(a,b,c,d){var f=document.createElement("div");f.setAttribute("style","width:150px;");var e=document.createElement("div");e.setAttribute("class","input-group");f.appendChild(e);var g=document.createElement("div");g.setAttribute("class","input-group-addon");g.innerHTML=a;e.appendChild(g);a=document.createElement("input");a.setAttribute("type","text");a.setAttribute("id",b);a.setAttribute("style","width:100px;");a.setAttribute("readonly","readonly");d&&a.setAttribute("class",
"datepicker");a.setAttribute("data-date-format","yyyy-mm-dd");a.setAttribute("value",c);e.appendChild(a);return f}function create_time_select(a,b,c,d){var f=document.createElement("div");f.appendChild(create_time_picker(a,b,c,d));return f}
function create_time_picker(a,b,c,d){var f=document.createElement("div");f.setAttribute("class","bootstrap-timepicker");f.setAttribute("style","width:180px;");var e=document.createElement("div");e.setAttribute("class","input-group");f.appendChild(e);var g=document.createElement("div");g.setAttribute("class","input-group-addon");g.innerHTML=a;e.appendChild(g);a=document.createElement("input");a.setAttribute("type","text");a.setAttribute("id",b);a.setAttribute("readonly","readonly");d?a.setAttribute("class",
"form-control timepicker"):a.setAttribute("class","form-control");a.setAttribute("value",c);e.appendChild(a);return f}function create_weekday_select(a,b,c,d){var f=document.createElement("div");f.setAttribute("id",a);a=create_weekday_ui(b,c,d);f.appendChild(a);return f}
function create_weekday_ui(a,b,c){var d=document.createElement("div");d.setAttribute("class","box");d.setAttribute("style","background-image: linear-gradient(to bottom, #a9dbde, #e4eded);");var f=document.createElement("div");f.setAttribute("class","box-header with-border");d.appendChild(f);var e=document.createElement("div");e.appendChild(document.createTextNode("\u8ab2\u7a0b\u9031\u9593\u65e5"));e.setAttribute("style","text-align:center;");f.appendChild(e);e=document.createElement("div");e.setAttribute("class",
"box-body no-padding");d.appendChild(e);f=document.createElement("table");f.setAttribute("class","table table-bordered");f.setAttribute("style","background-image: linear-gradient(to bottom, #e4eded, #e4eded);");e.appendChild(f);e=document.createElement("thead");f.appendChild(e);e=document.createElement("tr");f.appendChild(e);var g=document.createElement("th");g.textContent="\u4e00";e.appendChild(g);g=document.createElement("th");g.textContent="\u4e8c";e.appendChild(g);g=document.createElement("th");
g.textContent="\u4e09";e.appendChild(g);g=document.createElement("th");g.textContent="\u56db";e.appendChild(g);g=document.createElement("th");g.textContent="\u4e94";e.appendChild(g);g=document.createElement("th");g.textContent="\u516d";e.appendChild(g);g=document.createElement("th");g.textContent="\u65e5";e.appendChild(g);e=document.createElement("tbody");f.appendChild(e);f=document.createElement("tr");e.appendChild(f);for(e=1;7>=e;e++){var h=""+e;7==e&&(h="0");var k=!1;0<=b.indexOf(h)&&(k=!0);g=
document.createElement("td");h=create_checkbox(a,h,k,c);g.appendChild(h);f.appendChild(g)}return d}function create_checkbox(a,b,c,d){var f=document.createElement("input");f.setAttribute("id","uiid_checkbox_"+b+"_"+a);f.setAttribute("type","checkbox");c&&f.setAttribute("checked",c);d||f.setAttribute("disabled",!0);return f}
function fetch_storage_file(a,b){$.getJSON(gl_target_server+"/php/storage.php","loadsinglefile=1&project_id="+project_id+"&fileuid="+b,function(b){b=create_data_file(b.id,b.filename,b.filetype,b.filesize);document.getElementById("storage_file_"+a).appendChild(b)}).success(function(){}).error(function(){}).complete(function(){})}function convertFileSize(a){return 1048576<a?(Math.round(100*a/1048576)/100).toString()+"MB":(Math.round(100*a/1024)/100).toString()+"KB"}
function create_data_file(a,b,c,d){var f=document.createElement("ul");f.setAttribute("class","mailbox-attachments clearfix");var e=document.createElement("li");f.appendChild(e);var g=document.createElement("span");g.setAttribute("class","mailbox-attachment-icon");e.appendChild(g);g.appendChild(create_filetype_icon(c));c=document.createElement("div");c.setAttribute("class","mailbox-attachment-info");e.appendChild(c);e=document.createElement("a");e.setAttribute("href","/php/downloadfile.php?project_id="+
project_id+"&fileid="+a);e.setAttribute("class","mailbox-attachment-name");c.appendChild(e);c=document.createElement("i");c.setAttribute("class","fa fa-paperclip");e.appendChild(c);e.appendChild(document.createTextNode("  "+b));b=document.createElement("span");b.setAttribute("class","mailbox-attachment-size");b.textContent=convertFileSize(parseInt(d));e.appendChild(b);d=document.createElement("a");d.setAttribute("href","/php/downloadfile.php?project_id="+project_id+"&fileid="+a);d.setAttribute("class",
"btn btn-default btn-xs pull-right");b.appendChild(d);a=document.createElement("i");a.setAttribute("class","fa fa-cloud-download");d.appendChild(a);return f}
function create_filetype_icon(a){var b=document.createElement("i");a.includes("video")?b.setAttribute("class","fa fa-file-movie-o"):a.includes("audio")?b.setAttribute("class","fa fa-file-audio-o"):a.includes("application/pdf")?b.setAttribute("class","fa fa-file-pdf-o"):a.includes("application/zip")?b.setAttribute("class","fa fa-file-zip-o"):a.includes("ms-excel")?b.setAttribute("class","fa fa-file-excel-o"):a.includes("officedocument.wordprocessingml.document")?b.setAttribute("class","fa fa-file-word-o"):
a.includes("officedocument.presentationml.presentation")?b.setAttribute("class","fa fa-file-powerpoint-o"):a.includes("image")?b.setAttribute("class","fa fa-file-photo-o"):b.setAttribute("class","fa fa-file");return b}function reload_curriculumrecords(){PreLoadIndex=0;CurrentLoadIndex=1;setTimeout(check_loading_status,50)}function getUserName(a){for(var b="",c=0;c<gl_user_info.length;++c){var d=gl_user_info[c];if(d.userid==a){b=d.name;break}}return b}
function get_curriculumrecord(a){for(var b=0;b<gl_curriculumrecord_List.length;b++){var c=gl_curriculumrecord_List[b];if(c.id==a)return c}return null}function get_curriculum(a){for(var b=0;b<gl_curriculum_List.length;b++){var c=gl_curriculum_List[b];if(c.id==a)return c}return null}function getApplyStatus(a){for(var b=0;b<gl_curriculumapply_List.length;b++){var c=gl_curriculumapply_List[b];if(c.curriculumrecordid==a)return c.status}return-1}
function clearChildView(a){a=document.getElementById(a);if(null!=a)for(;a.firstChild;)a.removeChild(a.firstChild);return a}function isNumeric(a){return""!==a&&!isNaN(parseFloat(a))&&isFinite(a)}
function linkify(a){a=a.replace(/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,'<a href="$1" target="_blank">$1</a>');a=a.replace(/(^|[^\/])(www\.[\S]+(\b|$))/gim,'$1<a href="http://$2" target="_blank">$2</a>');return a=a.replace(/(([a-zA-Z0-9\-\_\.])+@[a-zA-Z\_]+?(\.[a-zA-Z]{2,6})+)/gim,'<a href="mailto:$1">$1</a>')}
function move_page_backward(){var a=document.getElementById("id_current_page_num");1>=glCurrentPage||(glCurrentPage--,a.textContent=glCurrentPage,PreLoadIndex=0,CurrentLoadIndex=1,check_loading_status())}function move_page_forward(){var a=document.getElementById("id_current_page_num");glCurrentPage++;a.textContent=glCurrentPage;PreLoadIndex=0;CurrentLoadIndex=1;check_loading_status()}
function open_curriculumrecords_page(){window.open("/index.php/vilscurriculumrecords/"+project_id,"_blank").focus()};
