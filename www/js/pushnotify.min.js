var PreLoadIndex=-1,CurrentLoadIndex=0,LOAD_STATE_END=9999,LOAD_DEVICE_NUM=20,UPDATE_INTERVAL=1E3,RECORD_PAGE_COUNT=5,DEVICE_TYPE_TAG=0,DEVICE_TYPE_LOCATOR=1,DEVICE_TYPE_EMPLOYEE=2,TAG_FUNCTION_NUM=11,TAG_FUNCTION_START_NUM=1,LOCATOR_FUNCTION_NUM=6,LOCATOR_FUNCTION_START_NUM=101,EMPLOYEE_FUNCTION_NUM=9,EMPLOYEE_FUNCTION_START_NUM=1,gl_tag_num=0,gl_locator_num=0,gl_tag_load_index=0,gl_coord_load_index=0,glTag_List=[],glLocator_List=[],glEmployee_List=[],glCurrentDevice_clicktime=new Date("2019/01/01"),
glCurrentDevice_nodeid="",glCurrentDevice_macaddress="",glCurrentDevice_type=DEVICE_TYPE_TAG,glCurrentDevice_Records={},glCurrentDevice_TriggerMessage_Records={},glDataLoading=0,glPushNotifyPrefix="",glPushNotifyWelcomeTitle="",glPushNotifyWelcomeBody="",glEnablePushNotify="0";check_loading_status();
function check_loading_status(){switch(CurrentLoadIndex){case 0:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,load_devices());break;case 1:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,load_system_topic());break;case 2:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+
PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,click_tag(""),CurrentLoadIndex=3);break;case 3:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,check_cookies(),CurrentLoadIndex=LOAD_STATE_END)}CurrentLoadIndex!=LOAD_STATE_END?setTimeout(check_loading_status,100):console.log("check_loading_status() Stop.")}
function load_devices(){$.getJSON(gl_target_server+"/php/vilsnodes.php","devicescount=1&project_id="+project_id,function(a){gl_tag_num=parseInt(a.LOC_TAG_NUM);gl_locator_num=parseInt(a.LOC_LOCATOR_NUM);gl_locator_load_index=gl_tag_load_index=0;glTag_List=[];glLocator_List=[];glEmployee_List=[]}).success(function(){setTimeout(load_tag,10);setTimeout(load_locator,20)}).error(function(){}).complete(function(){})}
function load_tag(){0==gl_tag_load_index&&(glTag_List=[],glEmployee_List=[]);$.getJSON(gl_target_server+"/php/vilsnodes.php","loadtag=1&s="+gl_tag_load_index+"&count="+LOAD_DEVICE_NUM+"&project_id="+project_id,function(a){var b=parseInt(a.LOC_TAG_NUM);console.log("tag_num:"+b+", gl_tag_load_index:"+gl_tag_load_index);for(var c=gl_tag_load_index;c<gl_tag_load_index+b;++c){var d="LOC_TAG_INDEX_"+c;void 0!=a[d]&&null!=a[d]&&(d=a[d].split(","),"4"===d[4]?glEmployee_List.push(d):glTag_List.push(d))}gl_tag_load_index+=
b}).success(function(){gl_tag_load_index>=gl_tag_num?(add_tag_to_table(),add_Employee_to_table(),CurrentLoadIndex=1):setTimeout(load_tag,1)}).error(function(){gl_tag_load_index=0;setTimeout(load_tag,UPDATE_INTERVAL)}).complete(function(){})}
function add_tag_to_table(){for(var a=document.getElementById("tag_list_content");1<=a.rows.length;)a.deleteRow(0);for(var b=0;b<glTag_List.length;b++){var c=glTag_List[b],d=c[5],e=c[3],c=c[4],f=document.createElement("tr");a.appendChild(f);var g=document.createElement("td");g.textContent=b+1;g.setAttribute("id","id_row_index_"+e);g.setAttribute("onclick",'click_tag("'+e+'");return false;');f.appendChild(g);g=document.createElement("td");g.setAttribute("id","id_row_node_name_"+e);g.setAttribute("onclick",
'click_tag("'+e+'");return false;');f.appendChild(g);var h=document.createElement("span");h.setAttribute("class","badge bg-green");h.textContent=d;h.setAttribute("onclick",'click_tag("'+e+'");return false;');g.appendChild(h);d=document.createElement("td");d.textContent=get_role_name(c);f.appendChild(d)}}
function add_Employee_to_table(){for(var a=document.getElementById("employee_list_content");1<=a.rows.length;)a.deleteRow(0);for(var b=0;b<glEmployee_List.length;b++){var c=glEmployee_List[b],d=c[5],c=c[3],e=document.createElement("tr");a.appendChild(e);var f=document.createElement("td");f.textContent=b+1;f.setAttribute("id","id_row_index_"+c);f.setAttribute("onclick",'click_employee("'+c+'");return false;');e.appendChild(f);f=document.createElement("td");f.setAttribute("id","id_row_node_name_"+c);
f.setAttribute("onclick",'click_employee("'+c+'");return false;');e.appendChild(f);e=document.createElement("span");e.setAttribute("class","badge bg-green");e.textContent=d;e.setAttribute("onclick",'click_employee("'+c+'");return false;');f.appendChild(e)}}
function load_locator(){0==gl_locator_load_index&&(glLocator_List=[]);$.getJSON(gl_target_server+"/php/vilsnodes.php","loadlocator=1&s="+gl_locator_load_index+"&count="+LOAD_DEVICE_NUM+"&project_id="+project_id,function(a){var b=parseInt(a.LOC_LOCATOR_NUM);console.log("locator_num:"+b+", gl_locator_load_index:"+gl_locator_load_index);for(var c=gl_locator_load_index;c<gl_locator_load_index+b;++c){var d="LOC_LOCATOR_INDEX_"+c;void 0!=a[d]&&null!=a[d]&&(d=a[d].split(","),glLocator_List.push(d))}gl_locator_load_index+=
b}).success(function(){gl_locator_load_index>=gl_locator_num?add_locator_to_table():setTimeout(load_locator,1)}).error(function(){gl_locator_load_index=0;setTimeout(load_locator,UPDATE_INTERVAL)}).complete(function(){})}
function add_locator_to_table(){for(var a=document.getElementById("locator_list_content");1<=a.rows.length;)a.deleteRow(0);console.log("add_locator_to_table() glLocator_List.length:"+glLocator_List.length);for(var b=0;b<glLocator_List.length;b++){var c=glLocator_List[b],d=c[5],e=c[3],c=c[4],f=document.createElement("tr");a.appendChild(f);var g=document.createElement("td");g.textContent=b+1;g.setAttribute("id","id_row_index_"+e);g.setAttribute("onclick",'click_locator("'+e+'");return false;');f.appendChild(g);
g=document.createElement("td");g.setAttribute("id","id_row_node_name_"+e);g.setAttribute("onclick",'click_locator("'+e+'");return false;');f.appendChild(g);var h=document.createElement("span");h.setAttribute("class","badge bg-yellow");h.textContent=d;h.setAttribute("onclick",'click_locator("'+e+'");return false;');g.appendChild(h);d=document.createElement("td");d.textContent=get_buttontype_name(c);f.appendChild(d)}}
function load_system_topic(){document.getElementById("PushNotifyPrefixInputText").value="Loading...";document.getElementById("PushNotifyWelcomeTitleInputText").value="Loading...";document.getElementById("PushNotifyWelcomeBodyInputText").value="Loading...";document.getElementById("EnablePushNotifyCheckBtn").checked=!1;$.getJSON(gl_target_server+"/php/configvils.php","loadsystemconfig=1&project_id="+project_id,function(a){glPushNotifyPrefix=a.PushNotifyPrefix;glPushNotifyWelcomeTitle=a.PushNotifyWelcomeTitle;
glPushNotifyWelcomeBody=a.PushNotifyWelcomeBody;glEnablePushNotify=a.EnablePushNotify;document.getElementById("PushNotifyPrefixInputText").value=a.PushNotifyPrefix;document.getElementById("PushNotifyWelcomeTitleInputText").value=a.PushNotifyWelcomeTitle;document.getElementById("PushNotifyWelcomeBodyInputText").value=a.PushNotifyWelcomeBody;"1"==a.EnablePushNotify&&document.getElementById("EnablePushNotifyCheckBtn").click()}).success(function(){}).error(function(){}).complete(function(){CurrentLoadIndex=
2})}
function click_tag(a){if(!(500>Math.abs((new Date).getTime()-glCurrentDevice_clicktime.getTime())||1==glDataLoading)){glDataLoading=1;glCurrentDevice_clicktime=new Date;for(var b=0;b<glTag_List.length;b++){var c=glTag_List[b],d=c[3],e=c[6],c="background-color:#FFFFFF;";if(0==glCurrentDevice_nodeid.length||a===d)glCurrentDevice_type=DEVICE_TYPE_TAG,glCurrentDevice_nodeid=d,glCurrentDevice_macaddress=e,c="background-color:#CCEEFF;";e=document.getElementById("id_row_index_"+d);d=document.getElementById("id_row_node_name_"+d);
e.setAttribute("style",c);d.setAttribute("style",c)}load_device_record()}}
function click_locator(a){if(!(500>Math.abs((new Date).getTime()-glCurrentDevice_clicktime.getTime())||1==glDataLoading)){glDataLoading=1;glCurrentDevice_clicktime=new Date;for(var b=0;b<glLocator_List.length;b++){var c=glLocator_List[b],d=c[3],e=c[6],c="background-color:#FFFFFF;";if(0==glCurrentDevice_nodeid.length||a===d)glCurrentDevice_type=DEVICE_TYPE_LOCATOR,glCurrentDevice_nodeid=d,glCurrentDevice_macaddress=e,c="background-color:#CCEEFF;";e=document.getElementById("id_row_index_"+d);d=document.getElementById("id_row_node_name_"+
d);e.setAttribute("style",c);d.setAttribute("style",c)}load_device_record()}}
function click_employee(a){if(!(500>Math.abs((new Date).getTime()-glCurrentDevice_clicktime.getTime())||1==glDataLoading)){glDataLoading=1;glCurrentDevice_clicktime=new Date;for(var b=0;b<glEmployee_List.length;b++){var c=glEmployee_List[b],d=c[3],e=c[6],c="background-color:#FFFFFF;";if(0==glCurrentDevice_nodeid.length||a===d)glCurrentDevice_type=DEVICE_TYPE_EMPLOYEE,glCurrentDevice_nodeid=d,glCurrentDevice_macaddress=e,c="background-color:#CCEEFF;";e=document.getElementById("id_row_index_"+d);d=
document.getElementById("id_row_node_name_"+d);e.setAttribute("style",c);d.setAttribute("style",c)}load_device_record()}}function load_device_record(){var a=document.getElementById("record_box_title");void 0!=a&&(a.textContent="Loading...");glCurrentDevice_Records={};glCurrentDevice_TriggerMessage_Records={};glTargetEndDate=glTargetStartDate=null;load_PushNotify_setting(glCurrentDevice_nodeid,glCurrentDevice_macaddress,glCurrentDevice_type)}
function load_PushNotify_setting(a,b,c){$.getJSON(gl_target_server+"/php/pushnotify.php","loadpushnotifysetting=1&project_id="+project_id+"&nodeid="+a,function(a){$.each(a,function(a,b){glCurrentDevice_Records[b.targetid]=0<b.functions.length?b.functions.split(","):[]})}).success(function(){setTimeout(load_PushNotify_triggerMessage,10,a,b,c)}).error(function(){}).complete(function(){})}
function load_PushNotify_triggerMessage(a,b,c){$.getJSON(gl_target_server+"/php/pushnotify.php","loadtriggermessage=1&project_id="+project_id+"&nodeid="+a,function(a){$.each(a,function(a,b){void 0==glCurrentDevice_TriggerMessage_Records[b.nodeid]&&(glCurrentDevice_TriggerMessage_Records[b.nodeid]=[]);glCurrentDevice_TriggerMessage_Records[b.nodeid].push(b)})}).success(function(){var d=document.getElementById("record_box_title");void 0!=d&&(d.textContent=get_node_name(a,c),glCurrentDevice_type==DEVICE_TYPE_LOCATOR?
d.setAttribute("class","badge bg-yellow"):d.setAttribute("class","badge bg-green"));create_PushNotify_setting(a,b,c)}).error(function(){}).complete(function(){glDataLoading=0})}
function create_PushNotify_setting(a,b,c){for(var d=document.getElementById("PUSH_NOTIFY_TABLE_BODY");1<=d.rows.length;)d.deleteRow(0);b=create_topic_item(a,b,c);d.appendChild(b);b=create_setting_item(a,c);d.appendChild(b);c==DEVICE_TYPE_EMPLOYEE?(b=create_tag_list_item(a,c),d.appendChild(b),b=create_locator_list_item(a,c),d.appendChild(b)):c==DEVICE_TYPE_LOCATOR&&(b=create_target_list_item(a,c),d.appendChild(b))}
function get_node_name(a,b){var c=a;b==DEVICE_TYPE_TAG?c=get_node_name_fromlist(glTag_List,a):b==DEVICE_TYPE_LOCATOR?c=get_node_name_fromlist(glLocator_List,a):b==DEVICE_TYPE_EMPLOYEE&&(c=get_node_name_fromlist(glEmployee_List,a));return c}function get_node_name_fromlist(a,b){for(var c=b,d=0;d<a.length;d++){var e=a[d];if(b===e[3]){c=e[5];break}}return c}
function create_topic_item(a,b,c){var d=document.createElement("tr");d.setAttribute("bgcolor","#cce6ff");var e=0;d.appendChild(document.createElement("td"));d.cells[e].appendChild(document.createTextNode("TOPIC"));e++;var f="TAG";c==DEVICE_TYPE_TAG&&(f="TAG");c==DEVICE_TYPE_LOCATOR&&(f="LOCATOR");c==DEVICE_TYPE_EMPLOYEE&&(f="USER");d.appendChild(document.createElement("td"));d.cells[e].appendChild(document.createTextNode(glPushNotifyPrefix+"_"+f+"_"+b));e++;f=get_node_name(a,c);d.appendChild(document.createElement("td"));
a=document.createElement("button");a.setAttribute("type","button");a.setAttribute("class","btn btn-default");a.setAttribute("data-toggle","modal");a.setAttribute("data-target","#modal-qrcode");a.setAttribute("onclick",'device_qrcode_show("'+c+'","'+f+'","'+b+'");return false;');b=document.createElement("i");b.setAttribute("class","fa fa-qrcode");a.appendChild(b);d.cells[e].appendChild(a);return d}
function create_setting_item(a,b){var c=document.createElement("tr");c.setAttribute("bgcolor","#ebebe0");var d=0;c.appendChild(document.createElement("td"));c.cells[d].appendChild(document.createTextNode("SETTING"));d++;var e=void 0;b==DEVICE_TYPE_TAG?e=create_tag_setting_item(a):b==DEVICE_TYPE_LOCATOR?e=create_locator_setting_item(a):b==DEVICE_TYPE_EMPLOYEE&&(e=create_employee_setting_item(a));if(void 0!=e){c.appendChild(e);d++;c.appendChild(document.createElement("td"));e=document.createElement("a");
e.setAttribute("id","EDIT_BTN_"+a);e.setAttribute("href","javascript:;");e.setAttribute("onclick",'edit_function("'+a+'",'+b+" );return false;");var f=document.createElement("i");f.setAttribute("id","EDIT_IMG_"+a);f.setAttribute("class","fa fa-edit");e.appendChild(f);c.cells[d].appendChild(e);return c}}
function create_tag_setting_item(a){var b=document.createElement("td"),c=glCurrentDevice_Records[a];void 0==c&&(c=[]);for(var d=TAG_FUNCTION_START_NUM;d<TAG_FUNCTION_START_NUM+TAG_FUNCTION_NUM;d++){var e=get_tag_function_name(d),e=create_function_item(d,e,a,c);b.appendChild(e)}return b}
function create_locator_setting_item(a){var b=document.createElement("td"),c=glCurrentDevice_Records[a];void 0==c&&(c=[]);for(var d=LOCATOR_FUNCTION_START_NUM;d<LOCATOR_FUNCTION_START_NUM+LOCATOR_FUNCTION_NUM;d++){var e=get_locator_function_name(d),e=create_function_item(d,e,a,c);b.appendChild(e)}return b}
function create_employee_setting_item(a){var b=document.createElement("td"),c=glCurrentDevice_Records[a];void 0==c&&(c=[]);for(var d=EMPLOYEE_FUNCTION_START_NUM;d<EMPLOYEE_FUNCTION_START_NUM+EMPLOYEE_FUNCTION_NUM;d++){var e=get_employee_function_name(d),e=create_function_item(d,e,a,c);b.appendChild(e)}return b}
function create_tag_list_item(a,b){var c=document.createElement("tr");c.setAttribute("bgcolor","#cce6ff");var d=0;c.appendChild(document.createElement("td"));c.cells[d].appendChild(document.createTextNode("\u8a02\u95b1Tag\u5217\u8868"));d++;var e=document.createElement("td");c.appendChild(e);var f=document.createElement("table");f.setAttribute("class","table table-bordered");e.appendChild(f);d++;e=document.createElement("tbody");f.appendChild(e);f=document.createElement("tr");e.appendChild(f);for(var g=
0;g<glTag_List.length;g++){var h=glTag_List[g],l=h[5],m=glCurrentDevice_Records[h[3]];void 0==m&&(m=[]);0!=g&&0==g%5&&(f=document.createElement("tr"),e.appendChild(f));h=document.createElement("td");f.appendChild(h);var n=!0;0==m.length&&(n=!1);var k=document.createElement("input");k.setAttribute("id","checkbox_taglist_"+g+"_"+a);k.setAttribute("type","checkbox");k.setAttribute("class","flat-red");n&&k.setAttribute("checked",!0);k.setAttribute("disabled",!0);h.appendChild(k);k=document.createElement("span");
k.setAttribute("onclick",'taglist_onclick("'+a+'", '+g+");return false;");k.setAttribute("id","badge_taglist_"+g+"_"+a);n?k.setAttribute("class","badge bg-green"):(k.setAttribute("class","badge bg-teal"),k.setAttribute("style","opacity:0.3;"));k.textContent=l;h.appendChild(k);l=create_taglist_dropdown_list(a,g,m,n);h.appendChild(l)}c.appendChild(document.createElement("td"));e=document.createElement("a");e.setAttribute("id","EDIT_TAGLIST_BTN_"+a);e.setAttribute("href","javascript:;");e.setAttribute("onclick",
'edit_taglist_function("'+a+'");return false;');f=document.createElement("i");f.setAttribute("id","EDIT_TAGLIST_IMG_"+a);f.setAttribute("class","fa fa-edit");e.appendChild(f);c.cells[d].appendChild(e);e=document.createElement("button");e.setAttribute("type","button");e.setAttribute("style","display:none");e.setAttribute("id","SEL_ALL_TAGLIST_BTN_"+a);e.setAttribute("href","javascript:;");e.setAttribute("onclick",'select_all_taglist_function("'+a+'");return false;');e.textContent="\u5168\u9078";c.cells[d].appendChild(e);
e=document.createElement("button");e.setAttribute("type","button");e.setAttribute("style","display:none");e.setAttribute("id","UNSEL_ALL_TAGLIST_BTN_"+a);e.setAttribute("href","javascript:;");e.setAttribute("onclick",'unselect_all_taglist_function("'+a+'");return false;');e.textContent="\u5168\u4e0d\u9078";c.cells[d].appendChild(e);return c}
function create_locator_list_item(a,b){var c=document.createElement("tr");c.setAttribute("bgcolor","#ebebe0");var d=0;c.appendChild(document.createElement("td"));c.cells[d].appendChild(document.createTextNode("\u8a02\u95b1Locator\u5217\u8868"));d++;var e=document.createElement("td");c.appendChild(e);var f=document.createElement("table");f.setAttribute("class","table table-bordered");e.appendChild(f);d++;e=document.createElement("tbody");f.appendChild(e);f=document.createElement("tr");e.appendChild(f);
for(var g=0;g<glLocator_List.length;g++){var h=glLocator_List[g],l=h[5],m=glCurrentDevice_Records[h[3]];void 0==m&&(m=[]);0!=g&&0==g%5&&(f=document.createElement("tr"),e.appendChild(f));h=document.createElement("td");f.appendChild(h);var n=!0;0==m.length&&(n=!1);var k=document.createElement("input");k.setAttribute("id","checkbox_locatorlist_"+g+"_"+a);k.setAttribute("type","checkbox");k.setAttribute("class","flat-red");n&&k.setAttribute("checked",!0);k.setAttribute("disabled",!0);h.appendChild(k);
k=document.createElement("span");k.setAttribute("onclick",'locatorlist_onclick("'+a+'", '+g+");return false;");k.setAttribute("id","badge_locatorlist_"+g+"_"+a);n?k.setAttribute("class","badge bg-yellow"):(k.setAttribute("class","badge bg-yellow"),k.setAttribute("style","opacity:0.3;"));k.textContent=l;h.appendChild(k);l=create_locatorlist_dropdown_list(a,g,m,n);h.appendChild(l)}c.appendChild(document.createElement("td"));e=document.createElement("a");e.setAttribute("id","EDIT_LOCATORLIST_BTN_"+a);
e.setAttribute("href","javascript:;");e.setAttribute("onclick",'edit_locatorlist_function("'+a+'");return false;');f=document.createElement("i");f.setAttribute("id","EDIT_LOCATORLIST_IMG_"+a);f.setAttribute("class","fa fa-edit");e.appendChild(f);c.cells[d].appendChild(e);e=document.createElement("button");e.setAttribute("type","button");e.setAttribute("style","display:none");e.setAttribute("id","SEL_ALL_LOCATORLIST_BTN_"+a);e.setAttribute("href","javascript:;");e.setAttribute("onclick",'select_all_locatorlist_function("'+
a+'");return false;');e.textContent="\u5168\u9078";c.cells[d].appendChild(e);e=document.createElement("button");e.setAttribute("type","button");e.setAttribute("style","display:none");e.setAttribute("id","UNSEL_ALL_LOCATORLIST_BTN_"+a);e.setAttribute("href","javascript:;");e.setAttribute("onclick",'unselect_all_locatorlist_function("'+a+'");return false;');e.textContent="\u5168\u4e0d\u9078";c.cells[d].appendChild(e);return c}
function create_target_list_item(a,b){var c=document.createElement("tr");c.setAttribute("bgcolor","#cce6ff");var d=0;c.appendChild(document.createElement("td"));c.cells[d].appendChild(document.createTextNode("\u4e0d\u7279\u5b9a\u5c0d\u8c61\u63a8\u64ad\u8a2d\u5b9a"));d++;var e=document.createElement("td");c.appendChild(e);var f=document.createElement("table");f.setAttribute("class","table table-bordered");e.appendChild(f);d++;e=createTargetListHead();f.appendChild(e);e=document.createElement("tbody");
e.setAttribute("bgcolor","#c4d7de");f.appendChild(e);f=glCurrentDevice_TriggerMessage_Records[a];for(b=0;7>b;b++){var g=!1;if(null!=f)for(var h=0;h<f.length;h++){var l=f[h];if(l.targettype==b){g=!1;1==l.enable&&(g=!0);l=createTargetListSetting(b,a,g,l.distance,l.title,l.message);e.appendChild(l);g=!0;break}}0==g&&(l=createTargetListSetting(b,a,!1,1E3,"\u63a8\u64ad\u8a0a\u606f Title","\u63a8\u64ad\u8a0a\u606f\u5167\u5bb9"),e.appendChild(l))}c.appendChild(document.createElement("td"));e=document.createElement("a");
e.setAttribute("id","EDIT_TARGETLIST_BTN_"+a);e.setAttribute("href","javascript:;");e.setAttribute("onclick",'edit_targetlist_function("'+a+'");return false;');f=document.createElement("i");f.setAttribute("id","EDIT_TARGETLIST_IMG_"+a);f.setAttribute("class","fa fa-edit");e.appendChild(f);c.cells[d].appendChild(e);return c}function create_function_item(a,b,c,d){return-1<d.indexOf(""+a)?create_checkbox_item(a,b,c,!0,!1):create_checkbox_item(a,b,c,!1,!1)}
function create_checkbox_item(a,b,c,d,e){var f=document.createElement("div");f.setAttribute("class","form-group");var g=document.createElement("p");d?g.setAttribute("class","text-green"):g.setAttribute("class","text-muted");f.appendChild(g);var h=document.createElement("label");g.appendChild(h);g=document.createElement("input");g.setAttribute("id","checkbox_"+a+"_"+c);g.setAttribute("type","checkbox");g.setAttribute("class","flat-red");d&&g.setAttribute("checked",!0);e||g.setAttribute("disabled",
!0);h.appendChild(g);h.appendChild(document.createTextNode(" "+b));return f}
function createTargetListHead(){var a=document.createElement("thead");a.setAttribute("bgcolor","#98cbfc");var b=document.createElement("tr");a.appendChild(b);var c=document.createElement("th");c.textContent="\u555f\u7528\u529f\u80fd";c.setAttribute("style","width:80px;");b.appendChild(c);c=document.createElement("th");c.textContent="\u88dd\u7f6e\u985e\u578b";b.appendChild(c);c=document.createElement("th");c.textContent="\u89f8\u767c\u8ddd\u96e2";b.appendChild(c);c=document.createElement("th");c.textContent=
"\u63a8\u64ad\u8a0a\u606f Title";b.appendChild(c);c=document.createElement("th");c.textContent="\u63a8\u64ad\u8a0a\u606f\u5167\u5bb9";b.appendChild(c);return a}
function createTargetListSetting(a,b,c,d,e,f){var g=document.createElement("tr");1==a%2&&g.setAttribute("bgcolor","#d5d8da");var h=document.createElement("td");g.appendChild(h);c=create_checkbox_item("TargetList_"+a,"",b,c,!1);h.appendChild(c);h=document.createElement("td");h.textContent=get_target_type_name(""+a);g.appendChild(h);h=document.createElement("td");g.appendChild(h);c=document.createElement("strong");c.setAttribute("id","TargetList_"+a+"_"+b+"_distance");c.setAttribute("style","font-weight:bold;");
c.innerHTML=d;h.appendChild(c);d=document.createElement("td");g.appendChild(d);h=document.createElement("strong");h.setAttribute("id","TargetList_"+a+"_"+b+"_title");h.setAttribute("style","font-weight:bold;");h.innerHTML=e;d.appendChild(h);e=document.createElement("td");g.appendChild(e);d=document.createElement("strong");d.setAttribute("id","TargetList_"+a+"_"+b+"_message");d.setAttribute("style","font-weight:bold;");d.innerHTML=f;e.appendChild(d);return g}
function get_tag_function_name(a){var b="";switch(a){case 1:b="\u975e\u8a2d\u5099\u6587\u5b57\u8a0a\u606f, \u5982\u91ab\u56d1\u7b49";break;case 2:b="\u7dca\u6025\u6c42\u52a9\u8207\u53d6\u6d88\u901a\u77e5";break;case 3:b="\u4f4e\u96fb\u91cf\u901a\u77e5";break;case 4:b="\u9032\u5165(\u96e2\u958b)\u5371\u96aa\u5340\u901a\u77e5, \u8eab\u4efd\u70ba\u5de5\u4f5c\u4eba\u54e1\u6642\u4e0d\u901a\u77e5";break;case 5:b="\u5de1\u6aa2\u76f8\u95dc\u901a\u77e5, \u8eab\u4efd\u70ba\u5de1\u6aa2\u54e1\u6642\u624d\u6709\u901a\u77e5";
break;case 6:b="\u672a\u6b63\u5e38\u914d\u6234\u901a\u77e5";break;case 7:b="\u9032\u51fa\u5340\u57df\u4e8b\u4ef6, \u9700\u8981\u5728\u4e8b\u4ef6\u5217\u8868\u8a2d\u5b9a\u624d\u6709\u901a\u77e5";break;case 8:b="\u8ab2\u7a0b\u9ede\u540d\u901a\u77e5, \u5305\u542b\u4e0a\u8ab2\u4e2d\u9032\u51fa\u901a\u77e5";break;case 9:b="GPS\u6d3b\u52d5\u8d85\u904e\u5340\u57df\u7bc4\u570d\u901a\u77e5";break;case 10:b="\u4e0d\u7279\u5b9a\u5c0d\u8c61\u63a8\u64ad";break;case 11:b="\u8a2d\u5099\u65e5\u8a8c\u76f8\u95dc\u901a\u77e5"}return b}
function get_locator_function_name(a){var b="";switch(a){case 101:b="\u975e\u8a2d\u5099\u6587\u5b57\u8a0a\u606f, \u5982\u91ab\u56d1\u7b49";break;case 102:b="\u7dca\u6025\u6c42\u52a9\u8207\u53d6\u6d88\u901a\u77e5";break;case 103:b="\u547c\u559a\u8207\u53d6\u6d88\u901a\u77e5";break;case 104:b="\u91ab\u751f\u9032\u51fa\u75c5\u623f\u8207\u75c5\u5e8a\u5340\u57df\u901a\u77e5";break;case 105:b="\u65b7\u96fb\u8b66\u5831";break;case 106:b="\u5468\u908a\u6a21\u7d44\u8a0a\u606f\uff0c\u5982\u4e0d\u660e\u7269\u9ad4\u79fb\u52d5\u3001\u7159\u9727\u63a2\u6e2c"}return b}
function get_employee_function_name(a){var b="";switch(a){case 1:b="\u975e\u8a2d\u5099\u6587\u5b57\u8a0a\u606f, \u5982\u91ab\u56d1\u7b49";break;case 2:b="\u7dca\u6025\u6c42\u52a9\u8207\u53d6\u6d88\u901a\u77e5";break;case 3:b="\u4f4e\u96fb\u91cf\u901a\u77e5";break;case 4:b="\u9032\u5165(\u96e2\u958b)\u5371\u96aa\u5340\u901a\u77e5, \u8eab\u4efd\u70ba\u5de5\u4f5c\u4eba\u54e1\u6642\u4e0d\u901a\u77e5";break;case 5:b="\u5de1\u6aa2\u76f8\u95dc\u901a\u77e5, \u8eab\u4efd\u70ba\u5de1\u6aa2\u54e1\u6642\u624d\u6709\u901a\u77e5";
break;case 6:b="\u672a\u6b63\u5e38\u914d\u6234\u901a\u77e5";break;case 7:b="\u9032\u51fa\u5340\u57df\u4e8b\u4ef6, \u9700\u8981\u5728\u4e8b\u4ef6\u5217\u8868\u8a2d\u5b9a\u624d\u6709\u901a\u77e5";break;case 8:b="\u8ab2\u7a0b\u9ede\u540d\u901a\u77e5, \u5305\u542b\u4e0a\u8ab2\u4e2d\u9032\u51fa\u901a\u77e5";break;case 9:b="GPS\u6d3b\u52d5\u8d85\u904e\u5340\u57df\u7bc4\u570d\u901a\u77e5"}return b}
function get_target_type_name(a){var b="";switch(a){case "0":b="\u4eba\u54e1\u8a2a\u5ba2";break;case "1":b="\u5de1\u6aa2\u54e1";break;case "2":b="\u8a2d\u5099";break;case "3":b="VIP\u8cb4\u8cd3";break;case "4":b="\u5de5\u4f5c\u4eba\u54e1";break;case "5":b="\u91ab\u5e2b";break;case "6":b="\u8b77\u7406\u5e2b"}return b}
function edit_function(a,b){b==DEVICE_TYPE_TAG?enable_edit_functions(a,TAG_FUNCTION_START_NUM,TAG_FUNCTION_NUM):b==DEVICE_TYPE_LOCATOR?enable_edit_functions(a,LOCATOR_FUNCTION_START_NUM,LOCATOR_FUNCTION_NUM):b==DEVICE_TYPE_EMPLOYEE&&enable_edit_functions(a,EMPLOYEE_FUNCTION_START_NUM,EMPLOYEE_FUNCTION_NUM);document.getElementById("EDIT_BTN_"+a).setAttribute("onclick",'save_function("'+a+'",'+b+" );return false;");document.getElementById("EDIT_IMG_"+a).setAttribute("class","fa fa-save")}
function enable_edit_functions(a,b,c){for(var d=b;d<b+c;d++)document.getElementById("checkbox_"+d+"_"+a).removeAttribute("disabled")}
function edit_taglist_function(a){for(var b=0;b<glTag_List.length;b++){var c=document.getElementById("checkbox_taglist_"+b+"_"+a);void 0!=c&&c.removeAttribute("disabled");c=document.getElementById("dropdown_cur_tag_"+b+"_"+a);void 0!=c&&c.removeAttribute("disabled");for(c=TAG_FUNCTION_START_NUM;c<TAG_FUNCTION_START_NUM+TAG_FUNCTION_NUM;c++){var d=document.getElementById("dropdown_checkbox_tag_function_"+c+"_"+b+"_"+a);void 0!=d&&d.removeAttribute("disabled")}}document.getElementById("EDIT_TAGLIST_BTN_"+
a).setAttribute("onclick",'save_taglist_function("'+a+'");return false;');document.getElementById("EDIT_TAGLIST_IMG_"+a).setAttribute("class","fa fa-save");document.getElementById("SEL_ALL_TAGLIST_BTN_"+a).setAttribute("style","display:block");document.getElementById("UNSEL_ALL_TAGLIST_BTN_"+a).setAttribute("style","display:block")}
function edit_locatorlist_function(a){for(var b=0;b<glLocator_List.length;b++){var c=document.getElementById("checkbox_locatorlist_"+b+"_"+a);void 0!=c&&c.removeAttribute("disabled");c=document.getElementById("dropdown_cur_locator_"+b+"_"+a);void 0!=c&&c.removeAttribute("disabled");for(c=LOCATOR_FUNCTION_START_NUM;c<LOCATOR_FUNCTION_START_NUM+LOCATOR_FUNCTION_NUM;c++){var d=document.getElementById("dropdown_checkbox_locator_function_"+c+"_"+b+"_"+a);void 0!=d&&d.removeAttribute("disabled")}}document.getElementById("EDIT_LOCATORLIST_BTN_"+
a).setAttribute("onclick",'save_locatorlist_function("'+a+'");return false;');document.getElementById("EDIT_LOCATORLIST_IMG_"+a).setAttribute("class","fa fa-save");document.getElementById("SEL_ALL_LOCATORLIST_BTN_"+a).setAttribute("style","display:block");document.getElementById("UNSEL_ALL_LOCATORLIST_BTN_"+a).setAttribute("style","display:block")}
function edit_targetlist_function(a){for(var b=glCurrentDevice_TriggerMessage_Records[a],c=0;7>c;c++){var d=document.getElementById("checkbox_TargetList_"+c+"_"+a);void 0!=d&&d.removeAttribute("disabled");var e="",f="",d="";if(null!=b)for(var g=0;g<b.length;g++){var h=b[g];if(h.targettype==c){e=h.distance;f=h.title;d=h.message;break}}g=document.getElementById("TargetList_"+c+"_"+a+"_distance");g.setAttribute("style","font-weight:bold;border:thin dotted red;");g.setAttribute("onclick","TargetList_distance_onclick("+
c+', "'+a+'", "'+e+'");return false;');e=document.getElementById("TargetList_"+c+"_"+a+"_title");e.setAttribute("style","font-weight:bold;border:thin dotted red;");e.setAttribute("onclick","TargetList_title_onclick("+c+', "'+a+'", "'+f+'");return false;');f=document.getElementById("TargetList_"+c+"_"+a+"_message");f.setAttribute("style","font-weight:bold;border:thin dotted red;");f.setAttribute("onclick","TargetList_message_onclick("+c+', "'+a+'", "'+d+'");return false;')}document.getElementById("EDIT_TARGETLIST_BTN_"+
a).setAttribute("onclick",'save_targetlist_function("'+a+'");return false;');document.getElementById("EDIT_TARGETLIST_IMG_"+a).setAttribute("class","fa fa-save")}
function save_taglist_function(a){document.getElementById("EDIT_TAGLIST_BTN_"+a).setAttribute("onclick",'edit_taglist_function("'+a+'");return false;');document.getElementById("EDIT_TAGLIST_IMG_"+a).setAttribute("class","fa fa-edit");document.getElementById("SEL_ALL_TAGLIST_BTN_"+a).setAttribute("style","display:none");document.getElementById("UNSEL_ALL_TAGLIST_BTN_"+a).setAttribute("style","display:none");var b=get_taglist_functions(a,TAG_FUNCTION_START_NUM,TAG_FUNCTION_NUM);update_PushNotify(a,
b)}function get_taglist_functions(a,b,c){for(var d={},e=0;e<glTag_List.length;e++){var f=glTag_List[e][3],g=[];if(document.getElementById("checkbox_taglist_"+e+"_"+a).checked)for(var h=b;h<b+c;h++){var l=document.getElementById("dropdown_checkbox_tag_function_"+h+"_"+e+"_"+a);void 0!=l&&l.checked&&g.push(""+h)}d[f]=g.toString()}return d}
function save_locatorlist_function(a){document.getElementById("EDIT_LOCATORLIST_BTN_"+a).setAttribute("onclick",'edit_locatorlist_function("'+a+'");return false;');document.getElementById("EDIT_LOCATORLIST_IMG_"+a).setAttribute("class","fa fa-edit");document.getElementById("SEL_ALL_LOCATORLIST_BTN_"+a).setAttribute("style","display:none");document.getElementById("UNSEL_ALL_LOCATORLIST_BTN_"+a).setAttribute("style","display:none");var b=get_locatorlist_functions(a,LOCATOR_FUNCTION_START_NUM,LOCATOR_FUNCTION_NUM);
update_PushNotify(a,b)}function get_locatorlist_functions(a,b,c){for(var d={},e=0;e<glLocator_List.length;e++){var f=glLocator_List[e][3],g=[];if(document.getElementById("checkbox_locatorlist_"+e+"_"+a).checked)for(var h=b;h<b+c;h++){var l=document.getElementById("dropdown_checkbox_locator_function_"+h+"_"+e+"_"+a);void 0!=l&&l.checked&&g.push(""+h)}d[f]=g.toString()}return d}
function save_targetlist_function(a){document.getElementById("EDIT_TARGETLIST_BTN_"+a).setAttribute("onclick",'edit_targetlist_function("'+a+'");return false;');document.getElementById("EDIT_TARGETLIST_IMG_"+a).setAttribute("class","fa fa-edit");var b=get_targetlist_functions(a);update_TriggerMessage(a,b)}
function get_targetlist_functions(a){for(var b={},c=0;7>c;c++){var d=""+c,e={};console.log("save_targetlist_function() enable type:"+c);var f=document.getElementById("TargetList_"+c+"_"+a+"_distance").textContent,g=document.getElementById("TargetList_"+c+"_"+a+"_title").textContent,h=document.getElementById("TargetList_"+c+"_"+a+"_message").textContent;console.log("save_targetlist_function() distance:"+f+" title:"+g+" message:"+h);document.getElementById("checkbox_TargetList_"+c+"_"+a).checked?e.enable=
1:e.enable=0;e.distance=f;e.title=g;e.message=h;b[d]=e}return b}function taglist_onclick(a,b){var c=document.getElementById("checkbox_taglist_"+b+"_"+a);if(!c.getAttribute("disabled")){c.checked=!c.checked;var d=document.getElementById("badge_taglist_"+b+"_"+a);c.checked?d.setAttribute("style","opacity:1.0;"):d.setAttribute("style","opacity:0.3;")}}
function locatorlist_onclick(a,b){var c=document.getElementById("checkbox_locatorlist_"+b+"_"+a);if(!c.getAttribute("disabled")){c.checked=!c.checked;var d=document.getElementById("badge_locatorlist_"+b+"_"+a);c.checked?d.setAttribute("style","opacity:1.0;"):d.setAttribute("style","opacity:0.3;")}}
function select_all_taglist_function(a){for(var b=0;b<glTag_List.length;b++)document.getElementById("checkbox_taglist_"+b+"_"+a).checked=!0,document.getElementById("badge_taglist_"+b+"_"+a).setAttribute("style","opacity:1.0;")}function unselect_all_taglist_function(a){for(var b=0;b<glTag_List.length;b++)document.getElementById("checkbox_taglist_"+b+"_"+a).checked=!1,document.getElementById("badge_taglist_"+b+"_"+a).setAttribute("style","opacity:0.3;")}
function select_all_locatorlist_function(a){for(var b=0;b<glLocator_List.length;b++)document.getElementById("checkbox_locatorlist_"+b+"_"+a).checked=!0,document.getElementById("badge_locatorlist_"+b+"_"+a).setAttribute("style","opacity:1.0;")}function unselect_all_locatorlist_function(a){for(var b=0;b<glLocator_List.length;b++)document.getElementById("checkbox_locatorlist_"+b+"_"+a).checked=!1,document.getElementById("badge_locatorlist_"+b+"_"+a).setAttribute("style","opacity:0.3;")}
function create_taglist_dropdown_list(a,b,c,d){var e=document.createElement("div");e.setAttribute("class","btn-group");var f=document.createElement("button");f.setAttribute("type","button");f.setAttribute("class","btn btn-default btn-sm dropdown-toggle");f.setAttribute("data-toggle","dropdown");f.setAttribute("id","dropdown_cur_tag_"+b+"_"+a);d||f.setAttribute("disabled",!0);e.appendChild(f);d=document.createElement("span");d.setAttribute("class","caret");f.appendChild(d);f=document.createElement("ul");
f.setAttribute("class","dropdown-menu");f.setAttribute("id","dropdown_tag_"+b+"_"+a);e.appendChild(f);for(var g=TAG_FUNCTION_START_NUM;g<TAG_FUNCTION_START_NUM+TAG_FUNCTION_NUM;g++){var h=c.indexOf(""+g);d=!0;0>h&&(d=!1);d=create_dropdown_tag_item(g,a,b,get_tag_function_name(g),d);f.appendChild(d)}return e}
function create_dropdown_tag_item(a,b,c,d,e){var f=document.createElement("li"),g=document.createElement("a");g.setAttribute("class","small");g.setAttribute("tabIndex","-1");g.setAttribute("data-value",a);g.setAttribute("href","javascript:;");g.setAttribute("onclick","dropdown_tag_function_click("+a+',"'+b+'", '+c+");return true;");var h=document.createElement("input");h.setAttribute("type","checkbox");h.setAttribute("id","dropdown_checkbox_tag_function_"+a+"_"+c+"_"+b);h.setAttribute("onclick","dropdown_checkbox_tag_function_click("+
a+',"'+b+'", '+c+");return true;");h.setAttribute("disabled",!0);h.checked=e;g.appendChild(h);a=document.createElement("label");e?a.setAttribute("class","text-green"):a.setAttribute("class","text-muted");a.appendChild(document.createTextNode(" "+d));g.appendChild(a);f.appendChild(g);return f}var glDropdown_checkbox_tag_function_click=!1;
function dropdown_tag_function_click(a,b,c){glDropdown_checkbox_tag_function_click||(a=document.getElementById("dropdown_checkbox_tag_function_"+a+"_"+c+"_"+b),a.checked=a.checked?!1:!0);glDropdown_checkbox_tag_function_click=!1}function dropdown_checkbox_tag_function_click(a,b,c){glDropdown_checkbox_tag_function_click=!0}
function create_locatorlist_dropdown_list(a,b,c,d){var e=document.createElement("div");e.setAttribute("class","btn-group");var f=document.createElement("button");f.setAttribute("type","button");f.setAttribute("class","btn btn-default btn-sm dropdown-toggle");f.setAttribute("data-toggle","dropdown");f.setAttribute("id","dropdown_cur_locator_"+b+"_"+a);d||f.setAttribute("disabled",!0);e.appendChild(f);d=document.createElement("span");d.setAttribute("class","caret");f.appendChild(d);f=document.createElement("ul");
f.setAttribute("class","dropdown-menu");f.setAttribute("id","dropdown_locator_"+b+"_"+a);e.appendChild(f);for(var g=LOCATOR_FUNCTION_START_NUM;g<LOCATOR_FUNCTION_START_NUM+LOCATOR_FUNCTION_NUM;g++){var h=c.indexOf(""+g);d=!0;0>h&&(d=!1);d=create_dropdown_locator_item(g,a,b,get_locator_function_name(g),d);f.appendChild(d)}return e}
function create_dropdown_locator_item(a,b,c,d,e){var f=document.createElement("li"),g=document.createElement("a");g.setAttribute("class","small");g.setAttribute("tabIndex","-1");g.setAttribute("data-value",a);g.setAttribute("href","javascript:;");g.setAttribute("onclick","dropdown_locator_function_click("+a+',"'+b+'", '+c+");return true;");var h=document.createElement("input");h.setAttribute("type","checkbox");h.setAttribute("id","dropdown_checkbox_locator_function_"+a+"_"+c+"_"+b);h.setAttribute("onclick",
"dropdown_checkbox_locator_function_click("+a+',"'+b+'", '+c+");return true;");h.setAttribute("disabled",!0);h.checked=e;g.appendChild(h);a=document.createElement("label");e?a.setAttribute("class","text-green"):a.setAttribute("class","text-muted");a.appendChild(document.createTextNode(" "+d));g.appendChild(a);f.appendChild(g);return f}var glDropdown_checkbox_locator_function_click=!1;
function dropdown_locator_function_click(a,b,c){glDropdown_checkbox_locator_function_click||(a=document.getElementById("dropdown_checkbox_locator_function_"+a+"_"+c+"_"+b),a.checked=a.checked?!1:!0);glDropdown_checkbox_locator_function_click=!1}function dropdown_checkbox_locator_function_click(a,b,c){glDropdown_checkbox_locator_function_click=!0}
function TargetList_distance_onclick(a,b,c){if(c=prompt("Edit Distance:",c)){console.log("TargetList_distance_onclick() newValue:"+c);var d=document.getElementById("TargetList_"+a+"_"+b+"_distance");d.innerHTML=c;d.setAttribute("onclick","TargetList_distance_onclick("+a+', "'+b+'", "'+c+'");return false;')}}
function TargetList_title_onclick(a,b,c){if(c=prompt("Edit Title:",c)){console.log("TargetList_title_onclick() newValue:"+c);var d=document.getElementById("TargetList_"+a+"_"+b+"_title");d.innerHTML=c;d.setAttribute("onclick","TargetList_title_onclick("+a+', "'+b+'", "'+c+'");return false;')}}
function TargetList_message_onclick(a,b,c){if(c=prompt("Edit Message:",c)){console.log("TargetList_message_onclick() newValue:"+c);var d=document.getElementById("TargetList_"+a+"_"+b+"_message");d.innerHTML=c;d.setAttribute("onclick","TargetList_message_onclick("+a+', "'+b+'", "'+c+'");return false;')}}
function save_function(a,b){document.getElementById("EDIT_BTN_"+a).setAttribute("onclick",'edit_function("'+a+'", '+b+");return false;");document.getElementById("EDIT_IMG_"+a).setAttribute("class","fa fa-edit");var c=[];b==DEVICE_TYPE_TAG?c=get_new_functions(a,TAG_FUNCTION_START_NUM,TAG_FUNCTION_NUM):b==DEVICE_TYPE_LOCATOR?c=get_new_functions(a,LOCATOR_FUNCTION_START_NUM,LOCATOR_FUNCTION_NUM):b==DEVICE_TYPE_EMPLOYEE&&(c=get_new_functions(a,EMPLOYEE_FUNCTION_START_NUM,EMPLOYEE_FUNCTION_NUM));update_PushNotify(a,
c.toString())}function get_new_functions(a,b,c){for(var d=[],e=b;e<b+c;e++)document.getElementById("checkbox_"+e+"_"+a).checked&&d.push(""+e);return d}
function update_PushNotify(a,b){var c={};c.project_id=""+project_id;c.UPDATE_PUSHNOTIFY=1;c.FUNCTIONS=b;c.ACCOUNT=a;jQuery.ajax({url:gl_target_server+"/php/pushnotify.php",type:"POST",data:c,success:function(a){load_device_record();400==a.status&&alert("update Error! response = "+JSON.stringify(a))},error:function(a,b,c){load_device_record();alert("error = "+c);alert("xhr.responseText = "+a.responseText)}});return!1}
function update_TriggerMessage(a,b){var c={};c.project_id=""+project_id;c.UPDATE_TRIGGERMESSAGE=1;c.FUNCTIONS=b;c.ACCOUNT=a;console.log("update_TriggerMessage() nodeid:"+a+", functions:"+JSON.stringify(b));jQuery.ajax({url:gl_target_server+"/php/pushnotify.php",type:"POST",data:c,success:function(a){load_device_record();400==a.status&&alert("update Error! response = "+JSON.stringify(a))},error:function(a,b,c){load_device_record();alert("error = "+c);alert("xhr.responseText = "+a.responseText)}});
return!1}
$("#pushnotifyconfigupdatebtn").click(function(){var a=document.getElementById("PushNotifyPrefixInputText").value,b=document.getElementById("PushNotifyWelcomeTitleInputText").value,c=document.getElementById("PushNotifyWelcomeBodyInputText").value,d=0;document.getElementById("EnablePushNotifyCheckBtn").checked&&(d=1);document.getElementById("pushnotifyconfigupdatebtn").disabled=!0;var e;e="project_id="+project_id;e=e+"&"+("setpushnotifyprefix="+a)+"&"+("setpushnotifywelcometitle="+b);e+="&";e+="setpushnotifywelcomebody="+
c;e+="&";e+="setenablepushnotify="+d;jQuery.ajax({url:gl_target_server+"/php/pushnotify.php",type:"POST",data:e,dataType:"text",success:function(a){},error:function(a,b,c){},complete:function(){check_pushnotifyconfig_update()}});return!1});
function check_pushnotifyconfig_update(){$.getJSON(gl_target_server+"/php/configvils.php","loadsystemconfig=1&project_id="+project_id,function(a){var b;b=0+(document.getElementById("PushNotifyPrefixInputText").value!=a.PushNotifyPrefix);b+=document.getElementById("PushNotifyWelcomeTitleInputText").value!=a.PushNotifyWelcomeTitle;b+=document.getElementById("PushNotifyWelcomeBodyInputText").value!=a.PushNotifyWelcomeBody;"1"!=a.EnablePushNotify||document.getElementById("EnablePushNotifyCheckBtn").checked||
(b+=1);"0"==a.EnablePushNotify&&document.getElementById("EnablePushNotifyCheckBtn").checked&&(b+=1);console.log("check_pushnotifyconfig_update() difference:"+b);0<b?(document.getElementById("pushnotifyconfig_warning_callout").style.display="block",setTimeout(check_pushnotifyconfig_update,1E3)):(console.log("check_pushnotifyconfig_update() update successfully!"),document.getElementById("pushnotifyconfig_warning_callout").style.display="none",document.getElementById("pushnotifyconfigupdate_callout").style.display=
"block",setTimeout(close_callout,2500,"pushnotifyconfigupdate_callout"),document.getElementById("pushnotifyconfigupdatebtn").disabled=!1)})}function close_callout(a){document.getElementById(a).style.display="none"}
function add_search_tag_to_table(a){for(var b=document.getElementById("search_list_content");1<=b.rows.length;)b.deleteRow(0);for(var c=0;c<glTag_List.length;c++){var d=glTag_List[c],e=d[5],d=d[3];if(!(0>e.indexOf(a))){var f=document.createElement("tr");b.appendChild(f);var g=document.createElement("td");g.setAttribute("id","id_row_node_name_"+d);g.setAttribute("onclick",'click_tag("'+d+'");return false;');f.appendChild(g);f=document.createElement("span");f.setAttribute("class","badge bg-green");
f.textContent=e;f.setAttribute("onclick",'click_tag("'+d+'");return false;');g.appendChild(f)}}}function loc_tab_search_text_change(a){a=document.getElementById("loc_tab_search_text").value;add_search_tag_to_table(a);setCookie("vilspushnotify_search_text",a,10)}
function device_qrcode_show(a,b,c){console.log("device_qrcode_show() type:"+a+" device_name:"+b+" device_macaddress:"+c);var d="TAG";"1"===a&&(d="TAG");"2"===a&&(d="USER");"3"===a&&(d="LOCATOR");document.getElementById("device_qrcode_type").textContent=d;document.getElementById("device_qrcode_name").textContent=b;document.getElementById("device_qrcode_macaddress").textContent=c;jQuery.ajax({url:gl_target_server+"/php/configvils.php",type:"POST",data:"loadqrcode=1&type="+d+"&accountid="+c+"&id="+c+
"&project_id="+project_id,dataType:"text",success:function(a){a=JSON.parse(a);document.getElementById("device_qrcode_ui").setAttribute("src",a.qrcode)}})}function check_cookies(){var a=getCookie("vilspushnotify_search_text");document.getElementById("loc_tab_search_text").value=a;add_search_tag_to_table(a)}var $source=document.querySelector("#loc_tab_search_text");$source.addEventListener("input",loc_tab_search_text_change);
function setCookie(a,b,c){var d="";c&&(d=new Date,d.setTime(d.getTime()+864E5*c),d="; expires="+d.toUTCString());document.cookie=a+"="+(b||"")+d+"; path=/"}function getCookie(a){a+="=";for(var b=document.cookie.split(";"),c=0;c<b.length;c++){for(var d=b[c];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null}function eraseCookie(a){document.cookie=a+"=; Max-Age=-99999999;"}
function get_role_name(a){var b="\u672a\u8a2d\u5b9a";"0"==a?b="\u4eba\u54e1\u8a2a\u5ba2":"1"==a?b="\u5de1\u6aa2\u54e1":"2"==a?b="\u8a2d\u5099":"3"==a?b="VIP\u8cb4\u8cd3":"4"==a?b="\u5de5\u4f5c\u4eba\u54e1":"5"==a?b="\u91ab\u5e2b":"6"==a&&(b="\u8b77\u7406\u5e2b");return b}function get_buttontype_name(a){var b="\u7dca\u6025\u6309\u9215";"0"==a?b="\u7dca\u6025\u6309\u9215":"1"==a?b="\u547c\u559a\u9215":"2"==a?b="\u958b\u95dc\u88dd\u7f6e":"3"==a&&(b="\u8a0a\u865f\u63a1\u96c6\u5668");return b}
function open_pushnotify_page(){window.open("/index.php/vilspushnotify/"+project_id,"_blank").focus()};
