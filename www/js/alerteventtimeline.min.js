var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,e,b){if(b.get||b.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[e]=b.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var e=0;return $jscomp.iteratorPrototype(function(){return e<a.length?{done:!1,value:a[e++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(a,e){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var b=0,c={next:function(){if(b<a.length){var g=b++;return{value:e(g,a[g]),done:!1}}c.next=function(){return{done:!0,value:void 0}};return c.next()}};c[Symbol.iterator]=function(){return c};return c};
$jscomp.polyfill=function(a,e,b,c){if(e){b=$jscomp.global;a=a.split(".");for(c=0;c<a.length-1;c++){var g=a[c];g in b||(b[g]={});b=b[g]}a=a[a.length-1];c=b[a];e=e(c);e!=c&&null!=e&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:e})}};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6-impl","es3");
(function(){var a=function(){this.init()};a.prototype={init:function(){var d=this||e;d._counter=1E3;d._codecs={};d._howls=[];d._muted=!1;d._volume=1;d._canPlayEvent="canplaythrough";d._navigator="undefined"!==typeof window&&window.navigator?window.navigator:null;d.masterGain=null;d.noAudio=!1;d.usingWebAudio=!0;d.autoSuspend=!0;d.ctx=null;d.mobileAutoEnable=!0;d._setup();return d},volume:function(d){var a=this||e;d=parseFloat(d);a.ctx||l();if("undefined"!==typeof d&&0<=d&&1>=d){a._volume=d;if(a._muted)return a;
a.usingWebAudio&&a.masterGain.gain.setValueAtTime(d,e.ctx.currentTime);for(var b=0;b<a._howls.length;b++)if(!a._howls[b]._webAudio)for(var c=a._howls[b]._getSoundIds(),f=0;f<c.length;f++){var g=a._howls[b]._soundById(c[f]);g&&g._node&&(g._node.volume=g._volume*d)}return a}return a._volume},mute:function(d){var a=this||e;a.ctx||l();a._muted=d;a.usingWebAudio&&a.masterGain.gain.setValueAtTime(d?0:a._volume,e.ctx.currentTime);for(var b=0;b<a._howls.length;b++)if(!a._howls[b]._webAudio)for(var c=a._howls[b]._getSoundIds(),
f=0;f<c.length;f++){var g=a._howls[b]._soundById(c[f]);g&&g._node&&(g._node.muted=d?!0:g._muted)}return a},unload:function(){for(var d=this||e,a=d._howls.length-1;0<=a;a--)d._howls[a].unload();d.usingWebAudio&&d.ctx&&"undefined"!==typeof d.ctx.close&&(d.ctx.close(),d.ctx=null,l());return d},codecs:function(d){return(this||e)._codecs[d.replace(/^x-/,"")]},_setup:function(){var d=this||e;d.state=d.ctx?d.ctx.state||"running":"running";d._autoSuspend();if(!d.usingWebAudio)if("undefined"!==typeof Audio)try{var a=
new Audio;"undefined"===typeof a.oncanplaythrough&&(d._canPlayEvent="canplay")}catch(b){d.noAudio=!0}else d.noAudio=!0;try{a=new Audio,a.muted&&(d.noAudio=!0)}catch(b){}d.noAudio||d._setupCodecs();return d},_setupCodecs:function(){var d=this||e,a=null;try{a="undefined"!==typeof Audio?new Audio:null}catch(b){return d}if(!a||"function"!==typeof a.canPlayType)return d;var c=a.canPlayType("audio/mpeg;").replace(/^no$/,""),f=d._navigator&&d._navigator.userAgent.match(/OPR\/([0-6].)/g),f=f&&33>parseInt(f[0].split("/")[1],
10);d._codecs={mp3:!(f||!c&&!a.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!c,opus:!!a.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!a.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!a.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(a.canPlayType("audio/x-m4a;")||
a.canPlayType("audio/m4a;")||a.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(a.canPlayType("audio/x-mp4;")||a.canPlayType("audio/mp4;")||a.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!a.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),webm:!!a.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),dolby:!!a.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(a.canPlayType("audio/x-flac;")||a.canPlayType("audio/flac;")).replace(/^no$/,"")};return d},
_enableMobileAudio:function(){var d=this||e,a=/iPhone|iPad|iPod|Android|BlackBerry|BB10|Silk|Mobi|Chrome/i.test(d._navigator&&d._navigator.userAgent);if(!d._mobileEnabled&&d.ctx&&a){d._mobileEnabled=!1;d.mobileAutoEnable=!1;d._mobileUnloaded||44100===d.ctx.sampleRate||(d._mobileUnloaded=!0,d.unload());d._scratchBuffer=d.ctx.createBuffer(1,1,22050);var b=function(a){e._autoResume();var n=d.ctx.createBufferSource();n.buffer=d._scratchBuffer;n.connect(d.ctx.destination);"undefined"===typeof n.start?
n.noteOn(0):n.start(0);"function"===typeof d.ctx.resume&&d.ctx.resume();n.onended=function(){n.disconnect(0);d._mobileEnabled=!0;document.removeEventListener("touchstart",b,!0);document.removeEventListener("touchend",b,!0);document.removeEventListener("click",b,!0);for(var a=0;a<d._howls.length;a++)d._howls[a]._emit("unlock")}};document.addEventListener("touchstart",b,!0);document.addEventListener("touchend",b,!0);document.addEventListener("click",b,!0);return d}},_autoSuspend:function(){var d=this;
if(d.autoSuspend&&d.ctx&&"undefined"!==typeof d.ctx.suspend&&e.usingWebAudio){for(var a=0;a<d._howls.length;a++)if(d._howls[a]._webAudio)for(var b=0;b<d._howls[a]._sounds.length;b++)if(!d._howls[a]._sounds[b]._paused)return d;d._suspendTimer&&clearTimeout(d._suspendTimer);d._suspendTimer=setTimeout(function(){d.autoSuspend&&(d._suspendTimer=null,d.state="suspending",d.ctx.suspend().then(function(){d.state="suspended";d._resumeAfterSuspend&&(delete d._resumeAfterSuspend,d._autoResume())}))},3E4);return d}},
_autoResume:function(){var d=this;if(d.ctx&&"undefined"!==typeof d.ctx.resume&&e.usingWebAudio)return"running"===d.state&&d._suspendTimer?(clearTimeout(d._suspendTimer),d._suspendTimer=null):"suspended"===d.state?(d.ctx.resume().then(function(){d.state="running";for(var a=0;a<d._howls.length;a++)d._howls[a]._emit("resume")}),d._suspendTimer&&(clearTimeout(d._suspendTimer),d._suspendTimer=null)):"suspending"===d.state&&(d._resumeAfterSuspend=!0),d}};var e=new a,b=function(d){d.src&&0!==d.src.length?
this.init(d):console.error("An array of source files must be passed with any new Howl.")};b.prototype={init:function(d){var a=this;e.ctx||l();a._autoplay=d.autoplay||!1;a._format="string"!==typeof d.format?d.format:[d.format];a._html5=d.html5||!1;a._muted=d.mute||!1;a._loop=d.loop||!1;a._pool=d.pool||5;a._preload="boolean"===typeof d.preload?d.preload:!0;a._rate=d.rate||1;a._sprite=d.sprite||{};a._src="string"!==typeof d.src?d.src:[d.src];a._volume=void 0!==d.volume?d.volume:1;a._xhrWithCredentials=
d.xhrWithCredentials||!1;a._duration=0;a._state="unloaded";a._sounds=[];a._endTimers={};a._queue=[];a._playLock=!1;a._onend=d.onend?[{fn:d.onend}]:[];a._onfade=d.onfade?[{fn:d.onfade}]:[];a._onload=d.onload?[{fn:d.onload}]:[];a._onloaderror=d.onloaderror?[{fn:d.onloaderror}]:[];a._onplayerror=d.onplayerror?[{fn:d.onplayerror}]:[];a._onpause=d.onpause?[{fn:d.onpause}]:[];a._onplay=d.onplay?[{fn:d.onplay}]:[];a._onstop=d.onstop?[{fn:d.onstop}]:[];a._onmute=d.onmute?[{fn:d.onmute}]:[];a._onvolume=d.onvolume?
[{fn:d.onvolume}]:[];a._onrate=d.onrate?[{fn:d.onrate}]:[];a._onseek=d.onseek?[{fn:d.onseek}]:[];a._onunlock=d.onunlock?[{fn:d.onunlock}]:[];a._onresume=[];a._webAudio=e.usingWebAudio&&!a._html5;"undefined"!==typeof e.ctx&&e.ctx&&e.mobileAutoEnable&&e._enableMobileAudio();e._howls.push(a);a._autoplay&&a._queue.push({event:"play",action:function(){a.play()}});a._preload&&a.load();return a},load:function(){var d=null;if(e.noAudio)this._emit("loaderror",null,"No audio support.");else{"string"===typeof this._src&&
(this._src=[this._src]);for(var a=0;a<this._src.length;a++){var b,g;if(this._format&&this._format[a])b=this._format[a];else{g=this._src[a];if("string"!==typeof g){this._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(b=/^data:audio\/([^;,]+);/i.exec(g))||(b=/\.([^.]+)$/.exec(g.split("?",1)[0]));b&&(b=b[1].toLowerCase())}b||console.warn('No file extension was found. Consider using the "format" property or specify an extension.');if(b&&e.codecs(b)){d=this._src[a];
break}}if(d)return this._src=d,this._state="loading","https:"===window.location.protocol&&"http:"===d.slice(0,5)&&(this._html5=!0,this._webAudio=!1),new c(this),this._webAudio&&f(this),this;this._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(d,a){var b=this,c=null;if("number"===typeof d)c=d,d=null;else{if("string"===typeof d&&"loaded"===b._state&&!b._sprite[d])return null;if("undefined"===typeof d){d="__default";for(var f=0,g=0;g<b._sounds.length;g++)b._sounds[g]._paused&&
!b._sounds[g]._ended&&(f++,c=b._sounds[g]._id);1===f?d=null:c=null}}var h=c?b._soundById(c):b._inactiveSound();if(!h)return null;c&&!d&&(d=h._sprite||"__default");if("loaded"!==b._state){h._sprite=d;h._ended=!1;var k=h._id;b._queue.push({event:"play",action:function(){b.play(k)}});return k}if(c&&!h._paused)return a||b._loadQueue("play"),h._id;b._webAudio&&e._autoResume();var m=Math.max(0,0<h._seek?h._seek:b._sprite[d][0]/1E3),l=Math.max(0,(b._sprite[d][0]+b._sprite[d][1])/1E3-m),u=1E3*l/Math.abs(h._rate);
h._paused=!1;h._ended=!1;h._sprite=d;h._seek=m;h._start=b._sprite[d][0]/1E3;h._stop=(b._sprite[d][0]+b._sprite[d][1])/1E3;h._loop=!(!h._loop&&!b._sprite[d][2]);if(h._seek>=h._stop)b._ended(h);else{var p=h._node;if(b._webAudio)c=function(){b._refreshBuffer(h);p.gain.setValueAtTime(h._muted||b._muted?0:h._volume,e.ctx.currentTime);h._playStart=e.ctx.currentTime;"undefined"===typeof p.bufferSource.start?h._loop?p.bufferSource.noteGrainOn(0,m,86400):p.bufferSource.noteGrainOn(0,m,l):h._loop?p.bufferSource.start(0,
m,86400):p.bufferSource.start(0,m,l);Infinity!==u&&(b._endTimers[h._id]=setTimeout(b._ended.bind(b,h),u));a||setTimeout(function(){b._emit("play",h._id)},0)},"running"===e.state?c():(b.once("resume",c),b._clearTimer(h._id));else{var v=function(){p.currentTime=m;p.muted=h._muted||b._muted||e._muted||p.muted;p.volume=h._volume*e.volume();p.playbackRate=h._rate;try{var c=p.play();c&&"undefined"!==typeof Promise&&(c instanceof Promise||"function"===typeof c.then)?(b._playLock=!0,c.then(function(){b._playLock=
!1;a||b._emit("play",h._id)})["catch"](function(){b._playLock=!1;b._emit("playerror",h._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.")})):a||b._emit("play",h._id);p.playbackRate=h._rate;p.paused?b._emit("playerror",h._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."):"__default"!==d||h._loop?b._endTimers[h._id]=
setTimeout(b._ended.bind(b,h),u):(b._endTimers[h._id]=function(){b._ended(h);p.removeEventListener("ended",b._endTimers[h._id],!1)},p.addEventListener("ended",b._endTimers[h._id],!1))}catch(f){b._emit("playerror",h._id,f)}},c=window&&window.ejecta||!p.readyState&&e._navigator.isCocoonJS;if(3<=p.readyState||c)v();else{var w=function(){v();p.removeEventListener(e._canPlayEvent,w,!1)};p.addEventListener(e._canPlayEvent,w,!1);b._clearTimer(h._id)}}return h._id}},pause:function(d,a){var b=this;if("loaded"!==
b._state||b._playLock)return b._queue.push({event:"pause",action:function(){b.pause(d)}}),b;for(var e=b._getSoundIds(d),c=0;c<e.length;c++){b._clearTimer(e[c]);var f=b._soundById(e[c]);if(f&&!f._paused&&(f._seek=b.seek(e[c]),f._rateSeek=0,f._paused=!0,b._stopFade(e[c]),f._node))if(b._webAudio){if(!f._node.bufferSource)continue;"undefined"===typeof f._node.bufferSource.stop?f._node.bufferSource.noteOff(0):f._node.bufferSource.stop(0);b._cleanBuffer(f._node)}else isNaN(f._node.duration)&&Infinity!==
f._node.duration||f._node.pause();a||b._emit("pause",f?f._id:null)}return b},stop:function(d,a){var b=this;if("loaded"!==b._state||b._playLock)return b._queue.push({event:"stop",action:function(){b.stop(d)}}),b;for(var e=b._getSoundIds(d),c=0;c<e.length;c++){b._clearTimer(e[c]);var f=b._soundById(e[c]);f&&(f._seek=f._start||0,f._rateSeek=0,f._paused=!0,f._ended=!0,b._stopFade(e[c]),f._node&&(b._webAudio?f._node.bufferSource&&("undefined"===typeof f._node.bufferSource.stop?f._node.bufferSource.noteOff(0):
f._node.bufferSource.stop(0),b._cleanBuffer(f._node)):isNaN(f._node.duration)&&Infinity!==f._node.duration||(f._node.currentTime=f._start||0,f._node.pause())),a||b._emit("stop",f._id))}return b},mute:function(d,a){var b=this;if("loaded"!==b._state||b._playLock)return b._queue.push({event:"mute",action:function(){b.mute(d,a)}}),b;if("undefined"===typeof a)if("boolean"===typeof d)b._muted=d;else return b._muted;for(var c=b._getSoundIds(a),f=0;f<c.length;f++){var g=b._soundById(c[f]);g&&(g._muted=d,
g._interval&&b._stopFade(g._id),b._webAudio&&g._node?g._node.gain.setValueAtTime(d?0:g._volume,e.ctx.currentTime):g._node&&(g._node.muted=e._muted?!0:d),b._emit("mute",g._id))}return b},volume:function(){var d=this,a=arguments,b,c;if(0===a.length)return d._volume;1===a.length||2===a.length&&"undefined"===typeof a[1]?0<=d._getSoundIds().indexOf(a[0])?c=parseInt(a[0],10):b=parseFloat(a[0]):2<=a.length&&(b=parseFloat(a[0]),c=parseInt(a[1],10));var f;if("undefined"!==typeof b&&0<=b&&1>=b){if("loaded"!==
d._state||d._playLock)return d._queue.push({event:"volume",action:function(){d.volume.apply(d,a)}}),d;"undefined"===typeof c&&(d._volume=b);c=d._getSoundIds(c);for(var g=0;g<c.length;g++)if(f=d._soundById(c[g]))f._volume=b,a[2]||d._stopFade(c[g]),d._webAudio&&f._node&&!f._muted?f._node.gain.setValueAtTime(b,e.ctx.currentTime):f._node&&!f._muted&&(f._node.volume=b*e.volume()),d._emit("volume",f._id)}else return(f=c?d._soundById(c):d._sounds[0])?f._volume:0;return d},fade:function(d,a,b,c){var f=this;
if("loaded"!==f._state||f._playLock)return f._queue.push({event:"fade",action:function(){f.fade(d,a,b,c)}}),f;d=parseFloat(d);a=parseFloat(a);b=parseFloat(b);f.volume(d,c);for(var g=f._getSoundIds(c),h=0;h<g.length;h++){var k=f._soundById(g[h]);if(k){c||f._stopFade(g[h]);if(f._webAudio&&!k._muted){var m=e.ctx.currentTime,l=m+b/1E3;k._volume=d;k._node.gain.setValueAtTime(d,m);k._node.gain.linearRampToValueAtTime(a,l)}f._startFadeInterval(k,d,a,b,g[h],"undefined"===typeof c)}}return f},_startFadeInterval:function(d,
a,b,e,c,f){var g=this,h=a,k=b-a;c=Math.abs(k/.01);c=Math.max(4,0<c?e/c:e);var m=Date.now();d._fadeTo=b;d._interval=setInterval(function(){var c=(Date.now()-m)/e;m=Date.now();h+=k*c;h=Math.max(0,h);h=Math.min(1,h);h=Math.round(100*h)/100;g._webAudio?d._volume=h:g.volume(h,d._id,!0);f&&(g._volume=h);if(b<a&&h<=b||b>a&&h>=b)clearInterval(d._interval),d._interval=null,d._fadeTo=null,g.volume(b,d._id),g._emit("fade",d._id)},c)},_stopFade:function(d){var a=this._soundById(d);a&&a._interval&&(this._webAudio&&
a._node.gain.cancelScheduledValues(e.ctx.currentTime),clearInterval(a._interval),a._interval=null,this.volume(a._fadeTo,d),a._fadeTo=null,this._emit("fade",d));return this},loop:function(){var d=arguments,a,b;if(0===d.length)return this._loop;if(1===d.length)if("boolean"===typeof d[0])this._loop=a=d[0];else return(d=this._soundById(parseInt(d[0],10)))?d._loop:!1;else 2===d.length&&(a=d[0],b=parseInt(d[1],10));b=this._getSoundIds(b);for(var e=0;e<b.length;e++)if(d=this._soundById(b[e]))if(d._loop=
a,this._webAudio&&d._node&&d._node.bufferSource&&(d._node.bufferSource.loop=a))d._node.bufferSource.loopStart=d._start||0,d._node.bufferSource.loopEnd=d._stop;return this},rate:function(){var d=this,a=arguments,b,c;0===a.length?c=d._sounds[0]._id:1===a.length?0<=d._getSoundIds().indexOf(a[0])?c=parseInt(a[0],10):b=parseFloat(a[0]):2===a.length&&(b=parseFloat(a[0]),c=parseInt(a[1],10));var f;if("number"===typeof b){if("loaded"!==d._state||d._playLock)return d._queue.push({event:"rate",action:function(){d.rate.apply(d,
a)}}),d;"undefined"===typeof c&&(d._rate=b);c=d._getSoundIds(c);for(var g=0;g<c.length;g++)if(f=d._soundById(c[g])){f._rateSeek=d.seek(c[g]);f._playStart=d._webAudio?e.ctx.currentTime:f._playStart;f._rate=b;d._webAudio&&f._node&&f._node.bufferSource?f._node.bufferSource.playbackRate.setValueAtTime(b,e.ctx.currentTime):f._node&&(f._node.playbackRate=b);var h=d.seek(c[g]),h=1E3*((d._sprite[f._sprite][0]+d._sprite[f._sprite][1])/1E3-h)/Math.abs(f._rate);if(d._endTimers[c[g]]||!f._paused)d._clearTimer(c[g]),
d._endTimers[c[g]]=setTimeout(d._ended.bind(d,f),h);d._emit("rate",f._id)}}else return(f=d._soundById(c))?f._rate:d._rate;return d},seek:function(){var d=this,a=arguments,b,c;0===a.length?c=d._sounds[0]._id:1===a.length?0<=d._getSoundIds().indexOf(a[0])?c=parseInt(a[0],10):d._sounds.length&&(c=d._sounds[0]._id,b=parseFloat(a[0])):2===a.length&&(b=parseFloat(a[0]),c=parseInt(a[1],10));if("undefined"===typeof c)return d;if("loaded"!==d._state||d._playLock)return d._queue.push({event:"seek",action:function(){d.seek.apply(d,
a)}}),d;var f=d._soundById(c);if(f)if("number"===typeof b&&0<=b){var g=d.playing(c);g&&d.pause(c,!0);f._seek=b;f._ended=!1;d._clearTimer(c);!d._webAudio&&f._node&&(f._node.currentTime=b);var h=function(){d._emit("seek",c);g&&d.play(c,!0)};if(g&&!d._webAudio){var k=function(){d._playLock?setTimeout(k,0):h()};setTimeout(k,0)}else h()}else return d._webAudio?(b=d.playing(c)?e.ctx.currentTime-f._playStart:0,f._seek+((f._rateSeek?f._rateSeek-f._seek:0)+b*Math.abs(f._rate))):f._node.currentTime;return d},
playing:function(a){if("number"===typeof a)return(a=this._soundById(a))?!a._paused:!1;for(a=0;a<this._sounds.length;a++)if(!this._sounds[a]._paused)return!0;return!1},duration:function(a){var b=this._duration;(a=this._soundById(a))&&(b=this._sprite[a._sprite][1]/1E3);return b},state:function(){return this._state},unload:function(){for(var a=this._sounds,b=0;b<a.length;b++)a[b]._paused||this.stop(a[b]._id),this._webAudio||(/MSIE |Trident\//.test(e._navigator&&e._navigator.userAgent)||(a[b]._node.src=
"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"),a[b]._node.removeEventListener("error",a[b]._errorFn,!1),a[b]._node.removeEventListener(e._canPlayEvent,a[b]._loadFn,!1)),delete a[b]._node,this._clearTimer(a[b]._id);b=e._howls.indexOf(this);0<=b&&e._howls.splice(b,1);a=!0;for(b=0;b<e._howls.length;b++)if(e._howls[b]._src===this._src){a=!1;break}g&&a&&delete g[this._src];e.noAudio=!1;this._state="unloaded";this._sounds=[];return null},on:function(a,b,c,e){a=
this["_on"+a];"function"===typeof b&&a.push(e?{id:c,fn:b,once:e}:{id:c,fn:b});return this},off:function(a,b,c){var e=this["_on"+a];"number"===typeof b&&(c=b,b=null);if(b||c)for(a=0;a<e.length;a++){var f=c===e[a].id;if(b===e[a].fn&&f||!b&&f){e.splice(a,1);break}}else if(a)this["_on"+a]=[];else for(b=Object.keys(this),a=0;a<b.length;a++)0===b[a].indexOf("_on")&&Array.isArray(this[b[a]])&&(this[b[a]]=[]);return this},once:function(a,b,c){this.on(a,b,c,1);return this},_emit:function(a,b,c){for(var e=
this["_on"+a],f=e.length-1;0<=f;f--)e[f].id&&e[f].id!==b&&"load"!==a||(setTimeout(function(a){a.call(this,b,c)}.bind(this,e[f].fn),0),e[f].once&&this.off(a,e[f].fn,e[f].id));this._loadQueue(a);return this},_loadQueue:function(a){if(0<this._queue.length){var b=this._queue[0];b.event===a&&(this._queue.shift(),this._loadQueue());a||b.action()}return this},_ended:function(a){var b=a._sprite;if(!this._webAudio&&a._node&&!a._node.paused&&!a._node.ended&&a._node.currentTime<a._stop)return setTimeout(this._ended.bind(this,
a),100),this;b=!(!a._loop&&!this._sprite[b][2]);this._emit("end",a._id);!this._webAudio&&b&&this.stop(a._id,!0).play(a._id);if(this._webAudio&&b){this._emit("play",a._id);a._seek=a._start||0;a._rateSeek=0;a._playStart=e.ctx.currentTime;var c=1E3*(a._stop-a._start)/Math.abs(a._rate);this._endTimers[a._id]=setTimeout(this._ended.bind(this,a),c)}this._webAudio&&!b&&(a._paused=!0,a._ended=!0,a._seek=a._start||0,a._rateSeek=0,this._clearTimer(a._id),this._cleanBuffer(a._node),e._autoSuspend());this._webAudio||
b||this.stop(a._id,!0);return this},_clearTimer:function(a){if(this._endTimers[a]){if("function"!==typeof this._endTimers[a])clearTimeout(this._endTimers[a]);else{var b=this._soundById(a);b&&b._node&&b._node.removeEventListener("ended",this._endTimers[a],!1)}delete this._endTimers[a]}return this},_soundById:function(a){for(var b=0;b<this._sounds.length;b++)if(a===this._sounds[b]._id)return this._sounds[b];return null},_inactiveSound:function(){this._drain();for(var a=0;a<this._sounds.length;a++)if(this._sounds[a]._ended)return this._sounds[a].reset();
return new c(this)},_drain:function(){var a=this._pool,b=0,c;if(!(this._sounds.length<a)){for(c=0;c<this._sounds.length;c++)this._sounds[c]._ended&&b++;for(c=this._sounds.length-1;0<=c&&!(b<=a);c--)this._sounds[c]._ended&&(this._webAudio&&this._sounds[c]._node&&this._sounds[c]._node.disconnect(0),this._sounds.splice(c,1),b--)}},_getSoundIds:function(a){if("undefined"===typeof a){a=[];for(var b=0;b<this._sounds.length;b++)a.push(this._sounds[b]._id);return a}return[a]},_refreshBuffer:function(a){a._node.bufferSource=
e.ctx.createBufferSource();a._node.bufferSource.buffer=g[this._src];a._panner?a._node.bufferSource.connect(a._panner):a._node.bufferSource.connect(a._node);if(a._node.bufferSource.loop=a._loop)a._node.bufferSource.loopStart=a._start||0,a._node.bufferSource.loopEnd=a._stop||0;a._node.bufferSource.playbackRate.setValueAtTime(a._rate,e.ctx.currentTime);return this},_cleanBuffer:function(a){if(e._scratchBuffer&&a.bufferSource){a.bufferSource.onended=null;a.bufferSource.disconnect(0);try{a.bufferSource.buffer=
e._scratchBuffer}catch(b){}}a.bufferSource=null;return this}};var c=function(a){this._parent=a;this.init()};c.prototype={init:function(){var a=this._parent;this._muted=a._muted;this._loop=a._loop;this._volume=a._volume;this._rate=a._rate;this._seek=0;this._ended=this._paused=!0;this._sprite="__default";this._id=++e._counter;a._sounds.push(this);this.create();return this},create:function(){var a=this._parent,b=e._muted||this._muted||this._parent._muted?0:this._volume;a._webAudio?(this._node="undefined"===
typeof e.ctx.createGain?e.ctx.createGainNode():e.ctx.createGain(),this._node.gain.setValueAtTime(b,e.ctx.currentTime),this._node.paused=!0,this._node.connect(e.masterGain)):(this._node=new Audio,this._errorFn=this._errorListener.bind(this),this._node.addEventListener("error",this._errorFn,!1),this._loadFn=this._loadListener.bind(this),this._node.addEventListener(e._canPlayEvent,this._loadFn,!1),this._node.src=a._src,this._node.preload="auto",this._node.volume=b*e.volume(),this._node.load());return this},
reset:function(){var a=this._parent;this._muted=a._muted;this._loop=a._loop;this._volume=a._volume;this._rate=a._rate;this._rateSeek=this._seek=0;this._ended=this._paused=!0;this._sprite="__default";this._id=++e._counter;return this},_errorListener:function(){this._parent._emit("loaderror",this._id,this._node.error?this._node.error.code:0);this._node.removeEventListener("error",this._errorFn,!1)},_loadListener:function(){var a=this._parent;a._duration=Math.ceil(10*this._node.duration)/10;0===Object.keys(a._sprite).length&&
(a._sprite={__default:[0,1E3*a._duration]});"loaded"!==a._state&&(a._state="loaded",a._emit("load"),a._loadQueue());this._node.removeEventListener(e._canPlayEvent,this._loadFn,!1)}};var g={},f=function(a){var b=a._src;if(g[b])a._duration=g[b].duration,m(a);else if(/^data:[^;]+;base64,/.test(b)){for(var c=atob(b.split(",")[1]),e=new Uint8Array(c.length),f=0;f<c.length;++f)e[f]=c.charCodeAt(f);k(e.buffer,a)}else{var l=new XMLHttpRequest;l.open("GET",b,!0);l.withCredentials=a._xhrWithCredentials;l.responseType=
"arraybuffer";l.onload=function(){var b=(l.status+"")[0];"0"!==b&&"2"!==b&&"3"!==b?a._emit("loaderror",null,"Failed loading audio file with status: "+l.status+"."):k(l.response,a)};l.onerror=function(){a._webAudio&&(a._html5=!0,a._webAudio=!1,a._sounds=[],delete g[b],a.load())};h(l)}},h=function(a){try{a.send()}catch(b){a.onerror()}},k=function(a,b){var c=function(){b._emit("loaderror",null,"Decoding audio data failed.")},f=function(a){a&&0<b._sounds.length?(g[b._src]=a,m(b,a)):c()};"undefined"!==
typeof Promise&&1===e.ctx.decodeAudioData.length?e.ctx.decodeAudioData(a).then(f)["catch"](c):e.ctx.decodeAudioData(a,f,c)},m=function(a,b){b&&!a._duration&&(a._duration=b.duration);0===Object.keys(a._sprite).length&&(a._sprite={__default:[0,1E3*a._duration]});"loaded"!==a._state&&(a._state="loaded",a._emit("load"),a._loadQueue())},l=function(){try{"undefined"!==typeof AudioContext?e.ctx=new AudioContext:"undefined"!==typeof webkitAudioContext?e.ctx=new webkitAudioContext:e.usingWebAudio=!1}catch(a){e.usingWebAudio=
!1}var b=/iP(hone|od|ad)/.test(e._navigator&&e._navigator.platform),c=e._navigator&&e._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),c=c?parseInt(c[1],10):null;b&&c&&9>c&&(b=/safari/.test(e._navigator&&e._navigator.userAgent.toLowerCase()),e._navigator&&e._navigator.standalone&&!b||e._navigator&&!e._navigator.standalone&&!b)&&(e.usingWebAudio=!1);e.usingWebAudio&&(e.masterGain="undefined"===typeof e.ctx.createGain?e.ctx.createGainNode():e.ctx.createGain(),e.masterGain.gain.setValueAtTime(e._muted?
0:1,e.ctx.currentTime),e.masterGain.connect(e.ctx.destination));e._setup()};"function"===typeof define&&define.amd&&define([],function(){return{Howler:e,Howl:b}});"undefined"!==typeof exports&&(exports.Howler=e,exports.Howl=b);"undefined"!==typeof window?(window.HowlerGlobal=a,window.Howler=e,window.Howl=b,window.Sound=c):"undefined"!==typeof global&&(global.HowlerGlobal=a,global.Howler=e,global.Howl=b,global.Sound=c)})();var glWebSocketPort=8083,glMenuCreated=!1,glWebSocketState_alertevent=1;load_websocket_event();function load_websocket_event(){$.getJSON(gl_target_server+"/php/configvils.php","loadsystemconfig=1&project_id="+project_id,function(a){glWebSocketPort=a.web_socket_port;load_AlertEvent_websocket()})}
function load_AlertEvent_websocket(){var a="",a=3>=gl_maingroups.length&&"1"!=gl_maingroups?gl_websocket_server+":"+glWebSocketPort+"/websocket/maingroups_"+gl_maingroups+"_2D1531973179180j8teuD5A4A_type|event|sos|fenceAlert|checkpointAlert":gl_websocket_server+":"+glWebSocketPort+"/websocket/xystudy_"+project_id+"_2D1531973179180j8teuD5A4A_type|event|sos|fenceAlert|checkpointAlert";console.log("load_AlertEvent_websocket() wsUri:"+a);websocket=new WebSocket(a);websocket.onmessage=function(a){onMessageAlertEvent(a)};
websocket.onclose=function(a){onCloseAlertEvent(a)};websocket.onopen=function(a){onOpenAlertEvent(a)}}
function onMessageAlertEvent(a){a=JSON.parse(a.data);if(a.hasOwnProperty("msgType")){if("sos"==a.msgType){console.log("onMessageAlertEvent() !! sos !! "+a.tagid+", "+a.tagname);var e=0,b=0;1==a.type&&(e=1);2==a.type&&(b=1);show_help_msg(e,b,a.tagid,a.tagname,a.locatorid,a.locatorname)}else"event"==a.msgType?"3"==a.alertAction?console.log("onMessageAlertEvent() !! Event !! data.alertAction == alert "):"4"==a.alertAction&&(console.log("onMessage() !! Event !! data.alertAction == cancel data.nodeid:"+
a.nodeid),remove_alert_box(a.nodeid,0,-1)):"fenceAlert"==a.msgType?(console.log("onMessage() tagid:"+a.tagid+" mac:"+a.mac+" action:"+a.action+" areaid:"+a.areaid+" areaname:"+a.areaname+" type:"+a.type),createFenceAlertMsg(a.tagid,a.tagname,a.action,a.areaname)):"checkpointAlert"==a.msgType?show_checkpoint_alert_msg(a.chcekPointName,a.alertType):"callout"==a.msgType&&create_CallOut_box(a.nodeid,a.nodename);parent.check_new_fired_events_countdown(10);refresh_timeline()}}
function onOpenAlertEvent(a){console.log("onOpenAlertEvent() Connected to VILS Center!! ");parent.$(".top_warning_content_alertevent_websocket").html('<a><i class="fa fa-chain text-green"></i>AlertEvent WebSocket Connected.</a>');glWebSocketState_alertevent=0;update_top_warning_state()}
function onCloseAlertEvent(a){console.log("onCloseAlertEvent() reconnect to VILS Center!! ");parent.$(".top_warning_content_alertevent_websocket").html('<a><i class="fa fa-chain-broken text-red"></i>AlertEvent WebSocket Connecting...</a>');glWebSocketState_alertevent=1;update_top_warning_state();setTimeout(load_AlertEvent_websocket,2E3)}
function update_top_warning_state(){var a=glWebSocketState_alertevent;parent.$("#top_warning_num").html("You have "+a+" warnings");parent.$("#top_warning_num_bubble").html(a);0==a?parent.$("#top_warning_num_bubble").hide():parent.$("#top_warning_num_bubble").show()}
function create_alert_box(a,e,b,c){var g="alert_box_"+a+"_"+c;if(null!=document.getElementById(g))return!1;console.log("create_alert_box() new_box_id:"+g);var f=document.getElementById("alert-box-content");if(null==f)return console.log("alert_box_content == null"),!1;var h=document.createElement("div");h.setAttribute("id",g);h.setAttribute("class","box box-danger");g=document.createElement("div");5==c?g.setAttribute("class","box-header with-border bg-yellow"):g.setAttribute("class","box-header with-border bg-orange");
h.appendChild(g);var k=document.createElement("h3");k.setAttribute("class","box-title");k.textContent=e;g.appendChild(k);k=document.createElement("div");k.setAttribute("class","box-tools pull-right");g.appendChild(k);g=document.createElement("button");g.setAttribute("type","button");g.setAttribute("class","btn btn-box-tool bg-gray disabled");g.setAttribute("data-widget","remove");g.setAttribute("onclick",'remove_alert_box("'+a+'", 1, '+c+")");k.appendChild(g);k=document.createElement("i");k.setAttribute("class",
"fa fa-times");g.appendChild(k);g=document.createElement("div");1==c?g.setAttribute("class","box-body bg-light-blue-active"):2==c?g.setAttribute("class","box-body bg-maroon disabled"):5==c?g.setAttribute("class","box-body bg-green disabled"):g.setAttribute("class","box-body bg-maroon disabled");h.appendChild(g);c=document.createElement("h1");c.setAttribute("class","box-title");c.setAttribute("style","font-size:"+100*ALERT_BOX_FONT_SIZE+"%;");c.textContent=e;g.appendChild(c);e=document.createElement("h1");
e.setAttribute("class","box-title");e.setAttribute("style","font-size: 200%;");e.textContent=b;g.appendChild(e);f.appendChild(h);void 0!=parent.$("#contentIframe")[0]&&"function"===typeof parent.$("#contentIframe")[0].contentWindow.start_alert&&parent.$("#contentIframe")[0].contentWindow.start_alert(a);return!0}
function remove_alert_box(a,e,b){if(-1==b){var c;for(c=1;6>=c;c++){var g=document.getElementById("alert_box_"+a+"_"+c);null!=g&&g.remove()}}else g=document.getElementById("alert_box_"+a+"_"+b),null!=g&&g.remove();1==b||2==b||-1==b?stop_help_msg(a,e):stop_fencealert_msg(a,e);console.log("remove_alert_box() accountid:"+accountid+", accountname:"+accountname+" tagid:"+a+" alert_type:"+b);if(1==e)for(e=0;e<gl_allevents.length;e++)if(c=gl_allevents[e],a===c.eventjson.nodeid&&"Alert"===c.eventjson.action&&
0==c.empid.length){console.log("remove_alert_box() index:"+e+", firedeventid:"+c.firedeventid+" nodeid:"+c.eventjson.nodeid+" action:"+c.eventjson.action+" empid:"+c.empid);update_FiredEvents_close(c.firedeventid,a,accountid,b);break}void 0!=parent.$("#contentIframe")[0]&&"function"===typeof parent.$("#contentIframe")[0].contentWindow.stop_alert&&parent.$("#contentIframe")[0].contentWindow.stop_alert(a)}
function update_FiredEvents_close(a,e,b,c){var g={};g.project_id=""+project_id;g.UPDATE_FIREDEVENT_CLOSE=1;g.ID=a;g.DEVICEID=e;g.EMPID=b;g.TYPE=c;jQuery.ajax({url:gl_target_server+"/php/eventfire.php",type:"POST",data:g,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a))},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}});return!1}
function convert_action_name(a){return"Enter"==a?"\u9032\u5165":"Leave"==a?"\u96e2\u958b":"Stay"==a?"\u505c\u7559":"Alert"==a?"\u6309\u4e0b\u8b66\u6025\u6309\u9215":"AlertTagNotMoving"==a?"\u7121\u52d5\u4f5c\u8b66\u544a":"AlertLayDown"==a?"\u8eba\u81e5\u8b66\u544a":"Cancel"==a||"cancel"==a?"\u6309\u4e0b\u53d6\u6d88\u6309\u9215":"Finish"==a?"\u5b8c\u6210":"Exceed"==a?"\u8d85\u904e\u5de1\u6aa2\u6642\u9593":"shorttime"==a?"\u5de1\u6aa2\u6642\u9593\u904e\u77ed":"longtime"==a?"\u5de1\u6aa2\u6642\u9593\u904e\u9577":
"CallOut"==a?"\u6309\u4e0b\u547c\u63db\u9215":"PowerOff"==a?"\u62d4\u9664\u96fb\u6e90":"PowerOn"==a?"\u63a5\u901a\u96fb\u6e90":"OpenDoor"==a?"\u958b\u9580":"CloseDoor"==a?"\u95dc\u9580":"iCoverOpenDoor"==a?"\u7570\u5e38\u79fb\u52d5":"iCoverCloseDoor"==a?"\u5b9a\u6642\u56de\u5831":"EnterDoor"==a?"\u9032\u5165\u958b\u9580\u5340\u57df":"ExitDoor"==a?"\u96e2\u958b\u958b\u9580\u5340\u57df":a}
function convert_IssueTime_name(a){return"Immediately"==a?"\u7acb\u523b":"1 minute"==a?"1\u5206\u9418":"5 minutes"==a?"5\u5206\u9418":"10 minutes"==a?"10\u5206\u9418":a}
function format_device_name(a){var e=a.indexOf("("),b=a.indexOf(")");if(0<=e&&0<=b&&!(e>b)){if(0==e)var c=a.substr(e,b-e+1),e=a.substr(b+1);else c=a.substr(0,e),e=a.substr(e);return c+"<br>"+e}b=e=-1;for(c=0;c<a.length;c++){var g=a.substr(c,1);if(isANumber(g)||"-"==g)-1==e?e=c:b=c;else if(0<=e&&0<=b)break}0==e?(c=a.substr(e,b-e+1),e=a.substr(b+1)):0>e?(c=a,e=""):(c=a.substr(0,e),e=a.substr(e));a=c+"<br>"+e;""===e&&(a=c);return a}function isANumber(a){return!/\D/.test(a)}
function open_eventtimeline_page(){window.open("/index.php/vilseventtimeline/"+project_id,"_blank").focus()};var glDeviceAlertTimestamp=[],SHOW_SAME_ALERT_TIMEOUT=30;
function show_help_msg(a,e,b,c,g,f){var h=getCurrentTimeStamp(),k=glDeviceAlertTimestamp[b];void 0!=k&&h-k<SHOW_SAME_ALERT_TIMEOUT||(glDeviceAlertTimestamp[b]=h,h=0,k=" alert ",0!=parseInt(a)?(k="\u4eba\u54e1\u5340\u57df\u6c42\u52a9",h=1):0!=parseInt(e)&&(b==g?(k="\u56fa\u5b9a\u88dd\u7f6e\u6c42\u52a9",h=2):0<f.length?(k="\u5728\u56fa\u5b9a\u88dd\u7f6e "+f+" \u6c42\u52a9",h=2):(k="\u4eba\u54e1\u5340\u57df\u6c42\u52a9",h=1)),create_alert_box(b,c,k,h)&&(create_HelpVoice(b,h),0>parent.document.getElementById("contentIframe").src.indexOf("vils2dmap")&&
(console.log("curURL:"+parent.document.getElementById("contentIframe").src),parent.show_2dmap(project_id))))}function stop_help_msg(a,e){console.log("stop_help_msg("+a+")");void 0!=glDeviceAlertTimestamp[a]&&0==e&&(glDeviceAlertTimestamp[a]=0);remove_HelpVoice(a)}
function create_CallOut_box(a,e){var b=getCurrentTimeStamp();console.log("create_CallOut_box() nodeid:"+a+" nodename:"+e);var c=glDeviceAlertTimestamp[a];void 0!=c&&b-c<SHOW_SAME_ALERT_TIMEOUT||(glDeviceAlertTimestamp[a]=b,console.log("create_CallOut_box() showMsg:\u6309\u4e0b\u547c\u559a\u9215"),create_alert_box(a,e,"\u6309\u4e0b\u547c\u559a\u9215",5))}function getCurrentTimeStamp(){return Math.floor(Date.now()/1E3)};function show_checkpoint_alert_msg(a,e){var b=" alert ";2==parseInt(e)?b=a+" \u5de1\u6aa2\u6642\u9593\u4e0d\u8db3!":3==parseInt(e)?b=a+" \u5de1\u6aa2\u6642\u9593\u904e\u9577!":4==parseInt(e)&&(b=a+" \u5de1\u6aa2\u6642\u9593\u5df2\u904e, \u672a\u898b\u5de1\u6aa2\u54e1!");create_alert_box(a,a,b,6)};var glFenceAlertInfo={},glEnableShowFenceAlertMsg=!1,glDeviceAlertEvent=[],SHOW_SAME_ALERT_TIMEOUT=30;check_alert_msg();function createFenceAlertMsg(a,e,b,c){glFenceAlertInfo.data_id=a;glFenceAlertInfo.data_name=e;glFenceAlertInfo.data_action=b;glFenceAlertInfo.data_areaname=c;glEnableShowFenceAlertMsg=!0}
function show_fence_alert_msg(a,e,b,c){var g=getCurrentTimeStamp(),f=glDeviceAlertEvent[a];if(void 0!=f)if(f.action==b){if(f=g-glDeviceAlertEvent[a].timestamp,console.log("show_fence_alert_msg() action:"+b+", tagid:"+a+", tagname:"+e+" diffTime:"+f),f<SHOW_SAME_ALERT_TIMEOUT)return}else glDeviceAlertEvent[a].action=b;else glDeviceAlertEvent[a]={},glDeviceAlertEvent[a].action=b,glDeviceAlertEvent[a].timestamp=g;glDeviceAlertEvent[a].timestamp=g;g=0;f=" alert ";1==parseInt(b)?(f="\u9032\u5165\u96fb\u5b50\u570d\u6b04 "+
c,g=3):2==parseInt(b)&&(f="\u96e2\u958b\u96fb\u5b50\u570d\u6b04 "+c,g=4);create_alert_box(a,e,f,g)&&(create_HelpVoice(a,g),0>parent.document.getElementById("contentIframe").src.indexOf("vils2dmap")&&(console.log("curURL:"+parent.document.getElementById("contentIframe").src),parent.show_2dmap(project_id)))}
function check_alert_msg(){1==glEnableShowFenceAlertMsg&&(show_fence_alert_msg(glFenceAlertInfo.data_id,glFenceAlertInfo.data_name,glFenceAlertInfo.data_action,glFenceAlertInfo.data_areaname),glEnableShowFenceAlertMsg=!1);setTimeout(check_alert_msg,200)}function stop_fencealert_msg(a,e){console.log("stop_fencealert_msg("+a+")");void 0!=glDeviceAlertEvent[a]&&0==e&&(glDeviceAlertEvent[a]=0);remove_HelpVoice(a)};var glHelpVoiceQueue=[],glCurrentPlayHelpVoice_id=-1,HelpVoiceAudio1=new Howl({src:["/audio/\u4eba\u54e1\u5340\u57df\u6c42\u52a9.mp3"],autoplay:!1,loop:!0,html5:!0}),HelpVoiceAudio2=new Howl({src:["/audio/\u56fa\u5b9a\u88dd\u7f6e\u6c42\u52a9.mp3"],autoplay:!1,loop:!0,html5:!0}),FenceAlertHelpVoiceAudio1=new Howl({src:["/audio/\u4eba\u54e1\u9032\u5165\u96fb\u5b50\u570d\u6b04.mp3"],autoplay:!1,loop:!0,html5:!0}),FenceAlertHelpVoiceAudio2=new Howl({src:["/audio/\u4eba\u54e1\u96e2\u958b\u96fb\u5b50\u570d\u6b04.mp3"],
autoplay:!1,loop:!0,html5:!0});function create_HelpVoice(a,e){var b={};b.nodeid=a;b.HelpVoice_id=e;console.log("create_HelpVoice() nodeid:"+a+" glCurrentPlayHelpVoice_id:"+glCurrentPlayHelpVoice_id+" glHelpVoiceQueue.length:"+glHelpVoiceQueue.length);if(3==e||4==e)for(var c=0;c<glHelpVoiceQueue.length;c++){var g=glHelpVoiceQueue[c];if(3==g.HelpVoice_id||4==g.HelpVoice_id){glHelpVoiceQueue.splice(c,1);break}}glHelpVoiceQueue.push(b);play_HelpVoice()}
function remove_HelpVoice(a){for(var e=0;e<glHelpVoiceQueue.length;e++)if(glHelpVoiceQueue[e].nodeid===a){glHelpVoiceQueue.splice(e,1);break}play_HelpVoice()}
function play_HelpVoice(){console.log("play_HelpVoice() glCurrentPlayHelpVoice_id:"+glCurrentPlayHelpVoice_id+" glHelpVoiceQueue.length:"+glHelpVoiceQueue.length);if(0<glHelpVoiceQueue.length){var a=glHelpVoiceQueue[0];glCurrentPlayHelpVoice_id!=a.HelpVoice_id&&(0<glCurrentPlayHelpVoice_id&&(stop_HelpVoice(glCurrentPlayHelpVoice_id),glCurrentPlayHelpVoice_id=0),1==a.HelpVoice_id?(HelpVoice_id=HelpVoiceAudio1.play(),console.log("play_HelpVoice() HelpVoiceAudio1.play() HelpVoice_id:"+HelpVoice_id)):
2==a.HelpVoice_id?(HelpVoice_id=HelpVoiceAudio2.play(),console.log("play_HelpVoice() HelpVoiceAudio2.play() HelpVoice_id:"+HelpVoice_id)):3==a.HelpVoice_id?(HelpVoice_id=FenceAlertHelpVoiceAudio1.play(),console.log("play_HelpVoice() FenceAlertHelpVoiceAudio1.play() HelpVoice_id:"+HelpVoice_id)):4==a.HelpVoice_id&&(HelpVoice_id=FenceAlertHelpVoiceAudio2.play(),console.log("play_HelpVoice() FenceAlertHelpVoiceAudio2.play() HelpVoice_id:"+HelpVoice_id)),glCurrentPlayHelpVoice_id=a.HelpVoice_id)}else 0<
glCurrentPlayHelpVoice_id&&(stop_HelpVoice(glCurrentPlayHelpVoice_id),glCurrentPlayHelpVoice_id=0)}
function stop_HelpVoice(a){1==a?(console.log("stop_HelpVoice("+a+") HelpVoiceAudio1.stop()"),HelpVoiceAudio1.stop()):2==a?(console.log("stop_HelpVoice("+a+") HelpVoiceAudio2.stop()"),HelpVoiceAudio2.stop()):3==a?(console.log("stop_HelpVoice("+a+") FenceAlertHelpVoiceAudio1.stop()"),FenceAlertHelpVoiceAudio1.stop()):4==a&&(console.log("stop_HelpVoice("+a+") FenceAlertHelpVoiceAudio2.stop()"),FenceAlertHelpVoiceAudio2.stop())};var glUpdatetime_countdown=1,firedEvents_count=20,firedEvents_offset=0,firedEvents_start_date="",gl_allevents=[],gl_AlreadyRunging=!1,gl_user_info=[],gl_EditMode=!1;load_user_info();update_timeline();
function load_user_info(){$.getJSON(gl_target_server+"/php/vilsnodes.php","userinfo=1&project_id="+project_id,function(a){$.each(a,function(a,b){var c=[];c.userid=parseInt(b.userid);c.account=b.account;c.empid=parseInt(b.userid);c.cname=b.name;c.orgName=b.unit;c.gender=b.gender;gl_user_info.push(c)})}).success(function(){}).error(function(){}).complete(function(){})}function update_timeline(){load_events_from_server()}
function load_events_from_server(){gl_AlreadyRunging||(gl_EditMode?console.log("update_timeline() gl_EditMode"):(gl_AlreadyRunging=!0,firedEvents_offset=0,$.getJSON(gl_target_server+"/php/eventfire.php?project_id="+project_id+"&prettystring=1&markasread=0&count="+firedEvents_count+"&offset="+firedEvents_offset,"",function(a){gl_allevents=[];$.each(a,function(a,b){gl_allevents.push(b)});firedEvents_start_date=""}).success(function(){var a=gl_allevents.slice().reverse(),a=merge_same_event(a),a=pair_event(a),
a=merge_same_tagaction_event(a).reverse();show_pairevent_timeline(a);10>a.length&&(firedEvents_count+=10);gl_AlreadyRunging=!1}).error(function(){setTimeout(update_timeline,3E3)}).complete(function(){glUpdatetime_countdown--;0<glUpdatetime_countdown?setTimeout(update_timeline,1E3):setTimeout(update_timeline,3E3)})))}function load_events_from_testdata(){gl_allevents=JSON.parse("")}
function merge_same_event(a){var e=[],b;for(b=0;b<a.length;b++){var c=a[b],g=c.eventjson.eventid;if(void 0==g){var f={type:"none",events:[]};f.events.push(c)}else{var h=c.eventjson.nodeid,k=c.eventjson.action,m=c.eventjson.locatorid,l=c.datetime;void 0==c.eventjson.nodeid&&void 0==c.eventjson.locatorid&&(m=h=c.eventjson.cardid,void 0!=c.eventjson.loramacaddress&&(m=c.eventjson.loramacaddress));f={};f.type=g;f.events=[];f.events.push(c);for(g=b+1;g<a.length;){var d=a[g];if(void 0==d.eventjson.eventid)g++;
else{var n=d.eventjson.nodeid,t=d.eventjson.action,r=d.eventjson.locatorid,q=d.datetime;void 0==d.eventjson.nodeid&&void 0==d.eventjson.locatorid&&(r=n=d.eventjson.cardid,void 0!=d.eventjson.loramacaddress&&(r=d.eventjson.loramacaddress));if(h===n&&k===t&&m===r){n=moment(l,"YYYY-MM-DD HH:mm:ss");q=moment(q,"YYYY-MM-DD HH:mm:ss").diff(n);q=moment.duration(q)/1E3;n=61;"Cancel"===k&&(n=90);"CallOut"===k&&(n=300);if(c.eventjson.areaid!=d.eventjson.areaid)break;if(q<n)f.events=addto_merageevent_list(f.events,
d),a.splice(g,1);else break}else if(k!=t&&m===r)break;else g++}}}e.push(f)}return e}function addto_merageevent_list(a,e){for(var b=!1,c=0;c<a.length;c++){var g=a[c];g.eventjson.locatorid===e.eventjson.locatorid&&(g.lastdatetime=e.datetime,b=!0);void 0==g.eventjson.locatorid&&g.eventjson.cardid===e.eventjson.cardid&&(g.lastdatetime=e.datetime,b=!0)}0==b&&a.push(e);return a}
function pair_event(a){var e=[],b;for(b=0;b<a.length;b++){var c=a[b],g=c.events[0],f=g.eventjson.eventid;if(void 0==f){var h={type:"single",events1:[],events2:[]};h.events1.push(g);e.push(h)}else if("9999"===f||"8888"===f)if(h=g.eventjson.action,"Alert"===h||"AlertTagNotMoving"===h||"AlertLayDown"===h||"CallOut"===h){var h={type:"pair",events1:[],events2:[]},k=!1,m;for(m=b+1;m<a.length;m++){var l=a[m],d=l.events[0];if(void 0!=f&&"Cancel"===d.eventjson.action){for(d=0;d<c.events.length;d++){for(var n=
c.events[d],t=n.eventjson.locatorid,r=0;r<l.events.length;r++){var q=l.events[r];if(t===q.eventjson.locatorid){n=moment(n.datetime,"YYYY-MM-DD HH:mm:ss");q=moment(q.datetime,"YYYY-MM-DD HH:mm:ss").diff(n);600>moment.duration(q)/1E3&&(k=!0);break}if(k)break}if(k)break}if(k){Array.prototype.push.apply(h.events1,l.events);Array.prototype.push.apply(h.events2,c.events);break}}}1==k?(e.push(h),b=m):0==k&&(h={type:"single",events1:[],events2:[]},h.events1.push(g),e.push(h))}else h={type:"single",events1:[],
events2:[]},h.events1.push(g),e.push(h);else h={type:"single",events1:[],events2:[]},h.events1.push(g),e.push(h)}return e}
function merge_same_tagaction_event(a){var e=[],b;for(b=0;b<a.length;b++){var c=a[b];if("single"===c.type&&(9999==c.eventid||8888==c.eventid)){var g=c.events1[0],f=g.eventjson.nodeid,h=g.datetime;void 0==g.eventjson.nodeid&&(f=g.eventjson.cardid);for(g=b+1;g<a.length;g++){var k=a[g];if("single"===k.type){var k=k.events1[0],m=k.eventjson.nodeid,l=k.datetime;void 0==k.eventjson.nodeid&&(m=k.eventjson.cardid);if(void 0!=k.eventjson.eventid){var d=moment(h,"YYYY-MM-DD HH:mm:ss"),l=moment(l,"YYYY-MM-DD HH:mm:ss").diff(d);
if(60<moment.duration(l)/1E3)break;f===m&&(c.type="sametag",c.events1.push(k),a.splice(g,1))}}}}e.push(c)}return e}
function show_pairevent_timeline(a){gl_ui_firedEvents_offset=0;var e;for(e=0;e<a.length;e++){var b=a[e];"single"===b.type?(b=create_single_event_html(b.events1[0],gl_ui_firedEvents_offset+1),$(".ajax-content-"+gl_ui_firedEvents_offset).html(b),gl_ui_firedEvents_offset+=1):"pair"===b.type?(b=create_pair_event_html(b.events1,b.events2,gl_ui_firedEvents_offset+1),$(".ajax-content-"+gl_ui_firedEvents_offset).html(b),gl_ui_firedEvents_offset+=1):"sametag"===b.type&&(b=b.events1.reverse(),b=create_sametag_event_html(b,
gl_ui_firedEvents_offset+1),$(".ajax-content-"+gl_ui_firedEvents_offset).html(b),gl_ui_firedEvents_offset+=1)}0==a.length&&($("#AjaxLoadMode").prop("disabled",!0),$("#AjaxLoadMode").prop("class","btn btn-lrg ajax"),$("#AjaxLoadMode").html("No more data."),$("#AjaxLoadModeicon").hide())}
function create_single_event_html(a,e){var b=a.prettyjson,c=a.eventjson,g=a.datetime,f='<ul class="timeline">',h=moment(g).format("YYYY MMM Do");firedEvents_start_date!=h&&(firedEvents_start_date=h,f+='<li class="time-label"><span class="bg-red">'+h+"</span></li>");f="Enter"==c.action?f+'<li><i class="fa fa-sign-in bg-aqua"></i>':"Leave"==c.action?f+'<li><i class="fa fa-share-square-o bg-yellow-active"></i>':"Stay"==c.action?f+'<li><i class="fa fa-street-view bg-aqua-active"></i>':"Alert"==c.action||
"AlertTagNotMoving"==c.action||"AlertLayDown"==c.action?f+'<li><i class="fa fa-bell-o bg-red"></i>':"Cancel"==c.action?f+'<li><i class="fa fa-bell-slash-o bg-blue"></i>':"CallOut"==c.action?f+'<li><i class="fa fa-hand-paper-o bg-green"></i>':"PowerOff"==c.action?f+'<li><i class="fa fa-flash bg-red"></i>':"PowerOn"==c.action?f+'<li><i class="fa fa-flash bg-green"></i>':"OpenDoor"==c.action?f+'<li><i class="fa fa-unlock bg-red"></i>':"CloseDoor"==c.action?f+'<li><i class="fa fa-lock bg-green"></i>':
"EnterDoor"==c.action?f+'<li><i class="fa fa-sign-in bg-red"></i>':"iCoverOpenDoor"==c.action?f+'<li><i class="fa fa-unlock bg-red"></i>':"iCoverCloseDoor"==c.action?f+'<li><i class="fa fa-lock bg-green"></i>':"ExitDoor"==c.action?f+'<li><i class="fa fa-sign-out bg-green"></i>':"SensorAlert"==c.action?f+'<li><i class="fa fa-rss bg-red"></i>':"unknowncard"==c.action?f+'<li><i class="fa fa-warning bg-red"></i>':"BodyInfoAlertNormal"==c.action?f+'<li><i class="fa fa-street-view bg-green"></i>':"BodyInfoAlertWarning"==
c.action?f+'<li><i class="fa fa-street-view bg-yellow"></i>':"BodyInfoAlertDanger"==c.action?f+'<li><i class="fa fa-street-view bg-red"></i>':f+'<li><i class="fa fa-street-view bg-yellow"></i>';f=f+'<div class="timeline-item">'+('<span class="time"><i class="fa fa-clock-o"></i>&nbsp;'+moment(g).format("hh:mm:ss A")+"</span>");"inspectionpoint"==b.type?(f+="<a href=\"javascript:;\" onclick=\"markclick('tag', '"+c.Inspector+"');return false;\">"+b.tagname+"&nbsp;&nbsp;</a></h3>",f=f+'<div class="timeline-body">'+
(convert_action_name(b.actionname)+"&nbsp;</br>"),f+="\u5de1\u6aa2\u9ede:"+b.inspectionpointname+"&nbsp;"):"inspectionpointtravel"==b.type?(0<b.tagname.length&&(f+="<a href=\"javascript:;\" onclick=\"markclick('tag', '"+c.Inspector+"');return false;\">"+b.tagname+"&nbsp;&nbsp;</a></h3>"),f=f+'<div class="timeline-body">'+(convert_action_name(b.actionname)+"&nbsp;</br>"),f+="\u5de1\u6aa2\u9ede:",null!=b.startinspectionpointname&&null!=b.endinspectionpointname?(f+=b.startinspectionpointname,f=f+"&nbsp;->"+
b.endinspectionpointname):null!=b.startinspectionpointname?f+=b.startinspectionpointname:null!=b.endinspectionpointname&&(f+=b.endinspectionpointname)):"inspectionGroup"==b.type?(f+="<a href=\"javascript:;\" onclick=\"markclick('inspectionGroup', '"+c.GroupID+"');return false;\">"+b.groupname+"&nbsp;&nbsp;</a></h3>",f=f+'<div class="timeline-body">'+(convert_action_name(b.actionname)+"&nbsp;</br>")):"rfidcard"==b.type?(f+='<a href="javascript:;" onclick="copyTextToClipboard(\''+b.cardid+"', '"+g+
"');return false;\">"+b.cardid+"&nbsp;&nbsp;</a></h3>",f+='<span id="cardid_copy_alert_'+b.cardid+"_"+g+'"></span>',f=f+'<div class="timeline-body">'+(b.locatorname+"&nbsp;"),f+=convert_action_name(b.actionname)+"&nbsp;</br>"):"nfccard"==b.type?(f+='<a href="javascript:;" onclick="copyTextToClipboard(\''+b.cardid+"', '"+g+"');return false;\">"+b.cardid+"&nbsp;&nbsp;</a></h3>",f+='<span id="cardid_copy_alert_'+b.cardid+"_"+g+'"></span>',f=f+'<div class="timeline-body">'+(b.locatorname+"&nbsp;"),f+=
convert_action_name(b.actionname)+"&nbsp;</br>"):(f+="<a href=\"javascript:;\" onclick=\"markclick('tag', '"+c.nodeid+"');return false;\">"+b.nodename+"&nbsp;&nbsp;</a></h3>",f+='<div class="timeline-body">',0<b.locatorname.length&&b.locatorname!=b.nodename&&(f+="\u5728"+b.locatorname),void 0!=c.lat&&(f+="\u4f4d\u7f6e"+c.lat+","+c.lng+"&nbsp;",f+='<a href="javascript:;" onclick="open_gmap('+c.lat+","+c.lng+');return false;"><i class="fa fa-map-marker"></i></a>',f+="&nbsp;</br>"),f+=convert_action_name(b.actionname)+
"&nbsp;",f+=b.areaname+"&nbsp;","0"!==c.issuetime&&(f+=convert_IssueTime_name(b.timename)+"&nbsp;"));f+="</div>";"9999"!==c.eventid||"Alert"!=c.action&&"AlertTagNotMoving"!=c.action&&"AlertLayDown"!=c.action&&"Cancel"!=c.action&&"CallOut"!=c.action||(f+=create_extra_info(a));return f+"</div></li>"+('</ul><div class="ajax-content-'+e+'"></div>')}
function create_pair_event_html(a,e,b){var c=e[0],g=c.prettyjson,f=c.eventjson,h='<ul class="timeline">',c=moment(c.datetime).format("YYYY MMM Do");firedEvents_start_date!=c&&(firedEvents_start_date=c,h+='<li class="time-label"><span class="bg-red">'+c+"</span></li>");c=g.nodename;g=!0;"Alert"==f.action||"AlertTagNotMoving"==f.action||"AlertLayDown"==f.action?h+='<li><i class="fa fa-bell-o bg-red"></i>':"CallOut"==f.action?h+='<li><i class="fa fa-hand-paper-o bg-green"></i>':"PowerOff"==f.action?
h+='<li><i class="fa fa-flash bg-red"></i>':"PowerOn"==f.action?h+='<li><i class="fa fa-flash bg-green"></i>':"OpenDoor"==f.action?h+='<li><i class="fa fa-unlock bg-red"></i>':"CloseDoor"==f.action?h+='<li><i class="fa fa-lock bg-green"></i>':"EnterDoor"==f.action?h+='<li><i class="fa fa-sign-in bg-red"></i>':"ExitDoor"==f.action?h+='<li><i class="fa fa-sign-out bg-green"></i>':"SensorAlert"==f.action?h+='<li><i class="fa fa-rss bg-red"></i>':"unknowncard"==f.action?(c=f.cardid,g=!1,h+='<li><i class="fa fa-warning bg-red"></i>'):
h+='<li><i class="fa fa-street-view bg-yellow"></i>';h=h+'<div class="timeline-item">'+("<a href=\"javascript:;\" onclick=\"markclick('tag', '"+f.nodeid+"');return false;\">"+c+"&nbsp;&nbsp;</a></h3>");h+='<div class="timeline-body"></div></div>';f=null;for(c=0;c<a.length;){a=a[c];null==f&&(f=a);h+=create_event_html(a,!1,a);break}for(c=0;c<e.length;){a=e[c];h=c==e.length-1?h+create_event_html(a,g,f):h+create_event_html(a,!1,f);break}return h+"</li>"+('</ul><div class="ajax-content-'+b+'"></div>')}
function create_sametag_event_html(a,e){var b=a[0],c=b.prettyjson,g=b.eventjson,f='<ul class="timeline">',h=moment(b.datetime).format("YYYY MMM Do");firedEvents_start_date!=h&&(firedEvents_start_date=h,f+='<li class="time-label"><span class="bg-red">'+h+"</span></li>");h=c.nodename;c=!0;1<a.length&&(b=a[a.length-1]);"Alert"==b.eventjson.action||"AlertTagNotMoving"==b.action||"AlertLayDown"==b.action?f+='<li><i class="fa fa-bell-o bg-red"></i>':"Cancel"==b.eventjson.action?f+='<li><i class="fa fa-bell-slash-o bg-blue"></i>':
"CallOut"==b.eventjson.action?f+='<li><i class="fa fa-hand-paper-o bg-green"></i>':"PowerOff"==b.eventjson.action?f+='<li><i class="fa fa-flash bg-red"></i>':"PowerOn"==b.eventjson.action?f+='<li><i class="fa fa-flash bg-green"></i>':"OpenDoor"==b.eventjson.action?f+='<li><i class="fa fa-unlock bg-red"></i>':"CloseDoor"==b.eventjson.action?f+='<li><i class="fa fa-lock bg-green"></i>':"EnterDoor"==b.eventjson.action?f+='<li><i class="fa fa-sign-in bg-red"></i>':"ExitDoor"==b.eventjson.action?f+='<li><i class="fa fa-sign-out bg-green"></i>':
"SensorAlert"==b.eventjson.action?f+='<li><i class="fa fa-rss bg-red"></i>':"unknowncard"==b.eventjson.action?(h=g.cardid,c=!1,f+='<li><i class="fa fa-warning bg-red"></i>'):f+='<li><i class="fa fa-street-view bg-yellow"></i>';f=f+'<div class="timeline-item">'+("<a href=\"javascript:;\" onclick=\"markclick('tag', '"+g.nodeid+"');return false;\">"+h+"&nbsp;&nbsp;</a></h3>");f+='<div class="timeline-body"></div></div>';for(g=0;g<a.length;g++)b=a[g],f=g==a.length-1?f+create_event_html(b,c,b):f+create_event_html(b,
!1,b);return f+"</li>"+('</ul><div class="ajax-content-'+e+'"></div>')}function create_event_html(a,e,b){var c=a.prettyjson;a='<div class="timeline-item">'+('<span class="time"><i class="fa fa-clock-o"></i>&nbsp;'+moment(a.datetime).format("hh:mm:ss A")+"</span>");a=a+'<div class="timeline-body">'+(convert_action_name(c.actionname)+"&nbsp;");a+=c.areaname+"&nbsp;";a+="</div>";e&&(a+=create_extra_info(b));return a+"</div>"}
function create_extra_info(a){var e=a.empid,b=findUserName(a.empid),c=a.comment,g=!0;0==b.length&&(b="\u57f7\u884c\u4eba\u54e1",g=!1);new_html="";new_html+='<div class="timeline-footer">';new_html+="<div id=timeline_footer_"+a.firedeventid+">";new_html+="<button type='button' class='btn btn-box-tool' onclick='click_edit_event("+a.firedeventid+', "'+e+'", "'+b+'", "'+c+"\");return false;'><i class='fa fa-edit'></i></button>&nbsp;";new_html=g?new_html+('<a class="btn btn-primary btn-xs">'+b+"</a>&nbsp;"):
new_html+('<a class="btn btn-warning btn-xs">'+b+"</a>&nbsp;");new_html+='<textarea class="form-control" rows="1" placeholder="\u8f38\u5165\u8a3b\u89e3..."  disabled>'+c+"</textarea>";new_html+="</div>";return new_html+="</div>"}function refresh_timeline(){0>=glUpdatetime_countdown?(glUpdatetime_countdown=10,update_timeline()):glUpdatetime_countdown=10}
function click_edit_event(a,e,b,c){console.log("click_edit_event() firedeventid:"+a+" empid:"+e);gl_EditMode=!0;for(var g=document.getElementById("timeline_footer_"+a);g.firstChild;)g.removeChild(g.firstChild);var f=document.createElement("button");f.setAttribute("type","button");f.setAttribute("class","btn btn-box-tool");f.setAttribute("onclick","click_save_event("+a+");return false;");var h=document.createElement("i");h.setAttribute("class","fa fa-save");f.appendChild(h);g.appendChild(f);f=document.createElement("div");
f.setAttribute("class","btn-group");h=document.createElement("button");h.setAttribute("type","button");h.setAttribute("class","btn btn-block btn-primary btn-xs dropdown-toggle");h.setAttribute("data-toggle","dropdown");h.setAttribute("data-id",e);h.setAttribute("id","dropdown_cur_user_"+a);h.textContent=b;f.appendChild(h);var k=document.createElement("span");k.setAttribute("class","caret");h.appendChild(k);h=document.createElement("ul");h.setAttribute("class","dropdown-menu");h.setAttribute("id",
"dropdown_user_"+a);f.appendChild(h);g.appendChild(f);add_user_dropdown_list(h,a,e,b);e=document.createElement("textarea");e.setAttribute("class","form-control");e.setAttribute("rows","1");e.setAttribute("id","comment_"+a);e.textContent=c;g.appendChild(e)}
function add_user_dropdown_list(a,e,b,c){c=create_dropdown_user_item("-1","\u4e0d\u6307\u5b9a",!1,e);a.appendChild(c);b=parseInt(b);for(var g=0;g<gl_user_info.length;g++)c=!1,gl_user_info[g].userid==b&&(c=!0),c=create_dropdown_user_item(gl_user_info[g].userid,gl_user_info[g].cname,c,e),a.appendChild(c)}
function create_dropdown_user_item(a,e,b,c){var g=document.createElement("li"),f=document.createElement("a");f.setAttribute("class","small");f.setAttribute("tabIndex","-1");f.setAttribute("data-value",a);f.setAttribute("href","javascript:;");f.setAttribute("onclick",'dropdown_user_click("'+c+'", "'+a+'");return true;');var h=document.createElement("input");h.setAttribute("type","checkbox");h.setAttribute("id","dropdown_checkbox_user_"+a);h.setAttribute("onclick",'dropdown_checkbox_user_click("'+c+
'", "'+a+'");return true;');h.checked=b;f.appendChild(h);f.appendChild(document.createTextNode(" "+e));g.appendChild(f);return g}var glDropdown_checkbox_user_click=!1;
function dropdown_user_click(a,e){console.log("dropdown_user_click() firedeventid:"+a+" userid:"+e);var b,c="";for(b=0;b<gl_user_info.length;b++)e==gl_user_info[b].userid?(c=gl_user_info[b].cname+" ",document.getElementById("dropdown_checkbox_user_"+gl_user_info[b].userid).checked=!0):document.getElementById("dropdown_checkbox_user_"+gl_user_info[b].userid).checked=!1;b=document.getElementById("dropdown_cur_user_"+a);-1==e?(document.getElementById("dropdown_checkbox_user_-1").checked=!0,b.setAttribute("data-id",
"-1"),b.innerHTML='<span class="caret"></span>'):(b.setAttribute("data-id",e),b.innerHTML=c+'<span class="caret"></span>');console.log("dropdown_user_click() firedeventid:"+a+" -> userid:"+e);glDropdown_checkbox_user_click=!1}function dropdown_checkbox_user_click(a,e){glDropdown_checkbox_user_click=!0}
function click_save_event(a){var e=$("#dropdown_cur_user_"+a).attr("data-id"),b=document.getElementById("comment_"+a).value;update_FiredEvents_user(a,e,b);gl_EditMode=!1;setTimeout(update_timeline,500)}
function update_FiredEvents_user(a,e,b){var c={};c.project_id=""+project_id;c.UPDATE_FIREDEVENT_USER=1;c.ID=a;c.EMPID=e;c.COMMENT=b;jQuery.ajax({url:gl_target_server+"/php/eventfire.php",type:"POST",data:c,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a))},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}});return!1}
function fallbackCopyTextToClipboard(a,e){var b=document.createElement("textarea");b.value=a;b.style.top="0";b.style.left="0";b.style.position="fixed";document.body.appendChild(b);b.focus();b.select();var c=document.getElementById("cardid_copy_alert_"+a+"_"+e);try{var g=document.execCommand("copy");c.textContent=g?"\u5df2\u8907\u88fd":"\u7121\u6cd5\u8907\u88fd";setTimeout(clear_alert_msg,3E3,a,e);console.log("Fallback: Copying text command was "+(g?"successful":"unsuccessful"))}catch(f){console.error("Fallback: Oops, unable to copy",
f),c.textContent="\u7121\u6cd5\u8907\u88fd",setTimeout(clear_alert_msg,3E3,a,e)}document.body.removeChild(b)}
function copyTextToClipboard(a,e){if(navigator.clipboard){var b="cardid_copy_alert_"+a+"_"+e;navigator.clipboard.writeText(a).then(function(){console.log("Async: Copying to clipboard was successful!");document.getElementById(b).textContent="\u5df2\u8907\u88fd";setTimeout(clear_alert_msg,3E3,a,e)},function(b){console.error("Async: Could not copy text: ",b);alert_msg_ui.textContent="\u7121\u6cd5\u8907\u88fd";setTimeout(clear_alert_msg,3E3,a,e)})}else fallbackCopyTextToClipboard(a,e)}
function markclick(a,e){console.log("markclick() type:"+a+" id:"+e);0>parent.document.getElementById("contentIframe").src.indexOf("vils2dmap")?(console.log("curURL:"+parent.document.getElementById("contentIframe").src),parent.show_2dmap(project_id),setTimeout(show_mark,300,e)):void 0!=parent.$("#contentIframe")[0]&&"function"===typeof parent.$("#contentIframe")[0].contentWindow.markclick&&parent.$("#contentIframe")[0].contentWindow.markclick(e)}
function show_mark(a){"function"===typeof parent.$("#contentIframe")[0].contentWindow.markclick?parent.$("#contentIframe")[0].contentWindow.markclick(a):setTimeout(show_mark,300,a)}function clear_alert_msg(a,e){document.getElementById("cardid_copy_alert_"+a+"_"+e).textContent=""}function findUserName(a){var e="";a=parseInt(a);for(var b=0;b<gl_user_info.length;b++)if(a==gl_user_info[b].userid){e=gl_user_info[b].cname;break}return e}
function open_gmap(a,e){window.open("http://www.google.com/maps/place/"+a+","+e,"_blank").focus()};
