var PreLoadIndex=-1,CurrentLoadIndex=0,LOAD_STATE_END=9999,LOAD_PAGE_NUM=20,gl_user_info=[],gl_curriculum_List=[],gl_shared_curriculum_List=[],gl_shared_curriculumrecord_List=[],gl_curriculumtype_List=[],gl_usersubgroups=[],gl_allmaingroups=[],gl_curriculumprefix="",glCurrentPage=1,glSharedCurrentPage=1;check_loading_status();
function check_loading_status(){switch(CurrentLoadIndex){case 0:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,load_usersubgroup(),load_allmaingroup());break;case 1:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,load_CurriculumType());break;case 2:PreLoadIndex!=
CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,load_Curriculums());break;case 3:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,load_shared_Curriculums());break;case 4:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+
CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,load_shared_CurriculumRecords());break;case 5:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,load_CurriculumPrefix());break;case 6:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,show_Curriculums(),show_shared_CurriculumRecords(),
show_CurriculumType(),CurrentLoadIndex+=1);break;case 7:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,load_user_info(),CurrentLoadIndex+=1);break;case 8:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,CurrentLoadIndex=LOAD_STATE_END)}CurrentLoadIndex!=LOAD_STATE_END?
setTimeout(check_loading_status,100):console.log("check_loading_status() Stop.")}function load_usersubgroup(){gl_usersubgroups=[];$.getJSON(gl_target_server+"/php/vilsnodes.php","loadusersubgroup=1&project_id="+project_id+"&type=0",function(a){$.each(a,function(a,b){b.id=parseInt(b.id);gl_usersubgroups.push(b)})}).success(function(){}).error(function(){}).complete(function(){})}
function load_allmaingroup(){gl_allmaingroups=[];$.getJSON(gl_target_server+"/php/vilsnodes.php","loadallmaingroup=1&project_id="+project_id,function(a){$.each(a,function(a,b){b.id=parseInt(b.id);gl_allmaingroups.push(b)})}).success(function(){CurrentLoadIndex+=1}).error(function(){}).complete(function(){})}
function load_CurriculumType(){var a=gl_target_server+"/php/curriculum.php";gl_curriculumtype_List=[];$.getJSON(a,"loadcurriculumtype=1&project_id="+project_id,function(a){$.each(a,function(a,c){c.id=parseInt(c.id);gl_curriculumtype_List.push(c)})}).success(function(){CurrentLoadIndex+=1}).error(function(){CurrentLoadIndex+=1}).complete(function(){})}
function load_Curriculums(){var a=gl_target_server+"/php/curriculum.php",c=(glCurrentPage-1)*LOAD_PAGE_NUM,b=LOAD_PAGE_NUM;gl_curriculum_List=[];$.getJSON(a,"loadcurriculums=1&project_id="+project_id+"&offset="+c+"&count="+b,function(a){$.each(a,function(a,b){b.id=parseInt(b.id);b.userid=parseInt(b.userid);b.typeid=parseInt(b.typeid);gl_curriculum_List.push(b)})}).success(function(){CurrentLoadIndex+=1}).error(function(){CurrentLoadIndex+=1}).complete(function(){})}
function load_shared_Curriculums(){var a=gl_target_server+"/php/curriculum.php";gl_shared_curriculum_List=[];$.getJSON(a,"loadsharedcurriculums=1&project_id="+project_id,function(a){$.each(a,function(a,c){c.id=parseInt(c.id);c.userid=parseInt(c.userid);c.typeid=parseInt(c.typeid);gl_shared_curriculum_List.push(c)})}).success(function(){CurrentLoadIndex+=1}).error(function(){CurrentLoadIndex+=1}).complete(function(){})}
function load_shared_CurriculumRecords(){var a=gl_target_server+"/php/curriculum.php",c=(glSharedCurrentPage-1)*LOAD_PAGE_NUM,b=LOAD_PAGE_NUM;gl_shared_curriculumrecord_List=[];for(var d=[],e=0;e<gl_shared_curriculum_List.length;e++)d.push(gl_shared_curriculum_List[e].recordid);$.getJSON(a,"loadsharedcurriculumrecords=1&project_id="+project_id+"&recordids="+d.toString()+"&offset="+c+"&count="+b,function(a){$.each(a,function(a,b){b.id=parseInt(b.id);b.userid=parseInt(b.userid);b.curriculumid=parseInt(b.curriculumid);
b.shared=parseInt(b.shared);gl_shared_curriculumrecord_List.push(b)})}).success(function(){CurrentLoadIndex+=1}).error(function(){CurrentLoadIndex+=1}).complete(function(){})}
function load_CurriculumPrefix(){$.getJSON(gl_target_server+"/php/curriculum.php","loadcurriculumprefix=1&project_id="+project_id,function(a){gl_curriculumprefix=a.prefix;document.getElementById("curriculumprefix_label").textContent="\u8ab2\u7a0b\u4ee3\u78bc:"+gl_curriculumprefix}).success(function(){CurrentLoadIndex+=1}).error(function(){CurrentLoadIndex+=1}).complete(function(){})}
function show_Curriculums(){for(var a=document.getElementById("CURRICULUM_TABLE_BODY");a.firstChild;)a.removeChild(a.firstChild);for(var c=0;c<gl_curriculum_List.length;c++)show_Curriculum(a,(glCurrentPage-1)*LOAD_PAGE_NUM+c+1,gl_curriculum_List[c])}
function show_Curriculum(a,c,b){var d=0,e=document.createElement("tr");e.setAttribute("id",b.id+"_TABLE_ROW");0==c%2&&e.setAttribute("bgcolor","#ebebe0");a.appendChild(e);e.appendChild(document.createElement("td"));e.cells[d].appendChild(document.createTextNode(""+c));d++;e.appendChild(document.createElement("td"));a=document.createElement("div");a.appendChild(create_user_label(b.id,b.userid));e.cells[d].appendChild(a);d++;a=create_maingroups(b.maingroups);a.setAttribute("id","maingroups_"+b.id);
e.appendChild(a);d++;e.appendChild(document.createElement("td"));a=document.createElement("div");a.setAttribute("id","type_"+b.id);a.appendChild(create_type_label(b.typeid));e.cells[d].appendChild(a);d++;e.appendChild(document.createElement("td"));a=document.createElement("div");a.setAttribute("id","shared_"+b.id);a.textContent=1==b.shared?"\u662f":"\u5426";e.cells[d].appendChild(a);d++;a=create_maingroups(b.sharedmaingroups);a.setAttribute("id","sharedmaingroups_"+b.id);e.appendChild(a);d++;a=create_subgroups(b.subgroups);
a.setAttribute("id","subgroups_"+b.id);e.appendChild(a);d++;e.appendChild(document.createElement("td"));a=document.createElement("div");a.setAttribute("id","number_"+b.id);a.appendChild(document.createTextNode(b.number));e.cells[d].appendChild(a);d++;e.appendChild(document.createElement("td"));a=document.createElement("button");a.setAttribute("id","edit_curriculum_btn_"+b.id);a.setAttribute("title","Edit this Curriculum");a.setAttribute("href","javascript:;");a.setAttribute("onclick","edit_curriculum("+
b.id+");return false;");c=document.createElement("i");c.setAttribute("id","edit_curriculum_img_"+b.id);c.setAttribute("class","fa fa-edit");a.appendChild(c);e.cells[d].appendChild(a);a=document.createElement("button");a.setAttribute("id","delete_curriculum_btn_"+b.id);a.setAttribute("style","display:none");a.setAttribute("title","Delete this Curriculum");a.setAttribute("href","javascript:;");a.setAttribute("onclick","confirm_delete_curriculum("+b.id+");return false;");b=document.createElement("i");
b.setAttribute("class","fa fa-trash-o");a.appendChild(b);e.cells[d].appendChild(a)}function show_shared_CurriculumRecords(){for(var a=document.getElementById("SHARED_CURRICULUM_TABLE_BODY");a.firstChild;)a.removeChild(a.firstChild);for(var c=0;c<gl_shared_curriculumrecord_List.length;c++)show_shared_CurriculumRecord(a,(glCurrentPage-1)*LOAD_PAGE_NUM+c+1,gl_shared_curriculumrecord_List[c])}
function show_shared_CurriculumRecord(a,c,b){var d=0,e=getSharedCurriculum(b.curriculumid),f=document.createElement("tr");f.setAttribute("id",b.id+"_TABLE_ROW");0==c%2&&f.setAttribute("bgcolor","#ebebe0");a.appendChild(f);f.appendChild(document.createElement("td"));f.cells[d].appendChild(document.createTextNode(""+c));d++;f.appendChild(document.createElement("td"));a=document.createElement("div");a.appendChild(create_user_label(b.id,b.userid));f.cells[d].appendChild(a);d++;a=create_maingroups(b.maingroups);
f.appendChild(a);d++;f.appendChild(document.createElement("td"));a=document.createElement("div");a.appendChild(create_type_label(e.typeid));f.cells[d].appendChild(a);d++;f.appendChild(document.createElement("td"));a=document.createElement("div");a.appendChild(document.createTextNode(b.name));f.cells[d].appendChild(a);d++;a=create_subgroups(b.subgroups);a.setAttribute("id","shared_subgroups_"+b.id);f.appendChild(a);d++;f.appendChild(document.createElement("td"));e=document.createElement("div");e.appendChild(document.createTextNode(b.number));
f.cells[d].appendChild(e);d++;f.appendChild(document.createElement("td"));e=document.createElement("button");e.setAttribute("id","edit_shared_curriculum_btn_"+b.id);e.setAttribute("title","Edit this Curriculum");e.setAttribute("href","javascript:;");e.setAttribute("onclick","edit_shared_curriculum("+b.id+","+b.curriculumid+");return false;");a=document.createElement("i");a.setAttribute("id","edit_shared_curriculum_img_"+b.id);a.setAttribute("class","fa fa-edit");e.appendChild(a);f.cells[d].appendChild(e)}
function create_select_shared_ui(a,c){var b=document.createElement("div");b.setAttribute("class","form-group");var d=create_radio_ui(a,"select_shared_"+a,"select_shared_yes_"+a,"\u662f",1==c),e=create_radio_ui(a,"select_shared_"+a,"select_shared_no_"+a,"\u5426",0==c);b.appendChild(d);b.appendChild(e);return b}
function create_radio_ui(a,c,b,d,e){var f=document.createElement("div");f.setAttribute("class","radio");var g=document.createElement("label");f.appendChild(g);var h=document.createElement("input");h.setAttribute("type","radio");h.setAttribute("name",c);h.setAttribute("id",b);h.setAttribute("onchange",'share_btn_click("'+a+'","'+d+'");');e&&(h.checked=!0);g.appendChild(h);g.appendChild(document.createTextNode(d));return f}
function share_btn_click(a,c){div_maingrouplist=document.getElementById("maingrouplist_"+a);"\u662f"===c?div_maingrouplist.setAttribute("style","display:block;"):div_maingrouplist.setAttribute("style","display:none;")}
function edit_curriculum(a){var c=clearChildView("type_"+a),b=clearChildView("shared_"+a),d=clearChildView("subgroups_"+a),e=clearChildView("sharedmaingroups_"+a),f=clearChildView("number_"+a),g=document.getElementById("edit_curriculum_btn_"+a),h=document.getElementById("edit_curriculum_img_"+a);g.setAttribute("title","Save this Curriculum");g.setAttribute("onclick","save_curriculum("+a+");return false;");h.setAttribute("class","fa fa-save");document.getElementById("delete_curriculum_btn_"+a).setAttribute("style",
"display:block");for(h=0;h<gl_curriculum_List.length;h++)if(g=gl_curriculum_List[h],g.id==a){h=create_edit_typelist_ui(a,g.typeid);c.appendChild(h);c=create_select_shared_ui(a,g.shared);b.appendChild(c);b=create_edit_subgrouplist_ui(a,g.subgroups);d.appendChild(b);d=create_edit_maingrouplist_ui(a,g.sharedmaingroups,g.shared);e.appendChild(d);f.appendChild(create_input_text("input_number_"+a,g.number));break}}
function edit_shared_curriculum(a,c){var b=clearChildView("shared_subgroups_"+a),d=document.getElementById("edit_shared_curriculum_btn_"+a),e=document.getElementById("edit_shared_curriculum_img_"+a);d.setAttribute("title","Save this Curriculum");d.setAttribute("onclick","save_shared_curriculum("+a+","+c+");return false;");e.setAttribute("class","fa fa-save");for(d=0;d<gl_shared_curriculumrecord_List.length;d++)if(e=gl_shared_curriculumrecord_List[d],e.curriculumid==c){d=create_edit_subgrouplist_ui(a,
e.subgroups);b.appendChild(d);break}}function confirm_delete_curriculum(a){confirm("Are you sure you want to delete this Curriculum ?")&&delete_curriculum(a)}
function delete_curriculum(a){var c={};c.project_id=""+project_id;c.delete_curriculum=1;c.id=a;jQuery.ajax({url:gl_target_server+"/php/curriculum.php",type:"POST",data:c,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a));setTimeout(reload_page,300)},error:function(a,c,e){alert("error = "+e);alert("xhr.responseText = "+a.responseText)}})}
function save_curriculum(a){for(var c=void 0,b=0;b<gl_curriculum_List.length;b++){var d=gl_curriculum_List[b];if(d.id==a){c=d;break}}if(void 0==c)alert("\u7121\u6b64\u4e8b\u9805\u7d00\u9304!");else{var c=getSelectedType(a),b=getSelectedMaingroup(a),d=getSelectedSubgroup(a),e=document.getElementById("input_number_"+a).value,f=document.getElementById("select_shared_yes_"+a).checked;document.getElementById("select_shared_no_"+a);if(0!=e.indexOf(gl_curriculumprefix))alert("\u8acb\u586b\u5165\u8ab2\u7a0b\u4ee3\u78bc:"+
gl_curriculumprefix);else{var g=0;f&&(g=1);f={};f.project_id=""+project_id;f.update_curriculum=1;f.id=a;f.typeid=c;f.subgroups=d;f.number=e;f.shared=g;f.sharedmaingroups=b;jQuery.ajax({url:gl_target_server+"/php/curriculum.php",type:"POST",data:f,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a));setTimeout(reload_page,300)},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}})}}}
function save_shared_curriculum(a,c){for(var b=void 0,d=0;d<gl_shared_curriculumrecord_List.length;d++){var e=gl_shared_curriculumrecord_List[d];if(e.curriculumid==c){b=e;break}}void 0==b?alert("\u7121\u6b64\u4e8b\u9805\u7d00\u9304!"):(d=getSelectedSubgroup(a),console.log("save_shared_curriculum() curCurriculumrecord.subgroups:"+b.subgroups),console.log("save_shared_curriculum() subgroups:"+d),b={},b.project_id=""+project_id,b.update_shared_curriculumrecord=1,b.recordid=a,b.curriculumid=c,b.subgroups=
d,jQuery.ajax({url:gl_target_server+"/php/curriculum.php",type:"POST",data:b,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a));setTimeout(reload_page,300)},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}}))}
function show_CurriculumType(){for(var a=document.getElementById("CURRICULUM_TYPE_TABLE_BODY");a.firstChild;)a.removeChild(a.firstChild);for(var c=0;c<gl_curriculumtype_List.length;c++)show_curriculumtype(a,c+1,gl_curriculumtype_List[c])}
function show_curriculumtype(a,c,b){var d=0,e=document.createElement("tr");e.setAttribute("id",b.id+"_CURRICULUM_TYPE_TABLE_ROW");0==c%2&&e.setAttribute("bgcolor","#ebebe0");a.appendChild(e);e.appendChild(document.createElement("td"));e.cells[d].appendChild(document.createTextNode(""+c));d++;e.appendChild(document.createElement("td"));a=document.createElement("div");a.setAttribute("id","curriculumtype_name_"+b.id);a.appendChild(document.createTextNode(b.name));e.cells[d].appendChild(a);d++;e.appendChild(document.createElement("td"));
a=document.createElement("button");a.setAttribute("id","edit_curriculumtype_btn_"+b.id);a.setAttribute("title","Edit this Curriculum Type");a.setAttribute("href","javascript:;");a.setAttribute("onclick","edit_curriculumtype("+b.id+");return false;");c=document.createElement("i");c.setAttribute("id","edit_curriculumtype_img_"+b.id);c.setAttribute("class","fa fa-edit");a.appendChild(c);e.cells[d].appendChild(a);a=document.createElement("button");a.setAttribute("id","delete_curriculumtype_btn_"+b.id);
a.setAttribute("style","display:none");a.setAttribute("title","Delete this Curriculum Type");a.setAttribute("href","javascript:;");a.setAttribute("onclick","confirm_delete_curriculumtype("+b.id+");return false;");b=document.createElement("i");b.setAttribute("class","fa fa-trash-o");a.appendChild(b);e.cells[d].appendChild(a)}
function edit_curriculumtype(a){for(var c=document.getElementById("curriculumtype_name_"+a);c.firstChild;)c.removeChild(c.firstChild);var b=document.getElementById("edit_curriculumtype_btn_"+a),d=document.getElementById("edit_curriculumtype_img_"+a);b.setAttribute("title","Save this Curriculum Type");b.setAttribute("onclick","save_curriculumtype("+a+");return false;");d.setAttribute("class","fa fa-save");document.getElementById("delete_curriculumtype_btn_"+a).setAttribute("style","display:block");
for(b=0;b<gl_curriculumtype_List.length;b++)if(d=gl_curriculumtype_List[b],d.id==a){c.appendChild(create_input_text("curriculumtype_input_name_"+a,d.name));break}}
function save_curriculumtype(a){var c=document.getElementById("curriculumtype_input_name_"+a).value;if(0==c.length)alert("\u8acb\u8f38\u5165\u8ab2\u7a0b\u985e\u5225");else{for(var b=void 0,d=0;d<gl_curriculumtype_List.length;d++){var e=gl_curriculumtype_List[d];if(e.id==a){b=e;break}}void 0==b?alert("\u7121\u6b64\u8ab2\u7a0b\u7d00\u9304!"):(b={},b.project_id=""+project_id,b.update_curriculumtype=1,b.id=a,b.name=c,jQuery.ajax({url:gl_target_server+"/php/curriculum.php",type:"POST",data:b,success:function(a){400==
a.status&&alert("update Error! response = "+JSON.stringify(a));setTimeout(reload_page,300)},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}}))}}function confirm_delete_curriculumtype(a){confirm("Are you sure you want to delete this Curriculum Type ?")&&delete_curriculumtype(a)}
function delete_curriculumtype(a){var c={};c.project_id=""+project_id;c.delete_curriculumtype=1;c.id=a;jQuery.ajax({url:gl_target_server+"/php/curriculum.php",type:"POST",data:c,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a));setTimeout(reload_page,300)},error:function(a,c,e){alert("error = "+e);alert("xhr.responseText = "+a.responseText)}})}
function load_user_info(){var a=[],c=check_userinfo_existed(parseInt(gl_userid));0==c&&a.push(gl_userid);for(var b=0;b<gl_curriculum_List.length;b++){var d=gl_curriculum_List[b],c=check_userinfo_existed(d.userid);if(0==c&&0<d.userid){for(var c=!1,e=0;e<a.length;e++)if(a[e]==d.userid){c=!0;break}c||a.push(d.userid)}}for(b=0;b<gl_shared_curriculumrecord_List.length;b++)if(d=gl_shared_curriculumrecord_List[b],c=check_userinfo_existed(d.userid),0==c&&0<d.userid){c=!1;for(e=0;e<a.length;e++)if(a[e]==d.userid){c=
!0;break}c||a.push(d.userid)}0==a.length?update_user_name():$.getJSON(gl_target_server+"/php/vilsnodes.php","queryusers=1&userid="+a.toString()+"&project_id="+project_id,function(a){$.each(a,function(a,b){b.userid=parseInt(b.userid);gl_user_info.push(b)})}).success(function(){update_user_name()}).error(function(){}).complete(function(){})}function check_userinfo_existed(a){for(var c=!1,b=0;b<gl_user_info.length;++b)if(gl_user_info[b].userid==a){c=!0;break}return c}
function update_user_name(){for(var a=0;a<gl_curriculum_List.length;a++){var c=gl_curriculum_List[a],b=document.getElementById("user_name_"+c.id+"_"+c.userid);b.textContent=getUserName(c.userid)}for(a=0;a<gl_shared_curriculumrecord_List.length;a++)c=gl_shared_curriculumrecord_List[a],b=document.getElementById("user_name_"+c.id+"_"+c.userid),b.textContent=getUserName(c.userid)}
function create_input_text(a,c){var b=document.createElement("textarea");b.setAttribute("rows","1");b.setAttribute("id",a);b.textContent=c;return b}function create_subgroup_label(a){var c=document.createElement("span");c.setAttribute("style","display:inline;padding:.2em .3em .3em;font-size:95%;font-weight:700;line-height:2;position:relative;top:-1px;color:#fff;border-radius:2px;white-space:nowrap;background-color:#00a65a;");c.textContent=a;return c}
function create_maingroup_label(a){var c=document.createElement("span");c.setAttribute("style","display:inline;padding:.2em .3em .3em;font-size:95%;font-weight:700;line-height:2;position:relative;top:-1px;color:#fff;border-radius:2px;white-space:nowrap;background-color:#00a65a;");c.textContent=a;return c}
function create_empty_spcae(){var a=document.createElement("span");a.setAttribute("style","display:inline;padding:.2em .3em .3em;font-size:95%;font-weight:700;line-height:2;position:relative;top:-1px;color:#fff;border-radius:2px;white-space:nowrap;");a.textContent="  ";return a}
function create_edit_typelist_ui(a,c){var b=document.createElement("select");b.setAttribute("id","select_type_"+a);for(var d=0;d<gl_curriculumtype_List.length;d++){var e=gl_curriculumtype_List[d],f=document.createElement("option");f.text=e.name;f.value=e.id;c==e.id&&f.setAttribute("selected","selected");b.appendChild(f)}return b}
function create_edit_subgrouplist_ui(a,c){var b=document.createElement("div");b.setAttribute("class","btn-group");var d=document.createElement("button");d.setAttribute("type","button");d.setAttribute("class","btn btn-default btn-sm dropdown-toggle");d.setAttribute("data-toggle","dropdown");d.textContent="\u5b50\u96c6\u5408";b.appendChild(d);var e=document.createElement("span");e.setAttribute("class","caret");d.appendChild(e);d=document.createElement("ul");d.setAttribute("class","dropdown-menu");b.appendChild(d);
if(1==gl_groupid||2==gl_groupid||3==gl_groupid){var e=document.createElement("li"),f=document.createElement("a");f.setAttribute("class","small");f.setAttribute("href","javascript:;");f.setAttribute("onclick",'dropdown_selectall("subgroup","'+a+'");return true;');e.appendChild(f);f.appendChild(document.createTextNode("\u5168\u9078"));d.appendChild(e)}e=c.split(",");for(f=0;f<gl_usersubgroups.length;++f){var g=gl_usersubgroups[f],h=check_numer_in_list(parseInt(g.subgroupid),e);d.appendChild(create_dropdown_subgroup_item(a,
f,parseInt(g.subgroupid),g.subgroupname,h))}return b}
function create_dropdown_subgroup_item(a,c,b,d,e){var f=document.createElement("li"),g=document.createElement("a");g.setAttribute("class","small");g.setAttribute("tabIndex","-1");g.setAttribute("data-value",b);g.setAttribute("href","javascript:;");g.setAttribute("onclick",'dropdown_subgroup_click("'+a+'",'+c+");return true;");b=document.createElement("input");b.setAttribute("type","checkbox");b.setAttribute("id","dropdown_checkbox_subgroup_"+a+"_"+c);b.setAttribute("onclick",'dropdown_checkbox_subgroup_click("'+
a+'",'+c+");return true;");b.checked=e;g.appendChild(b);g.appendChild(document.createTextNode(" "+d));f.appendChild(g);return f}function dropdown_checkbox_subgroup_click(a,c){glDropdown_checkbox_subgroup_click=!0}var glDropdown_checkbox_subgroup_click=!1;
function dropdown_subgroup_click(a,c){1!=glDropdown_checkbox_subgroup_click&&(1==document.getElementById("dropdown_checkbox_subgroup_"+a+"_"+c).checked?document.getElementById("dropdown_checkbox_subgroup_"+a+"_"+c).checked=!1:document.getElementById("dropdown_checkbox_subgroup_"+a+"_"+c).checked=!0);glDropdown_checkbox_subgroup_click=!1}
function dropdown_selectall(a,c){console.log("dropdown_selectall() prefix:"+a+" fileid:"+c);for(var b=0;100>b;b++){var d=document.getElementById("dropdown_checkbox_"+a+"_"+c+"_"+b);if(void 0==d){console.log("dropdown_selectall() fileid:"+c+" i:"+b+" ele == undefined ");break}d.checked=!0}}
function create_subgroups(a){var c=document.createElement("td"),b=document.createElement("div");b.setAttribute("class","row");c.appendChild(b);a=a.split(",");if(0<=a.indexOf("99999")){var d=document.createElement("div");d.setAttribute("class","col-md-6");d.appendChild(create_subgroup_label("\u5168\u90e8"));b.appendChild(d)}else for(var e=0,f=0;f<a.length;f++){var g=getSubgroupName(a[f]);0<g.length&&(d=document.createElement("div"),d.setAttribute("class","col-md-6"),b.appendChild(d),d.appendChild(create_subgroup_label(g)),
e++,5<=e&&(e=0))}return c}
function create_edit_maingrouplist_ui(a,c,b){var d=document.createElement("div");d.setAttribute("class","btn-group");d.setAttribute("id","maingrouplist_"+a);0==b&&d.setAttribute("style","display:none;");b=document.createElement("button");b.setAttribute("type","button");b.setAttribute("class","btn btn-default btn-sm dropdown-toggle");b.setAttribute("data-toggle","dropdown");b.textContent="\u4e3b\u96c6\u5408";d.appendChild(b);var e=document.createElement("span");e.setAttribute("class","caret");b.appendChild(e);
b=document.createElement("ul");b.setAttribute("class","dropdown-menu");d.appendChild(b);if(1==gl_groupid||2==gl_groupid||3==gl_groupid){var e=document.createElement("li"),f=document.createElement("a");f.setAttribute("class","small");f.setAttribute("href","javascript:;");f.setAttribute("onclick",'dropdown_selectall("maingroup","'+a+'");return true;');e.appendChild(f);f.appendChild(document.createTextNode("\u5168\u9078"));b.appendChild(e)}c=c.split(",");for(e=0;e<gl_allmaingroups.length;++e){var f=
gl_allmaingroups[e],g=check_numer_in_list(f.id,c);b.appendChild(create_dropdown_maingroup_item(a,e,f.id,f.name,g))}return d}
function create_dropdown_maingroup_item(a,c,b,d,e){var f=document.createElement("li"),g=document.createElement("a");g.setAttribute("class","small");g.setAttribute("tabIndex","-1");g.setAttribute("data-value",b);g.setAttribute("href","javascript:;");g.setAttribute("onclick",'dropdown_maingroup_click("'+a+'",'+c+");return true;");b=document.createElement("input");b.setAttribute("type","checkbox");b.setAttribute("id","dropdown_checkbox_maingroup_"+a+"_"+c);b.setAttribute("onclick",'dropdown_checkbox_maingroup_click("'+
a+'",'+c+");return true;");b.checked=e;g.appendChild(b);g.appendChild(document.createTextNode(" "+d));f.appendChild(g);return f}function dropdown_checkbox_maingroup_click(a,c){glDropdown_checkbox_maingroup_click=!0}var glDropdown_checkbox_maingroup_click=!1;
function dropdown_maingroup_click(a,c){1!=glDropdown_checkbox_maingroup_click&&(1==document.getElementById("dropdown_checkbox_maingroup_"+a+"_"+c).checked?document.getElementById("dropdown_checkbox_maingroup_"+a+"_"+c).checked=!1:document.getElementById("dropdown_checkbox_maingroup_"+a+"_"+c).checked=!0);glDropdown_checkbox_maingroup_click=!1}
function create_maingroups(a){var c=document.createElement("td"),b=document.createElement("div");b.setAttribute("class","row");c.appendChild(b);a=a.split(",");if(0<=a.indexOf("99999")){var d=document.createElement("div");d.setAttribute("class","col-md-6");d.appendChild(create_maingroup_label("\u5168\u90e8"));b.appendChild(d)}else for(var e=b=0;e<a.length;e++){var f=getMaingroupName(parseInt(a[e]));0<f.length&&(d=document.createElement("div"),d.setAttribute("class","col-md-6"),c.appendChild(d),d.appendChild(create_subgroup_label(f)),
b++,5<=b&&(b=0))}return c}function create_user_label(a,c){var b=document.createElement("div"),d=document.createElement("div");d.setAttribute("id","user_"+a+"_"+c);b.appendChild(d);var e=document.createElement("span");e.setAttribute("class","badge bg-aqua-active");e.setAttribute("id","user_name_"+a+"_"+c);e.textContent=getUserName(c);d.appendChild(e);return b}
function create_type_label(a){for(var c=document.createElement("span"),b=0;b<gl_curriculumtype_List.length;b++){var d=gl_curriculumtype_List[b];if(d.id==a){c.setAttribute("class","badge bg-yellow");c.textContent=d.name;break}}return c}
function getSelectedSubgroup(a){for(var c=[],b=0,d=0;d<gl_usersubgroups.length;++d){var e=gl_usersubgroups[d];document.getElementById("dropdown_checkbox_subgroup_"+a+"_"+d).checked&&(e=parseInt(e.subgroupid),c.push(e),b++)}1!=gl_groupid&&2!=gl_groupid||b!=gl_usersubgroups.length||(c=[],c.push(99999));return c.toString()}
function getSelectedMaingroup(a){for(var c=[],b=0,d=0;d<gl_allmaingroups.length;++d){var e=gl_allmaingroups[d];document.getElementById("dropdown_checkbox_maingroup_"+a+"_"+d).checked&&(e=parseInt(e.id),c.push(e),b++)}return c.toString()}function getSelectedType(a){return document.getElementById("select_type_"+a).value}function check_numer_in_list(a,c){for(var b=!1,d=0;d<c.length;++d){var e=c[d];if(parseInt(e)==a||99999==parseInt(e)){b=!0;break}}return b}
function getSubgroupName(a){var c="";if("99999"==a)return"\u5168\u90e8";for(var b=0;b<gl_usersubgroups.length;++b){var d=gl_usersubgroups[b];if(parseInt(d.subgroupid)==a){c=d.subgroupname;break}}return c}function getMaingroupName(a){var c="";if("99999"==a)return"\u5168\u90e8";for(var b=0;b<gl_allmaingroups.length;++b){var d=gl_allmaingroups[b];if(d.id==a){c=d.name;break}}return c}function create_new_curriculum(){create_empty_curriculum_table_item(gl_curriculum_List.length+1);return!1}
function create_empty_curriculum_table_item(a){var c=document.getElementById("CURRICULUM_TABLE_BODY");if(void 0==document.getElementById("input_number")){var c=c.insertRow(0),b=0;c.appendChild(document.createElement("td"));c.cells[b].appendChild(document.createTextNode(a));b++;c.appendChild(document.createElement("td"));a=document.createElement("span");a.setAttribute("class","badge bg-aqua-active");a.textContent=getUserName(parseInt(gl_userid));c.cells[b].appendChild(a);b++;c.appendChild(document.createElement("td"));
b++;c.appendChild(document.createElement("td"));a=create_edit_typelist_ui("new","");c.cells[b].appendChild(a);b++;c.appendChild(document.createElement("td"));a=create_select_shared_ui("new",0);c.cells[b].appendChild(a);b++;c.appendChild(document.createElement("td"));a=create_edit_maingrouplist_ui("new","",0);c.cells[b].appendChild(a);b++;c.appendChild(document.createElement("td"));a=create_edit_subgrouplist_ui("new","");c.cells[b].appendChild(a);b++;c.appendChild(document.createElement("td"));c.cells[b].appendChild(create_input_text("input_number",
gl_curriculumprefix));b++;c.appendChild(document.createElement("td"));a=document.createElement("button");a.setAttribute("class","btn btn-block btn-primary btn-lg");a.setAttribute("onclick","save_new_curriculum();");a.textContent="\u5132\u5b58";c.cells[b].appendChild(a)}}
function save_new_curriculum(){var a=document.getElementById("input_number").value;if(0==a.length)alert("\u8acb\u8f38\u5165\u8ab2\u7a0b\u865f\u78bc");else if(0!=a.indexOf(gl_curriculumprefix))alert("\u8acb\u586b\u5165\u8ab2\u7a0b\u4ee3\u78bc:"+gl_curriculumprefix);else{var c=getSelectedSubgroup("new");if(0==c.length)alert("\u8acb\u9078\u64c7\u5b50\u96c6\u5408");else{var b=getSelectedMaingroup("new"),d=getSelectedType("new"),e=document.getElementById("select_shared_yes_new").checked;document.getElementById("select_shared_no_new");
var f=0;e&&(f=1);e&&0==b.length?alert("\u8acb\u9078\u64c7\u4e3b\u96c6\u5408"):(e={},e.project_id=""+project_id,e.create_new_curriculum=1,e.typeid=d,e.subgroups=c,e.number=a,e.shared=f,e.sharedmaingroups=b,jQuery.ajax({url:gl_target_server+"/php/curriculum.php",type:"POST",data:e,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a));setTimeout(reload_page,300)},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}}))}}}
function create_new_curriculumtype(){create_empty_curriculumtype_table_item(gl_curriculumtype_List.length+1);return!1}
function create_empty_curriculumtype_table_item(a){var c=document.getElementById("CURRICULUM_TYPE_TABLE_BODY");if(void 0==document.getElementById("new_type_input_name")){var c=c.insertRow(0),b=0;c.appendChild(document.createElement("td"));c.cells[b].appendChild(document.createTextNode(a));b++;c.appendChild(document.createElement("td"));c.cells[b].appendChild(create_input_text("input_name",""));b++;c.appendChild(document.createElement("td"));a=document.createElement("button");a.setAttribute("class",
"btn btn-block btn-primary btn-lg");a.setAttribute("onclick","save_new_curriculumtype();");a.textContent="\u5132\u5b58";c.cells[b].appendChild(a)}}
function save_new_curriculumtype(){var a=document.getElementById("input_name").value;console.log("save_new_curriculumtype() input_name:"+a);if(0==a.length)alert("\u8acb\u8f38\u5165\u8ab2\u7a0b\u985e\u5225");else{var c={};c.project_id=""+project_id;c.create_curriculumtype=1;c.name=a;jQuery.ajax({url:gl_target_server+"/php/curriculum.php",type:"POST",data:c,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a));setTimeout(reload_page,300)},error:function(a,c,e){alert("error = "+
e);alert("xhr.responseText = "+a.responseText)}})}}
function edit_curriculumprefix(){var a=clearChildView("curriculumprefix_area"),c=document.createElement("input");c.setAttribute("type","text");c.setAttribute("id","curriculumprefix_text");c.value=gl_curriculumprefix;a.appendChild(c);a=document.getElementById("curriculumprefix_btn");a.setAttribute("title","\u5132\u5b58\u8ab2\u7a0b\u4ee3\u78bc");a.setAttribute("onclick","save_curriculumprefix();return false;");document.getElementById("curriculumprefix_img").setAttribute("class","fa fa-save");return!1}
function save_curriculumprefix(){var a=document.getElementById("curriculumprefix_text");if(0==a.value.length)alert("\u8acb\u8f38\u5165\u8ab2\u7a0b\u4ee3\u78bc");else{gl_curriculumprefix=a.value;var a=clearChildView("curriculumprefix_area"),c=document.createElement("span");c.setAttribute("class","badge bg-aqua-active");c.setAttribute("id","curriculumprefix_label");c.textContent="\u8ab2\u7a0b\u4ee3\u78bc:"+gl_curriculumprefix;a.appendChild(c);a=document.getElementById("curriculumprefix_btn");a.setAttribute("title",
"\u7de8\u8f2f\u8ab2\u7a0b\u4ee3\u78bc");a.setAttribute("onclick","edit_curriculumprefix();return false;");document.getElementById("curriculumprefix_img").setAttribute("class","fa fa-edit");a={};a.project_id=""+project_id;a.update_curriculumprefix=1;a.prefix=gl_curriculumprefix;jQuery.ajax({url:gl_target_server+"/php/curriculum.php",type:"POST",data:a,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a));setTimeout(reload_page,300)},error:function(a,c,e){alert("error = "+
e);alert("xhr.responseText = "+a.responseText)}})}}function isNumeric(a){return""!==a&&!isNaN(parseFloat(a))&&isFinite(a)}function clearChildView(a){a=document.getElementById(a);if(null!=a)for(;a.firstChild;)a.removeChild(a.firstChild);return a}function getUserName(a){for(var c="",b=0;b<gl_user_info.length;++b){var d=gl_user_info[b];if(d.userid==a){c=d.name;break}}return c}
function getSharedCurriculum(a){for(var c=void 0,b=0;b<gl_shared_curriculum_List.length;b++){var d=gl_shared_curriculum_List[b];if(d.id==a){c=d;break}}return c}function reload_page(){PreLoadIndex=-1;CurrentLoadIndex=0;check_loading_status()}function move_page_backward(){var a=document.getElementById("id_current_page_num");1>=glCurrentPage||(glCurrentPage--,a.textContent=glCurrentPage,reload_page())}
function move_page_forward(){var a=document.getElementById("id_current_page_num");glCurrentPage++;a.textContent=glCurrentPage;reload_page()}function move_shared_page_backward(){var a=document.getElementById("id_current_shared_page_num");1>=glSharedCurrentPage||(glSharedCurrentPage--,a.textContent=glSharedCurrentPage,reload_page())}function move_shared_page_forward(){var a=document.getElementById("id_current_shared_page_num");glSharedCurrentPage++;a.textContent=glSharedCurrentPage;reload_page()}
function open_curriculum_page(){window.open("/index.php/vilscurriculum/"+project_id,"_blank").focus()};
