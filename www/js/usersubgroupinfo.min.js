window.BlobBuilder=window.MozBlobBuilder||window.WebKitBlobBuilder||window.BlobBuilder;var blob,start,end,part,uploaded,SIZE,BYTES_PER_CHUNK,xhr,chunk,UploadImageFinishedCallback=null,uid="";
function sendUploadImageRequest(a){blob=document.getElementById("imageUpload").files[0];if(void 0==blob)return alert("\u8b80\u53d6\u6a94\u6848\u5931\u6557!"),null;BYTES_PER_CHUNK=1048576;SIZE=blob.size;part=start=0;end=BYTES_PER_CHUNK;uploaded=0;UploadImageFinishedCallback=a;uid=Date.now();chunk=blob.slice(start,end);uploadImageFile(chunk,part);start=end;end=start+BYTES_PER_CHUNK;part+=1;uploaded=0;return uid}
function imageSelected(){var a=document.getElementById("imageUpload").files[0];if(a){var b;b=1048576<a.size?(Math.round(100*a.size/1048576)/100).toString()+"MB":(Math.round(100*a.size/1024)/100).toString()+"KB";var c=a.name.split("."),d=document.getElementById("id_new_image_name");void 0!=d&&(d.value=c[0]);d=document.getElementById("id_new_image_description");void 0!=d&&(d.value=c[0]);document.getElementById("imageFileSize").innerHTML="Size: "+b;document.getElementById("imageFileType").innerHTML=
"Type: "+a.type;a=document.getElementById("removebutton");void 0!=a&&a.setAttribute("style","display:block;")}}
function uploadImageFile(a,b){var c=document.getElementById("imageUpload").files[0],d=new FormData;d.append("imageUpload",a);d.append("file",c.name);d.append("uid",uid);d.append("num",parseInt(b));c=new XMLHttpRequest;c.upload.addEventListener("progress",uploadImageProgress,!1);c.addEventListener("load",uploadImageComplete,!1);c.addEventListener("error",uploadImageFailed,!1);c.addEventListener("abort",uploadImageCanceled,!1);c.open("POST","/php/uploadfile.php");c.onload=function(a){};c.setRequestHeader("Cache-Control",
"no-cache");c.send(d)}function uploadImageProgress(a){a.lengthComputable?(a=Math.round(100*(uploaded+a.loaded)/SIZE),document.getElementById("imageProgressNumber").innerHTML=a.toString()+"%"):document.getElementById("imageProgressNumber").innerHTML="unable to compute"}
function uploadImageComplete(a){start<SIZE?(chunk=blob.slice(start,end),uploadImageFile(chunk,part),start=end,end=start+BYTES_PER_CHUNK,part+=1,uploaded+=BYTES_PER_CHUNK):"function"===typeof UploadImageFinishedCallback&&(0==JSON.parse(a.target.responseText).FileSize?UploadImageFinishedCallback(null):UploadImageFinishedCallback(uid))}function uploadImageFailed(a){alert("There was an error attempting to upload the file.");uid=null}
function uploadImageCanceled(a){xhr.abort();uid=xhr=null;alert("The upload has been canceled by the user or the browser dropped the connection.")};var LOAD_usersubgroup_NUM=20,PreLoadIndex=-1,CurrentLoadIndex=0,LOAD_STATE_END=9999,glCurrentPage=1,gl_user_info=[],gl_usersubgroups=[],gl_userdatasubgroups=[],gl_edit_subgroupid=0,gl_edit_maingroupid=0,gl_edit_subgroup_imageuid="",gl_uploadimage_uid="",LOAD_USER_NUM=500,gl_user_load_index=0;check_loading_status();
function check_loading_status(){switch(CurrentLoadIndex){case 0:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,gl_user_info=[],load_user_info());break;case 1:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,load_usersubgroup());break;case 2:PreLoadIndex!=CurrentLoadIndex&&
(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,draw_table(),CurrentLoadIndex+=1);break;case 3:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,show_subgroup_photo(),CurrentLoadIndex+=1);break;case 4:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+
" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,update_user_info(),check_nfclocator_info(),CurrentLoadIndex=LOAD_STATE_END)}CurrentLoadIndex!=LOAD_STATE_END?setTimeout(check_loading_status,100):console.log("check_loading_status() Stop.")}function reload_subgroup_info(){PreLoadIndex=0;CurrentLoadIndex=1;check_loading_status()}
function load_usersubgroup(){gl_usersubgroups=[];$.getJSON(gl_target_server+"/php/vilsnodes.php","loadusersubgroup=1&project_id="+project_id,function(a){$.each(a,function(a,c){c.subgroupid=parseInt(c.subgroupid);gl_usersubgroups.push(c)})}).success(function(){load_userdatasubgroup()}).error(function(){}).complete(function(){})}
function load_userdatasubgroup(){gl_userdatasubgroups=[];$.getJSON(gl_target_server+"/php/vilsnodes.php","loaddatasubgroup=1&project_id="+project_id+"&type=0",function(a){$.each(a,function(a,c){c.subgroupid=parseInt(c.subgroupid);gl_userdatasubgroups.push(c)})}).success(function(){CurrentLoadIndex+=1}).error(function(){}).complete(function(){})}
function load_user_info(){var a=0;$.getJSON(gl_target_server+"/php/vilsnodes.php","loaduser=1&s="+gl_user_load_index+"&count="+LOAD_USER_NUM+"&project_id="+project_id,function(b){$.each(b,function(b,d){d.userid=parseInt(d.userid);gl_user_info.push(d);a+=1});gl_user_load_index+=a}).success(function(){console.log("load_user_info() user_num:"+a);a<LOAD_USER_NUM?CurrentLoadIndex+=1:setTimeout(load_user_info,20)}).error(function(){CurrentLoadIndex+=1}).complete(function(){})}
function update_user_info(){for(var a=0;a<gl_userdatasubgroups.length;++a){var b=gl_userdatasubgroups[a],c=document.getElementById("uiid_userids_"+b.subgroupid),b=createUserIDUI(b.userids);c.appendChild(b)}}function createUserIDUI(a){var b=document.createElement("div");a=a.split(",");for(var c=0;c<a.length;c++){var d=getUserName(a[c]);if(0!=d.length){var e=document.createElement("div");b.appendChild(e);d=create_account_label(d);e.appendChild(d)}}return b}
function check_nfclocator_info(){$.getJSON(gl_target_server+"/php/nfclocator.php","loadnfclocatorcount=1&project_id="+project_id,function(a){var b=document.getElementById("btnCreateNewSubGroup");void 0!=b&&(1==gl_groupid||2==gl_groupid?b.setAttribute("class","btn btn-success btn-xs"):gl_userdatasubgroups.length>3*a.count-1?b.setAttribute("class","hidden btn btn-success btn-xs"):b.setAttribute("class","btn btn-success btn-xs"))}).success(function(){}).error(function(){}).complete(function(){})}
function draw_table(){for(var a=document.getElementById("usersubgroupinfo_TABLE");1<=a.rows.length;)a.deleteRow(0);console.log("draw_table() gl_userdatasubgroups.length:"+gl_userdatasubgroups.length);for(var b=0;b<gl_userdatasubgroups.length;++b){var c=create_record_table_item(b,gl_userdatasubgroups[b]);a.appendChild(c)}}
function create_record_table_item(a,b){if(null==b)return null;var c=document.createElement("tr");1==a%2&&c.setAttribute("bgcolor","#ebebe0");var d=0;c.appendChild(document.createElement("td"));c.cells[d].appendChild(document.createTextNode(""+(a+1)));d++;var e=document.createElement("td");e.setAttribute("id","uiid_groupname_"+b.subgroupid);c.appendChild(e);e=create_subgroup_label(b.subgroupname);c.cells[d].appendChild(e);d++;e=document.createElement("td");e.setAttribute("id","uiid_permission_"+b.subgroupid);
e.textContent=b.permission;c.appendChild(e);d++;e=document.createElement("td");e.setAttribute("id","uiid_photo_"+b.subgroupid);c.appendChild(e);d++;e=document.createElement("td");e.setAttribute("id","uiid_userids_"+b.subgroupid);c.appendChild(e);d++;e=document.createElement("td");c.appendChild(e);e=document.createElement("button");e.setAttribute("type","button");e.setAttribute("class","btn btn-default");e.setAttribute("data-toggle","modal");e.setAttribute("data-target","#modal-qrcode");e.setAttribute("onclick",
'device_qrcode_show("SUBGROUP","'+b.subgroupid+'","'+b.subgroupname+'");return false;');var f=document.createElement("i");f.setAttribute("class","fa fa-qrcode");e.appendChild(f);c.cells[d].appendChild(e);config_enable_edit&&(e=document.createElement("button"),e.setAttribute("id","uiid_editbtn_"+b.subgroupid),e.setAttribute("title","Edit this usersubgroup"),e.setAttribute("href","javascript:;"),e.setAttribute("onclick",'edit_usersubgroup("'+b.subgroupid+'");return false;'),f=document.createElement("i"),
f.setAttribute("id","uiid_editimg_"+b.subgroupid),f.setAttribute("class","fa fa-edit"),e.appendChild(f),c.cells[d].appendChild(e),0!=a&&(e=document.createElement("button"),e.setAttribute("style","display:none"),e.setAttribute("id","uiid_deletebtn_"+b.subgroupid),e.setAttribute("title","Delete This usersubgroup"),e.setAttribute("href","javascript:;"),e.setAttribute("onclick",'confirm_delete_usersubgroup("'+b.subgroupid+'", "'+b.subgroupname+'");return false;'),f=document.createElement("i"),f.setAttribute("class",
"fa fa-user-times"),e.appendChild(f),c.cells[d].appendChild(e)));return c}
function device_qrcode_show(a,b,c){b=parseInt(b);document.getElementById("device_qrcode_type").textContent="Type: \u5b50\u96c6\u5408";document.getElementById("device_qrcode_name").textContent="\u540d\u7a31: "+c;document.getElementById("device_qrcode_macaddress").textContent="\u5b50\u96c6\u5408ID: "+b;jQuery.ajax({url:gl_target_server+"/php/configvils.php",type:"POST",data:"loadqrcode=1&type="+a+"&accountid="+b+"&id="+b+"&project_id="+project_id,dataType:"text",success:function(a){a=JSON.parse(a);
document.getElementById("device_qrcode_ui").setAttribute("src",a.qrcode);document.getElementById("device_qrcode_target").textContent="target: "+a.target;document.getElementById("device_qrcode_topic").textContent="topic: "+a.topic;document.getElementById("device_qrcode_datetime").textContent="\u66f4\u65b0\u6642\u9593: "+a.datetime}})}
function create_empty_record_table_item(a){if(null==document.getElementById("empty_record_table_item")){var b=document.getElementById("usersubgroupinfo_TABLE").insertRow(0);b.setAttribute("bgcolor","#ebebe0");b.setAttribute("id","empty_record_table_item");var c=0;b.appendChild(document.createElement("td"));b.cells[c].appendChild(document.createTextNode(""+a));c++;b.appendChild(document.createElement("td"));b.cells[c].appendChild(create_input_text("input_groupname"));c++;b.appendChild(document.createElement("td"));
b.cells[c].appendChild(create_input_text("input_permission"));c++;b.appendChild(document.createElement("td"));a=create_upload_image_ui();b.cells[c].appendChild(a);c++;b.appendChild(document.createElement("td"));a=create_manager_dropdown_list("input_accountids",1!=gl_groupid&&2!=gl_groupid);b.cells[c].appendChild(a);c++;b.appendChild(document.createElement("td"));a=document.createElement("button");a.setAttribute("class","btn btn-block btn-primary btn-lg");a.setAttribute("onclick","save_new_usersubgroup();");
a.textContent="\u5132\u5b58";b.cells[c].appendChild(a)}}function create_input_text(a,b){var c=document.createElement("textarea");c.setAttribute("rows","1");c.setAttribute("id",a);c.textContent=b;return c}
function create_manager_dropdown_list(a,b){var c=document.createElement("div");c.setAttribute("class","btn-group");var d=document.createElement("button");d.setAttribute("type","button");d.setAttribute("class","btn btn-default btn-sm dropdown-toggle");d.setAttribute("data-toggle","dropdown");d.textContent="\u7ba1\u7406\u4eba\u54e1";c.appendChild(d);var e=document.createElement("span");e.setAttribute("class","caret");d.appendChild(e);d=document.createElement("ul");d.setAttribute("class","dropdown-menu");
d.setAttribute("id","dropdown_managerd");c.appendChild(d);for(e=0;e<gl_user_info.length;++e){var f=gl_user_info[e];"3"!=f.groupid&&d.appendChild(create_dropdown_user_item("new",f.name,f.account,b))}return c}
function create_dropdown_user_item(a,b,c,d){var e=document.createElement("li"),f=document.createElement("a");f.setAttribute("class","small");f.setAttribute("tabIndex","-1");f.setAttribute("data-value",c);f.setAttribute("href","javascript:;");f.setAttribute("onclick",'dropdown_user_click("'+a+'", "'+c+'");return true;');var g=document.createElement("input");g.setAttribute("type","checkbox");g.setAttribute("id","dropdown_checkbox_"+a+"_"+c);g.setAttribute("onclick",'dropdown_checkbox_user_click("'+
a+'", "'+c+'");return true;');g.checked=d;f.appendChild(g);f.appendChild(document.createTextNode(" "+b));e.appendChild(f);return e}var glDropdown_checkbox_user_click=!1;function dropdown_checkbox_user_click(a,b){glDropdown_checkbox_user_click=!0}
function dropdown_user_click(a,b){1!=glDropdown_checkbox_user_click&&(1==document.getElementById("dropdown_checkbox_"+a+"_"+b).checked?document.getElementById("dropdown_checkbox_"+a+"_"+b).checked=!1:document.getElementById("dropdown_checkbox_"+a+"_"+b).checked=!0);glDropdown_checkbox_user_click=!1}function show_subgroup_photo(){for(var a=0;a<gl_userdatasubgroups.length;++a){var b=gl_userdatasubgroups[a];0<b.imageuid.length&&load_subgroup_photo(b.subgroupid,b.imageuid)}}
function load_subgroup_photo(a,b){$.getJSON(gl_target_server+"/php/storage.php","loadsingleimage=1&project_id="+project_id+"&imageuid="+b,function(b){var d=document.getElementById("uiid_photo_"+a);void 0!=d&&(b=create_image_item(b),d.appendChild(b))}).success(function(){}).error(function(){}).complete(function(){})}
function create_user_photo(a){var b=document.createElement("img");b.setAttribute("src","/php/downloadfile.php?loadthumb=1&project_id="+project_id+"&imageid="+a.id);b.setAttribute("alt",a.description);b.setAttribute("style","max-width: 64px;");return b}function create_image_item(a){return create_data_image(a.id,a.name,a.thumbpath,a.imagetype,a.imagesize)}
function create_data_image(a,b,c,d,e){c=document.createElement("ul");c.setAttribute("class","mailbox-attachments clearfix");var f=document.createElement("li");c.appendChild(f);d=document.createElement("span");d.setAttribute("class","mailbox-attachment-icon has-img");f.appendChild(d);var g=document.createElement("img");g.setAttribute("src","/php/downloadfile.php?loadthumb=1&project_id="+project_id+"&imageid="+a);g.setAttribute("alt","Attachment");g.setAttribute("style","height:120px; width:auto; max-height:120px; max-width:auto;");
d.appendChild(g);d=document.createElement("div");d.setAttribute("class","mailbox-attachment-info");f.appendChild(d);f=document.createElement("a");f.setAttribute("href","/php/downloadfile.php?project_id="+project_id+"&imageid="+a);f.setAttribute("class","mailbox-attachment-name");d.appendChild(f);g=document.createElement("p");g.setAttribute("class","overflow-ellipsis");g.setAttribute("style","width: 180px;white-space: nowrap;overflow: hidden;");g.textContent=b;f.appendChild(g);b=document.createElement("span");
b.setAttribute("class","mailbox-attachment-size");b.setAttribute("style","text-align: center;");b.textContent=convertFileSize(parseInt(e));d.appendChild(b);e=document.createElement("a");e.setAttribute("href","/php/downloadfile.php?project_id="+project_id+"&imageid="+a);e.setAttribute("class","btn btn-default btn-xs pull-right");b.appendChild(e);a=document.createElement("i");a.setAttribute("class","fa fa-cloud-download");e.appendChild(a);return c}
function convertFileSize(a){return 1048576<a?(Math.round(100*a/1048576)/100).toString()+"MB":(Math.round(100*a/1024)/100).toString()+"KB"}
function edit_usersubgroup(a){console.log("edit_usersubgroup() groupid:"+a);var b=getusersubgroup(a);if(null==b)console.log("edit_usersubgroup() group == null");else{create_edit_ui("uiid_groupname",a,b.subgroupname);create_edit_ui("uiid_permission",a,b.permission);gl_edit_subgroup_imageuid=b.imageuid;if(1==gl_groupid||2==gl_groupid||6==gl_groupid){create_edit_manager_ui("uiid_userids",a,b.userids);var c=document.getElementById("uiid_photo_"+a);if(void 0!=c){if(0==gl_edit_subgroup_imageuid.length){clearChildView("uiid_photo_"+
a);var d=create_upload_image_ui()}else{d=document.createElement("button");d.setAttribute("style","color: #AF4C50;");d.setAttribute("title","Delete Subgroup Photo");d.setAttribute("href","javascript:;");d.setAttribute("onclick",'delete_subgroup_photo("'+a+'");return false;');var e=document.createElement("i");e.setAttribute("class","fa fa-remove");d.appendChild(e)}c.appendChild(d)}c=document.getElementById("uiid_deletebtn_"+a);void 0!=c&&c.setAttribute("style","display:block")}c=document.getElementById("uiid_editbtn_"+
a);c.setAttribute("title","Save this usersubgroup");c.setAttribute("onclick",'save_usersubgroup("'+a+'", "'+b.maingroupid+'");return false;');document.getElementById("uiid_editimg_"+a).setAttribute("class","fa fa-save")}}function delete_subgroup_photo(a){gl_edit_subgroup_imageuid="";clearChildView("uiid_photo_"+a);a=document.getElementById("uiid_photo_"+a);if(void 0!=a){var b=create_upload_image_ui();a.appendChild(b)}}
function create_edit_ui(a,b,c){var d=clearChildView(a+"_"+b);a=create_input_text(a+"_"+b+"_edit",c);d.appendChild(a)}
function create_edit_manager_ui(a,b,c){a=clearChildView(a+"_"+b);var d=document.createElement("div");d.setAttribute("class","btn-group");null!=a&&a.appendChild(d);var e=document.createElement("button");e.setAttribute("type","button");e.setAttribute("class","btn btn-default btn-sm dropdown-toggle");e.setAttribute("data-toggle","dropdown");e.textContent="\u7ba1\u7406\u4eba\u54e1";d.appendChild(e);var f=document.createElement("span");f.setAttribute("class","caret");e.appendChild(f);e=document.createElement("ul");
e.setAttribute("class","dropdown-menu");e.setAttribute("id","dropdown_managerd");d.appendChild(e);c=c.split(",");for(d=0;d<gl_user_info.length;++d)if(f=gl_user_info[d],"3"!=f.groupid){var g=f.datagroups.split(",");check_numer_in_list(parseInt(b),g)&&(g=0<=c.indexOf(f.userid+""),e.appendChild(create_dropdown_user_item(b,f.name,f.account,g)))}return a}
function create_upload_image_ui(){var a=document.createElement("div"),b=document.createElement("form");b.setAttribute("method","POST");b.setAttribute("enctype","multipart/form-data");b.setAttribute("action","php/uploadfile.php");a.appendChild(b);var c=document.createElement("div");c.setAttribute("class","form-group");b.appendChild(c);b=document.createElement("label");b.setAttribute("class","control-sidebar-subheading");b.setAttribute("for","imageUpload");b.innerHTML="\u4e0a\u50b3\u6a94\u6848";c.appendChild(b);
b=document.createElement("input");b.setAttribute("id","imageUpload");b.setAttribute("accept","image/*");b.setAttribute("type","file");b.setAttribute("name","imageUpload");b.setAttribute("onchange","imageSelected();");c.appendChild(b);b=document.createElement("div");b.setAttribute("id","imageFileSize");c.appendChild(b);b=document.createElement("div");b.setAttribute("id","imageFileType");c.appendChild(b);b=document.createElement("div");b.setAttribute("id","imageProgressNumber");c.appendChild(b);return a}
function clearChildView(a){a=document.getElementById(a);if(null!=a)for(;a.firstChild;)a.removeChild(a.firstChild);return a}function getusersubgroup(a){var b=null;a=parseInt(a);for(var c=0;c<gl_userdatasubgroups.length;++c){var d=gl_userdatasubgroups[c];if(d.subgroupid==a){b=d;break}}return b}
function create_subgroup_label(a){var b=document.createElement("span");b.setAttribute("style","display:inline;padding:.2em .3em .3em;font-size:95%;font-weight:700;line-height:2;position:relative;top:-1px;color:#fff;border-radius:2px;white-space:nowrap;background-color:#00a65a;");b.textContent=a;return b}
function create_account_label(a){var b=document.createElement("span");b.setAttribute("style","display:inline;padding:.2em .3em .3em;font-size:95%;font-weight:700;line-height:2;position:relative;top:-1px;color:#fff;border-radius:2px;white-space:nowrap;background-color:rgb(54, 127, 169);");b.textContent=a;return b}function save_new_usersubgroup(){check_upload_image(uploadNewSubGroupImageFinihed)}
function uploadNewSubGroupImageFinihed(a){gl_uploadimage_uid=a;uploadImageFinihed(upload_new_usersubgroup)}
function upload_new_usersubgroup(){var a=document.getElementById("input_groupname").value,b=document.getElementById("input_permission").value;if(0==a.length)alert("\u8acb\u8f38\u5165\u540d\u7a31");else{for(var c="",d="",e=0;e<gl_user_info.length;++e){var f=gl_user_info[e];if("3"!=f.groupid){var g=document.getElementById("dropdown_checkbox_new_"+f.account);void 0!=g&&1==g.checked&&(0<c.length&&(c+=","),c+=f.account,0<d.length&&(d+=","),d+=f.userid)}}e={};e.project_id=""+project_id;e.create_new_usersubgroup=
1;e.groupname=a;e.permission=b;e.accountids=c;e.userids=d;e.imageuid=gl_uploadimage_uid;jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:e,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a));reload_subgroup_info()},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}})}}function save_usersubgroup(a,b){gl_edit_subgroupid=a;gl_edit_maingroupid=b;check_upload_image(uploadEditSubgroupImageFinihed)}
function check_upload_image(a){gl_uploadimage_uid=gl_edit_subgroup_imageuid;var b=document.getElementById("imageUpload");void 0!=b?void 0!=b.files[0]?(console.log("check_upload_image() uploadimage.files[0] != undefined "),gl_uploadimage_uid=sendUploadImageRequest(a)):a(gl_uploadimage_uid):a(gl_uploadimage_uid)}function uploadEditSubgroupImageFinihed(){uploadImageFinihed(update_usersubgroup)}
function uploadImageFinihed(a){console.log("uploadImageFinihed() gl_uploadimage_uid:"+gl_uploadimage_uid);if(null==gl_uploadimage_uid)alert("\u4e0a\u50b3\u7167\u7247\u5931\u6557!");else{var b=document.getElementById("imageUpload"),c=void 0;if(void 0!=b)if(void 0==b.files[0])setTimeout(a,100);else{var c=b.files[0],b=c.name.split(".")[0],d="project_id="+project_id,d=d+"&createnewimage=1"+("&name="+b)+"&description="+("&filename="+c.name),d=d+("&fileuid="+gl_uploadimage_uid),d=d+("&filetype="+c.type),
d=d+("&filesize="+c.size),d=d+("&subgroups="+gl_edit_subgroupid),d=d+"&leaveform=0";return jQuery.ajax({url:"/php/uploadfile.php",type:"POST",data:d,dataType:"text",success:function(b){setTimeout(a,300)},error:function(b,c,d){setTimeout(a,300)}})}else setTimeout(a,100)}}
function update_usersubgroup(){groupid=gl_edit_subgroupid;maingroupid=gl_edit_maingroupid;var a=document.getElementById("uiid_groupname_"+groupid+"_edit").value,b=document.getElementById("uiid_permission_"+groupid+"_edit").value;if(0==a.length)alert("\u8acb\u8f38\u5165\u540d\u7a31");else{var c="",d="";if(1==gl_groupid||2==gl_groupid||6==gl_groupid)for(var e=0;e<gl_user_info.length;++e){var f=gl_user_info[e];if("3"!=f.groupid){var g=document.getElementById("dropdown_checkbox_"+groupid+"_"+f.account);
void 0!=g&&1==g.checked&&(0<c.length&&(c+=","),c+=f.account,0<d.length&&(d+=","),d+=f.userid)}}e={};e.project_id=""+project_id;e.update_usersubgroup=1;e.groupid=groupid;e.groupname=a;e.permission=b;e.imageuid=gl_uploadimage_uid;e.accountids=c;e.userids=d;e.maingroupid=maingroupid;jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:e,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a));reload_subgroup_info()},error:function(a,b,c){alert("error = "+
c);alert("xhr.responseText = "+a.responseText)}})}}function confirm_delete_usersubgroup(a,b){a=parseInt(a);confirm("Are you sure you want to delete this user group:"+b+" ?")&&delete_usersubgroup(a)}
function delete_usersubgroup(a){var b={};b.project_id=""+project_id;b.delete_usersubgroup=1;b.groupid=parseInt(a);jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:b,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a));reload_subgroup_info()},error:function(a,b,e){alert("error = "+e);alert("xhr.responseText = "+a.responseText)}})}function create_new_usersubgroup(){create_empty_record_table_item(gl_userdatasubgroups.length+1);return!1}
function getAccountName(a){for(var b="",c=0;c<gl_user_info.length;++c){var d=gl_user_info[c];if(d.account===a){b=d.name;break}}return b}function getUserName(a){a=parseInt(a);for(var b="",c=0;c<gl_user_info.length;++c){var d=gl_user_info[c];if(d.userid==a){b=d.name;break}}return b}function check_numer_in_list(a,b){for(var c=!1,d=0;d<b.length;++d)if(parseInt(b[d])==a){c=!0;break}return c}
function move_page_backward(){var a=document.getElementById("id_current_page_num");1>=glCurrentPage||(glCurrentPage--,a.textContent=glCurrentPage,reload_subgroup_info())}function move_page_forward(){var a=document.getElementById("id_current_page_num");glCurrentPage++;a.textContent=glCurrentPage;reload_subgroup_info()}function open_usersubgroupinfo_page(){window.open("/index.php/vilsusersubgroupinfo/"+project_id,"_blank").focus()};
