console.log("project_id="+project_id);console.log("gl_accountid="+gl_accountid);console.log("gl_accountname="+gl_accountname);console.log("gl_groupid="+gl_groupid);console.log("gl_userid="+gl_userid);var gl_EditMode=0,glUIBlocks=[];load_ui_info();function load_ui_info(){glUIBlocks=[];$.getJSON(gl_target_server+"/php/configvils.php","loaduiblock=1&project_id="+project_id,function(a){$.each(a.uidata,function(a,b){glUIBlocks.push(b)});create_blocks()});return!1}
function create_blocks(){for(var a=document.getElementById("main_content");a.firstChild;)a.removeChild(a.firstChild);for(var c=0;c<glUIBlocks.length;c++){var b=glUIBlocks[c],d=create_Sortable_row("row_block_"+(c+1));a.appendChild(d);for(var e=0;e<b.length;e++){var f=create_block(b[e]);d.appendChild(f)}1==gl_EditMode&&($("#row_block_"+(c+1)).sortable({connectWith:".connectedSortable",delay:1500,forcePlaceholderSize:!0,start:uiblock_start,receive:uiblock_receive,update:uiblock_update,stop:uiblock_stop,
zIndex:999999}).disableSelection(),init())}}function touchHandler(a){var c=a.changedTouches[0];switch(a.type){case "touchstart":a="mousedown";break;case "touchmove":a="mousemove";break;case "touchend":a="mouseup";break;default:return}var b=document.createEvent("MouseEvent");b.initMouseEvent(a,!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,!1,!1,!1,!1,0,null);c.target.dispatchEvent(b)}function preventDefault(a){a.preventDefault()}var clickms=100,lastTouchDown=-1;
function init(){document.addEventListener("touchstart",touchHandler,!0);document.addEventListener("touchmove",touchHandler,!0);document.addEventListener("touchend",touchHandler,!0);document.addEventListener("touchcancel",touchHandler,!0)}function create_Sortable_row(a){var c=document.createElement("div");c.setAttribute("class","row connectedSortable");c.setAttribute("id",a);return c}
function create_block(a){var c=document.createElement("div");c.setAttribute("class","col-lg-2 col-md-4 col-sm-6 col-xs-6");c.setAttribute("id",a.id);var b=document.createElement("div");b.setAttribute("class","box box-solid "+a.bgcolor);c.appendChild(b);var d=document.createElement("div");d.setAttribute("class","box-header");b.appendChild(d);var e=document.createElement("label");4<a.title.length?e.setAttribute("style","font-size: 31px;"):e.setAttribute("style","font-size: 32px;");e.textContent=a.title;
d.appendChild(e);e=document.createElement("label");e.setAttribute("class","box-tools pull-right");d.appendChild(e);1==gl_EditMode&&(d=document.createElement("button"),d.setAttribute("type","button"),d.setAttribute("class","btn btn-sm "+a.btncolor),d.setAttribute("data-widget","remove"),d.setAttribute("onclick",'box_close("'+a.id+'");'),e.appendChild(d),e=document.createElement("i"),e.setAttribute("class","fa fa-times"),d.appendChild(e));e=document.createElement("div");e.setAttribute("class","box-body border-radius-none");
b.appendChild(e);d=document.createElement("div");d.setAttribute("class","inner");e.appendChild(d);e=document.createElement("div");e.setAttribute("class","inner");e.textContent=a.context;d.appendChild(e);d=document.createElement("div");d.setAttribute("class","small-box-footer");d.setAttribute("style","background-color: #f3f3f3e3;");b.appendChild(d);0==gl_EditMode&&(b=document.createElement("a"),b.setAttribute("href",a.action),d.appendChild(b),d=document.createElement("div"),d.setAttribute("class",
"row"),b.appendChild(d),a=document.createElement("div"),a.setAttribute("class","col-xs-12 text-center"),d.appendChild(a),b=document.createElement("label"),b.setAttribute("style","font-size: 14px"),b.textContent="\u9ede\u64ca\u67e5\u770b",a.appendChild(b),b=document.createElement("i"),b.setAttribute("class","fa fa-arrow-circle-right"),a.appendChild(b));return c}
var gl_scrollPosition=[self.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,self.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop];function noScroll(){console.log("noScroll() 0:"+gl_scrollPosition[0]+" 1:"+gl_scrollPosition[1]);window.scrollTo(gl_scrollPosition[0],gl_scrollPosition[1])}
function uiblock_start(a,c){gl_scrollPosition=[self.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,self.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop];window.addEventListener("scroll",noScroll)}function uiblock_update(a,c){}function uiblock_receive(a,c){}
function uiblock_stop(a,c){window.removeEventListener("scroll",noScroll);for(var b=[],d=glUIBlocks.length,e=0;e<d;e++){for(var f=$("#row_block_"+(e+1)).sortable("toArray"),g=[],h=0;h<f.length;h++){var k=getUIdata(f[h]);g.push(k)}b.push(g)}glUIBlocks=null;glUIBlocks=b;create_blocks();update_uiblock_record()}function getUIdata(a){for(var c,b=glUIBlocks.length,d=0;d<b;d++)for(var e=glUIBlocks[d],f=0;f<e.length;f++)if(c=e[f],c.id===a)return c;return null}
function box_close(a){for(var c=[],b=glUIBlocks.length,d=0;d<b;d++){for(var e=glUIBlocks[d],f=[],g=0;g<e.length;g++){var h=e[g];h.id!=a&&f.push(h)}c.push(f)}glUIBlocks=null;glUIBlocks=c;create_blocks();update_uiblock_record()}
function update_uiblock_record(){var a=JSON.stringify(glUIBlocks);jQuery.ajax({url:gl_target_server+"/php/configvils.php",type:"POST",data:"updateuiblock=1&project_id="+project_id+("&uidata="+a),dataType:"text",success:function(a){},error:function(a,b,d){},complete:function(){}});return!1}
function editblockbutton_click(){console.log("editblockbutton_click()");var a=document.getElementById("editblockbutton");for(a.setAttribute("onclick","exitblockbutton_click();return false;");a.firstChild;)a.removeChild(a.firstChild);var c=document.createElement("i");c.setAttribute("class","fa fa-edit");a.appendChild(c);a.appendChild(document.createTextNode("\u96e2\u958b\u7de8\u8f2f\u6a21\u5f0f"));document.getElementById("resettodefaultbutton").setAttribute("style","display:block;display:table;margin:0 auto;");
gl_EditMode=1;create_blocks()}
function exitblockbutton_click(){console.log("exitblockbutton_click()");var a=document.getElementById("editblockbutton");for(a.setAttribute("onclick","editblockbutton_click();return false;");a.firstChild;)a.removeChild(a.firstChild);var c=document.createElement("i");c.setAttribute("class","fa fa-edit");a.appendChild(c);a.appendChild(document.createTextNode("\u7de8\u8f2f\u986f\u793a\u6846"));document.getElementById("resettodefaultbutton").setAttribute("style","display:none;margin:0 auto;");gl_EditMode=
0;create_blocks()}$("#resettodefaultbutton").click(function(){jQuery.ajax({url:gl_target_server+"/php/configvils.php",type:"POST",data:"resetuiblock=1&project_id="+project_id,dataType:"text",success:function(a){a=JSON.parse(a);glUIBlocks=[];$.each(a.uidata,function(a,b){glUIBlocks.push(b)});create_blocks()},error:function(a,c,b){},complete:function(){}});return!1});function showqrcode(){device_qrcode_show("2",gl_accountname,gl_accountid,gl_userid);$("#modal-qrcode").modal("show")}
function device_qrcode_show(a,c,b,d){console.log("device_qrcode_show() type:"+a+" accountname:"+c+" accountid:"+b+" userid:"+d);var e="TAG";"1"===a&&(e="TAG");"2"===a&&(e="USER");"3"===a&&(e="LOCATOR");document.getElementById("device_qrcode_type").textContent="Type: "+e;document.getElementById("device_qrcode_name").textContent="\u540d\u7a31: "+c;document.getElementById("device_qrcode_macaddress").textContent="\u5e33\u865f: "+b;jQuery.ajax({url:gl_target_server+"/php/configvils.php",type:"POST",data:"loadqrcode=1&type="+
e+"&accountid="+b+"&id="+d+"&project_id="+project_id,dataType:"text",success:function(a){a=JSON.parse(a);document.getElementById("device_qrcode_ui").setAttribute("src",a.qrcode);document.getElementById("device_qrcode_target").textContent="target: "+a.target;document.getElementById("device_qrcode_topic").textContent="topic: "+a.topic;document.getElementById("device_qrcode_datetime").textContent="\u66f4\u65b0\u6642\u9593: "+a.datetime}})}
function confirm_reset_user_password(){if(confirm("\u662f\u5426\u78ba\u5b9a\u91cd\u65b0\u8a2d\u5b9a\u6b64\u5e33\u865f\u5bc6\u78bc:"+gl_accountname+" ?")){var a=prompt("\u8acb\u8f38\u5165\u65b0\u5bc6\u78bc:[\u7a7a\u767d\u4ee3\u8868\u7cfb\u7d71\u5c07\u81ea\u52d5\u7522\u751f]");reset_user_password(gl_accountid,a)}}
function reset_user_password(a,c){var b={};b.project_id=""+project_id;b.reset_user_password=1;b.userid=gl_userid;b.account=a;b.password=c;jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:b,success:function(a){400==a.status?(alert("\u66f4\u65b0\u5bc6\u78bc\u5931\u6557!!!"),console.log("update Error! response = "+JSON.stringify(a))):(a=JSON.parse(a),void 0!=a.account&&void 0!=a.password?alert("\u66f4\u65b0\u6210\u529f \u65b0\u5bc6\u78bc\u70ba:"+a.password):alert("\u66f4\u65b0\u5bc6\u78bc\u5931\u6557!!!"))},
error:function(a,b,c){alert("\u66f4\u65b0\u5bc6\u78bc\u5931\u6557!!!");console.log("error = "+c);console.log("xhr.responseText = "+a.responseText)}})}$("#row_1, #row_2").sortable({placeholder:"sort-highlight",connectWith:".connectedSortable",forcePlaceholderSize:!1,start:uiblock_start,receive:uiblock_receive,update:uiblock_update,stop:uiblock_stop,zIndex:999999}).disableSelection();$(".connectedSortable .box-header, .connectedSortable .nav-tabs-custom").css("cursor","move");
