var glTargetEndDate=getTargetDateTime(0),glTargetStartDate=getTargetDateTime(-1);load_activity_user();load_systeminfo();load_sos_user();load_area_user();load_operation_mode();load_inspection_event();load_device_alive();load_system_service();load_nodemoveoffset();update_query_time();
function update_query_time(){glTargetEndDate=getTargetDateTime(0);glTargetStartDate=getTargetDateTime(-1);document.getElementById("data_range_datetime").textContent=glTargetStartDate+" -> "+glTargetEndDate;setTimeout(update_query_time,6E4)}
function load_activity_user(){$.getJSON(gl_target_server+"/php/dashboarddata.php","loadactivity=1&nodetype=1&project_id="+project_id,function(b){document.getElementById("main_activity_user_count").textContent=b.devicecount;aliveString=b.records;aliveString+=",0";document.getElementById("main_activity_alive_count").textContent=aliveString;$("#main_activity_alive_count").sparkline("html",{type:"bar",height:"30",barColor:"#744",tooltipFormat:"{{offset:offset}} {{value}}",tooltipValueLookups:{offset:{0:"\u76ee\u524d<br>\u6d3b\u52d5\u7528\u6236:",
1:"1\u5206\u9418\u524d<br>\u6d3b\u52d5\u7528\u6236:",2:"2\u5206\u9418\u524d<br>\u6d3b\u52d5\u7528\u6236:",3:"3\u5206\u9418\u524d<br>\u6d3b\u52d5\u7528\u6236:",4:"4\u5206\u9418\u524d<br>\u6d3b\u52d5\u7528\u6236:",5:"5\u5206\u9418\u524d<br>\u6d3b\u52d5\u7528\u6236:",6:"6\u5206\u9418\u524d<br>\u6d3b\u52d5\u7528\u6236:",7:"7\u5206\u9418\u524d<br>\u6d3b\u52d5\u7528\u6236:",8:"8\u5206\u9418\u524d<br>\u6d3b\u52d5\u7528\u6236:",9:"9\u5206\u9418\u524d<br>\u6d3b\u52d5\u7528\u6236:",10:"10\u5206\u9418\u524d<br>\u6d3b\u52d5\u7528\u6236:",
11:"11\u5206\u9418\u524d<br>\u6d3b\u52d5\u7528\u6236:",12:"12\u5206\u9418\u524d<br>\u6d3b\u52d5\u7528\u6236:",13:"13\u5206\u9418\u524d<br>\u6d3b\u52d5\u7528\u6236:",14:"14\u5206\u9418\u524d<br>\u6d3b\u52d5\u7528\u6236:",15:"15\u5206\u9418\u524d<br>\u6d3b\u52d5\u7528\u6236:",16:"16\u5206\u9418\u524d<br>\u6d3b\u52d5\u7528\u6236:",17:"17\u5206\u9418\u524d<br>\u6d3b\u52d5\u7528\u6236:",18:"18\u5206\u9418\u524d<br>\u6d3b\u52d5\u7528\u6236:",19:"19\u5206\u9418\u524d<br>\u6d3b\u52d5\u7528\u6236:",20:"20\u5206\u9418\u524d<br>\u6d3b\u52d5\u7528\u6236:",
21:"21\u5206\u9418\u524d<br>\u6d3b\u52d5\u7528\u6236:",22:"22\u5206\u9418\u524d<br>\u6d3b\u52d5\u7528\u6236:",23:"23\u5206\u9418\u524d<br>\u6d3b\u52d5\u7528\u6236:",24:"24\u5206\u9418\u524d<br>\u6d3b\u52d5\u7528\u6236:",25:"25\u5206\u9418\u524d<br>\u6d3b\u52d5\u7528\u6236:",26:"26\u5206\u9418\u524d<br>\u6d3b\u52d5\u7528\u6236:",27:"27\u5206\u9418\u524d<br>\u6d3b\u52d5\u7528\u6236:",28:"28\u5206\u9418\u524d<br>\u6d3b\u52d5\u7528\u6236:",29:"29\u5206\u9418\u524d<br>\u6d3b\u52d5\u7528\u6236:",30:" "}}})}).success(function(){setTimeout(load_activity_user,
3E4)}).error(function(){setTimeout(load_activity_user,3E4)}).complete(function(){})}
function load_systeminfo(){$.getJSON(gl_target_server+"/php/dashboarddata.php","loadsysteminfo=1&project_id="+project_id,function(b){for(var a=document.getElementById("systeminfo_box_body");a.firstChild;)a.removeChild(a.firstChild);var d=parseFloat(b.TotalDiskSize)/1024,c=parseFloat(b.TotalUsedSize)/1024,e=parseFloat(b.TotalFreeSize)/1024,g=parseFloat(b.DBUsedSize)/1024;a.appendChild(create_systeminfo_row("\u7cfb\u7d71\u78c1\u789f\u5bb9\u91cf",d.toFixed(2),"GB"));a.appendChild(create_systeminfo_row("\u5df2\u4f7f\u7528\u5bb9\u91cf",
c.toFixed(2),"GB"));a.appendChild(create_systeminfo_row("\u53ef\u4f7f\u7528\u5bb9\u91cf",e.toFixed(2),"GB"));a.appendChild(create_systeminfo_row("\u8cc7\u6599\u5eab\u4f7f\u7528\u5bb9\u91cf",g.toFixed(2),"GB"));a.appendChild(create_systeminfo_row("\u8a18\u61b6\u9ad4\u4f7f\u7528",b.MemoryUsage,"MB"));a.appendChild(create_systeminfo_row("\u670d\u52d9\u57f7\u884c\u6642\u9593",b.SystemRunTime,""));a.appendChild(create_systeminfo_row("CPU\u4f7f\u7528\u6642\u9593",b.CPURunTime,""))}).success(function(){setTimeout(load_systeminfo,
12E4)}).error(function(){setTimeout(load_systeminfo,12E4)}).complete(function(){})}function create_systeminfo_row(b,a,d){var c=document.createElement("tr"),e=document.createElement("td");e.textContent=b;c.appendChild(e);b=document.createElement("td");c.appendChild(b);e=document.createElement("span");0==d.length?e.setAttribute("class","label label-warning"):e.setAttribute("class","label label-success");e.textContent=a+" "+d;b.appendChild(e);return c}
function load_sos_user(){$.getJSON(gl_target_server+"/php/dashboarddata.php","loadalert=1&startdate="+glTargetStartDate+"&enddate="+glTargetEndDate+"&project_id="+project_id,function(b){for(var a=document.getElementById("sos_box_body");a.firstChild;)a.removeChild(a.firstChild);for(var d in b){var c=create_sos_row(b[d]);a.appendChild(c)}}).success(function(){setTimeout(load_sos_user,3E4)}).error(function(){setTimeout(load_sos_user,3E4)}).complete(function(){})}
function load_area_user(){$.getJSON(gl_target_server+"/php/dashboarddata.php","loadareauser=1&startdate="+glTargetStartDate+"&enddate="+glTargetEndDate,function(b){for(var a=document.getElementById("areauser_box_body");a.firstChild;)a.removeChild(a.firstChild);for(var d in b){var c=create_areauaer_row(b[d]);a.appendChild(c)}}).success(function(){setTimeout(load_area_user,3E4)}).error(function(){setTimeout(load_area_user,3E4)}).complete(function(){})}
function load_operation_mode(){$.getJSON(gl_target_server+"/php/dashboarddata.php","loadoperationmode=1&startdate="+glTargetStartDate+"&enddate="+glTargetEndDate+"&project_id="+project_id,function(b){for(var a=document.getElementById("operationmode_box_body");a.firstChild;)a.removeChild(a.firstChild);for(var d in b){var c=b[d];null!=c&&0<c.count&&(c=create_operationmode_row(c),a.appendChild(c))}}).success(function(){setTimeout(load_operation_mode,3E4)}).error(function(){setTimeout(load_operation_mode,
3E4)}).complete(function(){})}
function load_inspection_event(){$.getJSON(gl_target_server+"/php/dashboarddata.php","loadinspection=1&prettystring=1&startdate="+glTargetStartDate+"&enddate="+glTargetEndDate+"&project_id="+project_id,function(b){for(var a=document.getElementById("inspection_box_body");a.firstChild;)a.removeChild(a.firstChild);for(var d in b){var c=create_inspection_row(b[d]);a.appendChild(c)}}).success(function(){setTimeout(load_inspection_event,3E4)}).error(function(){setTimeout(load_inspection_event,3E4)}).complete(function(){})}
function load_device_alive(){$.getJSON(gl_target_server+"/php/dashboarddata.php","loaddevicealive=1&project_id="+project_id,function(b){for(var a=document.getElementById("device_alive_box_body");a.firstChild;)a.removeChild(a.firstChild);for(var d in b){var c=create_devicealive_row(b[d]);a.appendChild(c)}}).success(function(){setTimeout(load_device_alive,1E4)}).error(function(){setTimeout(load_device_alive,1E4)}).complete(function(){})}
function load_system_service(){$.getJSON(gl_target_server+"/php/dashboarddata.php","loadsystemservice=1&project_id="+project_id,function(b){for(var a=document.getElementById("system_service_box_body");a.firstChild;)a.removeChild(a.firstChild);b=create_systemservice_row(b);a.appendChild(b)}).success(function(){setTimeout(load_system_service,1E4)}).error(function(){setTimeout(load_system_service,1E4)}).complete(function(){})}
function load_nodemoveoffset(){$.getJSON(gl_target_server+"/php/dashboarddata.php","loadnodemoveoffset=1&startdate="+glTargetStartDate+"&enddate="+glTargetEndDate+"&project_id="+project_id,function(b){for(var a=document.getElementById("nodemoveoffset_box_body");a.firstChild;)a.removeChild(a.firstChild);for(var d in b){var c=create_nodemoveoffset_row(b[d]);a.appendChild(c);if(10<=d)break}}).success(function(){setTimeout(load_nodemoveoffset,3E4)}).error(function(){setTimeout(load_nodemoveoffset,3E4)}).complete(function(){})}
function create_sos_row(b){var a=document.createElement("tr"),d=document.createElement("td");a.appendChild(d);var c=document.createElement("span");c.setAttribute("class","badge bg-green");c.textContent=b.nodename;d.appendChild(c);d=document.createElement("td");d.textContent=b.count;a.appendChild(d);d=document.createElement("td");a.appendChild(d);c=document.createElement("span");c.setAttribute("class","label label-info");c.textContent=convertPrettyCourseTime(b.max_time);d.appendChild(c);return a}
function create_areauaer_row(b){var a=document.createElement("tr"),d=document.createElement("td");a.appendChild(d);var c=document.createElement("span");c.setAttribute("class","label label-success");c.textContent=b.areaname;d.appendChild(c);d=document.createElement("td");d.textContent=b.count;a.appendChild(d);d=document.createElement("td");a.appendChild(d);b=parseInt(b.totaltime)/parseInt(b.count);c=document.createElement("span");c.setAttribute("class","label label-warning");c.textContent=convertPrettyTime(convertFormatTime(b));
d.appendChild(c);return a}
function create_operationmode_row(b){var a=document.createElement("tr"),d=document.createElement("td");a.appendChild(d);var c=document.createElement("span");c.setAttribute("class","label label-success");"0"==b.mode?c.textContent=" ":"1"==b.mode?c.textContent=" UWB":"2"==b.mode?c.textContent=" LoRa_Ranging":"3"==b.mode&&(c.textContent=" GPS");d.appendChild(c);d=document.createElement("td");d.textContent=b.count;a.appendChild(d);d=document.createElement("td");a.appendChild(d);b=parseInt(b.totaltime)/
parseInt(b.count);c=document.createElement("span");c.setAttribute("class","label label-warning");c.textContent=convertPrettyTime(convertFormatTime(b));d.appendChild(c);return a}
function create_inspection_row(b){var a=JSON.parse(b.eventjson),d=document.createElement("tr"),c=document.createElement("td");d.appendChild(c);var e=document.createElement("span");e.setAttribute("class","label label-success");e.textContent=a.GroupName;c.appendChild(e);c=document.createElement("td");c.textContent=convertPrettyInspectionEvent(a,b.prettyjson);d.appendChild(c);a=document.createElement("td");d.appendChild(a);c=document.createElement("span");c.setAttribute("class","label label-info");c.textContent=
convertPrettyDateOnly(b.datetime);a.appendChild(c);a=document.createElement("td");d.appendChild(a);c=document.createElement("span");c.setAttribute("class","label label-warning");c.textContent=convertPrettyTimeOnly(b.datetime);a.appendChild(c);return d}
function create_devicealive_row(b){var a=document.createElement("tr"),d=document.createElement("td");a.appendChild(d);var c=document.createElement("span");0==b.type&&(c.setAttribute("class","badge bg-green-active"),c.textContent="\u57fa\u7ad9");1==b.type&&(c.setAttribute("class","badge bg-light-blue-active"),c.textContent="\u6a19\u7c64");2==b.type&&(c.setAttribute("class","badge bg-red-active"),c.textContent="\u9598\u9053");3==b.type&&(c.setAttribute("class","badge bg-yellow-active"),c.textContent=
"Locator");4==b.type&&(c.setAttribute("class","badge bg-purple-active"),c.textContent="LoRa Gateway");d.appendChild(c);d=document.createElement("td");d.textContent=b.total;a.appendChild(d);d=document.createElement("td");a.appendChild(d);c=document.createElement("span");0==b.alive?c.setAttribute("class","label label-danger"):c.setAttribute("class","label label-success");c.textContent=b.alive;d.appendChild(c);d=document.createElement("td");a.appendChild(d);b=b.total-b.alive;c=document.createElement("span");
c.textContent=b;0!=b&&c.setAttribute("class","label label-danger");d.appendChild(c);return a}
function create_systemservice_row(b){var a=document.createElement("tr"),d=document.createElement("td");d.textContent=b.total;a.appendChild(d);d=document.createElement("td");a.appendChild(d);var c=document.createElement("span");0==b.alive?c.setAttribute("class","label label-danger"):c.setAttribute("class","label label-success");c.textContent=b.alive;d.appendChild(c);d=document.createElement("td");a.appendChild(d);b=b.total-b.alive;c=document.createElement("span");0!=b&&c.setAttribute("class","label label-danger");
c.textContent=b;d.appendChild(c);return a}
function create_nodemoveoffset_row(b){var a=document.createElement("tr"),d=document.createElement("td"),c=document.createElement("span");c.setAttribute("class","badge bg-light-blue-active");c.textContent=b.nodename;d.appendChild(c);a.appendChild(d);d=document.createElement("td");a.appendChild(d);c=document.createElement("span");c.setAttribute("class","label label-success");var e=parseInt(b.moveoffset)/100;c.textContent=parseInt(e);d.appendChild(c);d=document.createElement("td");a.appendChild(d);c=
document.createElement("span");c.setAttribute("class","label label-warning");c.textContent=convertPrettyTime(convertFormatTime(60*b.minutes));d.appendChild(c);return a}
function convertPrettyInspectionEvent(b,a){if("inspectionpoint"===b.type){var d;d="\u5de1\u6aa2\u54e1 "+a.tagname;"enter"===b.action?d+=" \u9032\u5165":"leave"===b.action&&(d+="\u96e2\u958b");return d+=" \u5de1\u6aa2\u9ede:"+a.inspectionpointname}if("inspectionpointtravel"===b.type)return d="\u5de1\u6aa2\u54e1 "+a.tagname+" \u5de1\u6aa2\u8def\u7dda:",null!=a.startinspectionpointname&&null!=a.endinspectionpointname?d+=a.startinspectionpointname+" -> "+a.endinspectionpointname:null!=a.startinspectionpointname?
d+=a.startinspectionpointname:null!=a.endinspectionpointname&&(d+=a.endinspectionpointname),"exceed"===b.action?d+=" \u5de1\u6aa2\u8def\u7dda\u903e\u6642":"finish"===b.action&&(d+="\u5de1\u6aa2\u8def\u7dda\u5df2\u5b8c\u6210"),d;if("inspectionGroup"===b.type){if("exceed"===b.action)return"\u5de1\u6aa2\u5df2\u903e\u6642";if("finish"===b.action)return"\u5de1\u6aa2\u5df2\u5b8c\u6210"}}function getTargetDateTime(b){return moment().add(b,"d").format("YYYY-MM-DD HH:mm:ss")}
function convertFormatTime(b){return moment.utc(1E3*b).format("DD HH:mm:ss")}function convertPrettyTime(b){var a=moment(b,"DD HH:mm:ss");b=a.day()-3;var d=a.hour(),c=a.minutes(),a=a.seconds(),e="";0<b&&(e+=b+"\u5929");0<d&&(e+=d+"\u5c0f\u6642");0<c&&(e+=c+"\u5206");0<a&&(e+=a+"\u79d2");return e}function convertPrettyDateOnly(b){var a=moment(b,"YYYY-MM-DD HH:mm:ss");b=a.format("YYYY");var d=a.format("M"),a=a.format("D");return b+"\u5e74"+d+"\u6708"+a+"\u65e5 "}
function convertPrettyTimeOnly(b){var a=moment(b,"YYYY-MM-DD HH:mm:ss");b=a.hour();var d=a.minutes(),a=a.seconds(),c="";0<=b&&(c+=b+"\u9ede");0<=d&&(c+=d+"\u5206");0<=a&&(c+=a+"\u79d2");return c}
function convertPrettyCourseTime(b){var a=moment(b,"YYYY-MM-DD HH:mm:ss");b=a.format("YYYY");var d=a.format("M"),c=a.format("D"),e=a.hour(),g=a.minutes(),h=a.seconds();moment().diff(a,"days");var a=a.format("YYYY-MM-DD"),k=moment().format("YYYY-MM-DD"),f="";a!==k&&(f=b+"\u5e74"+d+"\u6708"+c+"\u65e5 ");0<e&&(f+=e+"\u9ede");0<g&&(f+=g+"\u5206");0<h&&(f+=h+"\u79d2");return f}function open_dashboard_page(){window.open("/index.php/vilsdashboard/"+project_id,"_blank").focus()};
