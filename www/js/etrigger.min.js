var glTag_List=[],gl_tag_num=0,gl_tag_load_index=0,LOAD_DEVICE_NUM=20;function event_trig_tag_select(a,b){var d=$("#event_trig_tag_"+a+"_item_"+b).html(),c=$("#event_trig_tag_"+a+"_item_"+b).attr("data-id");$("#event_trig_tag_"+a+"_name").html(d);$("#event_trig_tag_"+a+"_name").attr("data-id",c)}
function event_trig_action_select(a,b){var d=$("#event_trig_action_"+a+"_item_"+b).html(),c=$("#event_trig_action_"+a+"_item_"+b).attr("data-id");$("#event_trig_action_"+a+"_name").html(d);$("#event_trig_action_"+a+"_name").attr("data-id",c)}function event_trig_area_select(a,b){var d=$("#event_trig_area_"+a+"_item_"+b).html(),c=$("#event_trig_area_"+a+"_item_"+b).attr("data-id");$("#event_trig_area_"+a+"_name").html(d);$("#event_trig_area_"+a+"_name").attr("data-id",c)}
function event_trig_time_select(a,b){var d=$("#event_trig_time_"+a+"_item_"+b).html(),c=$("#event_trig_time_"+a+"_item_"+b).attr("data-id");$("#event_trig_time_"+a+"_name").html(d);$("#event_trig_time_"+a+"_name").attr("data-id",c)}
function event_trig_delete(a){return 1==confirm("Do you want to delete this event ?")?($("#event_trig_"+a).remove(),$("#event_trig_delete_"+a).remove(),a="eventid="+a+("&project_id="+project_id),jQuery.ajax({url:"/php/events.php",type:"POST",data:a+"&delete_event=1",dataType:"text",success:function(a){},error:function(a,d,c){alert(c);window.location="/index.php/events/"+project_id}})):!1}
function event_trig_create(){var a=$("#event_trig_tag_0_name").attr("data-id"),b=$("#event_trig_action_0_name").attr("data-id"),d=$("#event_trig_area_0_name").attr("data-id"),c=$("#event_trig_time_0_name").attr("data-id"),f={};f.project_id=""+project_id;f.nodeid=a;f.action=b;f.areaid=d;f.issuetime=c;return jQuery.ajax({url:"/php/events.php",type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify(f),success:function(a){load_event_exist()},error:function(a,b,c){alert(c);alert(a.responseText)}})}
function add_exist_event(a,b,d,c,f,g,e,k,h){b=document.getElementById("event_box_body");c=document.createElement("div");b.appendChild(c);c.setAttribute("class","breadcrumb flat");c.id="event_trig_"+a;g=document.createElement("a");c.appendChild(g);g.setAttribute("class","active");d=document.createTextNode(d);g.appendChild(d);d=document.createElement("a");c.appendChild(d);f=document.createTextNode(f);d.appendChild(f);f=document.createElement("a");c.appendChild(f);e=document.createTextNode(e);f.appendChild(e);
e=document.createElement("a");c.appendChild(e);h=document.createTextNode(h);e.appendChild(h);e=document.createElement("div");e.setAttribute("class","btn-group pull-right");b.appendChild(e);h=document.createElement("div");h.setAttribute("class","tools");e.appendChild(h);e=document.createElement("a");h.appendChild(e);e.setAttribute("href","javascript:;");e.setAttribute("onclick","event_trig_delete("+a+");return false;");e.setAttribute("data-id","eventid");e.id="event_trig_delete_"+a;a=document.createElement("i");
a.setAttribute("class","fa fa-trash-o");e.appendChild(a);a=document.createElement("br");b.appendChild(a)}function load_event_exist(){$.getJSON(gl_target_server+"/php/events.php","loadevents=1&project_id="+project_id,function(a){for(var b=document.getElementById("event_box_body");b.firstChild;)b.removeChild(b.firstChild);var d=1;$.each(a,function(a,b){add_exist_event(a,b.nodeid,b.nodename,b.action,b.action,b.areaid,b.areaname,b.issuetime,b.issuename);d++})});return!1}
function load_Items_to_newevent_UI(a,b,d,c){var f="",g="";0<c.length&&(f=c[0].itemid,g=c[0].itemname);var e=document.createElement("button");d.appendChild(e);e.setAttribute("class","btn "+b);e.setAttribute("data-id",f);e.id="event_trig_"+a+"_0_name";f=document.createTextNode(g);e.appendChild(f);e=document.createElement("button");d.appendChild(e);e.setAttribute("class","btn "+b+" dropdown-toggle");e.setAttribute("data-toggle","dropdown");e.id="event_trig_"+a+"_0";b=document.createElement("span");e.appendChild(b);
b.setAttribute("class","caret");b=document.createElement("span");e.appendChild(b);b.setAttribute("class","sr-only");b=document.createElement("ul");d.appendChild(b);b.setAttribute("class","dropdown-menu");b.setAttribute("role","menu");for(d=0;d<c.length;d++)f=document.createElement("li"),b.appendChild(f),e=document.createElement("a"),f.appendChild(e),e.setAttribute("href","javascript:;"),e.setAttribute("onclick","event_trig_"+a+"_select(0,"+d+");return false;"),e.setAttribute("data-id",c[d].itemid),
e.id="event_trig_"+a+"_0_item_"+d,f=document.createTextNode(c[d].itemname),e.appendChild(f)}function load_Tags_Info(){$.getJSON(gl_target_server+"/php/vilsnodes.php","devicescount=1&project_id="+project_id,function(a){gl_tag_num=parseInt(a.LOC_TAG_NUM);gl_tag_load_index=0}).success(function(){setTimeout(load_Tags,10)}).error(function(){setTimeout(load_Tags_Info,1E3)}).complete(function(){})}
function load_Tags(){gl_tag_load_index>=gl_tag_num?gl_tag_load_index=0:(0==gl_tag_load_index&&(glTag_List=[]),$.getJSON(gl_target_server+"/php/vilsnodes.php","loadtag=1&s="+gl_tag_load_index+"&count="+LOAD_DEVICE_NUM+"&project_id="+project_id,function(a){for(var b=parseInt(a.LOC_TAG_NUM),d=gl_tag_load_index;d<gl_tag_load_index+b;++d){var c="LOC_TAG_INDEX_"+d;void 0!=a[c]&&null!=a[c]&&(c=a[c].split(","),glTag_List[d]={},glTag_List[d].itemid=c[3],glTag_List[d].itemname=c[5])}gl_tag_load_index+=b}).success(function(){if(gl_tag_load_index>=
gl_tag_num){gl_tag_load_index=0;var a=document.getElementById("event_tag_selection");load_Items_to_newevent_UI("tag","btn-info",a,glTag_List)}else setTimeout(load_Tags,10)}).error(function(){gl_tag_load_index=0;setTimeout(load_Tags,1E3)}).complete(function(){}))}
function load_Tags_old(){var a=document.getElementById("event_tag_selection"),b=[];$.getJSON(gl_target_server+"/php/vilsnodes.php","loadtag=1&project_id="+project_id,function(d){for(var c=parseInt(d.LOC_TAG_NUM),f=0;f<c;++f){var g=d["LOC_TAG_INDEX_"+f].split(",");b[f]={};b[f].itemid=g[3];b[f].itemname=g[5]}load_Items_to_newevent_UI("tag","btn-info",a,b)})}
function load_Actions(){var a=document.getElementById("event_action_selection"),b=[];$.getJSON(gl_target_server+"/php/events.php","loadactions=1&project_id="+project_id,function(d){for(var c=0;c<d.length;++c){var f=convert_action_name(d[c].actionname);""!=f&&(b[c]={},b[c].itemid=d[c].actionid,b[c].itemname=f)}load_Items_to_newevent_UI("action","btn-warning",a,b)})}
function load_Areas(){var a=document.getElementById("event_area_selection"),b=[];$.getJSON(gl_target_server+"/php/map.php","project_id="+project_id,function(d){var c=0;$.each(d,function(a,d){var e=JSON.parse(d);b[c]={};b[c].itemid=e.properties.areaid;b[c].itemname=e.properties.areaname;c++});load_Items_to_newevent_UI("area","btn-success",a,b)})}
function load_IssueTimes(){var a=document.getElementById("event_time_selection"),b=[];$.getJSON(gl_target_server+"/php/events.php","loadissuetimes=1&project_id="+project_id,function(d){for(var c=0;c<d.length;++c)b[c]={},b[c].itemid=d[c].issueid,b[c].itemname=d[c].issuename;load_Items_to_newevent_UI("time","btn-danger",a,b)});event_trig_time_select()}function load_event_conditions(){load_Tags_Info();load_Actions();load_Areas();load_IssueTimes();return!1}load_event_exist();load_event_conditions();
function convert_action_name(a){if("Enter"==a)return"\u9032\u5165";if("Leave"==a)return"\u96e2\u958b";if("Stay"==a)return"\u505c\u7559";if("Alert"==a)return"\u6309\u4e0b\u8b66\u6025\u6309\u9215";if("Cancel"==a||"cancel"==a)return"\u6309\u4e0b\u53d6\u6d88\u6309\u9215"}function convert_IssueTime_name(a){return"Immediately"==a?"\u7acb\u523b":"1 minute"==a?"1\u5206\u9418":"5 minutes"==a?"5\u5206\u9418":"10 minutes"==a?"10\u5206\u9418":a}
function open_events_page(){window.open("/index.php/vilsevents/"+project_id,"_blank").focus()};
