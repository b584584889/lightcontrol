var PreLoadIndex=-1,CurrentLoadIndex=0,LOAD_STATE_END=9999,UPDATE_INTERVAL=1E3,LOAD_DEVICE_NUM=100,LOAD_PAGE_NUM=20,gl_tag_num=0,gl_anchor_num=0,gl_locator_num=0,gl_tag_load_index=0,gl_anchor_load_index=0,gl_coord_load_index=0,glTag_List=[],glAnchor_List=[],glLocator_List=[],glUser_List=[],glSensorInfo_List=[],gl_userdatasubgroups=[],glCurrentPage={},glRecord_List={},glResponseImage_List={},glMessageStatus_List=[],glActiveRecordType=1,glActiveRecordMsgType="1111",pre_input_value="",pre_input_date_value=
"";check_loading_status();
function check_loading_status(){switch(CurrentLoadIndex){case 0:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,create_dropdown_list(),CurrentLoadIndex+=1);break;case 1:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,load_devices());break;case 2:PreLoadIndex!=
CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,load_user(),load_sensor());break;case 3:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,load_userdatasubgroup());break;case 4:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+
CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,load_records());break;case 5:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,show_records(),CurrentLoadIndex+=1);break;case 6:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,load_message_status());break;case 7:PreLoadIndex!=
CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,show_message_status(),CurrentLoadIndex=LOAD_STATE_END)}CurrentLoadIndex!=LOAD_STATE_END?setTimeout(check_loading_status,100):console.log("check_loading_status() Stop.")}function reload_status(){PreLoadIndex=2;CurrentLoadIndex=3;check_loading_status()}
function create_dropdown_list(){var a=document.getElementById("current_type_title"),d=document.getElementById("dropdown_menu_type"),b=document.createElement("span");b.setAttribute("id","current_type_title_item");b.textContent="\u5361\u7247\u9ede\u540d";b.setAttribute("class","badge bg-blue-active");a.appendChild(b);d.appendChild(create_dropdown_type_item(1,"\u5361\u7247\u9ede\u540d"));d.appendChild(create_dropdown_type_item(2,"\u624b\u52d5(\u7fa4\u767c)"));d.appendChild(create_dropdown_type_item(3,
"\u4e8b\u52d9\u6d41\u7a0b"));d.appendChild(create_dropdown_type_item(4,"\u8a2d\u5099\u89f8\u767c"));d.appendChild(create_dropdown_type_item(5,"\u5de1\u6aa2\u76f8\u95dc\u901a\u77e5"));d.appendChild(create_dropdown_type_item(6,"\u4e0d\u7279\u5b9a\u5c0d\u8c61\u63a8\u64ad"));d.appendChild(create_dropdown_type_item(99,"ALL"));glActiveRecordType=1;update_dropdown_theme_item(1,"\u5361\u7247\u9ede\u540d")}
function create_dropdown_type_item(a,d){var b=document.createElement("li"),c=document.createElement("a");c.setAttribute("class","small");c.setAttribute("tabIndex","-1");c.setAttribute("data-value",a);c.setAttribute("href","javascript:;");c.setAttribute("onclick","click_dropdown_theme_item("+a+', "'+d+'");return true;');var e=document.createElement("span");e.textContent=d;1==a?e.setAttribute("class","badge bg-blue-active"):2==a?e.setAttribute("class","badge bg-yellow-active"):3==a?e.setAttribute("class",
"badge bg-green-active"):4==a?e.setAttribute("class","badge bg-aqua-active"):5==a?e.setAttribute("class","badge bg-purple-active"):e.setAttribute("class","badge bg-red-active");c.appendChild(e);b.appendChild(c);return b}
function create_dropdown_theme_item(a,d,b,c){var e=document.createElement("li"),f=document.createElement("a");f.setAttribute("class","small");f.setAttribute("tabIndex","-1");f.setAttribute("data-value",d);f.setAttribute("href","javascript:;");f.setAttribute("onclick",'dropdown_theme_item_click("'+a+'", "'+d+'", "'+b+'", "'+c+'");return true;');a=document.createElement("span");a.textContent=c;1==d?a.setAttribute("class","badge bg-blue-active"):2==d?a.setAttribute("class","badge bg-yellow-active"):
3==d?a.setAttribute("class","badge bg-green-active"):4==d?a.setAttribute("class","badge bg-aqua-active"):5==d?a.setAttribute("class","badge bg-purple-active"):6==d?a.setAttribute("class","badge bg-blue"):7==d?a.setAttribute("class","badge bg-teal-active"):8==d?a.setAttribute("class","badge bg-yellow"):9==d?a.setAttribute("class","badge bg-teal-dsiabled"):10==d?a.setAttribute("class","badge bg-aqua-active"):a.setAttribute("class","badge bg-red-active");f.appendChild(a);e.appendChild(f);return e}
function click_dropdown_theme_item(a,d){glActiveRecordType=a;update_dropdown_theme_item(a,d);glCurrentPage[glActiveRecordMsgType]=1;reload_status()}
function update_dropdown_theme_item(a,d){var b=document.getElementById("current_type_title_item");b.textContent=d;var c=clearChildView("current_theme_title"),e=clearChildView("dropdown_menu_theme"),f=document.createElement("span");f.setAttribute("id","current_theme_title_item");f.setAttribute("class","badge bg-blue-active");c.appendChild(f);1==a?(b.setAttribute("class","badge bg-blue-active"),f.textContent="\u5361\u7247\u9ede\u540d\u901a\u77e5",glActiveRecordMsgType="12",e.appendChild(create_dropdown_theme_item(a,
1,"12","\u5361\u7247\u9ede\u540d\u901a\u77e5")),e.appendChild(create_dropdown_theme_item(a,99,"12","ALL"))):2==a?(b.setAttribute("class","badge bg-yellow-active"),f.textContent="\u806f\u7d61\u7c3f",glActiveRecordMsgType="201",e.appendChild(create_dropdown_theme_item(a,1,"201","\u806f\u7d61\u7c3f")),e.appendChild(create_dropdown_theme_item(a,2,"202","\u5e2b\u751f\u4ea4\u6d41")),e.appendChild(create_dropdown_theme_item(a,3,"203","\u96fb\u5b50\u6295\u7968")),e.appendChild(create_dropdown_theme_item(a,
4,"204","\u5de5\u4f5c\u6307\u793a")),e.appendChild(create_dropdown_theme_item(a,5,"206","\u5354\u52a9\u4e8b\u9805\u56de\u5831")),e.appendChild(create_dropdown_theme_item(a,6,"207","\u516c\u5e03\u6b04")),e.appendChild(create_dropdown_theme_item(a,7,"205","\u4e0d\u5206\u985e")),e.appendChild(create_dropdown_theme_item(a,99,"201,202,203,204,205,206,207","ALL"))):3==a?(b.setAttribute("class","badge bg-green-active"),f.textContent="\u8acb\u5047\u76f8\u95dc\u7533\u8acb",glActiveRecordMsgType="2222",e.appendChild(create_dropdown_theme_item(a,
1,"2222","\u8acb\u5047\u76f8\u95dc\u7533\u8acb")),e.appendChild(create_dropdown_theme_item(a,2,"3333","\u9078\u8ab2\u76f8\u95dc\u7533\u8acb")),e.appendChild(create_dropdown_theme_item(a,99,"2222,3333","ALL"))):4==a?(b.setAttribute("class","badge bg-aqua-active"),f.textContent="Tag \u7dca\u6025\u6c42\u52a9\u8207\u53d6\u6d88\u901a\u77e5",glActiveRecordMsgType="2",e.appendChild(create_dropdown_theme_item(a,1,"2","Tag \u7dca\u6025\u6c42\u52a9\u8207\u53d6\u6d88\u901a\u77e5")),e.appendChild(create_dropdown_theme_item(a,
2,"3","\u4f4e\u96fb\u91cf\u901a\u77e5")),e.appendChild(create_dropdown_theme_item(a,3,"4","\u9032\u5165(\u96e2\u958b)\u5371\u96aa\u5340\u57df\u901a\u77e5")),e.appendChild(create_dropdown_theme_item(a,4,"6","\u672a\u6b63\u5e38\u914d\u6234\u901a\u77e5")),e.appendChild(create_dropdown_theme_item(a,5,"7","\u9032\u51fa\u5340\u57df\u4e8b\u4ef6")),e.appendChild(create_dropdown_theme_item(a,6,"9","GPS \u6d3b\u52d5\u8d85\u904e\u5340\u57df\u7bc4\u570d\u901a\u77e5")),e.appendChild(create_dropdown_theme_item(a,
7,"102","Locator \u7dca\u6025\u6c42\u52a9\u8207\u53d6\u6d88\u901a\u77e5")),e.appendChild(create_dropdown_theme_item(a,8,"103","\u547c\u559a\u53d6\u6d88\u901a\u77e5")),e.appendChild(create_dropdown_theme_item(a,9,"105","\u65b7\u96fb\u8b66\u5831")),e.appendChild(create_dropdown_theme_item(a,10,"106","\u9031\u908a\u6a21\u7d44\u8a0a\u606f")),e.appendChild(create_dropdown_theme_item(a,11,"800","\u4eba\u54e1\u7dca\u6025\u6c42\u52a9")),e.appendChild(create_dropdown_theme_item(a,99,"2,3,4,6,7,9,102,103,105,106,800",
"ALL"))):5==a?(b.setAttribute("class","badge bg-purple-active"),f.textContent="\u5de1\u6aa2\u76f8\u95dc\u901a\u77e5",glActiveRecordMsgType="5",e.appendChild(create_dropdown_theme_item(a,1,"5","\u5de1\u6aa2\u76f8\u95dc\u901a\u77e5")),e.appendChild(create_dropdown_theme_item(a,99,"5","ALL"))):6==a?(b.setAttribute("class","badge bbg-blue"),f.textContent="\u4e0d\u7279\u5b9a\u5c0d\u8c61\u63a8\u64ad",glActiveRecordMsgType="10",e.appendChild(create_dropdown_theme_item(a,1,"10","\u4e0d\u7279\u5b9a\u5c0d\u8c61\u63a8\u64ad")),
e.appendChild(create_dropdown_theme_item(a,99,"10","ALL"))):(b.setAttribute("class","badge bg-red-active"),f.textContent="ALL",glActiveRecordMsgType="0",e.appendChild(create_dropdown_theme_item(a,99,"0","ALL")))}
function dropdown_theme_item_click(a,d,b,c){update_dropdown_theme_title(a,d,c);glActiveRecordMsgType!=d&&(glActiveRecordType=a,glActiveRecordMsgType=b,a=glCurrentPage[glActiveRecordMsgType],void 0==a&&(a=glCurrentPage[glActiveRecordMsgType]=1),document.getElementById("id_current_page_num").textContent=a,reload_status())}
function update_dropdown_theme_title(a,d,b){a=clearChildView("current_theme_title");var c=document.createElement("span");c.setAttribute("id","current_theme_title_item");c.textContent=b;a.appendChild(c);1==d?c.setAttribute("class","badge bg-blue-active"):2==d?c.setAttribute("class","badge bg-yellow-active"):3==d?c.setAttribute("class","badge bg-green-active"):4==d?c.setAttribute("class","badge bg-aqua-active"):5==d?c.setAttribute("class","badge bg-purple-active"):6==d?c.setAttribute("class","badge bg-blue"):
7==d?c.setAttribute("class","badge bg-teal-active"):8==d?c.setAttribute("class","badge bg-yellow"):9==d?c.setAttribute("class","badge bg-teal-dsiabled"):10==d?c.setAttribute("class","badge bg-aqua-active"):c.setAttribute("class","badge bg-red-active")}
function load_devices(){$.getJSON(gl_target_server+"/php/vilsnodes.php","devicescount=1&project_id="+project_id,function(a){gl_tag_num=parseInt(a.LOC_TAG_NUM);gl_anchor_num=parseInt(a.LOC_ANCHOR_NUM);gl_locator_num=parseInt(a.LOC_LOCATOR_NUM);gl_locator_load_index=gl_anchor_load_index=gl_tag_load_index=0;glTag_List=[];glAnchor_List=[];glLocator_List=[]}).success(function(){setTimeout(load_tag,10)}).error(function(){}).complete(function(){})}
function load_tag(){gl_tag_load_index>=gl_tag_num?(gl_tag_load_index=0,setTimeout(load_anchors,10)):(0==gl_tag_load_index&&(glTag_List=[]),$.getJSON(gl_target_server+"/php/vilsnodes.php","loadtag=1&s="+gl_tag_load_index+"&count="+LOAD_DEVICE_NUM+"&project_id="+project_id,function(a){var d=parseInt(a.LOC_TAG_NUM);console.log("tag_num:"+d+", gl_tag_load_index:"+gl_tag_load_index);for(var b=gl_tag_load_index;b<gl_tag_load_index+d;++b){var c="LOC_TAG_INDEX_"+b;void 0!=a[c]&&null!=a[c]&&(c=a[c].split(","),
glTag_List.push(c))}gl_tag_load_index+=d}).success(function(){gl_tag_load_index>=gl_tag_num?setTimeout(load_anchors,10):setTimeout(load_tag,1)}).error(function(){gl_tag_load_index=0;setTimeout(load_tag,UPDATE_INTERVAL)}).complete(function(){}))}
function load_anchors(){gl_anchor_load_index>=gl_anchor_num?(gl_anchor_load_index=0,setTimeout(load_locator,10)):(0==gl_anchor_load_index&&(glAnchor_List=[]),$.getJSON(gl_target_server+"/php/vilsnodes.php","loadanchor=1&s="+gl_anchor_load_index+"&count="+LOAD_DEVICE_NUM+"&project_id="+project_id,function(a){for(var d=parseInt(a.LOC_ANCHOR_NUM),b=gl_anchor_load_index;b<gl_anchor_load_index+d;++b){var c="LOC_ANCHOR_INDEX_"+b;void 0!=a[c]&&null!=a[c]&&(c=a[c].split(","),glAnchor_List.push(c))}gl_anchor_load_index+=
d}).success(function(){gl_anchor_load_index>=gl_anchor_num?(gl_anchor_load_index=0,setTimeout(load_locator,10)):setTimeout(load_anchors,10)}).error(function(){gl_anchor_load_index=0;setTimeout(load_anchors,1E3)}).complete(function(){}))}
function load_locator(){gl_locator_load_index>=gl_locator_num?(gl_locator_load_index=0,CurrentLoadIndex+=1):(0==gl_locator_load_index&&(glLocator_List=[]),$.getJSON(gl_target_server+"/php/vilsnodes.php","loadlocator=1&s="+gl_locator_load_index+"&count="+LOAD_DEVICE_NUM+"&project_id="+project_id,function(a){var d=parseInt(a.LOC_LOCATOR_NUM);console.log("locator_num:"+d+", gl_locator_load_index:"+gl_locator_load_index);for(var b=gl_locator_load_index;b<gl_locator_load_index+d;++b){var c="LOC_LOCATOR_INDEX_"+
b;void 0!=a[c]&&null!=a[c]&&(c=a[c].split(","),glLocator_List.push(c))}gl_locator_load_index+=d}).success(function(){gl_locator_load_index>=gl_locator_num?CurrentLoadIndex+=1:setTimeout(load_locator,1)}).error(function(){gl_locator_load_index=0;setTimeout(load_locator,UPDATE_INTERVAL)}).complete(function(){}))}
function load_user(){glUser_List=[];$.getJSON(gl_target_server+"/php/vilsnodes.php","loaduserbaseinfo=1&&project_id="+project_id,function(a){$.each(a,function(a,b){glUser_List.push(b)})}).success(function(){CurrentLoadIndex+=1}).error(function(){}).complete(function(){})}
function load_sensor(){glSensorInfo_List=[];$.getJSON(gl_target_server+"/php/vilsnodes.php","loadsensordevicebaseinfo=1&&project_id="+project_id,function(a){$.each(a,function(a,b){var c={};c.id=a;c.name=b.name;glSensorInfo_List.push(c)})}).success(function(){}).error(function(){}).complete(function(){})}
function load_userdatasubgroup(){$.getJSON(gl_target_server+"/php/vilsnodes.php","loaddatasubgroup=1&project_id="+project_id,function(a){$.each(a,function(a,b){b.subgroupid=parseInt(b.subgroupid);gl_userdatasubgroups.push(b)})}).success(function(){CurrentLoadIndex+=1}).error(function(){}).complete(function(){})}
function load_records(){var a=document.getElementById("search_notify_target_text").value,d=document.getElementById("search_notify_date_text").value;pre_input_value=a;pre_input_date_value=d;var b=gl_target_server+"/php/pushnotify.php",c=glCurrentPage[glActiveRecordMsgType];void 0==c&&(c=glCurrentPage[glActiveRecordMsgType]=1);var c=(c-1)*LOAD_PAGE_NUM,e=LOAD_PAGE_NUM;glRecord_List[glActiveRecordMsgType]=[];c="loadrecords=1&project_id="+project_id+"&offset="+c+"&count="+e+"&type="+glActiveRecordMsgType;
0<a.length&&(c=c+"&searchtarget="+a);0<d.length&&(c=c+"&searchdate="+d);$.getJSON(b,c,function(a){$.each(a,function(a,b){glRecord_List[glActiveRecordMsgType].push(b)})}).success(function(){CurrentLoadIndex+=1}).error(function(){CurrentLoadIndex+=1}).complete(function(){})}
function show_records(){for(var a=document.getElementById("table_content");a.firstChild;)a.removeChild(a.firstChild);for(var d=glCurrentPage[glActiveRecordMsgType],b=0;b<glRecord_List[glActiveRecordMsgType].length;b++)show_record(a,(d-1)*LOAD_PAGE_NUM+b+1,glRecord_List[glActiveRecordMsgType][b])}
function show_record(a,d,b){var c=0,e=document.createElement("tr");e.setAttribute("id",b.dbId+"_TABLE_ROW");a.appendChild(e);var f=document.createElement("tr");f.setAttribute("id",b.dbId+"_TABLE_ROW_EXTRA");a.appendChild(f);e.appendChild(document.createElement("td"));e.cells[c].appendChild(document.createTextNode(""+d));if(0<b.surveyids.length||0<b.imageuid.length)a=document.createElement("a"),a.setAttribute("id",b.dbId+"_message_detail_button"),a.setAttribute("title","\u986f\u793a\u8a73\u7d30\u8cc7\u8a0a"),
a.setAttribute("onclick",'open_message_detail("'+b.dbId+'", "'+b.messagehashkey+'","'+b.surveyids+'","'+b.hashkeys+'","'+b.imageuid+'");'),a.setAttribute("class","btn btn-default btn-xs pull-right"),d=document.createElement("i"),d.setAttribute("id",b.dbId+"_message_detail_icon"),d.setAttribute("class","fa fa-plus text-green"),a.appendChild(d),e.cells[c].appendChild(a);c++;e.appendChild(document.createElement("td"));a=create_UI_record_type_ids(b.type,b.targetids);e.cells[c].appendChild(a);c++;e.appendChild(document.createElement("td"));
a=create_UI_record_device(b.nodeid);e.cells[c].appendChild(a);c++;e.appendChild(document.createElement("td"));a=create_UI_record_devices(b.targetids);e.cells[c].appendChild(a);a=create_UI_record_subgroups(b.subgroupids);e.cells[c].appendChild(a);c++;e.appendChild(document.createElement("td"));a=document.createElement("div");a.setAttribute("id",b.messagehashkey+"_message_read");e.cells[c].appendChild(a);c++;e.appendChild(document.createElement("td"));a=document.createElement("span");a.textContent=
b.title;e.cells[c].appendChild(a);c++;e.appendChild(document.createElement("td"));a=document.createElement("span");a.textContent=b.message;e.cells[c].appendChild(a);c++;e.appendChild(document.createElement("td"));a=document.createElement("span");a.setAttribute("class","label label-info");a.textContent=b.datetime;e.cells[c].appendChild(a);c++;e.appendChild(document.createElement("td"));b=create_resend_button(b);e.cells[c].appendChild(b)}
function load_message_status(){glMessageStatus_List=[];for(var a="",d=0,b=0;b<glRecord_List[glActiveRecordMsgType].length;b++){var c=glRecord_List[glActiveRecordMsgType][b];0<d&&(a+=",");a+=c.messagehashkey;d+=1}$.getJSON(gl_target_server+"/php/pushnotify.php","loadmessagestatus=1&project_id="+project_id+"&hashkeys="+a+"&loadaccount=1",function(a){$.each(a,function(a,b){glMessageStatus_List.push(b)})}).success(function(){CurrentLoadIndex+=1}).error(function(){CurrentLoadIndex+=1}).complete(function(){})}
function show_message_status(){for(var a=0;a<glMessageStatus_List.length;a++){var d=glMessageStatus_List[a];if("1"==d.readed){var b=document.getElementById(d.messagehashkey+"_message_read"),d=create_UI_record_device(d.account);b.appendChild(d)}}}function create_UI_record_type_ids(a,d){var b=d.split(",");if(0<b.length)return create_UI_record_type(a,b[0])}
function create_UI_record_type(a,d){var b=document.createElement("span");switch(a){default:b.textContent="\u672a\u77e5 tag type="+a;break;case "1111":b.textContent="\u624b\u52d5\u7fa4\u767c";break;case "1":b.textContent="\u624b\u52d5\u767c\u9001";break;case "2":b.textContent="\u7dca\u6025\u6c42\u52a9\u8207\u53d6\u6d88\u901a\u77e5";break;case "3":b.textContent="\u4f4e\u96fb\u91cf\u901a\u77e5";break;case "4":b.textContent="\u9032\u5165(\u96e2\u958b)\u5371\u96aa\u5340\u901a\u77e5";break;case "5":b.textContent=
"\u5de1\u6aa2\u76f8\u95dc\u901a\u77e5";break;case "6":b.textContent="\u672a\u6b63\u5e38\u914d\u6234\u901a\u77e5";break;case "7":b.textContent="\u9032\u51fa\u5340\u57df\u4e8b\u4ef6";break;case "8":b.textContent="\u8ab2\u7a0b\u9ede\u540d\u901a\u77e5";break;case "9":b.textContent="GPS\u6d3b\u52d5\u8d85\u904e\u5340\u57df\u7bc4\u570d\u901a\u77e5";break;case "10":b.textContent="\u4e0d\u7279\u5b9a\u5c0d\u8c61\u63a8\u64ad";break;case "12":b.textContent="\u4eba\u54e1\u9ede\u540d";break;case "2222":b.textContent=
"\u8acb\u5047\u76f8\u95dc\u7533\u8acb";break;case "3333":b.textContent="\u9078\u8ab2\u76f8\u95dc\u7533\u8acb";break;case "201":b.textContent="\u806f\u7d61\u7c3f";break;case "202":b.textContent="\u5e2b\u751f\u4ea4\u6d41";break;case "203":b.textContent="\u96fb\u5b50\u6295\u7968";break;case "204":b.textContent="\u5de5\u4f5c\u6307\u793a";break;case "205":b.textContent="\u4e0d\u5206\u985e";break;case "206":b.textContent="\u5354\u52a9\u4e8b\u9805\u56de\u5831";break;case "207":b.textContent="\u516c\u5e03\u6b04";
break;case "101":b.textContent="\u624b\u52d5\u767c\u9001";break;case "102":b.textContent="\u7dca\u6025\u6c42\u52a9\u8207\u53d6\u6d88\u901a\u77e5";break;case "103":b.textContent="\u547c\u559a\u8207\u53d6\u6d88\u901a\u77e5";break;case "104":b.textContent="\u91ab\u751f\u9032\u51fa\u75c5\u623f\u8207\u75c5\u5e8a\u5340\u57df\u901a\u77e5";break;case "105":b.textContent="\u65b7\u96fb\u8b66\u5831";break;case "106":b.textContent="\u5468\u908a\u6a21\u7d44\u8a0a\u606f";break;case "500":b.textContent="\u5361\u7247\u9ede\u540d";
break;case "800":b.textContent="\u4eba\u54e1\u7dca\u6025\u6c42\u52a9"}return b}function create_UI_record_devices(a){var d=document.createElement("div");a=a.split(",");for(var b=0;b<a.length;b++){var c=a[b];3==gl_groupid?c===gl_accountid?(c=create_UI_record_device(c),d.appendChild(c)):c===gl_userid&&(c=create_UI_record_device(c),d.appendChild(c)):(c=create_UI_record_device(c),d.appendChild(c))}return d}
function create_UI_record_device(a){var d=document.createElement("span");if(0==a.length)return d;var b=get_tag_node(a),c=0,e=a,f="0";null==b?(b=get_locator_node(a),null==b?(b=get_anchor_node(a),null==b?(b=get_user_node(a),null==b?(b=get_sensor_node(a),null!=b&&(c=5,d.setAttribute("class","badge bg-green"),e=b.name,f="0")):(c=3,d.setAttribute("class","badge bg-aqua-active"),e=b.name,f="0")):(c=1,d.setAttribute("class","badge bg-green"),e=b[5],f=b[4])):(c=2,d.setAttribute("class","badge bg-yellow-active"),
e=b[5],f=b[4])):(d.setAttribute("class","badge bg-light-blue-active"),e=b[5],f=b[4]);if(null==b)return console.log("create_UI_record_device() nodeid:"+a+"  node == null"),d;d.textContent=0==c&&"4"===f?e+"/\u5de5\u4f5c\u4eba\u54e1":e;return d}
function create_UI_record_subgroups(a){var d=document.createElement("div");a=a.split(",");for(var b=0;b<a.length;b++)for(var c=parseInt(a[b]),e=0;e<gl_userdatasubgroups.length;e++){var f=gl_userdatasubgroups[e];if(f.subgroupid==c){c=document.createElement("span");c.setAttribute("class","badge bg-yellow-active");c.textContent=f.subgroupname;d.appendChild(c);break}}return d}
function create_resend_button(a){var d=document.createElement("button");d.setAttribute("type","button");d.setAttribute("class","btn btn-default");d.setAttribute("title","\u91cd\u767c\u4e00\u6b21");d.setAttribute("onclick","open_pushnotification_page("+a.dbId+");return false;");a=document.createElement("i");a.setAttribute("class","fa fa-external-link");a.setAttribute("title","\u91cd\u767c\u4e00\u6b21");d.appendChild(a);return d}
function open_message_detail(a,d,b,c,e){var f=document.getElementById(a+"_message_detail_button");f.setAttribute("title","\u95dc\u9589\u8a73\u7d30\u8cc7\u8a0a");f.setAttribute("onclick",'close_message_detail("'+a+'", "'+d+'","'+b+'","'+c+'","'+e+'");');document.getElementById(a+"_message_detail_icon").setAttribute("class","fa fa-minus text-red");f=document.getElementById(a+"_TABLE_ROW_EXTRA");f.setAttribute("bgcolor","#ebebe0");f.appendChild(document.createElement("td"));var g=document.createElement("td");
g.setAttribute("colspan","2");f.appendChild(g);var h=document.createElement("div");h.setAttribute("class","row");h.setAttribute("id","notify_image_"+a);g.appendChild(h);g=document.createElement("td");g.setAttribute("id","reponse_image_"+a);g.setAttribute("colspan","2");f.appendChild(g);g=document.createElement("td");g.setAttribute("colspan","3");f.appendChild(g);0<b.length&&(f=document.createElement("table"),f.setAttribute("class","table table-bordered"),g.appendChild(f),h=document.createElement("thead"),
f.appendChild(h),g=document.createElement("tr"),f.setAttribute("style","background-color:rgb(236, 240, 245);"),h.appendChild(g),h=document.createElement("th"),h.textContent="\u4ee3\u8fa6\u4e8b\u9805\u540d\u7a31",g.appendChild(h),h=document.createElement("th"),h.textContent="\u4e8b\u9805\u5217\u8868",g.appendChild(h),h=document.createElement("th"),h.textContent="\u64cd\u4f5c",g.appendChild(h),g=document.createElement("tbody"),g.setAttribute("id","surveys_"+a),f.appendChild(g));load_notify_image(a,
e);load_reponse_image(a,d);load_surveys(a,b,c);load_survey_results(a,c)}function close_message_detail(a,d,b,c,e){var f=document.getElementById(a+"_message_detail_button");f.setAttribute("title","\u986f\u793a\u8a73\u7d30\u8cc7\u8a0a");f.setAttribute("onclick",'open_message_detail("'+a+'", "'+d+'","'+b+'","'+c+'","'+e+'");');document.getElementById(a+"_message_detail_icon").setAttribute("class","fa fa-plus text-green");clearChildView(a+"_TABLE_ROW_EXTRA")}
function load_notify_image(a,d){for(var b=d.split(","),c=0;c<b.length;c++){var e=b[c];0<e.length&&load_PushNotify_image(a,e)}}
function load_PushNotify_image(a,d){$.getJSON(gl_target_server+"/php/storage.php","loadsingleimage=1&project_id="+project_id+"&imageuid="+d,function(b){var c="show_img_area_"+d;if(void 0==document.getElementById(c)){var e=document.getElementById("notify_image_"+a);b=create_data_image("\u63a8\u64ad\u767c\u9001\u7167\u7247",a,b);b.setAttribute("id",c);e.appendChild(b)}}).success(function(){}).error(function(){}).complete(function(){})}
function create_data_image(a,d,b){d=document.createElement("div");d.setAttribute("class","col-xs-12 col-md-6 col-lg-4");var c=document.createElement("ul");c.setAttribute("class","mailbox-attachments clearfix");d.appendChild(c);var e=document.createElement("li");e.setAttribute("style","background-color:white;");c.appendChild(e);c=document.createElement("span");c.setAttribute("style","font-size:14px; font-weight:bold; color:#330033;");c.textContent=a;e.appendChild(c);a=document.createElement("span");
e.appendChild(a);c=create_UI_record_devices(b.accountid);a.appendChild(c);a=document.createElement("div");e.appendChild(a);c=document.createElement("span");c.setAttribute("class","label label-info");c.textContent=convertPrettyDateOnly(b.updatetime,"+00:00");a.appendChild(c);c=document.createElement("span");c.setAttribute("class","label label-warning");c.textContent=convertPrettyTimeOnly(b.updatetime,"+00:00");a.appendChild(c);a=document.createElement("span");a.setAttribute("class","mailbox-attachment-icon has-img");
e.appendChild(a);c=document.createElement("img");c.setAttribute("src","/php/downloadfile.php?loadthumb=1&project_id="+project_id+"&imageid="+b.id);c.setAttribute("alt","Attachment");a.appendChild(c);a=document.createElement("div");a.setAttribute("class","mailbox-attachment-info");e.appendChild(a);e=document.createElement("a");e.setAttribute("href","/php/downloadfile.php?project_id="+project_id+"&imageid="+b.id);e.setAttribute("class","mailbox-attachment-name");a.appendChild(e);e.appendChild(document.createTextNode("  "+
b.description));a=document.createElement("span");a.setAttribute("class","mailbox-attachment-size");a.textContent=convertFileSize(parseInt(b.imagesize));e.appendChild(a);e=document.createElement("a");e.setAttribute("href","/php/downloadfile.php?project_id="+project_id+"&imageid="+b.id);e.setAttribute("class","btn btn-default btn-xs pull-right");a.appendChild(e);b=document.createElement("i");b.setAttribute("class","fa fa-cloud-download");e.appendChild(b);return d}
function convertFileSize(a){return 1048576<a?(Math.round(100*a/1048576)/100).toString()+"MB":(Math.round(100*a/1024)/100).toString()+"KB"}function load_reponse_image(a,d){glResponseImage_List[a]=[];0!=d.length&&$.getJSON(gl_target_server+"/php/storage.php","loadnotifyimage=1&project_id="+project_id+"&messagehashkey="+d,function(b){$.each(b,function(b,d){glResponseImage_List[a].push(d)})}).success(function(){show_reponse_image(a)}).error(function(){}).complete(function(){})}
function show_reponse_image(a){for(var d=document.getElementById("reponse_image_"+a),b=glResponseImage_List[a],c=0;c<b.length;c++){var e=b[c];console.log("show_reponse_image() description:"+e.description);var f=document.getElementById("reponse_image_"+a+"_"+e.imageuid);void 0==f&&(f=document.createElement("span"),f.setAttribute("id","reponse_image_"+a+"_"+e.imageuid),d.appendChild(f));update_reponse_image_item(a,e)}}
function update_reponse_image_item(a,d){var b="show_img_"+d.imageuid;if(void 0==document.getElementById(b)){var c=document.getElementById("reponse_image_"+a+"_"+d.imageuid),e=create_data_image("\u4f7f\u7528\u8005\u56de\u50b3\u7167\u7247",a,d);e.setAttribute("id",b);c.appendChild(e)}}
function load_surveys(a,d,b){var c=document.getElementById("surveys_"+a);if(void 0!=c){d=d.split(",");b=b.split(",");for(var e=0;e<d.length;e++){var f=d[e],g=create_survey(a,f,b[e]);c.appendChild(g);load_survey_to_ui(a,f)}}}
function create_survey(a,d,b){var c=0,e=document.createElement("tr");e.appendChild(document.createElement("td"));var f=document.createElement("div");f.setAttribute("id",a+"_"+d+"_title");e.cells[c].appendChild(f);c++;e.appendChild(document.createElement("td"));f=document.createElement("div");f.setAttribute("id",a+"_"+d+"_item");e.cells[c].appendChild(f);c++;e.appendChild(document.createElement("td"));a=document.createElement("button");a.setAttribute("title","\u67e5\u770b\u8a73\u7d30\u8cc7\u8a0a");
a.setAttribute("href","javascript:;");a.setAttribute("onclick","show_surveyresult("+project_id+',"'+d+'","'+b+'");return false;');d=document.createElement("i");d.setAttribute("class","fa fa-calendar-check-o ");a.appendChild(d);e.cells[c].appendChild(a);return e}
function load_survey_to_ui(a,d){var b=gl_target_server+"/php/survey.php";glSurvey_List=[];$.getJSON(b,"loadsurvey=1&project_id="+project_id+"&surveyid="+d,function(b){$.each(b,function(b,c){var g=document.getElementById(a+"_"+d+"_title");void 0!=g&&(g.textContent=c.title);g=document.getElementById(a+"_"+d+"_item");if(void 0!=g){var h=show_survey_item(c.surveyid,c.items,a);g.appendChild(h)}})}).success(function(){}).error(function(){}).complete(function(){})}
function show_survey_item(a,d,b){var c=document.createElement("div");c.setAttribute("id","survey_item_"+a);var e=document.createElement("table");c.appendChild(e);var f=document.createElement("thead");e.appendChild(f);var g=document.createElement("tr");f.appendChild(g);f=document.createElement("th");f.setAttribute("style","width: 40px");g.appendChild(f);f=document.createElement("th");g.appendChild(f);g=document.createElement("tbody");g.setAttribute("id","survey_table_body_"+a);e.appendChild(g);for(e=
0;e<d.length;e++){f=d[e];a=document.createElement("tr");g.appendChild(a);var h=document.createElement("td");a.appendChild(h);var k=document.createElement("span");k.setAttribute("class","label label-danger");k.setAttribute("id","survey_item_"+b+"_"+e);k.textContent="0";h.appendChild(k);h=document.createElement("td");a.appendChild(h);h.appendChild(document.createTextNode(f.description))}a=document.createElement("tr");g.appendChild(a);h=document.createElement("td");a.appendChild(h);h.appendChild(document.createTextNode("\u8aaa\u660e:"));
d=document.createElement("td");d.setAttribute("id","survey_item_comment_"+b);a.appendChild(d);return c}function load_survey_results(a,d){var b=[];$.getJSON(gl_target_server+"/php/survey.php","loadsurveyresults=1&project_id="+project_id+"&hashkeys="+d,function(c){$.each(c,function(a,c){var d={};d.hashkey=a;d.record=c;b.push(d)});show_surveyresults(a,b)}).success(function(){}).error(function(){}).complete(function(){})}
function show_surveyresults(a,d){for(var b=0;b<d.length;b++){for(var c=d[b],e=[],f=[],g=[],h=0;h<c.record.length;h++){var k=c.record[h],l=k.results.split(",");0<k.comment.length&&g.push(k.comment);if(void 0==e[k.topic])for(e[k.topic]=1,k=0;k<l.length;k++){var m=parseInt(l[k]);void 0==f[k]&&(f[k]=0);f[k]+=m}}for(h=0;h<f.length;h++)c=document.getElementById("survey_item_"+a+"_"+h),void 0!=c&&(c.textContent=f[h],0==f[h]?c.setAttribute("class","label label-danger"):c.setAttribute("class","label label-info"));
f=document.getElementById("survey_item_comment_"+a);if(null!=f){for(;f.firstChild;)f.removeChild(f.firstChild);for(h=0;h<g.length;h++)void 0!=f&&(c=document.createElement("span"),c.setAttribute("class","label label-primary"),f.appendChild(c),c.textContent=g[h])}}}function show_surveyresult(a,d,b){window.open("/index.php/vilssurveyresult/"+a+"?surveyid="+d+"&hashkey="+b,"_blank").focus()}
function get_tag_node(a){for(var d=null,b=0;b<glTag_List.length;b++){var c=glTag_List[b];if(a===c[3]||a===c[6]){d=c;break}}return d}function get_locator_node(a){for(var d=null,b=0;b<glLocator_List.length;b++){var c=glLocator_List[b];if(a===c[3]||a===c[6]){d=c;break}}return d}function get_anchor_node(a){for(var d=null,b=0;b<glAnchor_List.length;b++){var c=glAnchor_List[b];if(a===c[3]||a===c[6]){d=c;break}}return d}
function get_user_node(a){for(var d=null,b=0;b<glUser_List.length;b++){var c=glUser_List[b];if(a===c.account){d=c;break}if(!isNaN(a)&&parseInt(a)==c.userid){d=c;break}}return d}function get_sensor_node(a){for(var d=null,b=0;b<glSensorInfo_List.length;b++){var c=glSensorInfo_List[b];if(a===c.id){d=c;break}}return d}
function move_page_backward(){var a=document.getElementById("id_current_page_num"),d=glCurrentPage[glActiveRecordMsgType];1>=d||(d--,a.textContent=d,glCurrentPage[glActiveRecordMsgType]=d,PreLoadIndex=2,CurrentLoadIndex=3,check_loading_status())}function move_page_forward(){var a=document.getElementById("id_current_page_num"),d=glCurrentPage[glActiveRecordMsgType];d++;a.textContent=d;glCurrentPage[glActiveRecordMsgType]=d;PreLoadIndex=2;CurrentLoadIndex=3;check_loading_status()}
function open_pushnotification_page(a){for(var d=0;d<glRecord_List[glActiveRecordMsgType].length;d++){var b=glRecord_List[glActiveRecordMsgType][d];if(b.dbId==a){void 0!=parent.$("#rightcontentIframe")[0]?parent.send_pushnotification(project_id,b.nodeid,b.title,b.message):window.open("/index.php/vilspushnotification/"+project_id+"?nodeid="+b.nodeid+"&title="+b.title+"&message="+b.message,"_self");break}}}var gl_search_start=0;
function search_notify_target_text_change(){var a=document.getElementById("search_notify_target_text").value;if(a===pre_input_value)console.log("search_notify_target_text_change() input_value === pre_input_value, input_value:"+a);else return glCurrentPage[glActiveRecordMsgType]=1,gl_search_start=0,reload_status(),!1}
function check_search_notify_target_text(a){0==gl_search_start&&(gl_search_start=new Date);a=((new Date).getTime()-gl_search_start.getTime())/1E3;CurrentLoadIndex!=LOAD_STATE_END?(console.log("check_search_notify_target_text() CurrentLoadIndex != LOAD_STATE_END"),setTimeout(search_notify_target_text_change,500)):1<=a?(gl_search_start=0,search_notify_target_text_change()):setTimeout(search_notify_target_text_change,500)}var gl_search_date_start=0;
function search_notify_date_text_change(){var a=document.getElementById("search_notify_date_text").value;if(a===pre_input_date_value)console.log("search_notify_date_text_change() input_date_value === pre_input_date_value, input_date_value:"+a);else return glCurrentPage[glActiveRecordMsgType]=1,gl_search_date_start=0,reload_status(),!1}
function check_search_notify_date_text(a){0==gl_search_date_start&&(gl_search_date_start=new Date);a=((new Date).getTime()-gl_search_date_start.getTime())/1E3;CurrentLoadIndex!=LOAD_STATE_END?(console.log("check_search_notify_date_text() CurrentLoadIndex != LOAD_STATE_END"),setTimeout(search_notify_date_text_change,500)):1<=a?(gl_search_date_start=0,search_notify_date_text_change()):setTimeout(search_notify_date_text_change,500)}var $source=document.querySelector("#search_notify_target_text");
$source.addEventListener("input",check_search_notify_target_text);var $source_date=document.querySelector("#search_notify_date_text");$source_date.addEventListener("input",check_search_notify_date_text);function clearChildView(a){a=document.getElementById(a);if(null!=a)for(;a.firstChild;)a.removeChild(a.firstChild);return a}
function convertPrettyDateOnly(a,d){var b=moment.utc(a,"YYYY-MM-DD HH:mm:ss").utcOffset(d),c=b.format("YYYY"),e=b.format("M"),b=b.format("D");return c+"\u5e74"+e+"\u6708"+b+"\u65e5 "}function convertPrettyTimeOnly(a,d){var b=moment.utc(a,"YYYY-MM-DD HH:mm:ss").utcOffset(d),c=b.hour(),e=b.minutes(),b=b.seconds(),f="";0<=c&&(f+=c+"\u9ede");0<=e&&(f+=e+"\u5206");0<=b&&(f+=b+"\u79d2");return f}
function open_pushnotificationrecords_page(){window.open("/index.php/vilspushnotificationrecords/"+project_id,"_blank").focus()};
