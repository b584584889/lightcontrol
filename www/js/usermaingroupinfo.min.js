window.BlobBuilder=window.MozBlobBuilder||window.WebKitBlobBuilder||window.BlobBuilder;var blob,start,end,part,uploaded,SIZE,BYTES_PER_CHUNK,xhr,chunk,UploadImageFinishedCallback=null,uid="";
function sendUploadImageRequest(a){blob=document.getElementById("imageUpload").files[0];if(void 0==blob)return alert("\u8b80\u53d6\u6a94\u6848\u5931\u6557!"),null;BYTES_PER_CHUNK=1048576;SIZE=blob.size;part=start=0;end=BYTES_PER_CHUNK;uploaded=0;UploadImageFinishedCallback=a;uid=Date.now();chunk=blob.slice(start,end);uploadImageFile(chunk,part);start=end;end=start+BYTES_PER_CHUNK;part+=1;uploaded=0;return uid}
function imageSelected(){var a=document.getElementById("imageUpload").files[0];if(a){var b;b=1048576<a.size?(Math.round(100*a.size/1048576)/100).toString()+"MB":(Math.round(100*a.size/1024)/100).toString()+"KB";var c=a.name.split("."),d=document.getElementById("id_new_image_name");void 0!=d&&(d.value=c[0]);d=document.getElementById("id_new_image_description");void 0!=d&&(d.value=c[0]);document.getElementById("imageFileSize").innerHTML="Size: "+b;document.getElementById("imageFileType").innerHTML=
"Type: "+a.type;a=document.getElementById("removebutton");void 0!=a&&a.setAttribute("style","display:block;")}}
function uploadImageFile(a,b){var c=document.getElementById("imageUpload").files[0],d=new FormData;d.append("imageUpload",a);d.append("file",c.name);d.append("uid",uid);d.append("num",parseInt(b));c=new XMLHttpRequest;c.upload.addEventListener("progress",uploadImageProgress,!1);c.addEventListener("load",uploadImageComplete,!1);c.addEventListener("error",uploadImageFailed,!1);c.addEventListener("abort",uploadImageCanceled,!1);c.open("POST","/php/uploadfile.php");c.onload=function(a){};c.setRequestHeader("Cache-Control",
"no-cache");c.send(d)}function uploadImageProgress(a){a.lengthComputable?(a=Math.round(100*(uploaded+a.loaded)/SIZE),document.getElementById("imageProgressNumber").innerHTML=a.toString()+"%"):document.getElementById("imageProgressNumber").innerHTML="unable to compute"}
function uploadImageComplete(a){start<SIZE?(chunk=blob.slice(start,end),uploadImageFile(chunk,part),start=end,end=start+BYTES_PER_CHUNK,part+=1,uploaded+=BYTES_PER_CHUNK):"function"===typeof UploadImageFinishedCallback&&(0==JSON.parse(a.target.responseText).FileSize?UploadImageFinishedCallback(null):UploadImageFinishedCallback(uid))}function uploadImageFailed(a){alert("There was an error attempting to upload the file.");uid=null}
function uploadImageCanceled(a){xhr.abort();uid=xhr=null;alert("The upload has been canceled by the user or the browser dropped the connection.")};var LOAD_usermaingroup_NUM=20,PreLoadIndex=-1,CurrentLoadIndex=0,LOAD_STATE_END=9999,glCurrentPage=1,gl_user_info=[],gl_usermaingroups=[],gl_edit_maingroupid=0,gl_edit_maingroup_imageuid="",gl_uploadimage_uid="";check_loading_status();
function check_loading_status(){switch(CurrentLoadIndex){case 0:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,load_usermaingroup());break;case 1:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,load_user_info());break;case 2:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+
PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,draw_table(),CurrentLoadIndex+=1);break;case 3:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,show_maingroup_photo(),CurrentLoadIndex+=1);break;case 4:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=
CurrentLoadIndex,CurrentLoadIndex=LOAD_STATE_END)}CurrentLoadIndex!=LOAD_STATE_END?setTimeout(check_loading_status,100):console.log("check_loading_status() Stop.")}function reload_maingroup_info(){PreLoadIndex=-1;CurrentLoadIndex=0;check_loading_status()}
function load_usermaingroup(){var a=(glCurrentPage-1)*LOAD_usermaingroup_NUM,b=LOAD_usermaingroup_NUM;gl_usermaingroups=[];$.getJSON(gl_target_server+"/php/vilsnodes.php","loadmaingroup=1&s="+a+"&count="+b+"&project_id="+project_id,function(a){$.each(a,function(a,b){gl_usermaingroups.push(b)})}).success(function(){CurrentLoadIndex+=1}).error(function(){}).complete(function(){})}
function load_user_info(){for(var a="",b=0,c=0;c<gl_usermaingroups.length;++c)for(var d=gl_usermaingroups[c].userids.split(","),e=0;e<d.length;++e){var f=d[e];0<f.length&&0==check_exist_user(f)&&(0<b&&(a+=","),a+=f,b+=1)}0==a.length?CurrentLoadIndex+=1:$.getJSON(gl_target_server+"/php/vilsnodes.php","loadusername=1&user="+a+"&project_id="+project_id,function(a){$.each(a,function(a,b){b.userid=parseInt(b.userid);gl_user_info.push(b)})}).success(function(){CurrentLoadIndex+=1}).error(function(){}).complete(function(){})}
function check_exist_user(a){a=parseInt(a);for(var b=!1,c=0;c<gl_user_info.length;++c)if(gl_user_info[c].userid==a){b=!0;break}return b}function draw_table(){for(var a=document.getElementById("usermaingroupinfo_TABLE");1<=a.rows.length;)a.deleteRow(0);console.log("draw_table() gl_usermaingroups.length:"+gl_usermaingroups.length);for(var b=0;b<gl_usermaingroups.length;++b){var c=create_record_table_item(b,gl_usermaingroups[b]);a.appendChild(c)}}
function create_record_table_item(a,b){if(null==b)return null;var c=document.createElement("tr");1==a%2&&c.setAttribute("bgcolor","#ebebe0");var d=0;c.appendChild(document.createElement("td"));c.cells[d].appendChild(document.createTextNode(""+(a+1)));d++;var e=document.createElement("td");e.setAttribute("id","uiid_groupname_"+b.id);c.appendChild(e);e=create_subgroup_label(b.name);c.cells[d].appendChild(e);d++;e=document.createElement("td");e.setAttribute("id","uiid_permission_"+b.id);e.textContent=
b.permission;c.appendChild(e);d++;e=document.createElement("td");e.setAttribute("id","uiid_welcommessage_"+b.id);e.textContent=b.welcommessage;c.appendChild(e);d++;e=document.createElement("td");e.setAttribute("id","uiid_photo_"+b.id);c.appendChild(e);d++;e=document.createElement("td");e.setAttribute("id","uiid_autojoin_"+b.id);"0"==b.autojoin?e.textContent="\u4e0d\u5141\u8a31\u81ea\u884c\u52a0\u5165":"1"==b.autojoin?e.textContent="\u4f7f\u7528\u8b58\u5225\u78bc\u8207\u5e33\u865f\u52a0\u5165":"2"==
b.autojoin&&(e.textContent="\u53ef\u81ea\u884c\u52a0\u5165");c.appendChild(e);d++;e=document.createElement("td");e.setAttribute("id","uiid_userids_"+b.id);var f=createUserIDUI(b.userids);e.appendChild(f);c.appendChild(e);d++;e=document.createElement("td");c.appendChild(e);e=document.createElement("button");e.setAttribute("type","button");e.setAttribute("class","btn btn-default");e.setAttribute("data-toggle","modal");e.setAttribute("data-target","#modal-qrcode");e.setAttribute("onclick",'device_qrcode_show("MAINGROUP","'+
b.id+'","'+b.name+'");return false;');f=document.createElement("i");f.setAttribute("class","fa fa-qrcode");e.appendChild(f);c.cells[d].appendChild(e);e=document.createElement("button");e.setAttribute("id","uiid_editbtn_"+b.id);e.setAttribute("title","\u7de8\u8f2f\u6b64\u4e3b\u96c6\u5408");e.setAttribute("href","javascript:;");e.setAttribute("onclick",'edit_usermaingroup("'+b.id+'");return false;');f=document.createElement("i");f.setAttribute("id","uiid_editimg_"+b.id);f.setAttribute("class","fa fa-edit");
e.appendChild(f);c.cells[d].appendChild(e);e=document.createElement("button");e.setAttribute("style","display:none");e.setAttribute("id","uiid_deletebtn_"+b.id);e.setAttribute("title","\u522a\u9664\u6b64\u4e3b\u96c6\u5408");e.setAttribute("href","javascript:;");e.setAttribute("onclick",'confirm_delete_usermaingroup("'+b.id+'", "'+b.name+'");return false;');f=document.createElement("i");f.setAttribute("class","fa fa-user-times");e.appendChild(f);c.cells[d].appendChild(e);return c}
function device_qrcode_show(a,b,c){b=parseInt(b);document.getElementById("device_qrcode_type").textContent="Type: \u4e3b\u96c6\u5408";document.getElementById("device_qrcode_name").textContent="\u540d\u7a31: "+c;document.getElementById("device_qrcode_macaddress").textContent="\u4e3b\u96c6\u5408ID: "+b;jQuery.ajax({url:gl_target_server+"/php/configvils.php",type:"POST",data:"loadqrcode=1&type="+a+"&accountid="+b+"&id="+b+"&project_id="+project_id,dataType:"text",success:function(a){a=JSON.parse(a);
document.getElementById("device_qrcode_ui").setAttribute("src",a.qrcode);document.getElementById("device_qrcode_target").textContent="target: "+a.target;document.getElementById("device_qrcode_topic").textContent="topic: "+a.topic;document.getElementById("device_qrcode_datetime").textContent="\u66f4\u65b0\u6642\u9593: "+a.datetime}})}function show_maingroup_photo(){for(var a=0;a<gl_usermaingroups.length;++a){var b=gl_usermaingroups[a];0<b.imageuid.length&&load_maingroup_photo(b.id,b.imageuid)}}
function load_maingroup_photo(a,b){$.getJSON(gl_target_server+"/php/storage.php","loadsingleimage=1&project_id="+project_id+"&imageuid="+b,function(b){var d=document.getElementById("uiid_photo_"+a);void 0!=d&&(b=create_image_item(b),d.appendChild(b))}).success(function(){}).error(function(){}).complete(function(){})}
function create_user_photo(a){var b=document.createElement("img");b.setAttribute("src","/php/downloadfile.php?loadthumb=1&project_id="+project_id+"&imageid="+a.id);b.setAttribute("alt",a.description);b.setAttribute("style","max-width: 64px;");return b}function create_image_item(a){return create_data_image(a.id,a.name,a.thumbpath,a.imagetype,a.imagesize)}
function create_data_image(a,b,c,d,e){c=document.createElement("ul");c.setAttribute("class","mailbox-attachments clearfix");var f=document.createElement("li");c.appendChild(f);d=document.createElement("span");d.setAttribute("class","mailbox-attachment-icon has-img");f.appendChild(d);var g=document.createElement("img");g.setAttribute("src","/php/downloadfile.php?loadthumb=1&project_id="+project_id+"&imageid="+a);g.setAttribute("alt","Attachment");g.setAttribute("style","height:120px; width:auto; max-height:120px; max-width:auto;");
d.appendChild(g);d=document.createElement("div");d.setAttribute("class","mailbox-attachment-info");f.appendChild(d);f=document.createElement("a");f.setAttribute("href","/php/downloadfile.php?project_id="+project_id+"&imageid="+a);f.setAttribute("class","mailbox-attachment-name");d.appendChild(f);g=document.createElement("p");g.setAttribute("class","overflow-ellipsis");g.setAttribute("style","width: 180px;white-space: nowrap;overflow: hidden;");g.textContent=b;f.appendChild(g);b=document.createElement("span");
b.setAttribute("class","mailbox-attachment-size");b.setAttribute("style","text-align: center;");b.textContent=convertFileSize(parseInt(e));d.appendChild(b);e=document.createElement("a");e.setAttribute("href","/php/downloadfile.php?project_id="+project_id+"&imageid="+a);e.setAttribute("class","btn btn-default btn-xs pull-right");b.appendChild(e);a=document.createElement("i");a.setAttribute("class","fa fa-cloud-download");e.appendChild(a);return c}
function convertFileSize(a){return 1048576<a?(Math.round(100*a/1048576)/100).toString()+"MB":(Math.round(100*a/1024)/100).toString()+"KB"}function createUserIDUI(a){var b=document.createElement("div");a=a.split(",");for(var c=0;c<a.length;c++){var d=getUserName(a[c]);if(0!=d.length){var e=document.createElement("div");b.appendChild(e);d=create_account_label(d);e.appendChild(d)}}return b}
function create_empty_record_table_item(a){if(null==document.getElementById("empty_record_table_item")){var b=document.getElementById("usermaingroupinfo_TABLE").insertRow(0);b.setAttribute("bgcolor","#ebebe0");b.setAttribute("id","empty_record_table_item");var c=0;b.appendChild(document.createElement("td"));b.cells[c].appendChild(document.createTextNode(""+a));c++;b.appendChild(document.createElement("td"));b.cells[c].appendChild(create_input_text("input_groupname"));c++;b.appendChild(document.createElement("td"));
b.cells[c].appendChild(create_input_text("input_permission"));c++;b.appendChild(document.createElement("td"));a=create_manager_dropdown_list("input_accountids");b.cells[c].appendChild(a);c++;b.appendChild(document.createElement("td"));a=document.createElement("button");a.setAttribute("class","btn btn-block btn-primary btn-lg");a.setAttribute("onclick","save_new_usermaingroup();");a.textContent="\u5132\u5b58";b.cells[c].appendChild(a)}}
function create_input_text(a,b){var c=document.createElement("textarea");c.setAttribute("rows","1");c.setAttribute("id",a);c.textContent=b;return c}
function create_manager_dropdown_list(a){a=document.createElement("div");a.setAttribute("class","btn-group");var b=document.createElement("button");b.setAttribute("type","button");b.setAttribute("class","btn btn-default btn-sm dropdown-toggle");b.setAttribute("data-toggle","dropdown");b.textContent="\u7ba1\u7406\u4eba\u54e1";a.appendChild(b);var c=document.createElement("span");c.setAttribute("class","caret");b.appendChild(c);b=document.createElement("ul");b.setAttribute("class","dropdown-menu");
b.setAttribute("id","dropdown_managerd");a.appendChild(b);for(c=0;c<gl_user_info.length;++c){var d=gl_user_info[c];"3"!=d.groupid&&b.appendChild(create_dropdown_user_item("new",d.name,d.account,!1))}return a}
function create_dropdown_user_item(a,b,c,d){var e=document.createElement("li"),f=document.createElement("a");f.setAttribute("class","small");f.setAttribute("tabIndex","-1");f.setAttribute("data-value",c);f.setAttribute("href","javascript:;");f.setAttribute("onclick",'dropdown_user_click("'+a+'", "'+c+'");return true;');var g=document.createElement("input");g.setAttribute("type","checkbox");g.setAttribute("id","dropdown_checkbox_"+a+"_"+c);g.setAttribute("onclick",'dropdown_checkbox_user_click("'+
a+'", "'+c+'");return true;');g.checked=d;f.appendChild(g);f.appendChild(document.createTextNode(" "+b));e.appendChild(f);return e}var glDropdown_checkbox_user_click=!1;function dropdown_checkbox_user_click(a,b){glDropdown_checkbox_user_click=!0}
function dropdown_user_click(a,b){1!=glDropdown_checkbox_user_click&&(1==document.getElementById("dropdown_checkbox_"+a+"_"+b).checked?document.getElementById("dropdown_checkbox_"+a+"_"+b).checked=!1:document.getElementById("dropdown_checkbox_"+a+"_"+b).checked=!0);glDropdown_checkbox_user_click=!1}
function edit_usermaingroup(a){console.log("edit_usermaingroup() groupid:"+a);var b=getusermaingroup(a);if(null==b)console.log("edit_usermaingroup() group == null");else{create_edit_ui("uiid_groupname",a,b.name);create_edit_ui("uiid_permission",a,b.permission);create_edit_ui("uiid_welcommessage",a,b.welcommessage);create_edit_autojoin_ui("uiid_autojoin",a,b.autojoin);if(1==gl_groupid||2==gl_groupid||4==gl_groupid)create_edit_manager_ui("uiid_userids",a,b.userids),document.getElementById("uiid_deletebtn_"+
a).setAttribute("style","display:block");gl_edit_maingroup_imageuid=b.imageuid;b=document.getElementById("uiid_photo_"+a);if(void 0!=b){if(0==gl_edit_maingroup_imageuid.length){clearChildView("uiid_photo_"+a);var c=create_upload_image_ui()}else{c=document.createElement("button");c.setAttribute("style","color: #AF4C50;");c.setAttribute("title","Delete Maingroup Photo");c.setAttribute("href","javascript:;");c.setAttribute("onclick",'delete_maingroup_photo("'+a+'");return false;');var d=document.createElement("i");
d.setAttribute("class","fa fa-remove");c.appendChild(d)}b.appendChild(c)}b=document.getElementById("uiid_editbtn_"+a);b.setAttribute("title","\u5132\u5b58\u6b64\u4e3b\u96c6\u5408");b.setAttribute("onclick",'save_usermaingroup("'+a+'");return false;');document.getElementById("uiid_editimg_"+a).setAttribute("class","fa fa-save")}}
function delete_maingroup_photo(a){gl_edit_maingroup_imageuid="";clearChildView("uiid_photo_"+a);a=document.getElementById("uiid_photo_"+a);if(void 0!=a){var b=create_upload_image_ui();a.appendChild(b)}}function create_edit_ui(a,b,c){var d=clearChildView(a+"_"+b);a=create_input_text(a+"_"+b+"_edit",c);d.appendChild(a)}
function create_edit_autojoin_ui(a,b,c){var d=clearChildView(a+"_"+b),e=document.createElement("div");d.appendChild(e);d=document.createElement("select");d.id=a+"_"+b+"_edit";e.appendChild(d);a=document.createElement("option");a.value="0";a.text="\u4e0d\u5141\u8a31\u81ea\u884c\u52a0\u5165";"0"==c&&a.setAttribute("selected","selected");d.appendChild(a);a=document.createElement("option");a.value="1";a.text="\u4f7f\u7528\u8b58\u5225\u78bc\u8207\u5e33\u865f\u52a0\u5165";"1"==c&&a.setAttribute("selected",
"selected");d.appendChild(a);a=document.createElement("option");a.value="2";a.text="\u53ef\u81ea\u884c\u52a0\u5165";"2"==c&&a.setAttribute("selected","selected");d.appendChild(a)}
function create_edit_manager_ui(a,b,c){a=clearChildView(a+"_"+b);var d=document.createElement("div");d.setAttribute("class","btn-group");null!=a&&a.appendChild(d);var e=document.createElement("button");e.setAttribute("type","button");e.setAttribute("class","btn btn-default btn-sm dropdown-toggle");e.setAttribute("data-toggle","dropdown");e.textContent="\u7ba1\u7406\u4eba\u54e1";d.appendChild(e);var f=document.createElement("span");f.setAttribute("class","caret");e.appendChild(f);e=document.createElement("ul");
e.setAttribute("class","dropdown-menu");e.setAttribute("id","dropdown_managerd");d.appendChild(e);c=c.split(",");for(d=0;d<gl_user_info.length;++d){var f=gl_user_info[d],g=0<=c.indexOf(f.userid+"");e.appendChild(create_dropdown_user_item(b,f.name,f.account,g))}return a}function clearChildView(a){a=document.getElementById(a);if(null!=a)for(;a.firstChild;)a.removeChild(a.firstChild);return a}
function getusermaingroup(a){for(var b=null,c=0;c<gl_usermaingroups.length;++c){var d=gl_usermaingroups[c];if(d.id===a){b=d;break}}return b}function create_subgroup_label(a){var b=document.createElement("span");b.setAttribute("style","display:inline;padding:.2em .3em .3em;font-size:95%;font-weight:700;line-height:2;position:relative;top:-1px;color:#fff;border-radius:2px;white-space:nowrap;background-color:#00a65a;");b.textContent=a;return b}
function create_account_label(a){var b=document.createElement("span");b.setAttribute("style","display:inline;padding:.2em .3em .3em;font-size:95%;font-weight:700;line-height:2;position:relative;top:-1px;color:#fff;border-radius:2px;white-space:nowrap;background-color:rgb(54, 127, 169);");b.textContent=a;return b}
function save_new_usermaingroup(){var a=document.getElementById("input_groupname").value,b=document.getElementById("input_permission").value;if(0==a.length)alert("\u8acb\u8f38\u5165\u540d\u7a31");else{var c="",d="";if(1==gl_groupid||2==gl_groupid||4==gl_groupid)for(var e=0;e<gl_user_info.length;++e){var f=gl_user_info[e];if("3"!=f.groupid){var g=document.getElementById("dropdown_checkbox_new_"+f.account);void 0!=g&&1==g.checked&&(0<c.length&&(c+=","),c+=f.account,0<d.length&&(d+=","),d+=f.userid)}}else c=
gl_accountid,d=gl_userid;e={};e.project_id=""+project_id;e.create_new_usermaingroup=1;e.groupname=a;e.permission=b;e.accountids=c;e.userids=d;jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:e,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a));reload_maingroup_info()},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}})}}
function save_usermaingroup(a){gl_edit_maingroupid=a;check_upload_image(uploadEditSubgroupImageFinihed)}function check_upload_image(a){gl_uploadimage_uid=gl_edit_maingroup_imageuid;var b=document.getElementById("imageUpload");void 0!=b?void 0!=b.files[0]?(console.log("check_upload_image() uploadimage.files[0] != undefined "),gl_uploadimage_uid=sendUploadImageRequest(a)):a(gl_uploadimage_uid):a(gl_uploadimage_uid)}function uploadEditSubgroupImageFinihed(){uploadImageFinihed(update_usermaingroup)}
function uploadImageFinihed(a){console.log("uploadImageFinihed() gl_uploadimage_uid:"+gl_uploadimage_uid);if(null==gl_uploadimage_uid)alert("\u4e0a\u50b3\u7167\u7247\u5931\u6557!");else{var b=document.getElementById("imageUpload"),c=void 0;if(void 0!=b)if(void 0==b.files[0])setTimeout(a,100);else{var c=b.files[0],b=c.name.split(".")[0],d="project_id="+project_id,d=d+"&createnewimage=1"+("&name="+b)+"&description="+("&filename="+c.name),d=d+("&fileuid="+gl_uploadimage_uid),d=d+("&filetype="+c.type),
d=d+("&filesize="+c.size),d=d+"&subgroups=0",d=d+"&leaveform=0";return jQuery.ajax({url:"/php/uploadfile.php",type:"POST",data:d,dataType:"text",success:function(b){setTimeout(a,300)},error:function(b,c,d){setTimeout(a,300)}})}else setTimeout(a,100)}}
function update_usermaingroup(){var a=document.getElementById("uiid_groupname_"+gl_edit_maingroupid+"_edit").value,b=document.getElementById("uiid_permission_"+gl_edit_maingroupid+"_edit").value,c=document.getElementById("uiid_welcommessage_"+gl_edit_maingroupid+"_edit").value,d=document.getElementById("uiid_autojoin_"+gl_edit_maingroupid+"_edit").value;if(0==a.length)alert("\u8acb\u8f38\u5165\u540d\u7a31");else{var e="",f="";if(1==gl_groupid||2==gl_groupid||4==gl_groupid)for(var g=0;g<gl_user_info.length;++g){var h=
gl_user_info[g];if("3"!=h.groupid){var k=document.getElementById("dropdown_checkbox_"+gl_edit_maingroupid+"_"+h.account);void 0!=k&&1==k.checked&&(0<e.length&&(e+=","),e+=h.account,0<f.length&&(f+=","),f+=h.userid)}}else e=gl_accountid,f=gl_userid;g={};g.project_id=""+project_id;g.update_usermaingroup=1;g.groupid=gl_edit_maingroupid;g.groupname=a;g.permission=b;g.accountids=e;g.userids=f;g.imageuid=gl_uploadimage_uid;g.welcommessage=c;g.autojoin=d;jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",
type:"POST",data:g,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a));reload_maingroup_info()},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}})}}function confirm_delete_usermaingroup(a,b){a=parseInt(a);confirm("Are you sure you want to delete this user group:"+b+" ?")&&delete_usermaingroup(a)}
function delete_usermaingroup(a){var b={};b.project_id=""+project_id;b.delete_usermaingroup=1;b.groupid=parseInt(a);jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:b,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a));reload_maingroup_info()},error:function(a,b,e){alert("error = "+e);alert("xhr.responseText = "+a.responseText)}})}function create_new_usermaingroup(){create_empty_record_table_item(gl_usermaingroups.length+1);return!1}
function create_upload_image_ui(){var a=document.createElement("div"),b=document.createElement("form");b.setAttribute("method","POST");b.setAttribute("enctype","multipart/form-data");b.setAttribute("action","php/uploadfile.php");a.appendChild(b);var c=document.createElement("div");c.setAttribute("class","form-group");b.appendChild(c);b=document.createElement("label");b.setAttribute("class","control-sidebar-subheading");b.setAttribute("for","imageUpload");b.innerHTML="\u4e0a\u50b3\u6a94\u6848";c.appendChild(b);
b=document.createElement("input");b.setAttribute("id","imageUpload");b.setAttribute("accept","image/*");b.setAttribute("type","file");b.setAttribute("name","imageUpload");b.setAttribute("onchange","imageSelected();");c.appendChild(b);b=document.createElement("div");b.setAttribute("id","imageFileSize");c.appendChild(b);b=document.createElement("div");b.setAttribute("id","imageFileType");c.appendChild(b);b=document.createElement("div");b.setAttribute("id","imageProgressNumber");c.appendChild(b);return a}
function clearChildView(a){a=document.getElementById(a);if(null!=a)for(;a.firstChild;)a.removeChild(a.firstChild);return a}function getUserName(a){a=parseInt(a);for(var b="",c=0;c<gl_user_info.length;++c){var d=gl_user_info[c];if(d.userid===a){b=d.name;break}}return b}function check_numer_in_list(a,b){for(var c=!1,d=0;d<b.length;++d)if(parseInt(b[d])==a){c=!0;break}return c}
function move_page_backward(){var a=document.getElementById("id_current_page_num");1>=glCurrentPage||(glCurrentPage--,a.textContent=glCurrentPage,reload_maingroup_info())}function move_page_forward(){var a=document.getElementById("id_current_page_num");glCurrentPage++;a.textContent=glCurrentPage;reload_maingroup_info()}function open_usermaingroupinfo_page(){window.open("/index.php/vilsusermaingroupinfo/"+project_id,"_blank").focus()};
