var glAnchors=[],glLocators=[],gl_anchor_num=0,gl_locator_num=0,gl_anchor_load_index=0,gl_locator_load_index=0,LOAD_DEVICE_NUM=20,PreLoadIndex=-1,CurrentLoadIndex=0,glDropdown_checkbox_anchor_click=!1;check_loading_status();
function check_loading_status(){switch(CurrentLoadIndex){case 0:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,load_devices());break;case 1:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,load_fencealert_exist(),CurrentLoadIndex+=1);break;case 2:PreLoadIndex!=
CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,CurrentLoadIndex+=1);break;case 3:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,CurrentLoadIndex+=1);break;case 4:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+
CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,CurrentLoadIndex+=1);break;case 5:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,CurrentLoadIndex+=1)}6!=CurrentLoadIndex&&setTimeout(check_loading_status,100)}
function load_devices(){$.getJSON(gl_target_server+"/php/vilsnodes.php","devicescount=1&project_id="+project_id,function(a){gl_anchor_num=parseInt(a.LOC_ANCHOR_NUM);gl_locator_num=parseInt(a.LOC_LOCATOR_NUM);console.log("load_devices() gl_anchor_num:"+gl_anchor_num+", gl_locator_num:"+gl_locator_num);gl_locator_load_index=gl_anchor_load_index=0}).success(function(){setTimeout(load_anchors,10)}).error(function(){setTimeout(load_devices,1E3)}).complete(function(){})}
function load_anchors(){gl_anchor_load_index>=gl_anchor_num?(gl_anchor_load_index=0,setTimeout(load_locators,10)):(0==gl_anchor_load_index&&(glAnchors=[]),$.getJSON(gl_target_server+"/php/vilsnodes.php","loadanchor=1&s="+gl_anchor_load_index+"&count="+LOAD_DEVICE_NUM+"&project_id="+project_id,function(a){var e=parseInt(a.LOC_ANCHOR_NUM);console.log("load_anchors() anchor_num:"+e+", gl_anchor_load_index:"+gl_anchor_load_index);for(var b=gl_anchor_load_index;b<gl_anchor_load_index+e;++b){var d="LOC_ANCHOR_INDEX_"+
b;void 0!=a[d]&&null!=a[d]&&(console.log("load_anchors() key:"+d+", data[key]:"+a[d]),d=a[d].split(","),glAnchors[b]={},glAnchors[b].itemid=d[3],glAnchors[b].itemname=d[5],glAnchors[b].posX=d[7],glAnchors[b].posY=d[8],glAnchors[b].posZ=d[9],glAnchors[b].type="anchor")}gl_anchor_load_index+=e}).success(function(){console.log("load_anchors() success gl_anchor_load_index:"+gl_anchor_load_index+", gl_anchor_num:"+gl_anchor_num);gl_anchor_load_index>=gl_anchor_num?(gl_anchor_load_index=0,setTimeout(load_locators,
10)):load_anchors()}).error(function(){console.log("load_anchors() error gl_anchor_load_index:"+gl_anchor_load_index+", gl_anchor_num:"+gl_anchor_num);gl_anchor_load_index=0;setTimeout(load_locators,10)}).complete(function(){}))}
function load_locators(){gl_locator_load_index>=gl_locator_num?(gl_locator_load_index=0,CurrentLoadIndex+=1,show_anchor_to_UI()):(0==gl_locator_load_index&&(glLocator_List=[]),$.getJSON(gl_target_server+"/php/vilsnodes.php","loadlocator=1&s="+gl_locator_load_index+"&count="+LOAD_DEVICE_NUM+"&project_id="+project_id,function(a){var e=parseInt(a.LOC_LOCATOR_NUM);console.log("load_locators() locator_num:"+e+", gl_locator_load_index:"+gl_locator_load_index);for(var b=gl_anchor_num,d=gl_locator_load_index;d<
gl_locator_load_index+e;++d){var c="LOC_LOCATOR_INDEX_"+d;void 0!=a[c]&&null!=a[c]&&(c=a[c].split(","),glAnchors[b+d]={},glAnchors[b+d].itemid=c[3],glAnchors[b+d].itemname=c[5],glAnchors[b+d].posX=c[7],glAnchors[b+d].posY=c[8],glAnchors[b+d].posZ=c[9],glAnchors[b+d].type="locator")}gl_locator_load_index+=e}).success(function(){console.log("load_locators() gl_locator_load_index:"+gl_locator_load_index+", gl_locator_num:"+gl_locator_num);gl_locator_load_index>=gl_locator_num?(gl_locator_load_index=
0,show_anchor_to_UI(),CurrentLoadIndex+=1):load_locators()}).error(function(){gl_locator_load_index=0;CurrentLoadIndex+=1;setTimeout(load_locators,1E3)}).complete(function(){}))}function show_anchor_to_UI(){var a=document.getElementById("fencealert_anchor_selection");load_Items_to_newevent_UI("anchor","btn-info",a,glAnchors)}
function load_Items_to_newevent_UI(a,e,b,d){var c="",g="";console.log("load_Items_to_newevent_UI() items.length:"+d.length);0<d.length&&(c=d[0].itemid,g=d[0].itemname);var f=document.createElement("button");b.appendChild(f);f.setAttribute("class","btn "+e);f.setAttribute("data-id",c);f.id="fencealert_"+a+"_name";c=document.createTextNode(g);f.appendChild(c);f=document.createElement("button");b.appendChild(f);f.setAttribute("class","btn "+e+" dropdown-toggle");f.setAttribute("data-toggle","dropdown");
f.id="fencealert_"+a;e=document.createElement("span");f.appendChild(e);e.setAttribute("class","caret");e=document.createElement("span");f.appendChild(e);e.setAttribute("class","sr-only");e=document.createElement("ul");b.appendChild(e);e.setAttribute("class","dropdown-menu");e.setAttribute("role","menu");for(b=0;b<d.length;b++)c=document.createElement("li"),e.appendChild(c),f=document.createElement("a"),c.appendChild(f),f.setAttribute("href","javascript:;"),f.setAttribute("onclick","fencealert_"+a+
"_select("+b+");return false;"),f.setAttribute("data-id",d[b].itemid),f.id="fencealert_"+a+"_item_"+b,"anchor"==a&&"anchor"==d[b].type?(c=document.createElement("span"),c.textContent=d[b].itemname,c.setAttribute("class","badge bg-green-active")):"anchor"==a&&"locator"==d[b].type?(c=document.createElement("span"),c.textContent=d[b].itemname,c.setAttribute("class","badge bg-yellow-active")):c=document.createTextNode(d[b].itemname),f.appendChild(c)}
function fencealert_anchor_select(a){var e=$("#fencealert_anchor_item_"+a).html();a=$("#fencealert_anchor_item_"+a).attr("data-id");$("#fencealert_anchor_name").html(e);$("#fencealert_anchor_name").attr("data-id",a)}
function load_fencealert_exist(){$.getJSON(gl_target_server+"/php/fencealert.php","loadfencealert=1&project_id="+project_id,function(a){for(var e=document.getElementById("fencealert_box_body");e.firstChild;)e.removeChild(e.firstChild);var b=1;$.each(a,function(a,c){add_exist_fencealert(parseInt(a),c.nodeid,c.distance);b++});CurrentLoadIndex+=1});return!1}
function add_exist_fencealert(a,e,b){var d=document.getElementById("fencealert_box_body"),c=document.createElement("div");d.appendChild(c);c.setAttribute("class","breadcrumb section0");c.id="fencealert_type_"+a;var g=document.createElement("a");c.appendChild(g);e=document.createTextNode(e);g.appendChild(e);g=document.createElement("a");c.appendChild(g);b=document.createTextNode(b);g.appendChild(b);c=document.createElement("div");c.setAttribute("class","btn-group pull-right");d.appendChild(c);b=document.createElement("div");
b.setAttribute("class","tools");c.appendChild(b);c=document.createElement("a");b.appendChild(c);c.setAttribute("href","javascript:;");c.setAttribute("onclick","fencealert_type_delete("+a+");return false;");c.setAttribute("data-id","sectionid");c.id="fencealert_type_delete_"+a;a=document.createElement("i");a.setAttribute("class","fa fa-trash-o");c.appendChild(a);a=document.createElement("br");d.appendChild(a)}
function load_dropdown_Items_to_UI(a,e){var b;for(b=0;b<e.length;b++){var d=create_dropdown_anchor_item(b,e[b].itemid,!1);a.appendChild(d)}}
function create_dropdown_anchor_item(a,e,b){var d=document.createElement("li"),c=document.createElement("a");c.setAttribute("class","small");c.setAttribute("tabIndex","-1");c.setAttribute("data-value",a);c.setAttribute("href","javascript:;");c.setAttribute("onclick",'dropdown_anchor_click("'+a+'");return true;');var g=document.createElement("input");g.setAttribute("type","checkbox");g.setAttribute("id","dropdown_checkbox_anchor_"+a);g.setAttribute("onclick",'dropdown_checkbox_anchor_click("'+a+'");return true;');
g.checked=b;c.appendChild(g);a=document.createElement("span");a.textContent=e;a.setAttribute("class","badge bg-green-active");c.appendChild(a);d.appendChild(c);return d}function dropdown_checkbox_anchor_click(a){glDropdown_checkbox_anchor_click=!0}glDropdown_checkbox_anchor_click=!1;
function dropdown_anchor_click(a){glDropdown_checkbox_anchor_click||(document.getElementById("dropdown_checkbox_anchor_"+a).checked?document.getElementById("dropdown_checkbox_anchor_"+a).checked=!1:document.getElementById("dropdown_checkbox_anchor_"+a).checked=!0);glDropdown_checkbox_anchor_click=!1}
function fencealert_type_delete(a){return 1==confirm("Do you want to delete this fence alert group?")?(a="group_id="+a+("&project_id="+project_id),jQuery.ajax({url:"/php/fencealert.php",type:"POST",data:a+"&delete_fencealertgroup=1",dataType:"text",success:function(a){console.log(JSON.stringify(a));setTimeout(load_fencealert_exist,1E3)},error:function(a,b,d){console.log(d);console.log(a.responseText);setTimeout(load_fencealert_exist,1E3)}})):!1}
function fencealert_group_create(){var a={},e=$("#fencealert_anchor_name").attr("data-id"),b=document.getElementById("fencealert_range_selection_input").value;a.project_id=project_id;a.anchor=e;a.distance=b;console.log("fencealert_group_create() fencealert_anchor:"+e);console.log("fencealert_group_create() fencealert_range:"+b);return jQuery.ajax({url:"/php/fencealert.php",type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify(a),success:function(a){console.log(JSON.stringify(a));
setTimeout(load_fencealert_exist,1E3)},error:function(a,b,e){console.log(e);console.log(a.responseText)}})}function open_fencealert_page(){window.open("/index.php/vilsfencealert/"+project_id,"_blank").focus()};
