var PreLoadIndex=-1,CurrentLoadIndex=0,gl_usergroups=[];check_loading_status();
function check_loading_status(){switch(CurrentLoadIndex){case 0:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,load_usergroup());break;case 1:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,draw_table(),CurrentLoadIndex+=1)}2!=CurrentLoadIndex?setTimeout(check_loading_status,
100):console.log("check_loading_status() Stop.")}function load_usergroup(){$.getJSON(gl_target_server+"/php/vilsnodes.php","loadusergroup=1&project_id="+project_id,function(a){$.each(a,function(a,c){gl_usergroups.push(c)})}).success(function(){CurrentLoadIndex+=1}).error(function(){}).complete(function(){})}
function draw_table(){for(var a=document.getElementById("USERGROUPINFO_TABLE");1<=a.rows.length;)a.deleteRow(0);console.log("draw_table() gl_usergroups.length:"+gl_usergroups.length);for(var b=0;b<gl_usergroups.length;++b){var c=create_record_table_item(b,gl_usergroups[b]);a.appendChild(c)}}
function create_record_table_item(a,b){if(null==b)return null;var c=document.createElement("tr");1==a%2&&c.setAttribute("bgcolor","#ebebe0");var d=0;c.appendChild(document.createElement("td"));c.cells[d].appendChild(document.createTextNode(""+(a+1)));d++;var e=document.createElement("td");e.setAttribute("id","uiid_groupname_"+b.groupid);c.appendChild(e);e=create_group_label(b.groupname);c.cells[d].appendChild(e);d=document.createElement("td");d.setAttribute("id","uiid_permission_"+b.groupid);d.textContent=
b.permission;c.appendChild(d);d=document.createElement("td");c.appendChild(d);return c}
function create_empty_record_table_item(a){if(null==document.getElementById("empty_record_table_item")){var b=document.getElementById("USERGROUPINFO_TABLE"),c=document.createElement("tr");c.setAttribute("id","empty_record_table_item");var d=0;c.appendChild(document.createElement("td"));c.cells[d].appendChild(document.createTextNode(""+a));d++;c.appendChild(document.createElement("td"));c.cells[d].appendChild(create_input_text("input_groupname"));d++;c.appendChild(document.createElement("td"));c.cells[d].appendChild(create_input_text("input_permission"));
d++;c.appendChild(document.createElement("td"));a=document.createElement("button");a.setAttribute("class","btn btn-block btn-primary btn-lg");a.setAttribute("onclick","save_new_usergroup();");a.textContent="\u5132\u5b58";c.cells[d].appendChild(a);b.appendChild(c)}}function create_input_text(a,b){var c=document.createElement("textarea");c.setAttribute("rows","1");c.setAttribute("id",a);c.textContent=b;return c}
function edit_usergroup(a){console.log("edit_usergroup() groupid:"+a);var b=getUserGroup(a);null==b?console.log("edit_usergroup() group == null"):(create_edit_ui("uiid_groupname",a,b.groupname),create_edit_ui("uiid_permission",a,b.permission),b=document.getElementById("uiid_editbtn_"+a),b.setAttribute("title","Save this UserGroup"),b.setAttribute("onclick",'save_usergroup("'+a+'");return false;'),document.getElementById("uiid_editimg_"+a).setAttribute("class","fa fa-save"),document.getElementById("uiid_deletebtn_"+
a).setAttribute("style","display:block"))}function create_edit_ui(a,b,c){var d=clearChildView(a+"_"+b);a=create_input_text(a+"_"+b+"_edit",c);d.appendChild(a)}function clearChildView(a){a=document.getElementById(a);if(null!=a)for(;a.firstChild;)a.removeChild(a.firstChild);return a}
function create_group_label(a){var b=document.createElement("span");b.setAttribute("style","display:inline;padding:.2em .3em .3em;font-size:95%;font-weight:700;line-height:2;position:relative;top:-1px;color:#fff;border-radius:2px;white-space:nowrap;background-color:#f0ad4e;");b.textContent=a;return b}function getUserGroup(a){for(var b=null,c=0;c<gl_usergroups.length;++c){var d=gl_usergroups[c];if(d.groupid===a){b=d;break}}return b}
function save_new_usergroup(){var a=document.getElementById("input_groupname").value,b=document.getElementById("input_permission").value;if(0==a.length)alert("\u8acb\u8f38\u5165\u540d\u7a31");else{var c={};c.project_id=""+project_id;c.create_new_usergroup=1;c.groupname=a;c.permission=b;jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:c,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a));CurrentLoadIndex=0;setTimeout(check_loading_status,300)},
error:function(a,c,b){alert("error = "+b);alert("xhr.responseText = "+a.responseText)}})}}
function save_usergroup(a){var b=document.getElementById("uiid_groupname_"+a+"_edit").value,c=document.getElementById("uiid_permission_"+a+"_edit").value;if(0==b.length)alert("\u8acb\u8f38\u5165\u540d\u7a31");else{var d={};d.project_id=""+project_id;d.update_usergroup=1;d.groupid=a;d.groupname=b;d.permission=c;jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:d,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a));CurrentLoadIndex=0;setTimeout(check_loading_status,
300)},error:function(a,c,b){alert("error = "+b);alert("xhr.responseText = "+a.responseText)}})}}function confirm_delete_usergroup(a,b){a=parseInt(a);1==a||2==a||3==a?alert("Can not delet this group!!!"):confirm("Are you sure you want to delete this user group:"+b+" ?")&&delete_usergroup(a)}
function delete_usergroup(a){var b={};b.project_id=""+project_id;b.delete_usergroup=1;b.groupid=parseInt(a);jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:b,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a));CurrentLoadIndex=0;setTimeout(check_loading_status,300)},error:function(a,b,e){alert("error = "+e);alert("xhr.responseText = "+a.responseText)}})}
$("#createnewusergroupbutton").click(function(){create_empty_record_table_item(gl_usergroups.length+1);return!1});function open_usergroupinfo_page(){window.open("/index.php/vilsusergroupinfo/"+project_id,"_blank").focus()};
