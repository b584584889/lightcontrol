var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,d,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[d]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var d=0;return $jscomp.iteratorPrototype(function(){return d<a.length?{done:!1,value:a[d++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(a,d){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,b={next:function(){if(c<a.length){var e=c++;return{value:d(e,a[e]),done:!1}}b.next=function(){return{done:!0,value:void 0}};return b.next()}};b[Symbol.iterator]=function(){return b};return b};
$jscomp.polyfill=function(a,d,c,b){if(d){c=$jscomp.global;a=a.split(".");for(b=0;b<a.length-1;b++){var e=a[b];e in c||(c[e]={});c=c[e]}a=a[a.length-1];b=c[a];d=d(b);d!=b&&null!=d&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:d})}};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6-impl","es3");
var glAllTags=[],glAllAnchors=[],glAllTagRanging={},gl_tag_num=0,gl_locator_num=0,gl_anchor_num=0,gl_tag_load_index=0,gl_locator_load_index=0,gl_anchor_load_index=0,glTag_List=[],glLocator_List=[],glAnchor_List=[],glCurrentLoadingState=0,MAX_RANGING_RESULT=20,LOAD_DEVICE_NUM=20;load_devices();
function load_devices(){$.getJSON(gl_target_server+"/php/vilsnodes.php","devicescount=1&project_id="+project_id,function(a){gl_tag_num=parseInt(a.LOC_TAG_NUM);gl_locator_num=parseInt(a.LOC_LOCATOR_NUM);gl_anchor_num=parseInt(a.LOC_ANCHOR_NUM);gl_anchor_load_index=gl_locator_load_index=gl_tag_load_index=0;glTag_List=[];glLocator_List=[];glAnchor_List=[]}).success(function(){setTimeout(load_tag,10)}).error(function(){}).complete(function(){})}
function load_tag(){gl_tag_load_index>=gl_tag_num?(gl_tag_load_index=0,setTimeout(load_locator,20)):(0==gl_tag_load_index&&(glTag_List=[]),$.getJSON(gl_target_server+"/php/vilsnodes.php","loadtag=1&s="+gl_tag_load_index+"&count="+LOAD_DEVICE_NUM+"&project_id="+project_id,function(a){var d=parseInt(a.LOC_TAG_NUM);console.log("tag_num:"+d+", gl_tag_load_index:"+gl_tag_load_index);for(var c=gl_tag_load_index;c<gl_tag_load_index+d;++c){var b="LOC_TAG_INDEX_"+c;void 0!=a[b]&&null!=a[b]&&(b=a[b].split(","),
glTag_List.push(b))}gl_tag_load_index+=d}).success(function(){gl_tag_load_index>=gl_tag_num?setTimeout(load_locator,20):setTimeout(load_tag,1)}).error(function(){gl_tag_load_index=0;setTimeout(load_tag,UPDATE_INTERVAL)}).complete(function(){}))}
function load_locator(){gl_locator_load_index>=gl_locator_num?(gl_locator_load_index=0,setTimeout(load_anchor,10)):(0==gl_locator_load_index&&(glLocator_List=[]),$.getJSON(gl_target_server+"/php/vilsnodes.php","loadlocator=1&s="+gl_locator_load_index+"&count="+LOAD_DEVICE_NUM+"&project_id="+project_id,function(a){var d=parseInt(a.LOC_LOCATOR_NUM);console.log("locator_num:"+d+", gl_locator_load_index:"+gl_locator_load_index);for(var c=gl_locator_load_index;c<gl_locator_load_index+d;++c){var b="LOC_LOCATOR_INDEX_"+
c;void 0!=a[b]&&null!=a[b]&&(b=a[b].split(","),glLocator_List.push(b))}gl_locator_load_index+=d}).success(function(){gl_locator_load_index>=gl_locator_num?setTimeout(load_anchor,10):setTimeout(load_locator,1)}).error(function(){gl_locator_load_index=0;setTimeout(load_locator,UPDATE_INTERVAL)}).complete(function(){}))}
function load_anchor(){gl_anchor_load_index>=gl_anchor_num?(gl_anchor_load_index=0,setTimeout(load_node_ranging,10)):(0==gl_anchor_load_index&&(glAnchor_List=[]),$.getJSON(gl_target_server+"/php/vilsnodes.php","loadanchor=1&s="+gl_anchor_load_index+"&count="+LOAD_DEVICE_NUM+"&project_id="+project_id,function(a){for(var d=parseInt(a.LOC_ANCHOR_NUM),c=gl_anchor_load_index;c<gl_anchor_load_index+d;++c){var b="LOC_ANCHOR_INDEX_"+c;void 0!=a[b]&&null!=a[b]&&(b=a[b].split(","),glLocator_List.push(b))}gl_anchor_load_index+=
d}).success(function(){gl_anchor_load_index>=gl_anchor_num?setTimeout(load_node_ranging,10):setTimeout(load_anchor,10)}).error(function(){console.log("load_anchors() error gl_anchor_load_index:"+gl_anchor_load_index+", gl_anchor_num:"+gl_anchor_num);gl_anchor_load_index=0;setTimeout(load_locator,10)}).complete(function(){}))}
function load_node_ranging(){null!=document.getElementById("RANGING_TABLE_TABS")&&$.getJSON(gl_target_server+"/php/vilsnodes.php","loadranging=1&project_id="+project_id,function(a){$.each(a,function(a,c){if(checkTagExist(a)){for(var b=!1,e=0;e<glAllTags.length;e++)if(glAllTags[e]==a){b=!0;break}b||glAllTags.push(a);void 0==glAllTagRanging[a]&&(glAllTagRanging[a]=[]);var f=glAllTagRanging[a],b=JSON.parse(c);$.each(b,function(a,c){var b=Object.keys(c),d="",e="",p="",l="";for(key in b)curKey=b[key],
"time"===curKey?(l=c[curKey].split(" "),l=1<l.length?l[1]:c[curKey]):"a"===curKey?p=c[curKey]:(e=curKey,d=c[curKey]);if(checkAnchorExist(e)){for(var b=!1,q=0;q<glAllAnchors.length;q++)if(glAllAnchors[q]==e){b=!0;break}b||glAllAnchors.push(e);void 0==f[e]&&(f[e]={},f[e].index=MAX_RANGING_RESULT,f[e].data=[],f[e].count=0);b=f[e].index;b++;b>=MAX_RANGING_RESULT&&(b=0);f[e].index=b;void 0==f[e].data[b]&&(f[e].data[b]={});f[e].data[b].ranging=d;f[e].data[b].angle=p;f[e].data[b].timestamp=l;f[e].count++}})}});
0==glCurrentLoadingState&&create_ranging_table()}).success(function(){setTimeout(load_node_ranging,500)}).error(function(){setTimeout(load_node_ranging,3E3)}).complete(function(){})}
function create_ranging_table(){if(0==glAllTags.length+glAllAnchors.length)document.getElementById("RANGING_TABLE_MSG").innerText="No new Record";else{document.getElementById("RANGING_TABLE_MSG").innerText="";for(var a=document.getElementById("RANGING_TABLE_TABS"),d=document.getElementById("RANGING_TABLE_CONTENT"),c=0;c<glAllTags.length;c++){var b=glAllTags[c];create_tab(c,a,b)}for(c=0;c<glAllTags.length;c++)b=glAllTags[c],create_tab_pane(c,d,b)}}
function create_tab(a,d,c){var b=document.getElementById("tab_"+c);if(null==b){var e=document.createElement("li");0==a&&e.setAttribute("class","active");e.setAttribute("id","tab_"+c);d.appendChild(e);a=document.createElement("a");a.setAttribute("href","#tab_tag_"+c);a.setAttribute("data-toggle","tab");e.appendChild(a);e=document.createElement("span");e.setAttribute("class","badge bg-blue-active");e.textContent=getTagName(c);a.appendChild(e)}return b}
function create_tab_pane(a,d,c){var b=document.getElementById("tab_tag_"+c);null==b&&(b=document.createElement("div"),0==a?b.setAttribute("class","tab-pane active"):b.setAttribute("class","tab-pane"),b.setAttribute("id","tab_tag_"+c),d.appendChild(b),a=document.createElement("div"),a.setAttribute("class","row"),a.setAttribute("id","tab_row_tag_"+c),b.appendChild(a));a=document.getElementById("tab_row_tag_"+c);if(null!=b)for(idx in b=glAllTagRanging[c],d=Object.keys(b),d){chrAnchor=d[idx];var e="tab_col_"+
c+"_"+chrAnchor,f=document.getElementById(e);if(null==f){var h=document.createElement("div");h.setAttribute("class","col-xs-4 col-sm-3 col-md-2 col-lg-2");a.appendChild(h);f=document.createElement("div");f.setAttribute("class","box");h.appendChild(f);h=document.createElement("div");h.setAttribute("class","box-header with-border");f.appendChild(h);var g=document.createElement("span");g.setAttribute("class","badge bg-green");g.textContent=getAnchorName(chrAnchor);h.appendChild(g);g=document.createElement("span");
g.setAttribute("class","badge bg-purple");g.setAttribute("id","box_header_count_"+e);g.textContent=0;h.appendChild(g);g=document.createElement("div");g.setAttribute("class","box-body");f.appendChild(g);h=document.createElement("table");h.setAttribute("class","table");g.appendChild(h);g=document.createElement("tr");h.appendChild(g);f=document.createElement("th");g.appendChild(f);g=document.createElement("span");g.setAttribute("class","badge bg-blue");g.textContent="Timestamp";f.appendChild(g);f=document.createElement("div");
f.setAttribute("id",e);h.appendChild(f)}f=document.getElementById(e);g=document.getElementById("box_header_count_"+e);for(g.textContent=b[chrAnchor].count;f.firstChild;)f.removeChild(f.firstChild);e=b[chrAnchor].index;for(h=0;h<b[chrAnchor].data.length;h++){var g=b[chrAnchor].data[h],n=e-h;0>n&&(n+=20);var n=1-.04*n,k=document.createElement("tr");f.appendChild(k);var m=document.createElement("td");h==e&&m.setAttribute("bgcolor","#00cccc");k.appendChild(m);var p=moment(g.timestamp,"HH:mm:ss"),p=moment().diff(p,
"seconds"),l=document.createElement("span");60<=p?l.setAttribute("class","badge bg-red"):l.setAttribute("class","badge bg-light-yellow");l.setAttribute("style","opacity:"+n);l.textContent=g.timestamp;m.appendChild(l);m=document.createElement("td");h==e&&m.setAttribute("bgcolor","#00cccc");k.appendChild(m);k=document.createElement("span");k.setAttribute("class","badge bg-yellow");k.setAttribute("style","opacity:"+n);k.textContent=g.ranging;m.appendChild(k);"0.00"!=g.angle&&(k=document.createElement("span"),
k.setAttribute("class","badge bg-fuchsia"),k.setAttribute("style","opacity:"+n),k.textContent=g.angle,m.appendChild(k))}}}function toggle_ranging_loading(){if(1==glCurrentLoadingState){glCurrentLoadingState=0;var a=document.getElementById("ranging_state_button");a.setAttribute("class","glyphicon glyphicon-pause")}else a=document.getElementById("ranging_state_button"),a.setAttribute("class","glyphicon glyphicon-play"),glCurrentLoadingState=1}
function checkTagExist(a){for(var d=0;d<glTag_List.length;d++)if(a===glTag_List[d][3])return!0;return!1}function checkAnchorExist(a){for(var d=0;d<glLocator_List.length;d++){var c=glLocator_List[d],c=c[3];if(a===c)return a=!0}for(d=0;d<glAnchor_List.length;d++)if(c=glAnchor_List[d],c=c[3],a===c)return a=!0;return!1}function getTagName(a){for(var d=0;d<glTag_List.length;d++){var c=glTag_List[d],b=c[5];if(a===c[3])return b}return a}
function getAnchorName(a){for(var d=0;d<glLocator_List.length;d++){var c=glLocator_List[d],b=c[5],c=c[3];if(a===c)return b}for(d=0;d<glAnchor_List.length;d++)if(c=glAnchor_List[d],b=c[5],c=c[3],a===c)return b;return a}function open_ranging_page(){window.open("/index.php/vilsranging/"+project_id,"_blank").focus()};
