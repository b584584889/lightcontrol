window.BlobBuilder=window.MozBlobBuilder||window.WebKitBlobBuilder||window.BlobBuilder;var blob,start,end,part,uploaded,SIZE,BYTES_PER_CHUNK,xhr,chunk,UploadImageFinishedCallback=null,uid="";
function sendUploadImageRequest(a){blob=document.getElementById("imageUpload").files[0];if(void 0==blob)return alert("\u8b80\u53d6\u6a94\u6848\u5931\u6557!"),null;BYTES_PER_CHUNK=1048576;SIZE=blob.size;part=start=0;end=BYTES_PER_CHUNK;uploaded=0;UploadImageFinishedCallback=a;uid=Date.now();chunk=blob.slice(start,end);uploadImageFile(chunk,part);start=end;end=start+BYTES_PER_CHUNK;part+=1;uploaded=0;return uid}
function imageSelected(){var a=document.getElementById("imageUpload").files[0];if(a){var b;b=1048576<a.size?(Math.round(100*a.size/1048576)/100).toString()+"MB":(Math.round(100*a.size/1024)/100).toString()+"KB";var c=a.name.split("."),e=document.getElementById("id_new_image_name");void 0!=e&&(e.value=c[0]);e=document.getElementById("id_new_image_description");void 0!=e&&(e.value=c[0]);document.getElementById("imageFileSize").innerHTML="Size: "+b;document.getElementById("imageFileType").innerHTML=
"Type: "+a.type;a=document.getElementById("removebutton");void 0!=a&&a.setAttribute("style","display:block;")}}
function uploadImageFile(a,b){var c=document.getElementById("imageUpload").files[0],e=new FormData;e.append("imageUpload",a);e.append("file",c.name);e.append("uid",uid);e.append("num",parseInt(b));c=new XMLHttpRequest;c.upload.addEventListener("progress",uploadImageProgress,!1);c.addEventListener("load",uploadImageComplete,!1);c.addEventListener("error",uploadImageFailed,!1);c.addEventListener("abort",uploadImageCanceled,!1);c.open("POST","/php/uploadfile.php");c.onload=function(a){};c.setRequestHeader("Cache-Control",
"no-cache");c.send(e)}function uploadImageProgress(a){a.lengthComputable?(a=Math.round(100*(uploaded+a.loaded)/SIZE),document.getElementById("imageProgressNumber").innerHTML=a.toString()+"%"):document.getElementById("imageProgressNumber").innerHTML="unable to compute"}
function uploadImageComplete(a){start<SIZE?(chunk=blob.slice(start,end),uploadImageFile(chunk,part),start=end,end=start+BYTES_PER_CHUNK,part+=1,uploaded+=BYTES_PER_CHUNK):"function"===typeof UploadImageFinishedCallback&&(0==JSON.parse(a.target.responseText).FileSize?UploadImageFinishedCallback(null):UploadImageFinishedCallback(uid))}function uploadImageFailed(a){alert("There was an error attempting to upload the file.");uid=null}
function uploadImageCanceled(a){xhr.abort();uid=xhr=null;alert("The upload has been canceled by the user or the browser dropped the connection.")};var LOAD_USER_NUM=20,PreLoadIndex=-1,CurrentLoadIndex=0,LOAD_STATE_END=9999,glCurrentPage=1,gl_users=[],gl_usergroups=[],gl_userdatasubgroups=[],gl_unknownrfidcards=[],gl_unknownnfccards=[],pre_input_value="",gl_uploadimage_uid="",glActiveSubgroup="";check_loading_status();
function check_loading_status(){switch(CurrentLoadIndex){case 0:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,load_usergroup());break;case 1:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,load_userdatasubgroup());break;case 2:PreLoadIndex!=CurrentLoadIndex&&
(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,load_user_info());break;case 3:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,show_user_photo(),CurrentLoadIndex+=1);break;case 4:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+
CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,load_unknownnfccard(),load_unknownrfidcard(),create_dropdown_list(),CurrentLoadIndex=LOAD_STATE_END)}CurrentLoadIndex!=LOAD_STATE_END?setTimeout(check_loading_status,100):console.log("check_loading_status() Stop.")}
function load_usergroup(){gl_usergroups=[];$.getJSON(gl_target_server+"/php/vilsnodes.php","loadusergroup=1&project_id="+project_id,function(a){$.each(a,function(a,c){c.groupid=parseInt(c.groupid);gl_usergroups.push(c)})}).success(function(){CurrentLoadIndex+=1}).error(function(){}).complete(function(){})}
function load_userdatasubgroup(){gl_userdatasubgroups=[];$.getJSON(gl_target_server+"/php/vilsnodes.php","loaddatasubgroup=1&project_id="+project_id+"&type=0",function(a){$.each(a,function(a,c){c.subgroupid=parseInt(c.subgroupid);gl_userdatasubgroups.push(c)})}).success(function(){CurrentLoadIndex+=1}).error(function(){}).complete(function(){})}function load_user_info(){var a=document.getElementById("map_search_text").value;0<a.length?(pre_input_value=a,search_text_change(a)):load_user()}
function load_user(){var a=(glCurrentPage-1)*LOAD_USER_NUM,b=LOAD_USER_NUM;gl_users=[];$.getJSON(gl_target_server+"/php/vilsnodes.php","loaduser=1&s="+a+"&count="+b+"&project_id="+project_id+"&subgroup="+glActiveSubgroup,function(a){$.each(a,function(a,b){gl_users.push(b)})}).success(function(){draw_table();CurrentLoadIndex+=1}).error(function(){}).complete(function(){})}
function show_user_photo(){for(var a=0;a<gl_users.length;++a){var b=gl_users[a];0<b.imageuid.length&&load_user_photo(b.userid,b.imageuid)}}function load_user_photo(a,b){$.getJSON(gl_target_server+"/php/storage.php","loadsingleimage=1&project_id="+project_id+"&imageuid="+b,function(b){var e=document.getElementById("uiid_photo_"+a);void 0!=e&&(b=create_user_photo(b),e.appendChild(b))}).success(function(){}).error(function(){}).complete(function(){})}
function create_user_photo(a){var b=document.createElement("img");b.setAttribute("src","/php/downloadfile.php?loadthumb=1&project_id="+project_id+"&imageid="+a.id);b.setAttribute("alt",a.description);b.setAttribute("style","max-width: 64px;");return b}
function load_unknownnfccard(){gl_unknownnfccards=[];$.getJSON(gl_target_server+"/php/nfclocator.php","loadunknowncard=1&s=0&count=20&project_id="+project_id,function(a){var b=0;$.each(a,function(a,e){gl_unknownnfccards.push(e);b++})}).success(function(){}).error(function(){}).complete(function(){})}
function load_unknownrfidcard(){gl_unknownrfidcards=[];$.getJSON(gl_target_server+"/php/rfiddevice.php","loadunknowncard=1&s=0&count=20&project_id="+project_id,function(a){var b=0;$.each(a,function(a,e){gl_unknownrfidcards.push(e);b++})}).success(function(){}).error(function(){}).complete(function(){})}
function create_dropdown_list(){var a=clearChildView("current_subgroup_title"),b=clearChildView("dropdown_menu_subgroup");if(0==glActiveSubgroup.length){var c=create_subgroup_label("\u5168\u90e8");a.appendChild(c)}b.appendChild(create_dropdown_type_item("","\u5168\u90e8"));for(var e=parseInt(glActiveSubgroup),d=0;d<gl_userdatasubgroups.length;++d){var f=gl_userdatasubgroups[d];e==f.subgroupid&&(c=create_subgroup_label(f.subgroupname),a.appendChild(c));b.appendChild(create_dropdown_type_item(f.subgroupid,
f.subgroupname))}}function create_dropdown_type_item(a,b){var c=document.createElement("li"),e=document.createElement("a");e.setAttribute("class","small");e.setAttribute("tabIndex","-1");e.setAttribute("data-value",a);e.setAttribute("href","javascript:;");e.setAttribute("onclick",'click_dropdown_theme_item("'+a+'", "'+b+'");return true;');var d=create_subgroup_label(b);e.appendChild(d);c.appendChild(e);return c}function click_dropdown_theme_item(a,b){glActiveSubgroup=a;reload_all_info()}
function search_text_change(a){var b=(glCurrentPage-1)*LOAD_USER_NUM,c=LOAD_USER_NUM;gl_users=[];jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:"searchuser=1&s="+b+"&count="+c+"&project_id="+project_id+"&text="+a+"&subgroup="+glActiveSubgroup,dataType:"text",success:function(a){a=JSON.parse(a);$.each(a,function(a,b){gl_users.push(b)});draw_table();CurrentLoadIndex+=1}});return!1}
function draw_table(){for(var a=document.getElementById("USER_TABLE");1<=a.rows.length;)a.deleteRow(0);for(var b=(glCurrentPage-1)*LOAD_USER_NUM,c=0;c<gl_users.length;++c){var e=create_record_table_item(b+c,gl_users[c]);a.appendChild(e)}}
function create_record_table_item(a,b){if(null==b)return null;var c=document.createElement("tr");1==a%2&&c.setAttribute("bgcolor","#ebebe0");var e=0;c.appendChild(document.createElement("td"));c.cells[e].appendChild(document.createTextNode(""+(a+1)));e++;var d=document.createElement("td");d.setAttribute("id","uiid_name_"+b.userid);c.appendChild(d);var f=document.createElement("span");f.setAttribute("style","font-size:14px; font-weight:bold; color:#330033;");f.textContent=b.name;d.appendChild(f);e++;
d=document.createElement("td");d.setAttribute("id","uiid_account_"+b.userid);c.appendChild(d);d=document.createElement("span");d.setAttribute("style","font-size:14px; font-weight:bold; color:#330033;");d.textContent=b.account;c.cells[e].appendChild(d);e++;d=document.createElement("td");d.setAttribute("id","uiid_id_"+b.userid);d.textContent=b.userid;c.appendChild(d);e++;d=document.createElement("td");d.setAttribute("id","uiid_title_"+b.userid);c.appendChild(d);d=document.createElement("span");0<b.title.length&&
d.setAttribute("style","display:inline;padding:.2em .3em .3em;font-size:95%;font-weight:700;line-height:1;position:relative;top:-1px;color:#fff;border-radius:2px;white-space:nowrap;background-color:rgb(185, 118, 211);");d.textContent=b.title;c.cells[e].appendChild(d);e++;c.appendChild(document.createElement("td"));f=document.createElement("span");f.setAttribute("id","uiid_photo_"+b.userid);c.cells[e].appendChild(f);e++;d=document.createElement("td");c.appendChild(d);f=document.createElement("span");
f.setAttribute("id","uiid_groupid_"+b.userid);d.appendChild(f);var g=create_group_label(getGroupName(parseInt(b.groupid)));f.appendChild(g);f=document.createElement("div");f.setAttribute("id","input_groupid_selected_"+b.userid);d.appendChild(f);e++;d=document.createElement("td");c.appendChild(d);f=document.createElement("span");f.setAttribute("id","uiid_datagroups_"+b.userid);d.appendChild(f);g=createDataGroupUI(b.datagroups);f.appendChild(g);f=document.createElement("div");f.setAttribute("id","input_datagroups_selected_"+
b.userid);d.appendChild(f);e++;d=document.createElement("td");c.appendChild(d);f=document.createElement("span");f.setAttribute("id","uiid_subgroups_"+b.userid);d.appendChild(f);g=createSubGroupUI(b.subgroups);f.appendChild(g);f=document.createElement("div");f.setAttribute("id","input_subgroups_selected_"+b.userid);d.appendChild(f);e++;d=document.createElement("td");d.setAttribute("id","uiid_rfidcards_"+b.userid);c.appendChild(d);d=create_ui_rfidcards(b.rfidcards);c.cells[e].appendChild(d);e++;d=document.createElement("td");
d.setAttribute("id","uiid_nfccards_"+b.userid);c.appendChild(d);d=create_ui_nfccards(b.nfccards);c.cells[e].appendChild(d);e++;d=document.createElement("td");d.setAttribute("id","uiid_uwbcards_"+b.userid);c.appendChild(d);d=create_ui_uwbcards(b.uwbcards);c.cells[e].appendChild(d);e++;d=document.createElement("td");d.setAttribute("id","uiid_sensors_"+b.userid);c.appendChild(d);d=create_ui_sensors(b.sensors);c.cells[e].appendChild(d);e++;d=document.createElement("td");c.appendChild(d);d=document.createElement("button");
d.setAttribute("type","button");d.setAttribute("class","btn btn-default");d.setAttribute("data-toggle","modal");d.setAttribute("data-target","#modal-qrcode");d.setAttribute("onclick",'device_qrcode_show("2","'+b.name+'","'+b.account+'","'+b.userid+'");return false;');f=document.createElement("i");f.setAttribute("class","fa fa-qrcode");d.appendChild(f);c.cells[e].appendChild(d);config_enable_edit&&(d=document.createElement("button"),d.setAttribute("id","uiid_editbtn_"+b.userid),d.setAttribute("title",
"Edit this User"),d.setAttribute("href","javascript:;"),d.setAttribute("onclick",'edit_user("'+b.userid+'");return false;'),f=document.createElement("i"),f.setAttribute("id","uiid_editimg_"+b.userid),f.setAttribute("class","fa fa-edit"),d.appendChild(f),c.cells[e].appendChild(d),d=document.createElement("button"),d.setAttribute("style","display:none"),d.setAttribute("id","uiid_resettopicbtn_"+b.userid),d.setAttribute("title","Reset Pushnotify Topic"),d.setAttribute("href","javascript:;"),d.setAttribute("onclick",
'confirm_reset_user_topic("'+b.userid+'", "'+b.name+'", "'+b.account+'");return false;'),f=document.createElement("i"),f.setAttribute("class","fa fa-unlink"),d.appendChild(f),c.cells[e].appendChild(d),d=document.createElement("button"),d.setAttribute("style","display:none"),d.setAttribute("id","uiid_resetbtn_"+b.userid),d.setAttribute("title","Reset User password"),d.setAttribute("href","javascript:;"),d.setAttribute("onclick",'confirm_reset_user_password("'+b.userid+'", "'+b.name+'", "'+b.account+
'");return false;'),f=document.createElement("i"),f.setAttribute("class","fa fa-refresh"),d.appendChild(f),c.cells[e].appendChild(d),b.account!=gl_accountid&&(d=document.createElement("button"),d.setAttribute("style","display:none"),d.setAttribute("id","uiid_deletebtn_"+b.userid),d.setAttribute("title","Delete This User"),d.setAttribute("href","javascript:;"),d.setAttribute("onclick",'confirm_delete_user("'+b.userid+'", "'+b.name+'", "'+b.account+'");return false;'),f=document.createElement("i"),
f.setAttribute("class","fa fa-user-times"),d.appendChild(f),c.cells[e].appendChild(d)));return c}
function createDataGroupUI(a){var b=document.createElement("div"),c=document.createElement("div");b.appendChild(c);a=a.split(",");for(var e=0;e<a.length;e++){var d=a[e];if("99999"==d)return d=create_datagroup_label("\u5168\u90e8"),c.appendChild(d),b}d=create_datagroup_label("\u81ea\u5df1");c.appendChild(d);for(e=0;e<a.length;e++)d=a[e],0!=d.length&&(d=getSubGroupName(d),0!=d.length&&(c=document.createElement("div"),b.appendChild(c),d=create_datagroup_label(d),c.appendChild(d)));return b}
function createSubGroupUI(a){var b=document.createElement("div");a=a.split(",");for(var c=0;c<a.length;c++){var e=a[c];if(0!=e.length){var d=getSubGroupName(e);0!=d.length&&(e=document.createElement("div"),b.appendChild(e),d=create_subgroup_label(d),e.appendChild(d))}}return b}
function create_group_label(a){var b=document.createElement("span");b.setAttribute("style","display:inline;padding:.2em .3em .3em;font-size:95%;font-weight:700;line-height:2;position:relative;top:-1px;color:#fff;border-radius:2px;white-space:nowrap;background-color:#f0ad4e;");b.textContent=a;return b}
function create_datagroup_label(a){var b=document.createElement("span");b.setAttribute("style","display:inline;padding:.2em .3em .3em;font-size:95%;font-weight:700;line-height:2;position:relative;top:-1px;color:#fff;border-radius:2px;white-space:nowrap;background-color:rgb(54, 127, 169);");b.textContent=a;return b}
function create_subgroup_label(a){var b=document.createElement("span");b.setAttribute("style","display:inline;padding:.2em .3em .3em;font-size:95%;font-weight:700;line-height:2;position:relative;top:-1px;color:#fff;border-radius:2px;white-space:nowrap;background-color:#00a65a;");b.textContent=a;return b}
function create_ui_rfidcards(a){var b=document.createElement("div");a=a.split(",");for(var c=0;c<a.length;c++){var e=a[c];if(0!=e.length){var d=document.createElement("div");b.appendChild(d);var f=document.createElement("span");f.setAttribute("class","label label-primary");f.textContent=e;d.appendChild(f)}}return b}
function create_ui_nfccards(a){var b=document.createElement("div");a=a.split(",");for(var c=0;c<a.length;c++){var e=a[c];if(0!=e.length){var d=document.createElement("div");b.appendChild(d);var f=document.createElement("span");f.setAttribute("class","label label-success");f.textContent=e;d.appendChild(f)}}return b}
function create_ui_uwbcards(a){var b=document.createElement("div");a=a.split(",");for(var c=0;c<a.length;c++){var e=a[c];if(0!=e.length){var d=document.createElement("div");b.appendChild(d);var f=document.createElement("span");f.setAttribute("class","badge bg-light-blue-active");f.textContent=e;d.appendChild(f)}}return b}
function create_ui_sensors(a){var b=document.createElement("div");a=a.split(",");for(var c=0;c<a.length;c++){var e=a[c];if(0!=e.length){var d=document.createElement("div");b.appendChild(d);var f=document.createElement("span");f.setAttribute("class","badge bg-blue");f.textContent=e;d.appendChild(f)}}return b}
function create_empty_record_table_item(a){if(null==document.getElementById("empty_record_table_item")){a=document.getElementById("USER_TABLE").insertRow(0);a.setAttribute("bgcolor","#ebebe0");a.setAttribute("id","empty_record_table_item");var b=0;a.appendChild(document.createElement("td"));a.cells[b].appendChild(document.createTextNode(""));b++;a.appendChild(document.createElement("td"));a.cells[b].appendChild(create_input_text("input_name"));b++;a.appendChild(document.createElement("td"));a.cells[b].appendChild(create_input_text("input_account"));
b++;a.appendChild(document.createElement("td"));b++;a.appendChild(document.createElement("td"));a.cells[b].appendChild(create_input_text("input_title"));b++;a.appendChild(document.createElement("td"));var c=create_upload_image_ui();a.cells[b].appendChild(c);b++;a.appendChild(document.createElement("td"));a.cells[b].appendChild(create_edit_group_ui("input_groupid","99999",2));c=document.createElement("div");c.setAttribute("id","input_groupid_selected_99999");a.cells[b].appendChild(c);b++;update_selected_group("99999",
2);a.appendChild(document.createElement("td"));a.cells[b].appendChild(create_edit_datagroup_ui("input_datagroups","99999",""));c=document.createElement("div");c.setAttribute("id","input_datagroups_selected_99999");a.cells[b].appendChild(c);b++;a.appendChild(document.createElement("td"));a.cells[b].appendChild(create_edit_subgroup_ui("input_subgroups","99999",""));c=document.createElement("div");c.setAttribute("id","input_subgroups_selected_99999");a.cells[b].appendChild(c);b++;a.appendChild(document.createElement("td"));
a.cells[b].appendChild(create_input_text("input_rfidcards"));b++;a.appendChild(document.createElement("td"));a.cells[b].appendChild(create_input_text("input_nfccards"));b++;a.appendChild(document.createElement("td"));a.cells[b].appendChild(create_input_text("input_uwbcards"));b++;a.appendChild(document.createElement("td"));a.cells[b].appendChild(create_input_text("input_sensors"));b++;a.appendChild(document.createElement("td"));c=document.createElement("button");c.setAttribute("class","btn btn-block btn-primary btn-lg");
c.setAttribute("onclick","save_new_user();");c.textContent="\u5132\u5b58";a.cells[b].appendChild(c)}}function create_input_text(a,b){var c=document.createElement("textarea");c.setAttribute("rows","1");c.setAttribute("id",a);c.textContent=b;return c}
function create_upload_image_ui(){var a=document.createElement("div"),b=document.createElement("form");b.setAttribute("method","POST");b.setAttribute("enctype","multipart/form-data");b.setAttribute("action","php/uploadfile.php");a.appendChild(b);var c=document.createElement("div");c.setAttribute("class","form-group");b.appendChild(c);b=document.createElement("label");b.setAttribute("class","control-sidebar-subheading");b.setAttribute("for","imageUpload");b.innerHTML="\u4e0a\u50b3\u6a94\u6848";c.appendChild(b);
b=document.createElement("input");b.setAttribute("id","imageUpload");b.setAttribute("accept","image/*");b.setAttribute("type","file");b.setAttribute("name","imageUpload");b.setAttribute("onchange","imageSelected();");c.appendChild(b);b=document.createElement("div");b.setAttribute("id","imageFileSize");c.appendChild(b);b=document.createElement("div");b.setAttribute("id","imageFileType");c.appendChild(b);b=document.createElement("div");b.setAttribute("id","imageProgressNumber");c.appendChild(b);return a}
var gl_edit_userid=0,gl_edit_user_imageuid=0;
function edit_user(a){var b=getUser(a);if(null!=b){for(var c=0;c<gl_users.length;++c){var e=gl_users[c];e.userid!=a&&document.getElementById("uiid_editbtn_"+e.userid).setAttribute("style","display:none;")}create_edit_ui("uiid_name",a,b.name);create_edit_ui("uiid_title",a,b.title);gl_edit_user_imageuid=b.imageuid;c=document.getElementById("uiid_photo_"+a);if(void 0!=c){if(0==gl_edit_user_imageuid.length)clearChildView("uiid_photo_"+a),e=create_upload_image_ui();else{e=document.createElement("button");
e.setAttribute("style","color: #AF4C50;");e.setAttribute("title","Delete User Photo");e.setAttribute("href","javascript:;");e.setAttribute("onclick",'delete_user_photo("'+a+'");return false;');var d=document.createElement("i");d.setAttribute("class","fa fa-remove");e.appendChild(d)}c.appendChild(e)}create_edit_group_ui("uiid_groupid",a,parseInt(b.groupid));create_edit_datagroup_ui("uiid_datagroups",a,b.datagroups);create_edit_subgroup_ui("uiid_subgroups",a,b.subgroups);c=create_edit_ui("uiid_rfidcards",
a,b.rfidcards);e=create_unregister_card_ui("rfid",a,gl_unknownrfidcards);c.appendChild(e);c=create_edit_ui("uiid_nfccards",a,b.nfccards);e=create_unregister_card_ui("nfc",a,gl_unknownnfccards);c.appendChild(e);create_edit_ui("uiid_uwbcards",a,b.uwbcards);create_edit_ui("uiid_sensors",a,b.sensors);c=document.getElementById("uiid_editbtn_"+b.userid);c.setAttribute("title","Save this User");c.setAttribute("onclick",'save_user("'+b.userid+'");return false;');document.getElementById("uiid_editimg_"+b.userid).setAttribute("class",
"fa fa-save");document.getElementById("uiid_resettopicbtn_"+b.userid).setAttribute("style","display:block");document.getElementById("uiid_resetbtn_"+b.userid).setAttribute("style","display:block");b=document.getElementById("uiid_deletebtn_"+b.userid);void 0!=b&&b.setAttribute("style","display:block");update_selected_group(a,0);update_selected_datagroup(a,0);update_selected_subgroup(a,0)}}
function delete_user_photo(a){gl_edit_user_imageuid="";clearChildView("uiid_photo_"+a);a=document.getElementById("uiid_photo_"+a);if(void 0!=a){var b=create_upload_image_ui();a.appendChild(b)}}function save_user(a){gl_edit_userid=a;check_upload_image(uploadEditUserImageFinihed)}function uploadEditUserImageFinihed(){uploadImageFinihed(save_edit_user)}
function save_edit_user(){var a=gl_edit_userid;gl_edit_userid=0;var b=document.getElementById("uiid_name_"+a+"_edit").value,c=document.getElementById("uiid_title_"+a+"_edit").value,e=getSelectedGroup(a),d=getSelectedDataGroup(a),f=getSelectedSubGroup(a),g=document.getElementById("uiid_rfidcards_"+a+"_edit").value,h=document.getElementById("uiid_nfccards_"+a+"_edit").value,m=document.getElementById("uiid_uwbcards_"+a+"_edit").value,n=document.getElementById("uiid_sensors_"+a+"_edit").value,b=checkValidUserName(b),
g=checkValidCardid(g),h=checkValidCardid(h),m=checkValidCardid(m),n=checkValidCardid(n);value_imageuid=0==gl_uploadimage_uid.length?gl_edit_user_imageuid:gl_uploadimage_uid;update_user(a,b,c,e,d,f,g,h,m,n,value_imageuid)}function checkValidCardid(a){return str=a.replace(/[^A-Za-z0-9,]*/g,"")}function checkValidUserName(a){return str=a.replace(/(\r\n|\n|\r)/gm,"")}
function create_edit_ui(a,b,c){var e=clearChildView(a+"_"+b),d=document.createElement("div");a=create_input_text(a+"_"+b+"_edit",c);d.appendChild(a);e.appendChild(d);return e}
function create_unregister_card_ui(a,b,c){var e=document.createElement("div");e.setAttribute("class","btn-group");var d=document.createElement("button");d.setAttribute("type","button");d.setAttribute("class","btn btn-default btn-sm dropdown-toggle");d.setAttribute("data-toggle","dropdown");d.textContent="\u672a\u8a3b\u518a\u5361\u7247";e.appendChild(d);var f=document.createElement("span");f.setAttribute("class","caret");d.appendChild(f);d=document.createElement("ul");d.setAttribute("class","dropdown-menu");
d.setAttribute("id","dropdown_card_"+a);e.appendChild(d);for(f=0;f<c.length;++f)d.appendChild(create_dropdown_card_item(b,a,f,c[f]));return e}
function create_dropdown_card_item(a,b,c,e){c=document.createElement("li");var d=document.createElement("a");d.setAttribute("class","small");d.setAttribute("tabIndex","-1");d.setAttribute("data-value",e.cardid);d.setAttribute("href","javascript:;");d.setAttribute("onclick",'dropdown_card_click("'+b+'","'+a+'","'+e.cardid+'");return true;');d.appendChild(document.createTextNode(e.cardid));c.appendChild(d);return c}
function dropdown_card_click(a,b,c){console.log("dropdown_card_click() type:"+a+" userid:"+b+" cardid:"+c);if("rfid"===a){var e=document.getElementById("uiid_rfidcards_"+b+"_edit"),d=e.value;0<d.length&&(d+=",");e.value=d+c;clearChildView("dropdown_card_"+a);e=document.getElementById("dropdown_card_"+a);for(d=0;d<gl_unknownrfidcards.length;++d){var f=gl_unknownrfidcards[d];c===f.cardid?(gl_unknownrfidcards.splice(d,1),d--):e.appendChild(create_dropdown_card_item(b,a,d,f))}}else if("nfc"===a)for(e=
document.getElementById("uiid_nfccards_"+b+"_edit"),d=e.value,0<d.length&&(d+=","),e.value=d+c,clearChildView("dropdown_card_"+a),e=document.getElementById("dropdown_card_"+a),d=0;d<gl_unknownnfccards.length;++d)f=gl_unknownnfccards[d],c===f.cardid?(gl_unknownnfccards.splice(d,1),d--):e.appendChild(create_dropdown_card_item(b,a,d,f))}
function create_edit_gender_ui(a,b,c){var e=clearChildView(a+"_"+b);a=document.createElement("div");a.setAttribute("class","btn-group");null!=e&&e.appendChild(a);e=document.createElement("button");e.setAttribute("type","button");e.setAttribute("class","btn btn-default btn-sm dropdown-toggle");e.setAttribute("data-toggle","dropdown");e.textContent="\u6027\u5225";a.appendChild(e);var d=document.createElement("span");d.setAttribute("class","caret");e.appendChild(d);e=document.createElement("ul");e.setAttribute("class",
"dropdown-menu");a.appendChild(e);e.appendChild(create_dropdown_gender_item(b,0,"0","\u672a\u77e5","0"===c));e.appendChild(create_dropdown_gender_item(b,1,"1","\u7537","1"===c));e.appendChild(create_dropdown_gender_item(b,2,"2","\u5973","2"===c));return a}
function create_dropdown_gender_item(a,b,c,e,d){var f=document.createElement("li"),g=document.createElement("a");g.setAttribute("class","small");g.setAttribute("tabIndex","-1");g.setAttribute("data-value",c);g.setAttribute("href","javascript:;");g.setAttribute("onclick",'dropdown_gender_click("'+a+'",'+b+");return true;");c=document.createElement("input");c.setAttribute("type","checkbox");c.setAttribute("id","dropdown_checkbox_gender_"+a+"_"+b);c.setAttribute("onclick",'dropdown_checkbox_gender_click("'+
a+'",'+b+");return true;");c.checked=d;g.appendChild(c);g.appendChild(document.createTextNode(e));f.appendChild(g);return f}function dropdown_checkbox_gender_click(a,b){glDropdown_checkbox_gender_click=!0;update_selected_gender(a,b)}var glDropdown_checkbox_gender_click=!1;
function dropdown_gender_click(a,b){1!=glDropdown_checkbox_gender_click&&(1==document.getElementById("dropdown_checkbox_gender_"+a+"_"+b).checked?document.getElementById("dropdown_checkbox_gender_"+a+"_"+b).checked=!1:document.getElementById("dropdown_checkbox_gender_"+a+"_"+b).checked=!0,update_selected_gender(a,b));glDropdown_checkbox_gender_click=!1}
function update_selected_gender(a,b){for(var c=0,e=0;2>=e;e++)b==e?0==document.getElementById("dropdown_checkbox_gender_"+a+"_"+e).checked&&c++:(c++,document.getElementById("dropdown_checkbox_gender_"+a+"_"+e).checked=!1);3==c&&(document.getElementById("dropdown_checkbox_gender_"+a+"_"+b).checked=!0)}
function create_edit_group_ui(a,b,c){var e=clearChildView(a+"_"+b);a=document.createElement("div");a.setAttribute("class","btn-group");null!=e&&e.appendChild(a);e=document.createElement("button");e.setAttribute("type","button");e.setAttribute("class","btn btn-default btn-sm dropdown-toggle");e.setAttribute("data-toggle","dropdown");e.textContent="\u6b0a\u9650\u7fa4\u7d44";a.appendChild(e);var d=document.createElement("span");d.setAttribute("class","caret");e.appendChild(d);e=document.createElement("ul");
e.setAttribute("class","dropdown-menu");a.appendChild(e);for(d=0;d<gl_usergroups.length;++d){var f=gl_usergroups[d],g=parseInt(f.groupid);1==gl_groupid||2==gl_groupid?e.appendChild(create_dropdown_group_item(b,"group",d,g,f.groupname,c==g)):1!=g&&2!=g&&e.appendChild(create_dropdown_group_item(b,"group",d,g,f.groupname,c==g))}return a}
function create_edit_datagroup_ui(a,b,c){var e=clearChildView(a+"_"+b);a=document.createElement("div");a.setAttribute("class","btn-group");null!=e&&e.appendChild(a);e=document.createElement("button");e.setAttribute("type","button");e.setAttribute("class","btn btn-default btn-sm dropdown-toggle");e.setAttribute("data-toggle","dropdown");e.textContent="\u8cc7\u6599\u6b0a\u9650\u7fa4\u7d44";a.appendChild(e);var d=document.createElement("span");d.setAttribute("class","caret");e.appendChild(d);e=document.createElement("ul");
e.setAttribute("class","dropdown-menu");a.appendChild(e);c=c.split(",");if(1==gl_groupid||2==gl_groupid)d=check_numer_in_list(99999,c),e.appendChild(create_dropdown_group_item(b,"datagroup",0,99999,"\u5168\u90e8",d));for(var f=0;f<gl_userdatasubgroups.length;++f){var g=gl_userdatasubgroups[f],d=check_numer_in_list(g.subgroupid,c);e.appendChild(create_dropdown_group_item(b,"datagroup",f+1,g.subgroupid,g.subgroupname,d))}return a}
function create_edit_subgroup_ui(a,b,c){var e=clearChildView(a+"_"+b);a=document.createElement("div");a.setAttribute("class","btn-group");null!=e&&e.appendChild(a);e=document.createElement("button");e.setAttribute("type","button");e.setAttribute("class","btn btn-default btn-sm dropdown-toggle");e.setAttribute("data-toggle","dropdown");e.textContent="\u5b50\u96c6\u5408";a.appendChild(e);var d=document.createElement("span");d.setAttribute("class","caret");e.appendChild(d);e=document.createElement("ul");
e.setAttribute("class","dropdown-menu");a.appendChild(e);c=c.split(",");for(d=0;d<gl_userdatasubgroups.length;++d){var f=gl_userdatasubgroups[d],g=check_numer_in_list(f.subgroupid,c);e.appendChild(create_dropdown_group_item(b,"subgroup",d,f.subgroupid,f.subgroupname,g))}return a}
function create_dropdown_group_item(a,b,c,e,d,f){var g=document.createElement("li"),h=document.createElement("a");h.setAttribute("class","small");h.setAttribute("tabIndex","-1");h.setAttribute("data-value",e);h.setAttribute("href","javascript:;");h.setAttribute("onclick",'dropdown_group_click("'+b+'","'+a+'",'+c+");return true;");e=document.createElement("input");"group"===b?(e.setAttribute("type","radio"),e.setAttribute("name","name_"+b+"_"+a)):e.setAttribute("type","checkbox");e.setAttribute("id",
"dropdown_checkbox_"+b+"_"+a+"_"+c);e.setAttribute("onclick",'dropdown_checkbox_group_click("'+b+'","'+a+'",'+c+");return true;");e.checked=f;h.appendChild(e);h.appendChild(document.createTextNode(" "+d));g.appendChild(h);return g}function dropdown_checkbox_group_click(a,b,c){glDropdown_checkbox_group_click=!0;update_selected_type(a,b,c)}var glDropdown_checkbox_group_click=!1;
function dropdown_group_click(a,b,c){1!=glDropdown_checkbox_group_click&&(1==document.getElementById("dropdown_checkbox_"+a+"_"+b+"_"+c).checked?document.getElementById("dropdown_checkbox_"+a+"_"+b+"_"+c).checked=!1:document.getElementById("dropdown_checkbox_"+a+"_"+b+"_"+c).checked=!0,update_selected_type(a,b,c));glDropdown_checkbox_group_click=!1}
function update_selected_type(a,b,c){"group"==a?update_selected_group(b,c):"datagroup"==a?update_selected_datagroup(b,c):"subgroup"==a&&update_selected_subgroup(b,c)}
function update_selected_group(a,b){console.log("update_selected_group() userid:"+a+" uiindex:"+b);var c=document.getElementById("input_groupid_selected_"+a);void 0!=c?clearChildView("input_groupid_selected_"+a):console.log("update_selected_group() group_selected_div == undefined input_groupid_selected_"+a);for(var e=0,d=0;d<gl_usergroups.length;++d){var f=gl_usergroups[d],g=document.getElementById("dropdown_checkbox_group_"+a+"_"+d);void 0!=g&&g.checked&&(e++,f=create_group_label(f.groupname),c.appendChild(f))}0==
e&&(g=document.getElementById("dropdown_checkbox_group_"+a+"_"+b),void 0!=g&&(g.checked=!0,f=gl_usergroups[b],f=create_group_label(f.groupname),c.appendChild(f)))}
function update_selected_datagroup(a,b){console.log("update_selected_datagroup() userid:"+a+" uiindex:"+b);var c=document.getElementById("input_datagroups_selected_"+a);void 0!=c&&clearChildView("input_datagroups_selected_"+a);for(var e=0;e<gl_userdatasubgroups.length;++e){var d=gl_userdatasubgroups[e],f=document.getElementById("dropdown_checkbox_datagroup_"+a+"_"+(e+1));void 0!=f&&f.checked&&(d=create_datagroup_label(d.subgroupname),c.appendChild(d))}}
function update_selected_subgroup(a,b){console.log("update_selected_subgroup() userid:"+a+" uiindex:"+b);var c=document.getElementById("input_subgroups_selected_"+a);void 0!=c&&clearChildView("input_subgroups_selected_"+a);for(var e=0;e<gl_userdatasubgroups.length;++e){var d=gl_userdatasubgroups[e],f=document.getElementById("dropdown_checkbox_subgroup_"+a+"_"+e);void 0!=f&&f.checked&&(d=create_subgroup_label(d.subgroupname),c.appendChild(d))}}
function getSelectedGender(a){var b=0;document.getElementById("dropdown_checkbox_gender_"+a+"_0").checked&&(b=0);document.getElementById("dropdown_checkbox_gender_"+a+"_1").checked&&(b=1);document.getElementById("dropdown_checkbox_gender_"+a+"_2").checked&&(b=2);return b}function getSelectedGroup(a){for(var b=0,c=0;c<gl_usergroups.length;++c){var e=gl_usergroups[c],d=document.getElementById("dropdown_checkbox_group_"+a+"_"+c);if(void 0!=d&&d.checked){b=parseInt(e.groupid);break}}return b}
function getSelectedDataGroup(a){var b=[],c=document.getElementById("dropdown_checkbox_datagroup_"+a+"_0");void 0!=c&&c.checked&&b.push(99999);for(c=0;c<gl_userdatasubgroups.length;++c){var e=gl_userdatasubgroups[c];document.getElementById("dropdown_checkbox_datagroup_"+a+"_"+(c+1)).checked&&b.push(e.subgroupid)}return b.toString()}
function getSelectedSubGroup(a){for(var b=[],c=0;c<gl_userdatasubgroups.length;++c){var e=gl_userdatasubgroups[c];document.getElementById("dropdown_checkbox_subgroup_"+a+"_"+c).checked&&b.push(e.subgroupid)}return b.toString()}function clearChildView(a){a=document.getElementById(a);if(null!=a)for(;a.firstChild;)a.removeChild(a.firstChild);return a}function create_new_user(){create_empty_record_table_item(gl_users.length+1);return!1}
function save_new_user(){check_upload_image(uploadNewUserImageFinihed)}function check_upload_image(a){gl_uploadimage_uid="";var b=document.getElementById("imageUpload");void 0!=b?void 0!=b.files[0]?(console.log("check_upload_image() uploadimage.files[0] != undefined "),gl_uploadimage_uid=sendUploadImageRequest(a)):a(gl_uploadimage_uid):a(gl_uploadimage_uid)}function uploadNewUserImageFinihed(a){gl_uploadimage_uid=a;uploadImageFinihed(upload_new_user)}
function uploadImageFinihed(a){console.log("uploadImageFinihed() gl_uploadimage_uid:"+gl_uploadimage_uid);if(null==gl_uploadimage_uid)alert("\u4e0a\u50b3\u7167\u7247\u5931\u6557!");else{var b=document.getElementById("input_name");void 0==b&&(b=document.getElementById("uiid_name_"+gl_edit_userid+"_edit"));var b=b.value,c=document.getElementById("imageUpload"),e=void 0;if(void 0!=c)if(void 0==c.files[0])setTimeout(a,100);else{var e=c.files[0],c=e.name.split(".")[0],d="project_id="+project_id,d=d+"&createnewimage=1"+
("&name="+c)+("&description="+b)+("&filename="+e.name),d=d+("&fileuid="+gl_uploadimage_uid),d=d+("&filetype="+e.type),d=d+("&filesize="+e.size),d=d+"&subgroups=",d=d+"&leaveform=0";return jQuery.ajax({url:"/php/uploadfile.php",type:"POST",data:d,dataType:"text",success:function(b){setTimeout(a,300)},error:function(b,c,e){setTimeout(a,300)}})}else setTimeout(a,100)}}
function upload_new_user(){var a=document.getElementById("input_name").value,b=document.getElementById("input_account").value,c=document.getElementById("input_title").value,e=getSelectedGroup("99999"),d=getSelectedDataGroup("99999"),f=getSelectedSubGroup("99999"),g=document.getElementById("input_rfidcards").value,h=document.getElementById("input_nfccards").value,m=document.getElementById("input_uwbcards").value,n=document.getElementById("input_sensors").value;if(0==a.length)alert("\u8acb\u8f38\u5165\u540d\u7a31");
else if(0==b.length)alert("\u8acb\u8f38\u5165\u5e33\u865f");else if(1!=gl_groupid&&2!=gl_groupid&&0==f.length)alert("\u8acb\u9078\u64c7\u5b50\u96c6\u5408");else{var k={};k.project_id=""+project_id;k.create_new_user=1;k.name=a;k.account=b;k.title=c;k.group=e;k.datagroups=d;k.subgroups=f;k.rfidcards=g;k.nfccards=h;k.uwbcards=m;k.sensors=n;k.imageuid=gl_uploadimage_uid;jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:k,success:function(a){400==a.status&&alert("update Error! response = "+
JSON.stringify(a));a=JSON.parse(a);1==a.existed&&alert("\u6b64\u7528\u6236\u5df2\u5b58\u5728 : "+b+" \u767b\u5165\u8acb\u7528\u8b58\u5225\u78bc:"+a.userid);0<a.assigned_rfidcards.length&&alert("RFID \u5361\u7247\u5df2\u6709\u7528\u6236\u4f7f\u7528 : "+a.assigned_rfidcards);0<a.assigned_nfccards.length&&alert("NFC \u5361\u7247\u5df2\u6709\u7528\u6236\u4f7f\u7528 : "+a.assigned_nfccards);setTimeout(reload_user_info,300)},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}})}}
function update_user(a,b,c,e,d,f,g,h,m,n,k){if(0==b.length)alert("\u8acb\u8f38\u5165\u540d\u7a31");else{var l=getUser(a);1!=gl_groupid&&2!=gl_groupid&&gl_accountid!=l.account&&0==f.length?alert("\u8acb\u9078\u64c7\u5b50\u96c6\u5408"):(l={},l.project_id=""+project_id,l.update_user=1,l.userid=a,l.name=b,l.title=c,l.group=e,l.datagroups=d,l.subgroups=f,l.rfidcards=g,l.nfccards=h,l.uwbcards=m,l.sensors=n,l.imageuid=k,jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:l,success:function(a){400==
a.status&&alert("update Error! response = "+JSON.stringify(a));a=JSON.parse(a);0<a.assigned_rfidcards.length&&alert("RFID \u5361\u7247\u5df2\u6709\u7528\u6236\u4f7f\u7528 : "+a.assigned_rfidcards);0<a.assigned_nfccards.length&&alert("NFC \u5361\u7247\u5df2\u6709\u7528\u6236\u4f7f\u7528 : "+a.assigned_nfccards);setTimeout(reload_user_info,300)},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}}))}}
function confirm_reset_user_topic(a,b,c){confirm("Are you sure you want to reset this user pushnotify topic:"+b+" ?")&&reset_user_topic(a,c)}
function reset_user_topic(a,b){var c={};c.project_id=""+project_id;c.reset_user_topic=1;c.userid=parseInt(a);c.account=b;jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:c,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a))},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}})}
function confirm_reset_user_password(a,b,c){confirm("Are you sure you want to reset this user password:"+b+" ?")&&(b=prompt("Please enter new password:[\u7a7a\u767d\u4ee3\u8868\u7cfb\u7d71\u5c07\u81ea\u52d5\u7522\u751f]"),reset_user_password(a,c,b))}
function reset_user_password(a,b,c){var e={};e.project_id=""+project_id;e.reset_user_password=1;e.userid=parseInt(a);e.account=b;e.password=c;jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:e,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a))},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}})}
function confirm_delete_user(a,b,c){confirm("Are you sure you want to delete this user:"+b+" ?")&&delete_user(a,c)}
function delete_user(a,b){var c={};c.project_id=""+project_id;c.delete_user=1;c.userid=parseInt(a);c.account=b;jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:c,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a));setTimeout(reload_user_info,300)},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}})}
function getUser(a){for(var b=null,c=0;c<gl_users.length;++c){var e=gl_users[c];if(e.userid===a){b=e;break}}return b}function getGroupName(a){for(var b="\u672a\u77e5",c=0;c<gl_usergroups.length;++c){var e=gl_usergroups[c];if(parseInt(e.groupid)==a){b=e.groupname;break}}return b}function getSubGroupName(a){if(99999==parseInt(a))return"\u5168\u90e8";for(var b="",c=0;c<gl_userdatasubgroups.length;++c){var e=gl_userdatasubgroups[c];if(e.subgroupid==parseInt(a)){b=e.subgroupname;break}}return b}
function getGenderName(a){switch(a){default:case "0":a="\u672a\u77e5";break;case "1":a="\u7537";break;case "2":a="\u5973"}return a}function check_numer_in_list(a,b){for(var c=!1,e=0;e<b.length;++e)if(parseInt(b[e])==a){c=!0;break}return c}function reload_user_info(){PreLoadIndex=1;CurrentLoadIndex=2;check_loading_status()}function reload_all_info(){PreLoadIndex=-1;CurrentLoadIndex=0;check_loading_status()}
function device_qrcode_show(a,b,c,e){console.log("device_qrcode_show() type:"+a+" accountname:"+b+" accountid:"+c);var d="TAG";"1"===a&&(d="TAG");"2"===a&&(d="USER");"3"===a&&(d="LOCATOR");document.getElementById("device_qrcode_type").textContent="Type: "+d;document.getElementById("device_qrcode_name").textContent="\u540d\u7a31: "+b;document.getElementById("device_qrcode_macaddress").textContent="\u5e33\u865f: "+c;jQuery.ajax({url:gl_target_server+"/php/configvils.php",type:"POST",data:"loadqrcode=1&type="+
d+"&accountid="+c+"&id="+e+"&project_id="+project_id,dataType:"text",success:function(a){a=JSON.parse(a);document.getElementById("device_qrcode_ui").setAttribute("src",a.qrcode);document.getElementById("device_qrcode_target").textContent="target: "+a.target;document.getElementById("device_qrcode_topic").textContent="topic: "+a.topic;document.getElementById("device_qrcode_datetime").textContent="\u66f4\u65b0\u6642\u9593: "+a.datetime}})}
function read_xlsx_input(){$("#file-input").trigger("click")}
function inputfile_onchange(){var a=document.getElementById("file-input").files[0];console.log("inputfile_onchange() file.name:"+a.name+" file.size:"+a.size+" file.type:"+a.type);var b=new FormData;b.append("uploadxlsxfile",a);b.append("project_id",""+project_id);b.append("fileinfo","userinfo");jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",processData:!1,contentType:!1,data:b,success:function(a){var b=JSON.parse(a);console.log("inputfile_onchange() success:"+b.success+" msg:"+
b.msg+" issuefile:"+b.issuefile);setTimeout(reload_all_info,100);if(void 0!=b.issuefile&&0<b.issuefile.length){alert("\u90e8\u5206\u8cc7\u6599\u6709\u8aa4!\u8acb\u67e5\u770b\u6a94\u6848!");for(var d=document.getElementById("xlsxreport_status");d.firstChild;)d.removeChild(d.firstChild);a=document.createElement("button");a.setAttribute("type","button");a.setAttribute("class","btn btn-app");a.setAttribute("style","width:90px;height:100px");a.setAttribute("onclick","open_new_page('"+b.issuefile+"');");
d.appendChild(a);b=document.createElement("img");b.setAttribute("src","/images/xlsx-dl-icon-1.png");b.setAttribute("alt","Download report");b.setAttribute("title","Download report");b.setAttribute("height","80");b.setAttribute("width","80");a.appendChild(b)}else alert(b.msg)},error:function(a,b,d){}})}
function create_user_xlsx_report(){document.getElementById("xlsxreport_status").textContent="\u7522\u751f\u5831\u8868\u4e2d...";jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:"loaduserinfoxlsxreport=1&project_id="+project_id,dataType:"text",success:function(a){var b=JSON.parse(a);console.log("create_user_xlsx_report() success:"+b.success+" xlsxreport:"+b.xlsxreport);for(var c=document.getElementById("xlsxreport_status");c.firstChild;)c.removeChild(c.firstChild);"true"===b.success?
(a=document.createElement("button"),a.setAttribute("type","button"),a.setAttribute("class","btn btn-app"),a.setAttribute("style","width:90px;height:100px"),a.setAttribute("onclick","open_new_page('"+b.xlsxreport+"');"),c.appendChild(a),b=document.createElement("img"),b.setAttribute("src","/images/xlsx-dl-icon-1.png"),b.setAttribute("alt","Download report"),b.setAttribute("title","Download report"),b.setAttribute("height","80"),b.setAttribute("width","80"),a.appendChild(b)):(c=document.getElementById("xlsxreport_status"),
c.textContent="\u7522\u751f\u5831\u8868\u5931\u6557!")}});return!1}function move_page_backward(){var a=document.getElementById("id_current_page_num");1>=glCurrentPage||(glCurrentPage--,a.textContent=glCurrentPage,reload_user_info())}function move_page_forward(){var a=document.getElementById("id_current_page_num");glCurrentPage++;a.textContent=glCurrentPage;reload_user_info()}var gl_search_start=0;
function map_search_text_change(){var a=document.getElementById("map_search_text").value;if(a===pre_input_value)console.log("check_search_text_change() input_value === pre_input_value, input_value:"+a);else return glCurrentPage=1,gl_search_start=0,reload_user_info(),!1}
function check_search_text_change(a){0==gl_search_start&&(gl_search_start=new Date);a=((new Date).getTime()-gl_search_start.getTime())/1E3;CurrentLoadIndex!=LOAD_STATE_END?(console.log("check_search_text_change() CurrentLoadIndex != LOAD_STATE_END"),setTimeout(map_search_text_change,500)):1<=a?(gl_search_start=0,map_search_text_change()):setTimeout(map_search_text_change,500)}var $source=document.querySelector("#map_search_text");$source.addEventListener("input",check_search_text_change);
function open_new_page(a){window.open(a,"_blank").focus()}function open_userinfo_page(){window.open("/index.php/vilsuserinfo/"+project_id,"_blank").focus()};
