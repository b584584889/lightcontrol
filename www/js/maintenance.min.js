var glMaintenanceRecords=[],gl_record_load_index=0,LOAD_DEVICE_NUM=20;load_maintenancerecords();function load_maintenancerecords(){glMaintenanceRecords=[];$.getJSON(gl_target_server+"/php/vilsnodes.php","project_id="+project_id+"&loadmaintenancerecord=1&s="+gl_record_load_index+"&count="+LOAD_DEVICE_NUM,function(e){var d=0;$.each(e,function(a,b){glMaintenanceRecords.push(b);d++});draw_table()})}
function draw_table(){for(var e=document.getElementById("MAINTENANCE_TABLE_BODY");1<=e.rows.length;)e.deleteRow(0);console.log("draw_table() glMaintenanceRecords.length:"+glMaintenanceRecords.length);for(var d=0;d<glMaintenanceRecords.length;++d){var a=create_record_table_item(d,glMaintenanceRecords[d]);e.appendChild(a)}}
function create_record_table_item(e,d){if(null==d)return null;var a=document.createElement("tr"),b=0;a.appendChild(document.createElement("td"));a.cells[b].appendChild(document.createTextNode(""+(e+1)));b++;var c=document.createElement("td");c.setAttribute("style","height: 90px;");a.appendChild(c);var g=document.createElement("span");g.setAttribute("style","font-size:14px; font-weight:bold; color:#330033;");g.textContent=d.name;a.cells[b].appendChild(g);b++;g=document.createElement("td");c.setAttribute("style",
"height: 90px;");a.appendChild(g);c=document.createElement("span");c.setAttribute("style","font-size:14px; font-weight:bold; color:#330033;");c.textContent=d.type;a.cells[b].appendChild(c);b++;a.appendChild(document.createElement("td"));c=document.createElement("span");c.setAttribute("style","font-size:14px; font-weight:bold; color:#330033;");c.textContent=d.unit;a.cells[b].appendChild(c);b++;a.appendChild(document.createElement("td"));c=document.createElement("span");c.setAttribute("style","font-size:14px; font-weight:bold; color:#330033;");
c.textContent=d.manager;a.cells[b].appendChild(c);b++;a.appendChild(document.createElement("td"));c=document.createElement("span");c.setAttribute("style","font-size:14px; font-weight:bold; color:#330033;");c.textContent=d.assetlife;a.cells[b].appendChild(c);b++;a.appendChild(document.createElement("td"));c=document.createElement("span");c.setAttribute("style","font-size:14px; font-weight:bold; color:#330033;");c.textContent=d.maintenancedate;a.cells[b].appendChild(c);b++;a.appendChild(document.createElement("td"));
c=document.createElement("span");c.setAttribute("style","font-size:14px; font-weight:bold; color:#330033;");c.textContent=d.status;a.cells[b].appendChild(c);b++;a.appendChild(document.createElement("td"));c=document.createElement("span");c.setAttribute("class","badge bg-blue");c.textContent=d.datetime;a.cells[b].appendChild(c);return a}
function create_empty_record_table_item(e){var d=document.getElementById("MAINTENANCE_TABLE_BODY"),a=document.createElement("tr"),b=0;a.appendChild(document.createElement("td"));a.cells[b].appendChild(document.createTextNode(""+e));b++;a.appendChild(document.createElement("td"));a.cells[b].appendChild(create_input_text("input_name"));b++;a.appendChild(document.createElement("td"));a.cells[b].appendChild(create_input_text("input_type"));b++;a.appendChild(document.createElement("td"));a.cells[b].appendChild(create_input_text("input_unit"));
b++;a.appendChild(document.createElement("td"));a.cells[b].appendChild(create_input_text("input_manager"));b++;a.appendChild(document.createElement("td"));a.cells[b].appendChild(create_input_text("input_assetlife"));b++;a.appendChild(document.createElement("td"));a.cells[b].appendChild(create_input_text("input_maintenancedate"));b++;a.appendChild(document.createElement("td"));a.cells[b].appendChild(create_input_text("input_status"));b++;a.appendChild(document.createElement("td"));e=document.createElement("button");
e.setAttribute("class","btn btn-block btn-primary btn-lg");e.setAttribute("onclick","save_new_record();");e.textContent="\u5132\u5b58";a.cells[b].appendChild(e);d.appendChild(a)}function create_input_text(e,d){var a=document.createElement("textarea");a.setAttribute("rows","1");a.setAttribute("id",e);a.textContent=d;return a}$("#createnewmaintenancebutton").click(function(){create_empty_record_table_item(glMaintenanceRecords.length+1);return!1});
function save_new_record(){var e=document.getElementById("input_name").value,d=document.getElementById("input_type").value,a=document.getElementById("input_unit").value,b=document.getElementById("input_manager").value,c=document.getElementById("input_assetlife").value,g=document.getElementById("input_maintenancedate").value,h=document.getElementById("input_status").value;console.log("save_new_record() input_name:"+e);if(0==e.length)alert("\u8acb\u8f38\u5165\u5100\u5668\u540d\u7a31");else if(0==g.length)alert("\u8acb\u8f38\u5165\u4fdd\u990a\u6821\u6b63(\u65e5\u671f\u901a\u77e5)");
else{var f={};f.project_id=""+project_id;f.create_new_maintenance=1;f.name=e;f.type=d;f.unit=a;f.manager=b;f.assetlife=c;f.maintenancedate=g;f.status=h;jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:f,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a));setTimeout(load_maintenancerecords,300)},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}})}}
function open_maintenance_page(){window.open("/index.php/vilsmaintenance/"+project_id,"_blank").focus()};
