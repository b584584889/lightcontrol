var PreLoadIndex=-1,CurrentLoadIndex=0,LOAD_STATE_END=9999,gl_updating_element_id="",edit_node_info=!1,stop_update_anchor_info=!1,stop_update_tag_info=!1,stop_update_coord_info=!1,stop_update_locator_info=!1,stop_update_gateway_info=!1,gl_showfilter_showonline=!0,gl_showfilter_showoffline=!0,gl_anchor_num=0,gl_tag_num=0,gl_coord_num=0,gl_locator_num=0,gl_anchor_load_index=0,gl_tag_load_index=0,gl_coord_load_index=0,gl_locator_load_index=0,gl_OnLinelist_anchor=[],gl_OnLinelist_tag=[],gl_OnLinelist_coord=
[],gl_OnLinelist_locator=[],gl_OnLinelist_gateway=[],gl_notOnLinelist_anchor=[],gl_notOnLinelist_tag=[],gl_notOnLinelist_coord=[],gl_notOnLinelist_locator=[],gl_notOnLinelist_gateway=[],gl_user_num=0,gl_user_load_index=0,gl_user_info=[],glMapLayerList=[],gl_prj_info=[],gl_tag_prj_info=[],gl_anchor_prj_info=[],gl_coord_prj_info=[],gl_locator_prj_info=[],gl_gateway_prj_info=[],glSendATcmdTimestamp=getCurrentTimeStamp(),LOAD_DEVICE_NUM=50,LOAD_USER_NUM=500;check_loading_status();
function check_loading_status(){switch(CurrentLoadIndex){case 0:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,load_maplayer_info());break;case 1:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,load_user_info(),load_node_info_all(),load_loragateway_info(),CurrentLoadIndex=
2);break;case 2:PreLoadIndex!=CurrentLoadIndex&&(console.log("check_loading_status() PreLoadIndex:"+PreLoadIndex+" != CurrentLoadIndex:"+CurrentLoadIndex),PreLoadIndex=CurrentLoadIndex,load_prj_info(),load_node_prj_info(),CurrentLoadIndex=LOAD_STATE_END)}CurrentLoadIndex!=LOAD_STATE_END?setTimeout(check_loading_status,100):console.log("check_loading_status() Stop.")}
function load_maplayer_info(){glMapLayerList=[];$.getJSON(gl_target_server+"/php/map.php","loadmap=1&project_id="+project_id,function(c){$.each(c,function(b,a){glMapLayerList.push(a)});CurrentLoadIndex+=1});return!1}
function load_user_info(){$.getJSON(gl_target_server+"/php/vilsnodes.php","usercount=1&project_id="+project_id,function(c){gl_user_num=parseInt(c.USER_NUM);gl_user_load_index=0;gl_user_info=[]}).success(function(){setTimeout(load_user,500)}).error(function(){setTimeout(load_user_info,1E3)}).complete(function(){})}
function load_user(){gl_user_load_index>=gl_user_num||$.getJSON(gl_target_server+"/php/vilsnodes.php","loaduser=1&s="+gl_user_load_index+"&count="+LOAD_USER_NUM+"&project_id="+project_id,function(c){var b=0;$.each(c,function(a,c){c.userid=parseInt(c.userid);gl_user_info.push(c);b++});gl_user_load_index+=b}).success(function(){gl_user_load_index>=gl_user_num||setTimeout(load_user,50)}).error(function(){}).complete(function(){})}
function load_node_info_all(){null==document.getElementById("LOC_TAG_NODE_TABLE")?console.log("load_node_info_all() LOC_TAG_NODE_TABLE == null "):"activetab_tags"===gl_activetab||"activetab_anchors"===gl_activetab||"activetab_coords"===gl_activetab||"activetab_locators"===gl_activetab?$.getJSON(gl_target_server+"/php/vilsnodes.php","devicescount=1&project_id="+project_id,function(c){gl_anchor_num=parseInt(c.LOC_ANCHOR_NUM);gl_tag_num=parseInt(c.LOC_TAG_NUM);gl_coord_num=parseInt(c.LOC_COORD_NUM);
gl_locator_num=parseInt(c.LOC_LOCATOR_NUM);gl_locator_load_index=gl_coord_load_index=gl_tag_load_index=gl_anchor_load_index=0;gl_OnLinelist_anchor=[];gl_notOnLinelist_anchor=[];gl_OnLinelist_tag=[];gl_notOnLinelist_tag=[];gl_OnLinelist_coord=[];gl_notOnLinelist_coord=[];gl_OnLinelist_locator=[];gl_notOnLinelist_locator=[]}).success(function(){setTimeout(load_tag_info,500)}).error(function(){setTimeout(load_node_info_all,1E3)}).complete(function(){}):setTimeout(load_node_info_all,1E3)}
function clear_anchor_table(){for(var c=document.getElementById("LOC_ANCHOR_NODE_TABLE");1<=c.rows.length&&0<=gl_anchor_num;)c.deleteRow(0)}function clear_tag_table(){for(var c=document.getElementById("LOC_TAG_NODE_TABLE");1<=c.rows.length&&0<=gl_tag_num;)c.deleteRow(0)}function clear_coord_table(){for(var c=document.getElementById("LOC_COORD_NODE_TABLE");1<=c.rows.length&&0<=gl_coord_num;)c.deleteRow(0)}
function clear_locator_table(){for(var c=document.getElementById("LOC_LOCATOR_NODE_TABLE");1<=c.rows.length&&0<=gl_locator_num;)c.deleteRow(0)}function put_anchor_to_table(){var c=document.getElementById("LOC_ANCHOR_NODE_TABLE"),b=0;gl_showfilter_showonline&&(b+=add_node_to_table(c,"LOC",gl_OnLinelist_anchor,b));gl_showfilter_showoffline&&add_node_to_table(c,"LOC",gl_notOnLinelist_anchor,b)}
function put_tag_to_table(){var c=document.getElementById("LOC_TAG_NODE_TABLE"),b=0;gl_showfilter_showonline&&(b+=add_node_to_table(c,"LOC",gl_OnLinelist_tag,b));gl_showfilter_showoffline&&add_node_to_table(c,"LOC",gl_notOnLinelist_tag,b)}function put_coord_to_table(){var c=document.getElementById("LOC_COORD_NODE_TABLE"),b=0;gl_showfilter_showonline&&(b+=add_node_to_table(c,"LOC",gl_OnLinelist_coord,b));gl_showfilter_showoffline&&add_node_to_table(c,"LOC",gl_notOnLinelist_coord,b)}
function put_locator_to_table(){var c=document.getElementById("LOC_LOCATOR_NODE_TABLE"),b=0;gl_showfilter_showonline&&(b+=add_node_to_table(c,"LOC",gl_OnLinelist_locator,b));gl_showfilter_showoffline&&add_node_to_table(c,"LOC",gl_notOnLinelist_locator,b)}
function load_anchor_info(){"activetab_anchors"===gl_activetab?gl_anchor_load_index>=gl_anchor_num?load_coord_info():$.getJSON(gl_target_server+"/php/vilsnodes.php","loadanchor=1&s="+gl_anchor_load_index+"&count="+LOAD_DEVICE_NUM+"&project_id="+project_id,function(c){var b=parseInt(c.LOC_ANCHOR_NUM);0==gl_anchor_load_index&&0==b&&(gl_anchor_load_index=gl_anchor_num=0);for(var a=gl_anchor_load_index;a<gl_anchor_load_index+b;++a){var e=c["LOC_ANCHOR_INDEX_"+a];if(void 0!=e){var e=e.split(","),d=e[1];
"-1"===e[0]||"0"===d?gl_notOnLinelist_anchor.push(e):gl_OnLinelist_anchor.push(e)}}gl_anchor_load_index+=b}).success(function(){gl_anchor_load_index>=gl_anchor_num?(stop_update_anchor_info||(clear_anchor_table(),put_anchor_to_table()),stop_update_anchor_info=edit_node_info,load_coord_info()):load_anchor_info()}).error(function(){load_coord_info()}).complete(function(){}):load_coord_info()}
function load_tag_info(){"activetab_tags"===gl_activetab?gl_tag_load_index>=gl_tag_num?load_anchor_info():$.getJSON(gl_target_server+"/php/vilsnodes.php","loadtag=1&s="+gl_tag_load_index+"&count="+LOAD_DEVICE_NUM+"&project_id="+project_id,function(c){var b=parseInt(c.LOC_TAG_NUM);0==gl_tag_load_index&&0==b&&(gl_tag_load_index=gl_tag_num=0);for(var a=gl_tag_load_index;a<gl_tag_load_index+b;++a){var e=c["LOC_TAG_INDEX_"+a];if(void 0!=e){var e=e.split(","),d=e[1];"-1"===e[0]||"0"===d?gl_notOnLinelist_tag.push(e):
gl_OnLinelist_tag.push(e)}}gl_tag_load_index+=b}).success(function(){gl_tag_load_index>=gl_tag_num?(stop_update_tag_info||(clear_tag_table(),put_tag_to_table()),stop_update_tag_info=edit_node_info?!0:!1,load_anchor_info()):load_tag_info()}).error(function(){load_anchor_info()}).complete(function(){}):load_anchor_info()}
function load_coord_info(){"activetab_coords"===gl_activetab?gl_coord_load_index>=gl_coord_num?load_locator_info():$.getJSON(gl_target_server+"/php/vilsnodes.php","loadcoord=1&s="+gl_coord_load_index+"&count="+LOAD_DEVICE_NUM+"&project_id="+project_id,function(c){var b=parseInt(c.LOC_COORD_NUM);0==gl_coord_load_index&&0==b&&(gl_coord_load_index=gl_coord_num=0);for(var a=gl_coord_load_index;a<gl_coord_load_index+b;++a){var e=c["LOC_COORD_INDEX_"+a];if(void 0!=e){var e=e.split(","),d=e[1];"-1"===e[0]||
"0"===d?gl_notOnLinelist_coord.push(e):gl_OnLinelist_coord.push(e)}}gl_coord_load_index+=b}).success(function(){gl_coord_load_index>=gl_coord_num?(stop_update_coord_info||(clear_coord_table(),put_coord_to_table()),stop_update_coord_info=edit_node_info,load_locator_info()):load_coord_info()}).error(function(){load_locator_info()}).complete(function(){}):load_locator_info()}
function load_locator_info(){"activetab_locators"===gl_activetab?gl_locator_load_index>=gl_locator_num?(edit_node_info?document.getElementById("createnewlocatorbutton").style.display="block":document.getElementById("createnewlocatorbutton").style.display="none",0==gl_locator_num&&clear_locator_table(),setTimeout(load_node_info_all,500)):$.getJSON(gl_target_server+"/php/vilsnodes.php","loadlocator=1&s="+gl_locator_load_index+"&count="+LOAD_DEVICE_NUM+"&project_id="+project_id,function(c){var b=parseInt(c.LOC_LOCATOR_NUM);
0==gl_locator_load_index&&0==b&&(gl_locator_load_index=gl_locator_num=0);for(var a=gl_locator_load_index;a<gl_locator_load_index+b;++a){var e=c["LOC_LOCATOR_INDEX_"+a];if(void 0!=e){var e=e.split(","),d=e[1];"-1"===e[0]||"0"===d?gl_notOnLinelist_locator.push(e):gl_OnLinelist_locator.push(e)}}gl_locator_load_index+=b}).success(function(){gl_locator_load_index>=gl_locator_num?(stop_update_locator_info||(clear_locator_table(),put_locator_to_table()),stop_update_locator_info=edit_node_info?!0:!1,setTimeout(load_node_info_all,
500)):load_locator_info()}).error(function(){setTimeout(load_node_info_all,500)}).complete(function(){edit_node_info?document.getElementById("createnewlocatorbutton").style.display="block":document.getElementById("createnewlocatorbutton").style.display="none"}):setTimeout(load_node_info_all,500)}
function load_loragateway_info(){"activetab_loragateways"===gl_activetab?(gl_OnLinelist_gateway=[],gl_notOnLinelist_gateway=[],$.getJSON(gl_target_server+"/php/vilsnodes.php","loadloragateway=1&project_id="+project_id,function(c){$.each(c,function(b,a){var c=a.ping,d=a.mqtt;"0"===a.alive&&"0"===c&&"0"===d?gl_notOnLinelist_gateway.push(a):gl_OnLinelist_gateway.push(a)})}).success(function(){stop_update_gateway_info||(clear_gateway_table(),put_gateway_to_table());stop_update_gateway_info=edit_node_info;
setTimeout(load_loragateway_info,1E4)}).error(function(){setTimeout(load_loragateway_info,1E4)}).complete(function(){})):setTimeout(load_loragateway_info,1E3)}function load_prj_info(){gl_prj_info=[];$.getJSON(gl_target_server+"/php/configvils.php","loadallconfig=1&project_id="+project_id,function(c){var b=0;$.each(c,function(a,c){gl_prj_info[b]=c;b++})}).success(function(){setTimeout(load_prj_info,6E4)}).error(function(){setTimeout(load_prj_info,1E4)}).complete(function(){})}
function load_node_prj_info(){load_tag_prj_info();load_anchor_prj_info();load_coord_prj_info();load_locator_prj_info();load_gateway_prj_info();setTimeout(load_node_prj_info,6E4)}function load_tag_prj_info(){gl_tag_prj_info=[];$.getJSON(gl_target_server+"/php/vilsnodes.php","loadtagprjinfo=1",function(c){$.each(c,function(b,a){$.each(a,function(a,d){var c=d.nodeid;void 0==gl_tag_prj_info[c]&&(gl_tag_prj_info[c]=[]);gl_tag_prj_info[c].push(parseInt(b))})})})}
function load_anchor_prj_info(){gl_anchor_prj_info=[];$.getJSON(gl_target_server+"/php/vilsnodes.php","loadanchorprjinfo=1",function(c){$.each(c,function(b,a){$.each(a,function(a,d){var c=d.nodeid;void 0==gl_anchor_prj_info[c]&&(gl_anchor_prj_info[c]=[]);gl_anchor_prj_info[c].push(parseInt(b))})})})}
function load_coord_prj_info(){gl_coord_prj_info=[];$.getJSON(gl_target_server+"/php/vilsnodes.php","loadcoordprjinfo=1",function(c){$.each(c,function(b,a){$.each(a,function(a,d){var c=d.nodeid;void 0==gl_coord_prj_info[c]&&(gl_coord_prj_info[c]=[]);gl_coord_prj_info[c].push(parseInt(b))})})})}
function load_locator_prj_info(){gl_locator_prj_info=[];$.getJSON(gl_target_server+"/php/vilsnodes.php","loadlocatorprjinfo=1",function(c){$.each(c,function(b,a){$.each(a,function(a,d){var c=d.nodeid;void 0==gl_locator_prj_info[c]&&(gl_locator_prj_info[c]=[]);gl_locator_prj_info[c].push(parseInt(b))})})})}
function load_gateway_prj_info(){gl_gateway_prj_info=[];$.getJSON(gl_target_server+"/php/vilsnodes.php","loadgatewayprjinfo=1",function(c){$.each(c,function(b,a){$.each(a,function(a,d){var c=d.gwid;void 0==gl_gateway_prj_info[c]&&(gl_gateway_prj_info[c]=[]);gl_gateway_prj_info[c].push(parseInt(b))})})})}function clear_gateway_table(){for(var c=document.getElementById("LOC_LORAGATEWAY_NODE_TABLE");1<=c.rows.length;)c.deleteRow(0)}
function put_gateway_to_table(){for(var c=document.getElementById("LOC_LORAGATEWAY_NODE_TABLE"),b=0,a=0;a<gl_OnLinelist_gateway.length;a++)add_gateway_to_table(c,b,gl_OnLinelist_gateway[a]),b++;for(a=0;a<gl_notOnLinelist_gateway.length;a++)add_gateway_to_table(c,b,gl_notOnLinelist_gateway[a]),b++}
function add_gateway_to_table(c,b,a){if(null==a)return 0;var e=a.alive,d=a.ping,f=a.mqtt,g=a.gwid,m=a.sf,h=a.gwip,l=a.repeater,n=a.channel,p=a.maplayer,k=a.posX,r=a.posY,t=a.posZ,w=a.verifykey;a=document.createElement("tr");a.setAttribute("id",g+"_TABLE_ROW");var u;"0"===e&&"0"===d&&"0"===f?(a.setAttribute("bgcolor","#a3c2c2"),u=!1):(u=!0,a.setAttribute("bgcolor","#FFFFFF"));if(!gl_showfilter_showonline||!gl_showfilter_showoffline)if(gl_showfilter_showonline&&!u||gl_showfilter_showoffline&&u)return 0;
u=0;a.appendChild(document.createElement("td"));a.cells[u].appendChild(document.createTextNode(""+b));u++;a.appendChild(document.createElement("td"));"0"!=e&&(b=document.createElement("span"),b.setAttribute("class","badge bg-fuchsia"),b.textContent=e,a.cells[u].appendChild(b));u++;a.appendChild(document.createElement("td"));"0"!=d&&(e=document.createElement("span"),e.setAttribute("class","badge bg-fuchsia"),e.textContent=d,a.cells[u].appendChild(e));u++;a.appendChild(document.createElement("td"));
"0"!=f&&(e=document.createElement("span"),e.setAttribute("class","badge bg-fuchsia"),e.textContent=f,a.cells[u].appendChild(e));u++;d=document.createElement("td");a.appendChild(d);d=document.createElement("span");d.textContent=w;a.cells[u].appendChild(d);u++;a.appendChild(document.createElement("td"));w=document.createElement("span");w.setAttribute("class","badge bg-light-blue-active");w.textContent=g;a.cells[u].appendChild(w);u++;a.appendChild(document.createElement("td"));w=document.createElement("span");
w.setAttribute("class","badge bg-yellow-active");w.textContent=h;a.cells[u].appendChild(w);u++;a.appendChild(document.createElement("td"));h=document.createElement("span");h.innerHTML="("+k+","+r+","+t+")";a.cells[u].appendChild(h);u++;a.appendChild(document.createElement("td"));r=get_maplayer_name(p);edit_node_info?(k=document.createElement("div"),k.setAttribute("class","btn-group"),t=document.createElement("button"),t.setAttribute("type","button"),t.setAttribute("class","btn btn-block btn-primary btn-xs dropdown-toggle"),
t.setAttribute("data-toggle","dropdown"),t.setAttribute("id","dropdown_cur_maplayer_"+g),t.textContent=r,k.appendChild(t),r=document.createElement("span"),r.setAttribute("class","caret"),t.appendChild(r),r=document.createElement("ul"),r.setAttribute("class","dropdown-menu"),r.setAttribute("id","dropdown_maplayer_"+g),k.appendChild(r),add_maplayer_dropdown_list(r,"gateway",g,g,"gateway",p),a.cells[u].appendChild(k)):(p=document.createElement("span"),p.setAttribute("id","gateway_"+g+"_MAPLAYER"),p.setAttribute("class",
"label label-primary"),p.textContent=r,a.cells[u].appendChild(p));u++;a.appendChild(document.createElement("td"));p=document.createElement("span");p.setAttribute("class","badge bg-maroon-active");p.textContent=m;a.cells[u].appendChild(p);u++;a.appendChild(document.createElement("td"));m=document.createElement("span");m.setAttribute("class","badge bg-gray-active");m.textContent=l;a.cells[u].appendChild(m);u++;a.appendChild(document.createElement("td"));l=n.split(",");for(n=0;n<l.length;n++)m=document.createElement("span"),
m.setAttribute("class","badge bg-purple-active"),m.textContent=l[n],a.cells[u].appendChild(m);u++;a.appendChild(document.createElement("td"));edit_node_info&&(l=document.createElement("button"),l.setAttribute("type","button"),l.setAttribute("class","btn btn-default"),l.setAttribute("onclick",'delete_gateway_dialog("'+g+'");return false;'),n=document.createElement("i"),n.setAttribute("class","fa fa-trash-o"),l.appendChild(n),a.cells[u].appendChild(l));u++;edit_node_info?(l=document.getElementById("loc_tab_loragateway_prj"),
l.setAttribute("style","display:block;"),a.appendChild(document.createElement("td")),g=create_prj_dropdown("gateway",g,g,"gateway"),a.cells[u].appendChild(g)):(l=document.getElementById("loc_tab_loragateway_prj"),l.setAttribute("style","display:none;"));c.appendChild(a);return 1}
function create_LOC_table_item(c,b,a,e){if(null==e||void 0==e)return null;var d=e[2];if("0"===d)return create_table_anchor_item(c,b,a,e);if("1"===d)return create_table_tag_item(c,b,a,e);if("2"==d)return create_table_coordinator_item(c,b,a,e);if("3"==d)return create_table_locator_item(c,b,a,e)}
function create_table_anchor_item(c,b,a,e){var d=e[0],f=e[1],g=e[3],m=e[5],h=e[6],l=get_node_type(e[2]),n=e[20],p=e[23];b=document.createElement("tr");b.setAttribute("id",h+"_TABLE_ROW");"0"===f?b.setAttribute("bgcolor","#a3c2c2"):b.setAttribute("bgcolor","#FFFFFF");var k=0;b.appendChild(document.createElement("td"));b.cells[k].appendChild(document.createTextNode(""+a));k++;b.appendChild(document.createElement("td"));"0"!=f&&(a=document.createElement("span"),a.setAttribute("class","badge bg-fuchsia"),
a.textContent=f,b.cells[k].appendChild(a));k++;b.appendChild(document.createElement("td"));a=document.createElement("span");a.setAttribute("id",c+"_"+h+"_NODNAME");a.setAttribute("class","badge bg-yellow-active");a.textContent=m;b.cells[k].appendChild(a);edit_node_info&&(a=document.createElement("a"),a.setAttribute("id",c+"_"+h+"_NODNAME_EDIT"),a.setAttribute("href","javascript:;"),a.setAttribute("onclick",'edit_node_name("'+h+'","'+l.toLowerCase()+'","'+m+'");return false;'),f=document.createElement("i"),
f.setAttribute("class","fa fa-edit"),a.appendChild(f),b.cells[k].appendChild(a));k++;b.appendChild(document.createElement("td"));a=document.createElement("span");a.setAttribute("class","badge bg-green-active");a.textContent=l;b.cells[k].appendChild(a);a=document.createElement("span");a.setAttribute("class","badge bg-purple-active");"-1"==d&&a.setAttribute("class","badge bg-maroon-active");a.textContent=d;b.cells[k].appendChild(a);k++;d=document.createElement("td");b.appendChild(d);d=document.createElement("span");
d.textContent=p;b.cells[k].appendChild(d);k++;b.appendChild(document.createElement("td"));p=document.createElement("span");p.setAttribute("class","badge bg-gray-active");p.textContent=h;b.cells[k].appendChild(p);k++;p="("+e[7]+","+e[8]+","+e[9]+")";b.appendChild(document.createElement("td"));d=document.createElement("span");d.setAttribute("id",c+"_"+h+"_POS");d.innerHTML=p;b.cells[k].appendChild(d);edit_node_info&&(a=document.createElement("a"),a.setAttribute("id",c+"_"+h+"_LINK"),a.setAttribute("href",
"javascript:;"),a.setAttribute("onclick",'edit_node_position("anchor","'+h+'","'+e[7]+'","'+e[8]+'","'+e[9]+'");return false;'),f=document.createElement("i"),f.setAttribute("class","fa fa-edit"),a.appendChild(f),b.cells[k].appendChild(a));k++;b.appendChild(document.createElement("td"));d=get_maplayer_name(n);edit_node_info?(p=document.createElement("div"),p.setAttribute("class","btn-group"),a=document.createElement("button"),a.setAttribute("type","button"),a.setAttribute("class","btn btn-block btn-primary btn-xs dropdown-toggle"),
a.setAttribute("data-toggle","dropdown"),a.setAttribute("id","dropdown_cur_maplayer_"+h),a.textContent=d,p.appendChild(a),d=document.createElement("span"),d.setAttribute("class","caret"),a.appendChild(d),d=document.createElement("ul"),d.setAttribute("class","dropdown-menu"),d.setAttribute("id","dropdown_maplayer_"+h),p.appendChild(d),add_maplayer_dropdown_list(d,c,g,h,"anchor",n),b.cells[k].appendChild(p)):(n=document.createElement("span"),n.setAttribute("id",c+"_"+h+"_MAPLAYER"),n.setAttribute("class",
"label label-primary"),n.textContent=d,b.cells[k].appendChild(n));k++;n="";0<e[10].length&&(n+=e[10]+"v ");0<e[11].length&&(n+=e[11]+"\u00b0C ");0<e[12].length&&(n+=" V"+e[12]);0<e[19].length&&(n+=" panid:"+e[19]);b.appendChild(document.createElement("td"));b.cells[k].appendChild(document.createTextNode(n));edit_node_info&&(e=document.createElement("button"),e.setAttribute("type","button"),e.setAttribute("class","btn btn-default"),e.setAttribute("onclick",'delete_node_dialog("'+h+'","'+l.toLowerCase()+
'","'+m+'");return false;'),m=document.createElement("i"),m.setAttribute("class","fa fa-trash-o"),e.appendChild(m),b.cells[k].appendChild(e));k++;edit_node_info?(e=document.getElementById("loc_tab_anchor_prj"),e.setAttribute("style","display:block;"),b.appendChild(document.createElement("td")),c=create_prj_dropdown(c,g,h,"anchor"),b.cells[k].appendChild(c)):(e=document.getElementById("loc_tab_anchor_prj"),e.setAttribute("style","display:none;"));return b}
function create_table_tag_item(c,b,a,e){var d=e[0],f=e[1],g=e[2],m=e[3],h=e[4],l=e[5],n=e[6],p=get_node_type(g),k=e[36],r=e[41];b=document.createElement("tr");b.setAttribute("id",n+"_TABLE_ROW");"0"===f?b.setAttribute("bgcolor","#a3c2c2"):b.setAttribute("bgcolor","#FFFFFF");var t=0;b.appendChild(document.createElement("td"));b.cells[t].appendChild(document.createTextNode(""+a));t++;b.appendChild(document.createElement("td"));"0"!=f&&(a=document.createElement("span"),a.setAttribute("class","badge bg-fuchsia"),
a.textContent=f,b.cells[t].appendChild(a));t++;b.appendChild(document.createElement("td"));a=document.createElement("span");a.setAttribute("id",c+"_"+n+"_NODNAME");a.setAttribute("class","badge bg-yellow-active");a.textContent=l;b.cells[t].appendChild(a);edit_node_info&&(a=document.createElement("a"),a.setAttribute("id",c+"_"+n+"_NODNAME_EDIT"),a.setAttribute("href","javascript:;"),a.setAttribute("onclick",'edit_node_name("'+n+'","'+p.toLowerCase()+'","'+l+'");return false;'),f=document.createElement("i"),
f.setAttribute("class","fa fa-edit"),a.appendChild(f),b.cells[t].appendChild(a));t++;b.appendChild(document.createElement("td"));a=document.createElement("span");a.setAttribute("class","badge bg-blue-active");a.textContent=p;b.cells[t].appendChild(a);a=document.createElement("span");a.setAttribute("class","badge bg-purple-active");"-1"==d&&a.setAttribute("class","badge bg-maroon-active");a.textContent=d;b.cells[t].appendChild(a);t++;1==GL_CONFIG_SHOW_ROLE_INFO&&(b.appendChild(document.createElement("td")),
f=get_role_name(h),edit_node_info?(d=document.createElement("div"),d.setAttribute("class","btn-group"),a=document.createElement("button"),a.setAttribute("type","button"),a.setAttribute("class","btn btn-block btn-primary btn-xs dropdown-toggle"),a.setAttribute("data-toggle","dropdown"),a.setAttribute("id","dropdown_cur_role_"+n),a.textContent=f,d.appendChild(a),f=document.createElement("span"),f.setAttribute("class","caret"),a.appendChild(f),a=document.createElement("ul"),a.setAttribute("class","dropdown-menu"),
a.setAttribute("id","dropdown_role_"+n),d.appendChild(a),add_role_dropdown_list(a,c,m,n,"tag",h),b.cells[t].appendChild(d)):(h=document.createElement("span"),h.setAttribute("id",c+"_"+n+"_ROLE"),h.setAttribute("class","badge bg-green-active"),h.textContent=f,b.cells[t].appendChild(h)),t++);b.appendChild(document.createElement("td"));h=create_userItem("tag",m,n,e[39]);null!=h&&b.cells[t].appendChild(h);t++;h=document.createElement("td");b.appendChild(h);h=document.createElement("span");h.textContent=
r;b.cells[t].appendChild(h);t++;b.appendChild(document.createElement("td"));r=document.createElement("span");r.setAttribute("class","badge bg-gray-active");r.textContent=n;b.cells[t].appendChild(r);t++;r="("+e[7]+","+e[8]+","+e[9]+")";b.appendChild(document.createElement("td"));h=document.createElement("span");h.setAttribute("id",c+"_"+n+"_POS");h.innerHTML=r;b.cells[t].appendChild(h);t++;1==GL_CONFIG_SHOW_GPS_INFO&&(b.appendChild(document.createElement("td")),r="\u7d93\u7def\u5ea6("+e[24]+","+e[25]+
")",h=document.createElement("span"),h.setAttribute("id",c+"_"+n+"_GPS"),h.innerHTML=r,b.cells[t].appendChild(h),r=parseInt(e[25]),h=parseInt(e[24]),0!=r&&0!=h&&(r=document.createElement("a"),r.setAttribute("href","javascript:;"),r.setAttribute("onclick","open_gmap("+e[25]+","+e[24]+");return false;"),h=document.createElement("i"),h.setAttribute("class","fa fa-map-marker"),r.appendChild(h),b.cells[t].appendChild(r)),t++);b.appendChild(document.createElement("td"));r=get_maplayer_name(k);edit_node_info?
(d=document.createElement("div"),d.setAttribute("class","btn-group"),a=document.createElement("button"),a.setAttribute("type","button"),a.setAttribute("class","btn btn-block btn-primary btn-xs dropdown-toggle"),a.setAttribute("data-toggle","dropdown"),a.setAttribute("id","dropdown_cur_maplayer_"+n),a.textContent=r,d.appendChild(a),f=document.createElement("span"),f.setAttribute("class","caret"),a.appendChild(f),a=document.createElement("ul"),a.setAttribute("class","dropdown-menu"),a.setAttribute("id",
"dropdown_maplayer_"+n),d.appendChild(a),add_maplayer_dropdown_list(a,c,m,n,"tag",k),b.cells[t].appendChild(d)):(k=document.createElement("span"),k.setAttribute("id",c+"_"+n+"_MAPLAYER"),k.setAttribute("class","label label-primary"),k.textContent=r,b.cells[t].appendChild(k));t++;k="";0<e[10].length&&(k+=e[10]+"v ");0<e[11].length&&(k+=e[11]+"\u00b0C ");0<e[12].length&&(k+=" V"+e[12]);0<e[21].length&&(k+=" panid:"+e[21]);0<e[27].length&&("0"==e[27]?k+=" ":"1"==e[27]?k+=" UWB":"2"==e[27]?k+=" LoRa_Ranging":
"3"==e[27]&&(k+=" GPS"));0<e[29].length&&(k+=" gwid:"+e[29]);b.appendChild(document.createElement("td"));b.cells[t].appendChild(document.createTextNode(k));k=document.createElement("button");k.setAttribute("type","button");k.setAttribute("class","btn btn-default");k.setAttribute("data-toggle","modal");k.setAttribute("data-target","#modal-qrcode");k.setAttribute("onclick",'device_qrcode_show("'+g+'","'+l+'","'+n+'");return false;');g=document.createElement("i");g.setAttribute("class","fa fa-qrcode");
k.appendChild(g);b.cells[t].appendChild(k);edit_node_info&&(g=document.createElement("button"),g.setAttribute("type","button"),g.setAttribute("class","btn btn-default"),g.setAttribute("onclick",'delete_node_dialog("'+n+'","'+p.toLowerCase()+'","'+l+'");return false;'),l=document.createElement("i"),l.setAttribute("class","fa fa-trash-o"),g.appendChild(l),b.cells[t].appendChild(g));t++;if(0<e[15].length){b.appendChild(document.createElement("td"));e=e[15].split(":");for(l=0;l<e.length;l++)p=document.createElement("span"),
p.setAttribute("class","badge bg-aqua"),p.textContent=e[l],b.cells[t].appendChild(p);t++}edit_node_info?(e=document.getElementById("loc_tab_tag_prj"),e.setAttribute("style","display:block;"),b.appendChild(document.createElement("td")),c=create_prj_dropdown(c,m,n,"tag"),b.cells[t].appendChild(c)):(e=document.getElementById("loc_tab_tag_prj"),e.setAttribute("style","display:none;"));return b}
function create_userItem(c,b,a,e){var d=findUserName(e);if(edit_node_info){var f=document.createElement("div");f.setAttribute("class","btn-group");var g=document.createElement("button");g.setAttribute("type","button");g.setAttribute("class","btn btn-block btn-primary btn-xs dropdown-toggle");g.setAttribute("data-toggle","dropdown");g.setAttribute("id","dropdown_cur_user_"+a);g.textContent=d;f.appendChild(g);d=document.createElement("span");d.setAttribute("class","caret");g.appendChild(d);d=document.createElement("ul");
d.setAttribute("class","dropdown-menu");d.setAttribute("id","dropdown_user_"+a);f.appendChild(d);add_user_dropdown_list(d,c,b,a,e);return f}return 0<d.length?(c=document.createElement("span"),c.setAttribute("style","display:inline;padding:.2em .3em .3em;font-size:95%;font-weight:700;line-height:1;position:relative;top:-1px;color:#fff;border-radius:2px;white-space:nowrap;background-color:rgb(54, 127, 169);"),c.textContent=d,c):null}
function create_table_coordinator_item(c,b,a,e){var d=e[0],f=e[1],g=e[3],m=e[5],h=e[6],l=get_node_type(e[2]),n=e[26],p=e[29];b=document.createElement("tr");b.setAttribute("id",h+"_TABLE_ROW");"0"===f?b.setAttribute("bgcolor","#a3c2c2"):b.setAttribute("bgcolor","#FFFFFF");var k=0;b.appendChild(document.createElement("td"));b.cells[k].appendChild(document.createTextNode(""+a));k++;b.appendChild(document.createElement("td"));"0"!=f&&(a=document.createElement("span"),a.setAttribute("class","badge bg-fuchsia"),
a.textContent=f,b.cells[k].appendChild(a));k++;a=e[20];b.appendChild(document.createElement("td"));"0"!=a&&(f=document.createElement("span"),f.setAttribute("class","badge bg-fuchsia"),f.textContent=a,b.cells[k].appendChild(f));k++;b.appendChild(document.createElement("td"));a=document.createElement("span");a.setAttribute("id",c+"_"+h+"_NODNAME");a.setAttribute("class","badge bg-yellow-active");a.textContent=m;b.cells[k].appendChild(a);edit_node_info&&(a=document.createElement("a"),a.setAttribute("id",
c+"_"+h+"_NODNAME_EDIT"),a.setAttribute("href","javascript:;"),a.setAttribute("onclick",'edit_node_name("'+h+'","'+l.toLowerCase()+'","'+m+'");return false;'),f=document.createElement("i"),f.setAttribute("class","fa fa-edit"),a.appendChild(f),b.cells[k].appendChild(a));k++;b.appendChild(document.createElement("td"));a=document.createElement("span");a.setAttribute("class","badge bg-red-active");a.textContent=l;b.cells[k].appendChild(a);a=document.createElement("span");a.setAttribute("class","badge bg-purple-active");
"-1"==d&&a.setAttribute("class","badge bg-maroon-active");a.textContent=d;b.cells[k].appendChild(a);k++;d=document.createElement("td");b.appendChild(d);d=document.createElement("span");d.textContent=p;b.cells[k].appendChild(d);k++;b.appendChild(document.createElement("td"));p=document.createElement("span");p.setAttribute("class","badge bg-gray-active");p.textContent=h;b.cells[k].appendChild(p);k++;p="("+e[7]+","+e[8]+","+e[9]+")";b.appendChild(document.createElement("td"));d=document.createElement("span");
d.setAttribute("id",c+"_"+h+"_POS");d.innerHTML=p;b.cells[k].appendChild(d);edit_node_info&&(a=document.createElement("a"),a.setAttribute("id",c+"_"+h+"_LINK"),a.setAttribute("href","javascript:;"),a.setAttribute("onclick",'edit_node_position("coord","'+h+'","'+e[7]+'","'+e[8]+'","'+e[9]+'");return false;'),f=document.createElement("i"),f.setAttribute("class","fa fa-edit"),a.appendChild(f),b.cells[k].appendChild(a));k++;b.appendChild(document.createElement("td"));d=get_maplayer_name(n);edit_node_info?
(p=document.createElement("div"),p.setAttribute("class","btn-group"),a=document.createElement("button"),a.setAttribute("type","button"),a.setAttribute("class","btn btn-block btn-primary btn-xs dropdown-toggle"),a.setAttribute("data-toggle","dropdown"),a.setAttribute("id","dropdown_cur_maplayer_"+h),a.textContent=d,p.appendChild(a),d=document.createElement("span"),d.setAttribute("class","caret"),a.appendChild(d),d=document.createElement("ul"),d.setAttribute("class","dropdown-menu"),d.setAttribute("id",
"dropdown_maplayer_"+h),p.appendChild(d),add_maplayer_dropdown_list(d,c,g,h,"coord",n),b.cells[k].appendChild(p)):(n=document.createElement("span"),n.setAttribute("id",c+"_"+h+"_MAPLAYER"),n.setAttribute("class","label label-primary"),n.textContent=d,b.cells[k].appendChild(n));k++;n="";0<e[10].length&&(n+=e[10]+"v ");0<e[11].length&&(n+=e[11]+"\u00b0C ");0<e[12].length&&(n+=" V"+e[12]);b.appendChild(document.createElement("td"));b.cells[k].appendChild(document.createTextNode(n));edit_node_info&&(n=
document.createElement("button"),n.setAttribute("type","button"),n.setAttribute("class","btn btn-default"),n.setAttribute("onclick",'delete_node_dialog("'+h+'","'+l.toLowerCase()+'","'+m+'");return false;'),p=document.createElement("i"),p.setAttribute("class","fa fa-trash-o"),n.appendChild(p),b.cells[k].appendChild(n));k++;b.appendChild(document.createElement("td"));0<e[16].length&&(n=document.createElement("span"),n.textContent=e[16],b.cells[k].appendChild(n));k++;b.appendChild(document.createElement("td"));
n="";0<e[17].length&&(n+=e[17]);0<e[19].length&&(n=n+" PANID:"+e[19]);p=document.createElement("span");p.textContent=n;b.cells[k].appendChild(p);k++;b.appendChild(document.createElement("td"));0<e[21].length&&(n=document.createElement("span"),p=parseFloat(e[21]),n.textContent=msToDuration(p),b.cells[k].appendChild(n));k++;b.appendChild(document.createElement("td"));n=document.createElement("span");n.setAttribute("id",c+"_"+h+"_BLACKLIST");n.textContent=e[22];b.cells[k].appendChild(n);edit_node_info&&
(a=document.createElement("a"),a.setAttribute("id",c+"_"+h+"_BLACKLIST_EDIT"),a.setAttribute("href","javascript:;"),a.setAttribute("onclick",'edit_node_blacklist("'+h+'","'+l.toLowerCase()+'","'+e[22]+'");return false;'),f=document.createElement("i"),f.setAttribute("class","fa fa-edit"),a.appendChild(f),b.cells[k].appendChild(a));k++;b.appendChild(document.createElement("td"));p=document.createElement("span");n.setAttribute("id",c+"_"+h+"_WHITELIST");p.textContent=e[23];b.cells[k].appendChild(p);
edit_node_info&&(a=document.createElement("a"),a.setAttribute("id",c+"_"+h+"_WHITELIST_EDIT"),a.setAttribute("href","javascript:;"),a.setAttribute("onclick",'edit_node_whitelist("'+h+'","'+l.toLowerCase()+'","'+e[23]+'");return false;'),f=document.createElement("i"),f.setAttribute("class","fa fa-edit"),a.appendChild(f),b.cells[k].appendChild(a));k++;b.appendChild(document.createElement("td"));n=document.createElement("span");n.setAttribute("class","label label-warning");n.textContent=e[24];b.cells[k].appendChild(n);
edit_node_info&&(a=document.createElement("a"),a.setAttribute("href","javascript:;"),a.setAttribute("onclick",'edit_node_joinRangingRange("'+h+'","'+l.toLowerCase()+'","'+e[24]+'");return false;'),f=document.createElement("i"),f.setAttribute("class","fa fa-edit"),a.appendChild(f),b.cells[k].appendChild(a));k++;b.appendChild(document.createElement("td"));n=document.createElement("span");n.setAttribute("class","label label-warning");n.textContent=e[25];b.cells[k].appendChild(n);edit_node_info&&(a=document.createElement("a"),
a.setAttribute("href","javascript:;"),a.setAttribute("onclick",'edit_node_joinNotRangingRange("'+h+'","'+l.toLowerCase()+'","'+e[25]+'");return false;'),f=document.createElement("i"),f.setAttribute("class","fa fa-edit"),a.appendChild(f),b.cells[k].appendChild(a));k++;b.appendChild(document.createElement("td"));e=document.createElement("div");e.setAttribute("class","btn-group");b.cells[k].appendChild(e);l=document.createElement("button");l.setAttribute("class","btn btn-block btn-danger btn-xs");l.setAttribute("onclick",
'reset_m4_dialog("'+h+'","'+m+'");return false;');l.textContent="Reset M4";e.appendChild(l);l=document.createElement("button");l.setAttribute("class","btn btn-block btn-danger btn-xs");l.setAttribute("onclick",'reset_m0_dialog("'+h+'","'+m+'");return false;');l.textContent="Reset M0";e.appendChild(l);k++;edit_node_info?(m=document.getElementById("loc_tab_coord_prj"),m.setAttribute("style","display:block;"),b.appendChild(document.createElement("td")),c=create_prj_dropdown(c,g,h,"coord"),b.cells[k].appendChild(c)):
(m=document.getElementById("loc_tab_coord_prj"),m.setAttribute("style","display:none;"));return b}
function create_table_locator_item(c,b,a,e){var d=e[0],f=e[1],g=e[2],m=e[3],h=e[5],l=e[6],n=get_node_type(g),p=e[26],k=e[31],r=e[33],t=e[34],w=e[35],u="",q=l[1];"7"==q&&(u=e[30]);b=document.createElement("tr");b.setAttribute("id",l+"_TABLE_ROW");"0"===f?b.setAttribute("bgcolor","#a3c2c2"):b.setAttribute("bgcolor","#FFFFFF");var v=0;b.appendChild(document.createElement("td"));b.cells[v].appendChild(document.createTextNode(""+a));v++;b.appendChild(document.createElement("td"));"0"!=f&&(q=document.createElement("span"),
q.setAttribute("class","badge bg-fuchsia"),q.textContent=f,b.cells[v].appendChild(q));v++;b.appendChild(document.createElement("td"));q=document.createElement("span");q.setAttribute("id",c+"_"+l+"_NODNAME");q.setAttribute("class","badge bg-yellow-active");q.textContent=h;b.cells[v].appendChild(q);edit_node_info&&(q=document.createElement("a"),q.setAttribute("id",c+"_"+l+"_NODNAME_EDIT"),q.setAttribute("href","javascript:;"),q.setAttribute("onclick",'edit_node_name("'+l+'","'+n.toLowerCase()+'","'+
h+'");return false;'),a=document.createElement("i"),a.setAttribute("class","fa fa-edit"),q.appendChild(a),b.cells[v].appendChild(q));v++;b.appendChild(document.createElement("td"));q=document.createElement("span");q.setAttribute("class","badge bg-yellow-active");q.textContent=n;b.cells[v].appendChild(q);q=document.createElement("span");q.setAttribute("class","badge bg-purple-active");"-1"==d&&q.setAttribute("class","badge bg-maroon-active");q.textContent=d;b.cells[v].appendChild(q);v++;q=e[4];f=get_buttontype_name(q);
b.appendChild(document.createElement("td"));edit_node_info?(d=document.createElement("div"),d.setAttribute("class","btn-group"),a=document.createElement("button"),a.setAttribute("type","button"),a.setAttribute("class","btn btn-block btn-primary btn-xs dropdown-toggle"),a.setAttribute("data-toggle","dropdown"),a.setAttribute("id","dropdown_cur_buttontype_"+l),a.textContent=f,d.appendChild(a),f=document.createElement("span"),f.setAttribute("class","caret"),a.appendChild(f),a=document.createElement("ul"),
a.setAttribute("class","dropdown-menu"),a.setAttribute("id","dropdown_buttontype_"+l),d.appendChild(a),add_buttontype_dropdown_list(a,c,m,l,"locator",q),b.cells[v].appendChild(d)):0<f.length&&(d=document.createElement("span"),"0"===q?d.setAttribute("style","display:inline;padding:.2em .3em .3em;font-size:95%;font-weight:700;line-height:1;position:relative;top:-1px;color:#fff;border-radius:2px;white-space:nowrap;background-color:rgb(204, 51, 153);"):"1"===q?d.setAttribute("style","display:inline;padding:.2em .3em .3em;font-size:95%;font-weight:700;line-height:1;position:relative;top:-1px;color:#fff;border-radius:2px;white-space:nowrap;background-color:rgb(119, 179, 0);"):
"2"===q?d.setAttribute("style","display:inline;padding:.2em .3em .3em;font-size:95%;font-weight:700;line-height:1;position:relative;top:-1px;color:#fff;border-radius:2px;white-space:nowrap;background-color:rgb(91, 160, 218);"):"3"===q?d.setAttribute("style","display:inline;padding:.2em .3em .3em;font-size:95%;font-weight:700;line-height:1;position:relative;top:-1px;color:#fff;border-radius:2px;white-space:nowrap;background-color:rgb(35, 91, 210);"):"4"===q&&d.setAttribute("style","display:inline;padding:.2em .3em .3em;font-size:95%;font-weight:700;line-height:1;position:relative;top:-1px;color:#fff;border-radius:2px;white-space:nowrap;background-color:rgb(85, 101, 30);"),
d.textContent=f,b.cells[v].appendChild(d));v++;b.appendChild(document.createElement("td"));q=create_userItem("locator",m,l,e[32]);null!=q&&b.cells[v].appendChild(q);v++;q=document.createElement("td");b.appendChild(q);q=document.createElement("span");q.textContent=w;b.cells[v].appendChild(q);v++;b.appendChild(document.createElement("td"));d=document.createElement("span");d.setAttribute("class","badge bg-gray-active");d.textContent=l;b.cells[v].appendChild(d);v++;b.appendChild(document.createElement("td"));
d=document.createElement("span");d.setAttribute("id",c+"_"+l+"_LORAMACADDRESS");d.setAttribute("class","badge bg-gray-active");d.textContent=e[22];b.cells[v].appendChild(d);edit_node_info&&(q=document.createElement("a"),q.setAttribute("id",c+"_"+l+"_LORAMACADDRESS_EDIT"),q.setAttribute("href","javascript:;"),q.setAttribute("onclick",'edit_LoRA_macaddress("'+l+'","'+n.toLowerCase()+'","'+e[22]+'");return false;'),a=document.createElement("i"),a.setAttribute("class","fa fa-edit"),q.appendChild(a),b.cells[v].appendChild(q));
v++;w="("+e[7]+","+e[8]+","+e[9]+")";b.appendChild(document.createElement("td"));q=document.createElement("span");q.setAttribute("id",c+"_"+l+"_POS");q.innerHTML=w;b.cells[v].appendChild(q);edit_node_info&&(q=document.createElement("a"),q.setAttribute("id",c+"_"+l+"_LINK"),q.setAttribute("href","javascript:;"),q.setAttribute("onclick",'edit_node_position("locator","'+l+'","'+e[7]+'","'+e[8]+'","'+e[9]+'");return false;'),a=document.createElement("i"),a.setAttribute("class","fa fa-edit"),q.appendChild(a),
b.cells[v].appendChild(q));v++;b.appendChild(document.createElement("td"));edit_node_info?(w=document.createElement("div"),b.cells[v].appendChild(w),q=document.createElement("input"),q.setAttribute("id",c+"_"+l+"_SensorAlert"),q.setAttribute("type","checkbox"),q.setAttribute("onclick",'checkbox_locator_SensorAlert_click("'+l+'");return true;'),1==k&&(q.checked=!0),k=document.createElement("label"),k.setAttribute("for",c+"_"+l+"_SensorAlert"),k.textContent="\u555f\u7528\u5165\u4fb5\u8b66\u793a",w.appendChild(q),
w.appendChild(k)):(w=document.createElement("span"),w.setAttribute("id",c+"_"+l+"_SensorAlert"),b.cells[v].appendChild(w),1==k?(w.textContent="ON",w.setAttribute("class","badge bg-green")):(w.textContent="OFF",w.setAttribute("class","badge bg-red")));v++;b.appendChild(document.createElement("td"));k=get_maplayer_name(p);edit_node_info?(d=document.createElement("div"),d.setAttribute("class","btn-group"),a=document.createElement("button"),a.setAttribute("type","button"),a.setAttribute("class","btn btn-block btn-primary btn-xs dropdown-toggle"),
a.setAttribute("data-toggle","dropdown"),a.setAttribute("id","dropdown_cur_maplayer_"+l),a.textContent=k,d.appendChild(a),f=document.createElement("span"),f.setAttribute("class","caret"),a.appendChild(f),a=document.createElement("ul"),a.setAttribute("class","dropdown-menu"),a.setAttribute("id","dropdown_maplayer_"+l),d.appendChild(a),add_maplayer_dropdown_list(a,c,m,l,"locator",p),b.cells[v].appendChild(d)):(p=document.createElement("span"),p.setAttribute("id",c+"_"+l+"_MAPLAYER"),p.setAttribute("class",
"label label-primary"),p.textContent=k,b.cells[v].appendChild(p));v++;b.appendChild(document.createElement("td"));w="";q=e[12];p=e[19];k=e[25];0<e[10].length&&(w+=e[10]+"v ");0<e[11].length&&(w+=e[11]+"\u00b0C ");0<q.length&&(w+=" V"+q);0<p.length&&(w+=" panid:"+p);0<k.length&&(w+=" mode:"+k);0<e[23].length&&(w+=" gwid:"+e[23]);0<u.length&&(w+=" "+u);w+=" ";1<r.length&&1<t.length&&(w+=" \u7d93\u7def\u5ea6("+r+","+t+")");b.cells[v].appendChild(document.createTextNode(w));e=parseInt(t);u=parseInt(r);
0!=e&&0!=u&&(e=document.createElement("button"),u=document.createElement("a"),u.setAttribute("href","javascript:;"),u.setAttribute("onclick","open_gmap("+t+","+r+");return false;"),r=document.createElement("i"),r.setAttribute("class","fa fa-map-marker"),u.appendChild(r),e.appendChild(u),b.cells[v].appendChild(e));e=document.createElement("button");e.setAttribute("type","button");e.setAttribute("title","Show QR Code");e.setAttribute("class","btn btn-default");e.setAttribute("data-toggle","modal");
e.setAttribute("data-target","#modal-qrcode");e.setAttribute("onclick",'device_qrcode_show("'+g+'","'+h+'","'+l+'");return false;');r=document.createElement("i");r.setAttribute("class","fa fa-qrcode");r.setAttribute("title","Show QR Code");e.appendChild(r);b.cells[v].appendChild(e);r=document.createElement("button");r.setAttribute("type","button");r.setAttribute("title","AT Command");r.setAttribute("class","btn btn-default");r.setAttribute("data-toggle","modal");r.setAttribute("data-target","#modal-atcommand");
r.setAttribute("onclick",'device_atcommand_show("'+g+'","'+h+'","'+l+'","'+q+'","'+p+'","'+k+'");return false;');g=document.createElement("i");g.setAttribute("class","fa fa-terminal");g.setAttribute("title","AT Command");r.appendChild(g);b.cells[v].appendChild(r);edit_node_info&&(-1!==m.indexOf("AOA")&&(g=document.createElement("button"),g.setAttribute("type","button"),g.setAttribute("class","btn btn-default"),g.setAttribute("onclick",'set_aoa_normal_vector("'+l+'","'+n.toLowerCase()+'","'+h+'");return false;'),
r=document.createElement("i"),r.setAttribute("class","fa fa-long-arrow-up"),g.appendChild(r),b.cells[v].appendChild(g)),g=document.createElement("button"),g.setAttribute("type","button"),g.setAttribute("class","btn btn-default"),g.setAttribute("onclick",'delete_node_dialog("'+l+'","'+n.toLowerCase()+'","'+h+'");return false;'),h=document.createElement("i"),h.setAttribute("class","fa fa-trash-o"),g.appendChild(h),b.cells[v].appendChild(g));v++;edit_node_info?(h=document.getElementById("loc_tab_locator_prj"),
h.setAttribute("style","display:block;"),b.appendChild(document.createElement("td")),c=create_prj_dropdown(c,m,l,"locator"),b.cells[v].appendChild(c)):(h=document.getElementById("loc_tab_locator_prj"),h.setAttribute("style","display:none;"));return b}function get_node_type(c){var b="";"0"==c?b="ANCHOR":"1"==c?b="TAG":"2"==c?b="COORD":"3"==c&&(b="LOCATOR");return b}
function get_role_name(c){var b="\u672a\u8a2d\u5b9a";"0"==c?b="\u4eba\u54e1\u8a2a\u5ba2":"1"==c?b="\u5de1\u6aa2\u54e1":"2"==c?b="\u8a2d\u5099":"3"==c?b="VIP\u8cb4\u8cd3":"4"==c?b="\u5de5\u4f5c\u4eba\u54e1":"5"==c?b="\u91ab\u5e2b":"6"==c&&(b="\u8b77\u7406\u5e2b");return b}
function get_buttontype_name(c){var b="\u7dca\u6025\u6309\u9215";"0"==c?b="\u7dca\u6025\u6309\u9215":"1"==c?b="\u547c\u559a\u9215":"2"==c?b="\u958b\u95dc\u88dd\u7f6e":"3"==c?b="\u8a0a\u865f\u63a1\u96c6\u5668":"4"==c&&(b="\u5de1\u6aa2\u5668");return b}function get_maplayer_name(c){for(var b="",a=0;a<glMapLayerList.length;a++){var e=glMapLayerList[a];if(e.layerid==c){b=e.layer_name;break}}0==b.length&&(e=glMapLayerList[0],b=e.layer_name);return b}
function add_node_to_table(c,b,a,e){for(var d=0,f=a.length,g=0;g<f;g++)for(var m=0;m<a.length;m++)if(parseInt(a[m][0])==g){var h=create_LOC_table_item(b,m,e,a[m]);c.appendChild(h);a.splice(m,1);m--;e++;d++}for(m=0;m<a.length;m++,e++)h=create_LOC_table_item(b,m,e,a[m]),c.appendChild(h),d++;return d}function hasWhiteSpace(c){return 0<=c.indexOf(" ")}function alphanumeric(c){return/^[0-9a-zA-Z]+$/.test(c)?!0:!1}
function edit_node_id(c,b,a){if(a=prompt("Edit Node ID:(alphanumeric characters only)",a))hasWhiteSpace(a)?alert("Whitespace is not allowed for Node ID."):alphanumeric(a)?0==a.length?alert("Node id is not valid."):(document.getElementById("LOC_"+c+"_NODID").innerText=a,update_node_info(c,b,a,"","","","","","","","","")):alert("Please input alphanumeric characters only")}
function edit_taf_id(c,b,a){if(a=prompt("Edit Node TAF ID:(100 ~ 200)",a))hasWhiteSpace(a)?alert("Whitespace is not allowed for TAF ID."):alphanumeric(a)?0==a.length?alert("TAF id is not valid."):(document.getElementById("LOC_"+c+"_TAFID").innerText=a,update_node_info(c,b,"",a,"","","","","","","","")):alert("Please input alphanumeric characters only")}
function edit_node_name(c,b,a){if(a=prompt("Edit Node name:(Human readable name)",a))document.getElementById("LOC_"+c+"_NODNAME").innerText=a,update_node_info(c,b,"","","","",a,"","","","","")}function edit_LoRA_macaddress(c,b,a){if(a=prompt("Edit LoRA macaddress:",a))document.getElementById("LOC_"+c+"_LORAMACADDRESS").innerText=a,update_node_info(c,b,"","","","","","","","",a,"")}
function edit_node_buildingid(c,b,a){if(a=prompt("Edit Building ID:",a)){document.getElementById("LOC_"+c+"_BUILDINGID").innerText=a;var e=document.getElementById("LOC_"+c+"_BUILDINGFLOOR").innerText;update_node_info(c,b,"","",a,e,"","","","","","")}}
function edit_node_buildingfloor(c,b,a){if(a=prompt("Edit Building Floor:",a)){document.getElementById("LOC_"+c+"_BUILDINGFLOOR").innerText=a;var e=document.getElementById("LOC_"+c+"_BUILDINGID").innerText;update_node_info(c,b,"","",e,a,"","","","","","")}}function edit_node_blacklist(c,b,a){b=prompt("Edit black list:",a);null!=b&&update_node_blacklist(c,b)}function edit_node_whitelist(c,b,a){b=prompt("Edit white list:",a);null!=b&&update_node_whitelist(c,b)}
function edit_node_joinRangingRange(c,b,a){b=prompt("Edit join Ranging Range:",a);null!=b&&update_node_joinRangingRange(c,b)}function edit_node_joinNotRangingRange(c,b,a){b=prompt("Edit join Not Ranging Range:",a);null!=b&&update_node_joinNotRangingRange(c,b)}
function edit_node_position(c,b,a,e,d){if(a=prompt("Edit positin: (format: X,Y,Z)",""+a+","+e+","+d))3!=a.split(",").length?alert("Error format: need X,Y,Z"):(e=a.split(","),gl_updating_element_id=""+b,"locator"===c||"anchor"===c||"coord"===c?(d="LOC_"+gl_updating_element_id+"_LINK",document.getElementById("LOC_"+gl_updating_element_id+"_POS").innerText="("+a+")",document.getElementById(d).setAttribute("onclick",'edit_node_position("'+c+'","'+b+'","'+e[0]+'","'+e[1]+'","'+e[2]+'");return false;')):
node_info_updating(),update_node_info(b,c,"","","","","",e[0],e[1],e[2],"",""))}
function edit_role(c,b,a,e,d){if(c=prompt("Edit Role: (0:\u4eba\u54e1\u8a2a\u5ba2 1:\u5de1\u6aa2\u54e1 2:\u8a2d\u5099 3:VIP\u8cb4\u8cd3 4:\u5de5\u4f5c\u4eba\u54e1)",d))if("0"!=c&&"1"!=c&&"2"!=c&&"3"!=c&&"4"!=c)alert("Error format: need 0,1,2,3 or 4");else for(document.getElementById("LOC_"+a+"_ROLE").innerText=get_role_name(c),update_node_info(a,e,"",c,"","","","","","","",""),a=document.getElementById("dropdown_tag_"+a);a.firstChild;)a.removeChild(a.firstChild)}
function node_info_updating(){if(0!=gl_updating_element_id.length){var c="LOC_"+gl_updating_element_id+"_LINK";document.getElementById("LOC_"+gl_updating_element_id+"_POS").innerText="Updating...";document.getElementById(c).style.visibility="hidden";setTimeout(node_info_updating,1E3)}}
function update_node_info(c,b,a,e,d,f,g,m,h,l,n,p){var k={};k.project_id=""+project_id;k.EDIT_MODE=1;k.MAC=c;k.TYPE=b;0<a.length&&(k.NODEID=a);0<e.length&&(k.TAFID=e);0<d.length&&(k.BUILDINGID=d);0<f.length&&(k.BUILDINGFLOOR=f);0<g.length&&(k.NODENAME=g);0<m.length&&(k.POSX=m);0<h.length&&(k.POSY=h);0<l.length&&(k.POSZ=l);0<n.length&&(k.LORAMACADDRESS=n);0<p.length&&(k.maplayerid=p);jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:k,success:function(a){400==a.status&&alert("update Error! response = "+
JSON.stringify(a));gl_updating_element_id=""},error:function(a,b,d){alert("error = "+d);alert("xhr.responseText = "+a.responseText);gl_updating_element_id=""}});return!1}
function update_node_blacklist(c,b){var a={};a.project_id=""+project_id;0==b.length?(a.CLEAR_BLACKLIST=1,a.MAC=c):(a.UPDATE_BLACKLIST=1,a.MAC=c,a.LIST=b);jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:a,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a))},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}});return!1}
function update_node_whitelist(c,b){var a={};a.project_id=""+project_id;0==b.length?(a.CLEAR_WHITELIST=1,a.MAC=c):(a.UPDATE_WHITELIST=1,a.MAC=c,a.LIST=b);jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:a,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a))},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}});return!1}
function update_node_joinRangingRange(c,b){var a={};a.project_id=""+project_id;a.UPDATE_JOINRANGINGRANGE=1;a.MAC=c;a.RANGE=b;jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:a,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a))},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}});return!1}
function update_node_joinNotRangingRange(c,b){var a={};a.project_id=""+project_id;a.UPDATE_JOINNOTRANGINGRANGE=1;a.MAC=c;a.RANGE=b;jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:a,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a))},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}});return!1}
function update_locator_buttontype(c,b,a){var e={};e.project_id=""+project_id;e.UPDATE_LOCATOR_BUTTONTYPE=1;e.MAC=c;e.TYPE=b;e.BUTTONTYPE=a;jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:e,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a))},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}});return!1}
function update_locator_SensorAlert(c,b){var a={};a.project_id=""+project_id;a.UPDATE_LOCATOR_SENSORALERT=1;a.MAC=c;a.TYPE="locator";a.SENSORALERT=b?1:0;jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:a,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a))},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}});return!1}
function update_node_prj(c,b,a,e){c={};c.project_id=""+project_id;c.UPDATE_NODE_PEROJECT=1;c.MAC=b;c.TYPE=a;c.target_projectid=e;jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:c,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a))},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}});return!1}
function update_node_user(c,b,a){var e={};e.project_id=""+project_id;e.UPDATE_NODE_USER=1;e.MAC=c;e.TYPE=b;e.userid=a;jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:e,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a))},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}});return!1}function delete_node_dialog(c,b,a){confirm("Are you sure you want to delete this node "+b+":"+a+" ?")&&delete_node(c,b)}
function delete_node(c,b){var a={};a.project_id=""+project_id;a.DELETE_NODE=1;a.MAC=c;a.TYPE=b;stop_update_locator_info=stop_update_tag_info=!1;jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:a,success:function(a){400==a.status?alert("DELETE Error! response = "+JSON.stringify(a)):(a=document.getElementById(c+"_TABLE_ROW"),a.parentNode.removeChild(a))},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}});return!1}
function delete_gateway_dialog(c){confirm("Are you sure you want to delete this gatewayid:"+c+" ?")&&delete_gateway(c)}
function delete_gateway(c){var b={};b.project_id=""+project_id;b.DELETE_GATEWAY=1;b.ID=c;jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:b,success:function(a){400==a.status?alert("DELETE Error! response = "+JSON.stringify(a)):(a=document.getElementById(c+"_TABLE_ROW"),a.parentNode.removeChild(a))},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}});return!1}
function delete_all_offline_device(c){var b={};b.project_id=""+project_id;b.DELETE_ALL_OFFLINE_DEVICE=1;b.TYPE=c;stop_update_locator_info=stop_update_tag_info=!1;jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:b,success:function(a){400==a.status?alert("DELETE Error! response = "+JSON.stringify(a)):("tag"===c&&(clear_tag_table(),gl_tag_load_index=gl_tag_num=0),"anchor"===c&&(clear_anchor_table(),gl_anchor_load_index=gl_anchor_num=0),"coord"===c&&(clear_coord_table(),gl_coord_load_index=
gl_coord_num=0),"locator"===c&&(clear_locator_table(),locator_num=gl_locator_load_index=0))},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}});return!1}function set_aoa_normal_vector(c,b,a){a=prompt("\u8a2d\u5b9a AOA \u6cd5\u7dda\u5ea7\u6a19\u9ede(X,Y,Z)\u8207\u50be\u5074\u89d2\u5ea6(Roll angle):","0,0,0,0");null!=a&&(a=a.split(","),4!=a.length?alert("Error format: need X,Y,Z,Roll angle"):update_aoa_normal_vector(c,b,a[0],a[1],a[2],a[3]))}
function update_aoa_normal_vector(c,b,a,e,d,f){b={};b.project_id=""+project_id;b.update_aoa_normal_vector=1;b.MAC=c;b.POSX=a;b.POSY=e;b.POSZ=d;b.ROLL=f;jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:b,success:function(a){},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}});return!1}$("#toggleeditnodebtn").click(function(){edit_node_info=edit_node_info?!1:!0;return!1});
$("#createnewlocatorbutton").click(function(){var c=prompt("New Locator UWB MAC Address: (format:053000000000xxxx)","053000000000xxxx");if(c){if(16!=c.length||!isANumber(c)){alert("Error format: need 053000000000xxxx");return}var b=c.substring(12);update_node_info(c,"locator","Locator"+b,"0","1","1","Locator"+b,"0","0","0","000000000005"+b,"")}return!1});function reset_m4_dialog(c,b){confirm("Are you sure you want to reset M4 of this device:"+b+" ?")&&reset_m4(c)}
function reset_m4(c){var b={};b.project_id=""+project_id;b.RESET_M4=1;b.MAC=c;jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:b,success:function(a){400==a.status&&alert("DELETE Error! response = "+JSON.stringify(a))},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}});return!1}function reset_m0_dialog(c,b){confirm("Are you sure you want to reset M0 of this device:"+b+" ?")&&reset_m0(c)}
function reset_m0(c){var b={};b.project_id=""+project_id;b.RESET_M0=1;b.MAC=c;jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:b,success:function(a){400==a.status&&alert("DELETE Error! response = "+JSON.stringify(a))},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}});return!1}var glDropdown_checkbox_filter_click=!1;
function dropdown_filter_click(c){var b=document.getElementById("dropdown_checkbox_filter_"+c).checked;glDropdown_checkbox_filter_click||(document.getElementById("dropdown_checkbox_filter_"+c).checked=!b,b=document.getElementById("dropdown_checkbox_filter_"+c).checked);"show_online"===c?gl_showfilter_showonline=b:"show_offline"===c&&(gl_showfilter_showoffline=b);glDropdown_checkbox_filter_click=!1}function dropdown_checkbox_filter_click(c){glDropdown_checkbox_filter_click=!0}
function msToDuration(c){var b=moment.duration(c,"milliseconds");c=parseInt(b.asDays());var a=parseInt(b.asHours()),e=parseInt(b.asMinutes()),b=parseInt(b.asSeconds()),d=24*c,a=a-d,d=60*(d+a),e=e-d,b=b-60*(d+e),d="";0<c&&(d+=c+"\u5929");0<a&&(d+=a+"\u5c0f\u6642");0<e&&(d+=e+"\u5206");0<b&&(d+=b+"\u79d2");return d}function pad(c){return("0"+c).slice(-2)}
function hhmmss(c){var b=Math.floor(c/60);c%=60;var a=Math.floor(b/60),b=b%60,e=Math.floor(a/24),a=a%24,d=Math.floor(e/30),e=e%30;return"00/"+pad(d)+"/"+pad(e)+" "+pad(a)+":"+pad(b)+":"+pad(c)}function convertPrettyTime(c){var b=moment(c,"MM/dd HH:mm:ss"),a=b.day(),e=b.hour(),d=b.minutes(),f=b.seconds();console.log("inDate:"+c+", cur_date:"+b);c="";0<a&&(c+=a+"\u5929");0<e&&(c+=e+"\u5c0f\u6642");0<d&&(c+=d+"\u5206");0<f&&(c+=f+"\u79d2");return c}
function add_user_dropdown_list(c,b,a,e,d){var f=create_dropdown_user_item("-1","\u4e0d\u6307\u5b9a",!1,b,a,e);c.appendChild(f);for(var g=0;g<gl_user_info.length;g++)f=!1,gl_user_info[g].userid==d&&(f=!0),f=create_dropdown_user_item(gl_user_info[g].userid,gl_user_info[g].name,f,b,a,e),c.appendChild(f)}
function create_dropdown_user_item(c,b,a,e,d,f){var g=document.createElement("li"),m=document.createElement("a");m.setAttribute("class","small");m.setAttribute("tabIndex","-1");m.setAttribute("data-value",c);m.setAttribute("href","javascript:;");m.setAttribute("onclick",'dropdown_user_click("'+e+'", "'+d+'", "'+f+'", "'+c+'");return true;');var h=document.createElement("input");h.setAttribute("type","checkbox");h.setAttribute("id","dropdown_checkbox_user_"+c);h.setAttribute("onclick",'dropdown_checkbox_user_click("'+
e+'", "'+d+'", "'+f+'", "'+c+'");return true;');h.checked=a;m.appendChild(h);m.appendChild(document.createTextNode(" "+b));g.appendChild(m);return g}var glDropdown_checkbox_user_click=!1;
function dropdown_user_click(c,b,a,e){console.log("dropdown_user_click() nodetype:"+c+" nodeid:"+b+" macaddress:"+a+" userid:"+e);var d="";for(b=0;b<gl_user_info.length;b++)e==gl_user_info[b].userid?(d=gl_user_info[b].name,document.getElementById("dropdown_checkbox_user_"+gl_user_info[b].userid).checked=!0):document.getElementById("dropdown_checkbox_user_"+gl_user_info[b].userid).checked=!1;"-1"==e?(console.log("dropdown_user_click() nodename_id:"+nodename_id),document.getElementById("dropdown_checkbox_user_-1").checked=
!0,document.getElementById("dropdown_cur_user_"+a).innerHTML='<span class="caret"></span>'):document.getElementById("dropdown_cur_user_"+a).innerHTML=d+'<span class="caret"></span>';console.log("dropdown_user_click() macaddress:"+a+" nodetype:"+c+" -> userid:"+e);update_node_user(a,c,e);glDropdown_checkbox_user_click=!1}function dropdown_checkbox_user_click(c,b,a,e,d){glDropdown_checkbox_user_click=!0}
function add_buttontype_dropdown_list(c,b,a,e,d,f){var g=create_dropdown_buttontype_item("0",get_buttontype_name("0"),"0"===f,b,a,e,d);c.appendChild(g);g=create_dropdown_buttontype_item("1",get_buttontype_name("1"),"1"===f,b,a,e,d);c.appendChild(g);g=create_dropdown_buttontype_item("2",get_buttontype_name("2"),"2"===f,b,a,e,d);c.appendChild(g);g=create_dropdown_buttontype_item("3",get_buttontype_name("3"),"3"===f,b,a,e,d);c.appendChild(g);b=create_dropdown_buttontype_item("4",get_buttontype_name("4"),
"4"===f,b,a,e,d);c.appendChild(b)}
function create_dropdown_buttontype_item(c,b,a,e,d,f,g){var m=document.createElement("li"),h=document.createElement("a");h.setAttribute("class","small");h.setAttribute("tabIndex","-1");h.setAttribute("data-value",c);h.setAttribute("href","javascript:;");h.setAttribute("onclick",'dropdown_buttontype_click("'+e+'", "'+d+'", "'+f+'", "'+g+'", "'+c+'");return true;');var l=document.createElement("input");l.setAttribute("type","checkbox");l.setAttribute("id","dropdown_checkbox_buttontype_"+f+"_"+c);l.setAttribute("onclick",
'dropdown_checkbox_buttontype_click("'+e+'", "'+d+'", "'+f+'", "'+g+'", "'+c+'");return true;');l.checked=a;h.appendChild(l);h.appendChild(document.createTextNode(b));m.appendChild(h);return m}var glDropdown_checkbox_buttontype_click=!1;
function dropdown_buttontype_click(c,b,a,e,d){console.log("dropdown_buttontype_click() macaddress:"+a+" type:"+e+" -> buttontype:"+d);c="";"0"===d?(c=get_buttontype_name("0"),document.getElementById("dropdown_checkbox_buttontype_"+a+"_0").checked=!0,document.getElementById("dropdown_checkbox_buttontype_"+a+"_1").checked=!1,document.getElementById("dropdown_checkbox_buttontype_"+a+"_2").checked=!1,document.getElementById("dropdown_checkbox_buttontype_"+a+"_3").checked=!1,document.getElementById("dropdown_checkbox_buttontype_"+
a+"_4").checked=!1):"1"===d?(c=get_buttontype_name("1"),document.getElementById("dropdown_checkbox_buttontype_"+a+"_0").checked=!1,document.getElementById("dropdown_checkbox_buttontype_"+a+"_1").checked=!0,document.getElementById("dropdown_checkbox_buttontype_"+a+"_2").checked=!1,document.getElementById("dropdown_checkbox_buttontype_"+a+"_3").checked=!1,document.getElementById("dropdown_checkbox_buttontype_"+a+"_4").checked=!1):"2"===d?(c=get_buttontype_name("2"),document.getElementById("dropdown_checkbox_buttontype_"+
a+"_0").checked=!1,document.getElementById("dropdown_checkbox_buttontype_"+a+"_1").checked=!1,document.getElementById("dropdown_checkbox_buttontype_"+a+"_2").checked=!0,document.getElementById("dropdown_checkbox_buttontype_"+a+"_3").checked=!1,document.getElementById("dropdown_checkbox_buttontype_"+a+"_4").checked=!1):"3"===d?(c=get_buttontype_name("3"),document.getElementById("dropdown_checkbox_buttontype_"+a+"_0").checked=!1,document.getElementById("dropdown_checkbox_buttontype_"+a+"_1").checked=
!1,document.getElementById("dropdown_checkbox_buttontype_"+a+"_2").checked=!1,document.getElementById("dropdown_checkbox_buttontype_"+a+"_3").checked=!0,document.getElementById("dropdown_checkbox_buttontype_"+a+"_4").checked=!1):"4"===d&&(c=get_buttontype_name("4"),document.getElementById("dropdown_checkbox_buttontype_"+a+"_0").checked=!1,document.getElementById("dropdown_checkbox_buttontype_"+a+"_1").checked=!1,document.getElementById("dropdown_checkbox_buttontype_"+a+"_2").checked=!1,document.getElementById("dropdown_checkbox_buttontype_"+
a+"_3").checked=!1,document.getElementById("dropdown_checkbox_buttontype_"+a+"_4").checked=!0);document.getElementById("dropdown_cur_buttontype_"+a).innerHTML=c+'<span class="caret"></span>';update_locator_buttontype(a,e,d);glDropdown_checkbox_buttontype_click=!1}function dropdown_checkbox_buttontype_click(c,b,a,e,d){glDropdown_checkbox_buttontype_click=!0}
function add_role_dropdown_list(c,b,a,e,d,f){var g=create_dropdown_role_item("0",get_role_name("0"),"0"===f,b,a,e,d);c.appendChild(g);g=create_dropdown_role_item("1",get_role_name("1"),"1"===f,b,a,e,d);c.appendChild(g);g=create_dropdown_role_item("2",get_role_name("2"),"2"===f,b,a,e,d);c.appendChild(g);g=create_dropdown_role_item("3",get_role_name("3"),"3"===f,b,a,e,d);c.appendChild(g);g=create_dropdown_role_item("4",get_role_name("4"),"4"===f,b,a,e,d);c.appendChild(g);g=create_dropdown_role_item("5",
get_role_name("5"),"5"===f,b,a,e,d);c.appendChild(g);b=create_dropdown_role_item("6",get_role_name("6"),"6"===f,b,a,e,d);c.appendChild(b)}
function create_dropdown_role_item(c,b,a,e,d,f,g){var m=document.createElement("li"),h=document.createElement("a");h.setAttribute("class","small");h.setAttribute("tabIndex","-1");h.setAttribute("data-value",c);h.setAttribute("href","javascript:;");h.setAttribute("onclick",'dropdown_role_click("'+e+'", "'+d+'", "'+f+'", "'+g+'", "'+c+'");return true;');var l=document.createElement("input");l.setAttribute("type","checkbox");l.setAttribute("id","dropdown_checkbox_role_"+f+"_"+c);l.setAttribute("onclick",
'dropdown_checkbox_role_click("'+e+'", "'+d+'", "'+f+'", "'+g+'", "'+c+'");return true;');l.checked=a;h.appendChild(l);h.appendChild(document.createTextNode(b));m.appendChild(h);return m}var glDropdown_checkbox_role_click=!1;
function dropdown_role_click(c,b,a,e,d){console.log("dropdown_role_click() macaddress:"+a+" type:"+e+" -> role_type:"+d);c=get_role_name(d);document.getElementById("dropdown_checkbox_role_"+a+"_0").checked=!1;document.getElementById("dropdown_checkbox_role_"+a+"_1").checked=!1;document.getElementById("dropdown_checkbox_role_"+a+"_2").checked=!1;document.getElementById("dropdown_checkbox_role_"+a+"_3").checked=!1;document.getElementById("dropdown_checkbox_role_"+a+"_4").checked=!1;document.getElementById("dropdown_checkbox_role_"+
a+"_5").checked=!1;document.getElementById("dropdown_checkbox_role_"+a+"_6").checked=!1;document.getElementById("dropdown_checkbox_role_"+a+"_"+d).checked=!0;document.getElementById("dropdown_cur_role_"+a).innerHTML=c+'<span class="caret"></span>';update_node_info(a,e,"",d,"","","","","","","","");glDropdown_checkbox_role_click=!1}function dropdown_checkbox_role_click(c,b,a,e,d){glDropdown_checkbox_role_click=!0}
function add_maplayer_dropdown_list(c,b,a,e,d,f){for(var g=0;g<glMapLayerList.length;g++){var m=glMapLayerList[g],m=create_dropdown_maplayer_item(m.layerid,m.layer_name,m.layerid===f,b,a,e,d);c.appendChild(m)}}
function create_dropdown_maplayer_item(c,b,a,e,d,f,g){var m=document.createElement("li"),h=document.createElement("a");h.setAttribute("class","small");h.setAttribute("tabIndex","-1");h.setAttribute("data-value",c);h.setAttribute("href","javascript:;");h.setAttribute("onclick",'dropdown_maplayer_click("'+e+'", "'+d+'", "'+f+'", "'+g+'", "'+c+'", "'+b+'");return true;');var l=document.createElement("input");l.setAttribute("type","checkbox");l.setAttribute("id","dropdown_checkbox_maplayer_"+f+"_"+c);
l.setAttribute("onclick",'dropdown_checkbox_maplayer_click("'+e+'", "'+d+'", "'+f+'", "'+g+'", "'+c+'", "'+b+'");return true;');l.checked=a;h.appendChild(l);h.appendChild(document.createTextNode(b));m.appendChild(h);return m}var glDropdown_checkbox_maplayer_click=!1;
function dropdown_maplayer_click(c,b,a,e,d,f){console.log("dropdown_maplayer_click() macaddress:"+a+" nodetype:"+e+" -> layerid:"+d);for(c=0;c<glMapLayerList.length;c++)document.getElementById("dropdown_checkbox_maplayer_"+a+"_"+glMapLayerList[c].layerid).checked=!1;document.getElementById("dropdown_checkbox_maplayer_"+a+"_"+d).checked=!0;document.getElementById("dropdown_cur_maplayer_"+a).innerHTML=f+'<span class="caret"></span>';update_node_info(a,e,"","","","","","","","","",d);glDropdown_checkbox_maplayer_click=
!1}function dropdown_checkbox_maplayer_click(c,b,a,e,d,f){glDropdown_checkbox_maplayer_click=!0}
function create_prj_dropdown(c,b,a,e){var d=document.createElement("div");d.setAttribute("class","btn-group");var f=document.createElement("button");f.setAttribute("type","button");f.setAttribute("class","btn btn-block btn-primary btn-xs dropdown-toggle");f.setAttribute("data-toggle","dropdown");f.textContent="";d.appendChild(f);var g=document.createElement("span");g.setAttribute("class","caret");f.appendChild(g);f=document.createElement("ul");f.setAttribute("class","dropdown-menu");f.setAttribute("id",
"dropdown_prj_"+a);d.appendChild(f);for(g=0;g<gl_prj_info.length;g++){var m=check_existed_in_prj(gl_prj_info[g].PROJECT_ID,b,e),m=create_dropdown_prj_item(gl_prj_info[g].PROJECT_ID,gl_prj_info[g].PROJECT_NAME,m,c,b,a,e);f.appendChild(m)}return d}
function create_dropdown_prj_item(c,b,a,e,d,f,g){var m=document.createElement("li"),h=document.createElement("a");h.setAttribute("class","small");h.setAttribute("tabIndex","-1");h.setAttribute("data-value",c);h.setAttribute("id","dropdown_label_prj_"+f+"_"+c);a?h.setAttribute("disabled","true"):(h.setAttribute("href","javascript:;"),h.setAttribute("onclick",'dropdown_prj_click("'+e+'", "'+d+'", "'+f+'", "'+g+'", "'+c+'", "'+b+'");return true;'));e=document.createElement("input");e.setAttribute("type",
"checkbox");e.setAttribute("id","dropdown_checkbox_prj_"+f+"_"+c);e.setAttribute("onclick","dropdown_checkbox_prj_click();return true;");(e.checked=a)&&e.setAttribute("disabled","true");h.appendChild(e);h.appendChild(document.createTextNode(b));m.appendChild(h);return m}var glDropdown_checkbox_prj_click=!1;
function dropdown_prj_click(c,b,a,e,d,f){c=document.getElementById("dropdown_label_prj_"+a+"_"+d);var g=document.getElementById("dropdown_checkbox_prj_"+a+"_"+d);confirm("\u8981\u5c07 "+b+" \u8907\u88fd\u81f3\u5c08\u6848 "+f+"?")?(update_node_prj(b,a,e,d),g.checked=!0,g.setAttribute("disabled","true"),c.removeAttribute("href"),c.removeAttribute("onclick")):(g.checked=!1,g.removeAttribute("disabled"));glDropdown_checkbox_prj_click=!1}
function dropdown_checkbox_prj_click(){glDropdown_checkbox_prj_click=!0}function check_existed_in_prj(c,b,a){var e=gl_tag_prj_info;"anchor"==a&&(e=gl_anchor_prj_info);"tag"==a&&(e=gl_tag_prj_info);"coord"==a&&(e=gl_coord_prj_info);"locator"==a&&(e=gl_locator_prj_info);"gateway"==a&&(e=gl_gateway_prj_info);if(void 0!=e[b])for(c=parseInt(c),a=0;a<e[b].length;a++)if(c==e[b][a])return!0;return!1}
function findUserName(c){for(var b="",a=0;a<gl_user_info.length;a++)if(c==gl_user_info[a].userid){b=gl_user_info[a].name;break}return b}
function device_qrcode_show(c,b,a){console.log("device_qrcode_show() type:"+c+" device_name:"+b+" device_macaddress:"+a);var e="TAG";"1"===c&&(e="TAG");"3"===c&&(e="LOCATOR");document.getElementById("device_qrcode_type").textContent="Type: "+e;document.getElementById("device_qrcode_name").textContent="\u540d\u7a31: "+b;document.getElementById("device_qrcode_macaddress").textContent="\u786c\u9ad4\u4f4d\u5740: "+a;jQuery.ajax({url:gl_target_server+"/php/configvils.php",type:"POST",data:"loadqrcode=1&type="+
e+"&accountid="+a+"&id="+a+"&project_id="+project_id,dataType:"text",success:function(a){a=JSON.parse(a);document.getElementById("device_qrcode_ui").setAttribute("src",a.qrcode);document.getElementById("device_qrcode_target").textContent="target: "+a.target;document.getElementById("device_qrcode_topic").textContent="topic: "+a.topic;document.getElementById("device_qrcode_datetime").textContent="\u66f4\u65b0\u6642\u9593: "+a.datetime}})}
function device_atcommand_show(c,b,a,e,d,f){console.log("device_atcommand_show() type:"+c+" device_name:"+b+" device_macaddress:"+a);document.getElementById("device_name_atcmd").textContent="name:"+b;document.getElementById("device_macaddress_atcmd").textContent=a;document.getElementById("device_version_atcmd").textContent="version:"+e;document.getElementById("device_panid_atcmd").textContent="panid:"+d;document.getElementById("device_mode_atcmd").textContent="mode:"+f}
function dropdown_atcmd_click(c){document.getElementById("inputAtcmd").value=c}
$("#sendAtcmdbtn").click(function(){var c=document.getElementById("inputAtcmd").value;if(0==c.length)alert("\u8acb\u8f38\u5165\u6307\u4ee4!");else if(0>c.indexOf("AT+"))alert("\u8acb\u8f38\u5165\u6709\u6548\u6307\u4ee4!");else{document.getElementById("sendAtcmd_sending_callout").style.display="block";document.getElementById("sendAtcmd_failed_callout").style.display="none";document.getElementById("sendAtcmd_finished_callout").style.display="none";document.getElementById("sendAtcmd_reponse_msg_callout").style.display=
"none";document.getElementById("sendAtcmd_reponse_msg_callout").innerHTML="<p></p>";device_macaddress=document.getElementById("device_macaddress_atcmd").textContent;var b={};b.project_id=""+project_id;b.sendatcmd="1";b.atcmd=c;b.macaddress=device_macaddress;document.getElementById("sendAtcmdbtn").disabled=!0;jQuery.ajax({url:gl_target_server+"/php/configvils.php",type:"POST",data:b,success:function(a){console.log("response:"+a);a=JSON.parse(a);console.log("status:"+a);glSendATcmdTimestamp=getCurrentTimeStamp();
setTimeout(wait_atcmd_finish,1,a.waitkey)},error:function(a,b,c){console.log("error = "+c);console.log("xhr.responseText = "+a.responseText);document.getElementById("sendAtcmd_sending_callout").style.display="none";document.getElementById("sendAtcmd_failed_callout").style.display="block";document.getElementById("sendAtcmd_finished_callout").style.display="none";setTimeout(close_callout,5E3,"sendAtcmd_failed_callout");document.getElementById("sendAtcmdbtn").disabled=!1}});return!1}});
function close_callout(c){document.getElementById(c).style.display="none"}
function wait_atcmd_finish(c){30<=getCurrentTimeStamp()-glSendATcmdTimestamp?(document.getElementById("sendAtcmd_reponse_msg_callout").style.display="none",document.getElementById("sendAtcmd_reponse_msg_callout").innerHTML="<p></p>",document.getElementById("sendAtcmd_failed_msg_callout").innerHTML="<p>\u767c\u51fa\u63a8\u64ad \u5931\u6557! \u7b49\u5f85\u6642\u9593\u904e\u4e45!</p>",document.getElementById("sendAtcmd_sending_callout").style.display="none",document.getElementById("sendAtcmd_failed_callout").style.display=
"block",document.getElementById("sendAtcmd_finished_callout").style.display="none",setTimeout(close_callout,1E4,"sendAtcmd_failed_callout"),document.getElementById("sendAtcmdbtn").disabled=!1):$.getJSON(gl_target_server+"/php/configvils.php","waitatcmd=1&project_id="+project_id+"&waitkey="+c,function(b){void 0==b.success?setTimeout(wait_atcmd_finish,1E3,c):"true"===b.success?(document.getElementById("sendAtcmd_reponse_msg_callout").style.display="block",document.getElementById("sendAtcmd_reponse_msg_callout").innerHTML=
"<p>"+b.msg+"</p>",document.getElementById("sendAtcmd_sending_callout").style.display="none",document.getElementById("sendAtcmd_failed_callout").style.display="none",document.getElementById("sendAtcmd_finished_callout").style.display="block",setTimeout(close_callout,5E3,"sendAtcmd_finished_callout"),document.getElementById("sendAtcmdbtn").disabled=!1):"false"===b.success?(document.getElementById("sendAtcmd_reponse_msg_callout").style.display="none",document.getElementById("sendAtcmd_reponse_msg_callout").innerHTML=
"<p></p>",document.getElementById("sendAtcmd_failed_msg_callout").innerHTML="<p>\u767c\u51fa\u63a8\u64ad \u5931\u6557! "+b.msg+"</p>",document.getElementById("sendAtcmd_sending_callout").style.display="none",document.getElementById("sendAtcmd_failed_callout").style.display="block",document.getElementById("sendAtcmd_finished_callout").style.display="none",setTimeout(close_callout,1E4,"sendAtcmd_failed_callout"),document.getElementById("sendAtcmdbtn").disabled=!1):"wait"===b.success&&(document.getElementById("sendAtcmd_reponse_msg_callout").style.display=
"block",document.getElementById("sendAtcmd_reponse_msg_callout").innerHTML="<p>"+b.msg+"</p>",setTimeout(wait_atcmd_finish,1E3,c))}).success(function(){}).error(function(){}).complete(function(){})}function checkbox_locator_SensorAlert_click(c){var b="LOC_"+c+"_SensorAlert";console.log("checkbox_locator_SensorAlert_click() macaddress:"+c+" checked:"+document.getElementById(b).checked);update_locator_SensorAlert(c,document.getElementById(b).checked)}
function verify_new_device(c,b,a,e){b=document.getElementById(b).value;if(8!=b.length)alert("\u8acb\u8f38\u5165\u6b63\u78ba\u6a5f\u5668\u9a57\u8b49\u78bc");else{var d={};d.project_id=""+project_id;d.verify_new_device=1;d.type=c;d.verifykey=b;jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:d,success:function(b){if(400==b.status)alert("update Error! response = "+JSON.stringify(b));else{b=JSON.parse(b);var c=document.getElementById(a),d=document.getElementById(e);0<b.verify_error.length?
(c.textContent=b.verify_error,d.setAttribute("style","display:none;"),c.setAttribute("style","display:block;")):0<b.verify_pass.length&&(d.textContent=b.verify_pass,d.setAttribute("style","display:block;"),c.setAttribute("style","display:none;"))}},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}})}}function isANumber(c){return!/\D/.test(c)}function getCurrentTimeStamp(){return Math.floor(Date.now()/1E3)}
function device_tab_onclick(c){console.log("device_tab_onclick() tabname:"+c);gl_activetab="activetab_"+c}function open_gmap(c,b){window.open("http://www.google.com/maps/place/"+c+","+b,"_blank").focus()}function open_dvices_page(){window.open("/index.php/vilsdevices/"+project_id,"_blank").focus()};var LOAD_PAGE_NUM=20,nfclocators_PreLoadIndex=-1,nfclocators_CurrentLoadIndex=0,LOAD_STATE_END=9999,nfclocators_glCurrentPage=1,gl_notOnLinelist_nfclocators=[],gl_OnLinelist_nfclocators=[],gl_editMode_count=0;nfclocators_loading_status();
function nfclocators_loading_status(){switch(nfclocators_CurrentLoadIndex){case 0:nfclocators_PreLoadIndex!=nfclocators_CurrentLoadIndex&&(nfclocators_PreLoadIndex=nfclocators_CurrentLoadIndex,load_nfclocator());break;case 1:nfclocators_PreLoadIndex!=nfclocators_CurrentLoadIndex&&(nfclocators_PreLoadIndex=nfclocators_CurrentLoadIndex,draw_nfclocator_table(),nfclocators_CurrentLoadIndex+=1);break;case 2:nfclocators_PreLoadIndex!=nfclocators_CurrentLoadIndex&&(nfclocators_PreLoadIndex=nfclocators_CurrentLoadIndex,
nfclocators_CurrentLoadIndex=LOAD_STATE_END)}nfclocators_CurrentLoadIndex!=LOAD_STATE_END?setTimeout(nfclocators_loading_status,100):setTimeout(reload_nfcdevice_device_info,1E4)}function reload_nfcdevice_device_info(){nfclocators_PreLoadIndex=-1;nfclocators_CurrentLoadIndex=0;nfclocators_loading_status()}
function load_nfclocator(){if("activetab_nfclocators"===gl_activetab){var c=(nfclocators_glCurrentPage-1)*LOAD_PAGE_NUM,b=LOAD_PAGE_NUM,a=gl_showfilter_showonline?1:0,e=gl_showfilter_showoffline?1:0;gl_notOnLinelist_nfclocators=[];gl_OnLinelist_nfclocators=[];$.getJSON(gl_target_server+"/php/nfclocator.php","loadnfclocator=1&s="+c+"&count="+b+"&project_id="+project_id+"&showonline="+a+"&showoffline="+e,function(a){$.each(a,function(a,b){"0"===b.alive?gl_notOnLinelist_nfclocators.push(b):gl_OnLinelist_nfclocators.push(b)})}).success(function(){nfclocators_CurrentLoadIndex+=
1}).error(function(){}).complete(function(){})}else setTimeout(load_nfclocator,1E3)}
function draw_nfclocator_table(){if(0<gl_editMode_count)console.log("draw_nfclocator_table() gl_OnLinelist_nfclocators.length:"+gl_OnLinelist_nfclocators.length+" gl_editMode_count:"+gl_editMode_count),console.log("draw_nfclocator_table() gl_notOnLinelist_nfclocators.length:"+gl_notOnLinelist_nfclocators.length+" gl_editMode_count:"+gl_editMode_count);else{for(var c=document.getElementById("LOC_NFCLOCATOR_TABLE");1<=c.rows.length;)c.deleteRow(0);var b=0;if(gl_showfilter_showonline){for(var a=0;a<
gl_OnLinelist_nfclocators.length;++a){var e=gl_OnLinelist_nfclocators[a],e=nfclocators_create_record_table_item((nfclocators_glCurrentPage-1)*LOAD_PAGE_NUM+a,e);c.appendChild(e)}b=gl_OnLinelist_nfclocators.length}if(gl_showfilter_showoffline)for(a=0;a<gl_notOnLinelist_nfclocators.length;++a)e=gl_notOnLinelist_nfclocators[a],e=nfclocators_create_record_table_item((nfclocators_glCurrentPage-1)*LOAD_PAGE_NUM+b+a,e),c.appendChild(e)}}
function nfclocators_create_record_table_item(c,b){if(null==b)return null;var a=document.createElement("tr");a.setAttribute("id",b.macaddress+"_TABLE_ROW");"0"===b.alive?a.setAttribute("bgcolor","#a3c2c2"):a.setAttribute("bgcolor","#FFFFFF");var e=0;a.appendChild(document.createElement("td"));a.cells[e].appendChild(document.createTextNode(""+(c+1)));e++;a.appendChild(document.createElement("td"));if("0"!=b.alive){var d=document.createElement("span");d.setAttribute("class","badge bg-fuchsia");d.textContent=
b.alive;a.cells[e].appendChild(d)}e++;d=document.createElement("td");d.setAttribute("id","uiid_name_"+b.macaddress);a.appendChild(d);var f=document.createElement("span");f.setAttribute("style","font-size:14px; font-weight:bold; color:#330033;");f.textContent=b.name;d.appendChild(f);e++;d=document.createElement("td");d.setAttribute("id","uiid_type_"+b.macaddress);a.appendChild(d);d=document.createElement("span");0<b.type.length&&d.setAttribute("style","font-size:14px; font-weight:bold; color:#330033;");
d.textContent=b.type;a.cells[e].appendChild(d);e++;d=document.createElement("td");a.appendChild(d);d=document.createElement("span");d.textContent=b.verifykey;a.cells[e].appendChild(d);e++;d=document.createElement("td");d.setAttribute("id","uiid_macaddress_"+b.macaddress);a.appendChild(d);d=document.createElement("span");0<b.macaddress.length&&d.setAttribute("class","label label-primary");d.textContent=b.macaddress;a.cells[e].appendChild(d);e++;d=document.createElement("td");d.setAttribute("id","uiid_LoRAMacaddress_"+
b.macaddress);a.appendChild(d);d=document.createElement("span");0<b.LoRAMacaddress.length&&d.setAttribute("class","label label-warning");d.textContent=b.LoRAMacaddress;a.cells[e].appendChild(d);e++;d=document.createElement("td");d.setAttribute("id","uiid_gwid_"+b.macaddress);a.appendChild(d);d=document.createElement("span");0<b.gwid.length&&d.setAttribute("class","label label-success");d.textContent=b.gwid;a.cells[e].appendChild(d);e++;d=document.createElement("td");d.setAttribute("id","uiid_version_"+
b.macaddress);a.appendChild(d);d=document.createElement("span");0<b.version.length&&d.setAttribute("class","label label-warning");d.textContent=b.version;a.cells[e].appendChild(d);e++;d=document.createElement("td");a.appendChild(d);d=document.createElement("button");d.setAttribute("id","uiid_editbtn_"+b.macaddress);d.setAttribute("title","Edit this device");d.setAttribute("href","javascript:;");d.setAttribute("onclick",'edit_nfclocator_device("'+b.alive+'", "'+b.macaddress+'","'+b.name+'", "'+b.type+
'", "'+b.LoRAMacaddress+'", "'+b.gwid+'");return false;');f=document.createElement("i");f.setAttribute("id","uiid_editimg_"+b.macaddress);f.setAttribute("class","fa fa-edit");d.appendChild(f);a.cells[e].appendChild(d);d=document.createElement("button");d.setAttribute("style","display:none");d.setAttribute("id","uiid_deletebtn_"+b.macaddress);d.setAttribute("title","Delete This Device");d.setAttribute("href","javascript:;");d.setAttribute("onclick",'confirm_delete_nfclocator_device("'+b.macaddress+
'", "'+b.name+'", "'+b.type+'");return false;');f=document.createElement("i");f.setAttribute("class","fa fa-user-times");d.appendChild(f);a.cells[e].appendChild(d);return a}
function edit_nfclocator_device(c,b,a,e,d,f){console.log("edit_nfclocator_device() macaddress:"+b);gl_editMode_count+=1;create_edit_ui("uiid_name",b,a);5!=groupid&&(create_edit_ui("uiid_LoRAMacaddress",b,d),create_edit_ui("uiid_gwid",b,f));a=document.getElementById("uiid_editbtn_"+b);a.setAttribute("title","Save this Device");a.setAttribute("onclick",'save_nfclocator_device("'+c+'","'+b+'","'+d+'","'+f+'");return false;');document.getElementById("uiid_editimg_"+b).setAttribute("class","fa fa-save");
document.getElementById("uiid_deletebtn_"+b).setAttribute("style","display:block")}function create_edit_ui(c,b,a){var e=clearChildView(c+"_"+b);c=create_input_text(c+"_"+b+"_edit",a);e.appendChild(c)}function clearChildView(c){c=document.getElementById(c);if(null!=c)for(;c.firstChild;)c.removeChild(c.firstChild);return c}
function save_nfclocator_device(c,b,a,e){var d=document.getElementById("uiid_name_"+b+"_edit").value;5!=groupid&&(a=document.getElementById("uiid_LoRAMacaddress_"+b+"_edit").value,e=document.getElementById("uiid_gwid_"+b+"_edit").value);update_nfclocator_device(c,b,d,a,e)}
function update_nfclocator_device(c,b,a,e,d){console.log("update_nfclocator_device() macaddress:"+b);console.log("update_nfclocator_device() value_name:"+a);if(0==a.length)alert("\u8acb\u8f38\u5165\u540d\u7a31");else if(0==b.length)alert("\u8acb\u8f38\u5165\u786c\u9ad4\u4f4d\u5740");else{gl_editMode_count=0;var f={};f.project_id=""+project_id;f.update_nfclocator=1;f.alive=c;f.macaddress=b;f.name=a;f.gwid=d;f.LoRAMacaddress=e;jQuery.ajax({url:gl_target_server+"/php/nfclocator.php",type:"POST",data:f,
success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a));setTimeout(reload_nfcdevice_device_info,300)},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}})}}function confirm_delete_nfclocator_device(c,b,a){confirm("Are you sure you want to delete this device:"+b+" "+a+"   ?")&&delete_nfclocator_device(c)}
function delete_nfclocator_device(c){var b={};b.project_id=""+project_id;b.delete_nfclocator=1;b.macaddress=c;gl_editMode_count=0;jQuery.ajax({url:gl_target_server+"/php/nfclocator.php",type:"POST",data:b,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a));setTimeout(reload_nfcdevice_device_info,300)},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}})}
function create_empty_nfclocator_record_table_item(c){if(null==document.getElementById("empty_nfclocator_record_table_item")){var b=document.getElementById("LOC_NFCLOCATOR_TABLE"),a=document.createElement("tr");a.setAttribute("id","empty_nfclocator_record_table_item");var e=0;a.appendChild(document.createElement("td"));a.cells[e].appendChild(document.createTextNode(""+c));e++;a.appendChild(document.createElement("td"));e++;a.appendChild(document.createElement("td"));a.cells[e].appendChild(create_input_text("input_name"));
e++;a.appendChild(document.createElement("td"));a.cells[e].appendChild(create_input_text("input_type"));e++;a.appendChild(document.createElement("td"));e++;a.appendChild(document.createElement("td"));a.cells[e].appendChild(create_input_text("input_macaddress"));e++;a.appendChild(document.createElement("td"));a.cells[e].appendChild(create_input_text("input_LoRAMacaddress"));e++;a.appendChild(document.createElement("td"));a.cells[e].appendChild(create_input_text("input_gwid"));e++;a.appendChild(document.createElement("td"));
c=document.createElement("button");c.setAttribute("class","btn btn-block btn-primary btn-lg");c.setAttribute("onclick","save_new_nfclocator_device();");c.textContent="\u5132\u5b58";a.cells[e].appendChild(c);b.appendChild(a)}}function create_input_text(c,b){var a=document.createElement("textarea");a.setAttribute("rows","1");a.setAttribute("id",c);a.textContent=b;return a}
function save_new_nfclocator_device(){var c=document.getElementById("input_name").value,b=document.getElementById("input_type").value,a=document.getElementById("input_macaddress").value,e=document.getElementById("input_LoRAMacaddress").value,d=document.getElementById("input_gwid").value;if(0==c.length)alert("\u8acb\u8f38\u5165\u540d\u7a31");else if(0==a.length)alert("\u8acb\u8f38\u5165\u786c\u9ad4\u4f4d\u5740");else{gl_editMode_count=0;var f={};f.project_id=""+project_id;f.create_new_nfclocator=1;
f.macaddress=a;f.name=c;f.type=b;f.gwid=d;f.LoRAMacaddress=e;jQuery.ajax({url:gl_target_server+"/php/nfclocator.php",type:"POST",data:f,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a));setTimeout(reload_nfcdevice_device_info,300)},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}})}}
function verify_new_nfclocator(){var c=document.getElementById("nfclocator_verifykey").value;if(8!=c.length)alert("\u8acb\u8f38\u5165\u6b63\u78ba\u6a5f\u5668\u9a57\u8b49\u78bc");else{var b={};b.project_id=""+project_id;b.verify_new_nfclocator=1;b.verifykey=c;jQuery.ajax({url:gl_target_server+"/php/nfclocator.php",type:"POST",data:b,success:function(a){if(400==a.status)alert("update Error! response = "+JSON.stringify(a));else{a=JSON.parse(a);var b=document.getElementById("nfclocator_verify_error"),
c=document.getElementById("nfclocator_verify_pass");0<a.verify_error.length?(b.textContent=a.verify_error,c.setAttribute("style","display:none;"),b.setAttribute("style","display:block;")):0<a.verify_pass.length&&(c.textContent=a.verify_pass,c.setAttribute("style","display:block;"),b.setAttribute("style","display:none;"),reload_nfcdevice_device_info())}},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}})}}
function getNFCDeviceName(c){for(var b=0;b<gl_OnLinelist_nfclocators.length;++b){var a=gl_OnLinelist_nfclocators[b];if(a.deviceid===c)return c=a.name}for(b=0;b<gl_notOnLinelist_nfclocators.length;++b)if(a=gl_notOnLinelist_nfclocators[b],a.deviceid===c){c=a.name;break}return c}$("#createnewnfclocatorbutton").click(function(){create_empty_nfclocator_record_table_item(gl_OnLinelist_nfclocators.length+gl_notOnLinelist_nfclocators.length+1);return!1});
function nfclocators_move_page_backward(){var c=document.getElementById("nfclocators_id_current_page_num");1>=nfclocators_glCurrentPage||(nfclocators_glCurrentPage--,c.textContent=nfclocators_glCurrentPage,reload_nfcdevice_device_info())}function nfclocators_move_page_forward(){var c=document.getElementById("nfclocators_id_current_page_num");nfclocators_glCurrentPage++;c.textContent=nfclocators_glCurrentPage;reload_nfcdevice_device_info()};var LOAD_PAGE_NUM=20,nfccards_PreLoadIndex=-1,nfccards_CurrentLoadIndex=0,LOAD_STATE_END=9999,nfccards_glCurrentPage=1,gl_OnLinelist_nfccards=[],gl_notOnLinelist_nfccards=[];check_nfccards_loading_status();
function check_nfccards_loading_status(){switch(nfccards_CurrentLoadIndex){case 0:nfccards_PreLoadIndex!=nfccards_CurrentLoadIndex&&(nfccards_PreLoadIndex=nfccards_CurrentLoadIndex,load_nfccard());break;case 1:nfccards_PreLoadIndex!=nfccards_CurrentLoadIndex&&(nfccards_PreLoadIndex=nfccards_CurrentLoadIndex,draw_nfccard_table(),nfccards_CurrentLoadIndex+=1);break;case 2:nfccards_PreLoadIndex!=nfccards_CurrentLoadIndex&&(nfccards_PreLoadIndex=nfccards_CurrentLoadIndex,nfccards_CurrentLoadIndex=LOAD_STATE_END)}nfccards_CurrentLoadIndex!=
LOAD_STATE_END?setTimeout(check_nfccards_loading_status,100):setTimeout(reload_nfccard_info,1E4)}
function load_nfccard(){if("activetab_nfccards"===gl_activetab){var c=(nfccards_glCurrentPage-1)*LOAD_PAGE_NUM,b=LOAD_PAGE_NUM,a=gl_showfilter_showonline?1:0,e=gl_showfilter_showoffline?1:0;gl_OnLinelist_nfccards=[];gl_notOnLinelist_nfccards=[];$.getJSON(gl_target_server+"/php/nfclocator.php","loadcard=1&s="+c+"&count="+b+"&project_id="+project_id+"&showonline="+a+"&showoffline="+e,function(a){$.each(a,function(a,b){"0"===b.alive?gl_notOnLinelist_nfccards.push(b):gl_OnLinelist_nfccards.push(b)})}).success(function(){nfccards_CurrentLoadIndex+=
1}).error(function(){}).complete(function(){})}else setTimeout(load_nfccard,1E3)}
function draw_nfccard_table(){for(var c=document.getElementById("NFC_CARD_TABLE");1<=c.rows.length;)c.deleteRow(0);var b=0;if(gl_showfilter_showonline){for(var a=0;a<gl_OnLinelist_nfccards.length;++a){var e=gl_OnLinelist_nfccards[a],d=(nfccards_glCurrentPage-1)*LOAD_PAGE_NUM,e=nfccards_create_record_table_item(d+a,e);c.appendChild(e)}b=gl_OnLinelist_nfccards.length}if(gl_showfilter_showoffline)for(a=0;a<gl_notOnLinelist_nfccards.length;++a)e=gl_notOnLinelist_nfccards[a],d=(nfccards_glCurrentPage-
1)*LOAD_PAGE_NUM+b,e=nfccards_create_record_table_item(d+a,e),c.appendChild(e)}
function nfccards_create_record_table_item(c,b){if(null==b)return null;var a=document.createElement("tr");"0"===b.alive?a.setAttribute("bgcolor","#a3c2c2"):a.setAttribute("bgcolor","#FFFFFF");var e=b.cardid;"0"!==b.userid&&(e=findUserName(b.userid));var d=0;a.appendChild(document.createElement("td"));a.cells[d].appendChild(document.createTextNode(""+c));d++;a.appendChild(document.createElement("td"));if("0"!=b.alive){var f=document.createElement("span");f.setAttribute("class","badge bg-fuchsia");
f.textContent=b.alive;a.cells[d].appendChild(f)}d++;a.appendChild(document.createElement("td"));f=document.createElement("span");f.setAttribute("id","uiid_name_"+b.cardid);f.setAttribute("class","badge bg-yellow-active");f.textContent=0<b.name.length?b.name:e;a.cells[d].appendChild(f);if(edit_node_info){f=document.createElement("a");f.setAttribute("href","javascript:;");f.setAttribute("onclick",'edit_nfccard_name("'+b.cardid+'","'+e+'");return false;');var g=document.createElement("i");g.setAttribute("class",
"fa fa-edit");f.appendChild(g);a.cells[d].appendChild(f)}d++;f=document.createElement("td");f.setAttribute("id","uiid_type_"+b.cardid);a.appendChild(f);g=document.createElement("span");g.setAttribute("class","badge bg-green-active");g.textContent="0"===b.userid?"\u5361\u7247":"\u4eba\u54e1\u914d\u6234";f.appendChild(g);d++;f=document.createElement("td");f.setAttribute("id","uiid_id_"+b.cardid);a.appendChild(f);g=document.createElement("span");g.setAttribute("style","font-size:14px; font-weight:bold; color:#330033;");
g.textContent=b.cardid;f.appendChild(g);d++;f=document.createElement("td");f.setAttribute("id","uiid_id_"+b.cardid);a.appendChild(f);"0"!==b.userid&&(g=document.createElement("span"),g.setAttribute("style","display:inline;padding:.2em .3em .3em;font-size:95%;font-weight:700;line-height:1;position:relative;top:-1px;color:#fff;border-radius:2px;white-space:nowrap;background-color:rgb(54, 127, 169);"),g.textContent=e,f.appendChild(g));d++;"5"!=groupid&&(a.appendChild(document.createElement("td")),e=
document.createElement("span"),e.setAttribute("id","uiid_maplayer_"+b.cardid),e.setAttribute("class","label label-primary"),e.textContent=get_maplayer_name(b.maplayer),a.cells[d].appendChild(e),d++);e=document.createElement("td");a.appendChild(e);e=document.createElement("button");e.setAttribute("type","button");e.setAttribute("class","btn btn-default");e.setAttribute("data-toggle","modal");e.setAttribute("data-target","#modal-qrcode");e.setAttribute("onclick",'device_card_qrcode_show("'+b.cardid+
'");return false;');f=document.createElement("i");f.setAttribute("class","fa fa-qrcode");e.appendChild(f);a.cells[d].appendChild(e);edit_node_info&&(e=document.createElement("button"),e.setAttribute("id","uiid_deletebtn_"+b.cardid),e.setAttribute("title","Delete This Card"),e.setAttribute("href","javascript:;"),e.setAttribute("onclick",'confirm_delete_nfccard("'+b.cardid+'");return false;'),f=document.createElement("i"),f.setAttribute("class","fa fa-user-times"),e.appendChild(f),a.cells[d].appendChild(e));
return a}function edit_nfccard_name(c,b){console.log("edit_nfccard_name() cardid:"+c+" cardname:"+b);var a=prompt("\u7de8\u8f2fNFC\u5361\u7247\u540d\u7a31:",b);a&&(document.getElementById("uiid_name_"+c).innerText=a,update_nfccard_name(c,a))}
function device_card_qrcode_show(c){console.log("device_card_qrcode_show() cardid:"+c);document.getElementById("device_qrcode_type").textContent="Type: CARD";document.getElementById("device_qrcode_name").textContent="";document.getElementById("device_qrcode_macaddress").textContent="\u5361\u7247ID: "+c;jQuery.ajax({url:gl_target_server+"/php/configvils.php",type:"POST",data:"loadqrcode=1&type=CARD&accountid="+c+"&id="+c+"&project_id="+project_id,dataType:"text",success:function(b){b=JSON.parse(b);
document.getElementById("device_qrcode_ui").setAttribute("src",b.qrcode);document.getElementById("device_qrcode_target").textContent="target: "+b.target;document.getElementById("device_qrcode_topic").textContent="topic: "+b.topic;document.getElementById("device_qrcode_datetime").textContent="\u66f4\u65b0\u6642\u9593: "+b.datetime}})}
function update_nfccard_name(c,b){if(0==b.length)alert("\u8acb\u8f38\u5165\u540d\u7a31");else{var a={};a.project_id=""+project_id;a.update_nfccard_name=1;a.cardid=c;a.cardname=b;jQuery.ajax({url:gl_target_server+"/php/nfclocator.php",type:"POST",data:a,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a))},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}})}}
function confirm_delete_nfccard(c){confirm("Are you sure you want to delete this card:"+c+"   ?")&&delete_nfccard(c)}function delete_nfccard(c){var b={};b.project_id=""+project_id;b.delete_card=1;b.cardid=c;jQuery.ajax({url:gl_target_server+"/php/nfclocator.php",type:"POST",data:b,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a))},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}})}
$("#scannewnfccardbutton").click(function(){var c={};c.project_id=""+project_id;c.scan_nfccard=1;jQuery.ajax({url:gl_target_server+"/php/nfclocator.php",type:"POST",data:c,success:function(b){400==b.status&&alert("update Error! response = "+JSON.stringify(b))},error:function(b,a,c){alert("error = "+c);alert("xhr.responseText = "+b.responseText)}});return!1});function reload_nfccard_info(){nfccards_PreLoadIndex=-1;nfccards_CurrentLoadIndex=0;check_nfccards_loading_status()}
function nfccards_move_page_backward(){var c=document.getElementById("nfccards_id_current_page_num");1>=nfccards_glCurrentPage||(nfccards_glCurrentPage--,c.textContent=nfccards_glCurrentPage,reload_nfccard_info())}function nfccards_move_page_forward(){var c=document.getElementById("nfccards_id_current_page_num");nfccards_glCurrentPage++;c.textContent=nfccards_glCurrentPage;reload_nfccard_info()}function open_nfccards_page(){window.open("/index.php/vilsnfccards/"+project_id,"_blank").focus()};var LOAD_PAGE_NUM=20,unknownnfccards_PreLoadIndex=-1,unknownnfccards_CurrentLoadIndex=0,LOAD_STATE_END=9999,unknownnfccards_glCurrentPage=1,gl_notOnLinelist_unknownnfccards=[],gl_OnLinelist_unknownnfccards=[];check_unknownnfccards_loading_status();
function check_unknownnfccards_loading_status(){switch(unknownnfccards_CurrentLoadIndex){case 0:unknownnfccards_PreLoadIndex!=unknownnfccards_CurrentLoadIndex&&(unknownnfccards_PreLoadIndex=unknownnfccards_CurrentLoadIndex,load_unknownnfccard());break;case 1:unknownnfccards_PreLoadIndex!=unknownnfccards_CurrentLoadIndex&&(unknownnfccards_PreLoadIndex=unknownnfccards_CurrentLoadIndex,draw_unknownnfccard_table(),unknownnfccards_CurrentLoadIndex+=1);break;case 2:unknownnfccards_PreLoadIndex!=unknownnfccards_CurrentLoadIndex&&
(unknownnfccards_PreLoadIndex=unknownnfccards_CurrentLoadIndex,unknownnfccards_CurrentLoadIndex=LOAD_STATE_END)}unknownnfccards_CurrentLoadIndex!=LOAD_STATE_END?setTimeout(check_unknownnfccards_loading_status,100):setTimeout(reload_unknownnfccard_info,1E4)}
function load_unknownnfccard(){if("activetab_unknown_nfccards"===gl_activetab){var c=(unknownnfccards_glCurrentPage-1)*LOAD_PAGE_NUM,b=LOAD_PAGE_NUM,a=gl_showfilter_showonline?1:0,e=gl_showfilter_showoffline?1:0;gl_notOnLinelist_unknownnfccards=[];gl_OnLinelist_unknownnfccards=[];$.getJSON(gl_target_server+"/php/nfclocator.php","loadunknowncard=1&s="+c+"&count="+b+"&project_id="+project_id+"&showonline="+a+"&showoffline="+e,function(a){$.each(a,function(a,b){"0"===b.alive?gl_notOnLinelist_unknownnfccards.push(b):
gl_OnLinelist_unknownnfccards.push(b)})}).success(function(){unknownnfccards_CurrentLoadIndex+=1}).error(function(){}).complete(function(){})}else setTimeout(load_unknownnfccard,1E3)}
function draw_unknownnfccard_table(){for(var c=document.getElementById("UNKNOWN_NFC_CARD_TABLE");1<=c.rows.length;)c.deleteRow(0);var b=0;if(gl_showfilter_showonline){for(var a=0;a<gl_OnLinelist_unknownnfccards.length;++a){var e=gl_OnLinelist_unknownnfccards[a],d=(unknownnfccards_glCurrentPage-1)*LOAD_PAGE_NUM,e=unknownnfccards_create_record_table_item(d+a,e);c.appendChild(e)}b=gl_OnLinelist_unknownnfccards.length}if(gl_showfilter_showoffline)for(a=0;a<gl_notOnLinelist_unknownnfccards.length;++a)e=
gl_notOnLinelist_unknownnfccards[a],d=(unknownnfccards_glCurrentPage-1)*LOAD_PAGE_NUM+b,e=unknownnfccards_create_record_table_item(d+a,e),c.appendChild(e)}
function unknownnfccards_create_record_table_item(c,b){if(null==b)return null;var a=document.createElement("tr");"0"===b.alive?a.setAttribute("bgcolor","#a3c2c2"):a.setAttribute("bgcolor","#FFFFFF");var e=0;a.appendChild(document.createElement("td"));a.cells[e].appendChild(document.createTextNode(""+c));e++;a.appendChild(document.createElement("td"));if("0"!=b.alive){var d=document.createElement("span");d.setAttribute("class","badge bg-fuchsia");d.textContent=b.alive;a.cells[e].appendChild(d)}e++;
a.appendChild(document.createElement("td"));d=document.createElement("span");d.setAttribute("id","uiid_name_"+b.cardid);d.setAttribute("style","font-size:14px; font-weight:bold; color:#330033;");d.textContent=b.cardid;a.cells[e].appendChild(d);e++;a.appendChild(document.createElement("td"));d=document.createElement("span");d.setAttribute("class","badge bg-yellow");d.textContent=getNFCDeviceName(b.deviceid);a.cells[e].appendChild(d);e++;a.appendChild(document.createElement("td"));d=document.createElement("span");
d.setAttribute("class","badge bg-green-active");d.textContent=b.updatetime;a.cells[e].appendChild(d);e++;d=document.createElement("td");a.appendChild(d);if(edit_node_info){d=document.createElement("button");d.setAttribute("id","uiid_deletebtn_"+b.cardid);d.setAttribute("title","Delete This Card");d.setAttribute("href","javascript:;");d.setAttribute("onclick",'confirm_delete_unknownnfccard("'+b.cardid+'");return false;');var f=document.createElement("i");f.setAttribute("class","fa fa-user-times");
d.appendChild(f);a.cells[e].appendChild(d);d=document.createElement("button");d.setAttribute("id","uiid_registerbtn_"+b.cardid);d.setAttribute("title","\u8a3b\u518a\u5361\u7247");d.setAttribute("href","javascript:;");d.setAttribute("onclick",'confirm_register_unknownnfccard("'+b.cardid+'");return false;');f=document.createElement("i");f.setAttribute("class","fa fa-check-square-o");d.appendChild(f);a.cells[e].appendChild(d)}return a}
function confirm_delete_unknownnfccard(c){confirm("Are you sure you want to delete this card:"+c+"   ?")&&delete_unknownnfccard(c)}function delete_unknownnfccard(c){var b={};b.project_id=""+project_id;b.delete_card=1;b.cardid=c;jQuery.ajax({url:gl_target_server+"/php/nfclocator.php",type:"POST",data:b,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a))},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}})}
function confirm_register_unknownnfccard(c){confirm("\u8a3b\u518a\u5361\u7247, \u8a2d\u5b9a\u9019\u5f35\u5361\u7247\u5230\u5df2\u8a3b\u518a\u5340? "+c+"   ?")&&register_unknownnfccard(c)}
function register_unknownnfccard(c){var b={};b.project_id=""+project_id;b.register_card=1;b.cardid=c;jQuery.ajax({url:gl_target_server+"/php/nfclocator.php",type:"POST",data:b,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a))},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}})}
function delete_all_unknownnfccard(){var c={};c.project_id=""+project_id;c.delete_all_unknowncard=1;jQuery.ajax({url:gl_target_server+"/php/nfclocator.php",type:"POST",data:c,success:function(b){400==b.status&&alert("update Error! response = "+JSON.stringify(b))},error:function(b,a,c){alert("error = "+c);alert("xhr.responseText = "+b.responseText)}})}
function create_unknown_nfccards_xlsx_report(){document.getElementById("unknown_nfccards_xlsxreport_status").textContent="\u7522\u751f\u5831\u8868\u4e2d...";jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:"loadunknownnfccardsxlsxreport=1&project_id="+project_id,dataType:"text",success:function(c){var b=JSON.parse(c);console.log("create_unknown_nfccards_xlsx_report() success:"+b.success+" xlsxreport:"+b.xlsxreport);for(var a=document.getElementById("unknown_nfccards_xlsxreport_status");a.firstChild;)a.removeChild(a.firstChild);
"true"===b.success?(c=document.createElement("button"),c.setAttribute("type","button"),c.setAttribute("class","btn btn-app"),c.setAttribute("style","width:90px;height:100px"),c.setAttribute("onclick","open_new_page('"+b.xlsxreport+"');"),a.appendChild(c),b=document.createElement("img"),b.setAttribute("src","/images/xlsx-dl-icon-1.png"),b.setAttribute("alt","Download report"),b.setAttribute("title","Download report"),b.setAttribute("height","80"),b.setAttribute("width","80"),c.appendChild(b)):(a=document.getElementById("xlsxreport_status"),
a.textContent="\u7522\u751f\u5831\u8868\u5931\u6557!")}});return!1}function open_new_page(c){window.open(c,"_blank").focus()}function reload_unknownnfccard_info(){unknownnfccards_PreLoadIndex=-1;unknownnfccards_CurrentLoadIndex=0;check_unknownnfccards_loading_status()}
function unknown_nfccards_move_page_backward(){var c=document.getElementById("unknown_nfccards_id_current_page_num");1>=unknownnfccards_glCurrentPage||(unknownnfccards_glCurrentPage--,c.textContent=unknownnfccards_glCurrentPage,reload_unknownnfccard_info())}function unknown_nfccards_move_page_forward(){var c=document.getElementById("unknown_nfccards_id_current_page_num");unknownnfccards_glCurrentPage++;c.textContent=unknownnfccards_glCurrentPage;reload_unknownnfccard_info()};var LOAD_PAGE_NUM=20,wifilocators_PreLoadIndex=-1,wifilocators_CurrentLoadIndex=0,LOAD_STATE_END=9999,wifilocators_glCurrentPage=1,gl_notOnLinelist_wifilocators=[],gl_OnLinelist_wifilocators=[],gl_editMode_count=0;wifilocators_loading_status();
function wifilocators_loading_status(){switch(wifilocators_CurrentLoadIndex){case 0:wifilocators_PreLoadIndex!=wifilocators_CurrentLoadIndex&&(wifilocators_PreLoadIndex=wifilocators_CurrentLoadIndex,load_wifilocator());break;case 1:wifilocators_PreLoadIndex!=wifilocators_CurrentLoadIndex&&(wifilocators_PreLoadIndex=wifilocators_CurrentLoadIndex,draw_wifilocator_table(),wifilocators_CurrentLoadIndex+=1);break;case 2:wifilocators_PreLoadIndex!=wifilocators_CurrentLoadIndex&&(wifilocators_PreLoadIndex=
wifilocators_CurrentLoadIndex,wifilocators_CurrentLoadIndex=LOAD_STATE_END)}wifilocators_CurrentLoadIndex!=LOAD_STATE_END?setTimeout(wifilocators_loading_status,100):setTimeout(reload_wifidevice_device_info,1E4)}function reload_wifidevice_device_info(){wifilocators_PreLoadIndex=-1;wifilocators_CurrentLoadIndex=0;wifilocators_loading_status()}
function load_wifilocator(){if("activetab_wifilocators"===gl_activetab){var c=(wifilocators_glCurrentPage-1)*LOAD_PAGE_NUM,b=LOAD_PAGE_NUM,a=gl_showfilter_showonline?1:0,e=gl_showfilter_showoffline?1:0;gl_notOnLinelist_wifilocators=[];gl_OnLinelist_wifilocators=[];$.getJSON(gl_target_server+"/php/nfclocator.php","loadwifilocator=1&s="+c+"&count="+b+"&project_id="+project_id+"&showonline="+a+"&showoffline="+e,function(a){$.each(a,function(a,b){"0"===b.alive?gl_notOnLinelist_wifilocators.push(b):gl_OnLinelist_wifilocators.push(b)})}).success(function(){wifilocators_CurrentLoadIndex+=
1}).error(function(){}).complete(function(){})}else setTimeout(load_wifilocator,1E3)}
function draw_wifilocator_table(){if(0<gl_editMode_count)console.log("draw_wifilocator_table() gl_notOnLinelist_wifilocators.length:"+gl_notOnLinelist_wifilocators.length+" gl_editMode_count:"+gl_editMode_count),console.log("draw_wifilocator_table() gl_OnLinelist_wifilocators.length:"+gl_OnLinelist_wifilocators.length+" gl_editMode_count:"+gl_editMode_count);else{for(var c=document.getElementById("LOC_WIFI_LOCATOR_NODE_TABLE");1<=c.rows.length;)c.deleteRow(0);var b=0;if(gl_showfilter_showonline){for(var a=
0;a<gl_OnLinelist_wifilocators.length;++a){var e=gl_OnLinelist_wifilocators[a],d=(wifilocators_glCurrentPage-1)*LOAD_PAGE_NUM,e=wifilocators_create_record_table_item(d+a,e);c.appendChild(e)}b=gl_OnLinelist_wifilocators.length}if(gl_showfilter_showoffline)for(a=0;a<gl_notOnLinelist_wifilocators.length;++a)e=gl_notOnLinelist_wifilocators[a],d=(wifilocators_glCurrentPage-1)*LOAD_PAGE_NUM+b,e=wifilocators_create_record_table_item(d+a,e),c.appendChild(e)}}
function wifilocators_create_record_table_item(c,b){if(null==b)return null;var a=document.createElement("tr");"0"===b.alive?a.setAttribute("bgcolor","#a3c2c2"):a.setAttribute("bgcolor","#FFFFFF");var e=0;a.appendChild(document.createElement("td"));a.cells[e].appendChild(document.createTextNode(""+(c+1)));e++;a.appendChild(document.createElement("td"));if("0"!=b.alive){var d=document.createElement("span");d.setAttribute("class","badge bg-fuchsia");d.textContent=b.alive;a.cells[e].appendChild(d)}e++;
d=document.createElement("td");d.setAttribute("id","wifilocator_uiid_name_"+b.macaddress);a.appendChild(d);var f=document.createElement("span");f.setAttribute("style","font-size:14px; font-weight:bold; color:#330033;");f.textContent=b.name;d.appendChild(f);e++;d=document.createElement("td");a.appendChild(d);d=document.createElement("span");0<b.type.length&&d.setAttribute("style","font-size:14px; font-weight:bold; color:#330033;");d.textContent=b.type;a.cells[e].appendChild(d);e++;d=document.createElement("td");
a.appendChild(d);d=document.createElement("span");d.textContent=b.verifykey;a.cells[e].appendChild(d);e++;d=document.createElement("td");d.setAttribute("id","wifilocator_uiid_macaddress_"+b.macaddress);a.appendChild(d);d=document.createElement("span");0<b.macaddress.length&&d.setAttribute("class","label label-primary");d.textContent=b.macaddress;a.cells[e].appendChild(d);e++;d=document.createElement("td");d.setAttribute("id","wifilocator_uiid_ssid_"+b.macaddress);a.appendChild(d);d=document.createElement("span");
0<b.ssid.length&&d.setAttribute("class","label label-warning");d.textContent=b.ssid;a.cells[e].appendChild(d);e++;d=document.createElement("td");d.setAttribute("id","wifilocator_uiid_wifimac_"+b.macaddress);a.appendChild(d);d=document.createElement("span");0<b.wifimac.length&&d.setAttribute("class","label label-success");d.textContent=b.wifimac;a.cells[e].appendChild(d);e++;d=document.createElement("td");a.appendChild(d);d=document.createElement("td");d.setAttribute("id","edgecontrol_uiid_version_"+
b.macaddress);a.appendChild(d);d=document.createElement("span");0<b.version.length&&d.setAttribute("class","label label-warning");d.textContent=b.version;a.cells[e].appendChild(d);e++;d=document.createElement("button");d.setAttribute("id","wifilocator_uiid_editbtn_"+b.macaddress);d.setAttribute("title","Edit this device");d.setAttribute("href","javascript:;");d.setAttribute("onclick",'edit_wifilocator_device("'+b.alive+'", "'+b.macaddress+'","'+b.name+'", "'+b.type+'", "'+b.ssid+'", "'+b.wifimac+
'");return false;');f=document.createElement("i");f.setAttribute("id","wifilocator_uiid_editimg_"+b.macaddress);f.setAttribute("class","fa fa-edit");d.appendChild(f);a.cells[e].appendChild(d);d=document.createElement("button");d.setAttribute("style","display:none");d.setAttribute("id","wifilocator_uiid_deletebtn_"+b.macaddress);d.setAttribute("title","Delete This Device");d.setAttribute("href","javascript:;");d.setAttribute("onclick",'confirm_delete_wifilocator_device("'+b.macaddress+'", "'+b.name+
'", "'+b.type+'");return false;');f=document.createElement("i");f.setAttribute("class","fa fa-user-times");d.appendChild(f);a.cells[e].appendChild(d);return a}
function edit_wifilocator_device(c,b,a,e,d,f){console.log("edit_wifilocator_device() macaddress:"+b);gl_editMode_count+=1;create_edit_ui("wifilocator_uiid_name",b,a);create_edit_ui("wifilocator_uiid_ssid",b,d);create_edit_ui("wifilocator_uiid_wifimac",b,f);a=document.getElementById("wifilocator_uiid_editbtn_"+b);a.setAttribute("title","Save this Device");a.setAttribute("onclick",'save_wifilocator_device("'+c+'","'+b+'");return false;');document.getElementById("wifilocator_uiid_editimg_"+b).setAttribute("class",
"fa fa-save");document.getElementById("wifilocator_uiid_deletebtn_"+b).setAttribute("style","display:block")}function create_edit_ui(c,b,a){var e=clearChildView(c+"_"+b);c=create_input_text(c+"_"+b+"_edit",a);e.appendChild(c)}function clearChildView(c){c=document.getElementById(c);if(null!=c)for(;c.firstChild;)c.removeChild(c.firstChild);return c}
function save_wifilocator_device(c,b){var a=document.getElementById("wifilocator_uiid_name_"+b+"_edit").value,e=document.getElementById("wifilocator_uiid_ssid_"+b+"_edit").value,d=document.getElementById("wifilocator_uiid_wifimac_"+b+"_edit").value;update_wifilocator_device(c,b,a,e,d)}
function update_wifilocator_device(c,b,a,e,d){console.log("update_wifilocator_device() macaddress:"+b);console.log("update_wifilocator_device() value_name:"+a);if(0==a.length)alert("\u8acb\u8f38\u5165\u540d\u7a31");else if(0==b.length)alert("\u8acb\u8f38\u5165\u786c\u9ad4\u4f4d\u5740");else{gl_editMode_count=0;var f={};f.project_id=""+project_id;f.update_wifilocator=1;f.alive=c;f.macaddress=b;f.name=a;f.wifimac=d;f.ssid=e;jQuery.ajax({url:gl_target_server+"/php/nfclocator.php",type:"POST",data:f,
success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a));setTimeout(reload_wifidevice_device_info,300)},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}})}}function confirm_delete_wifilocator_device(c,b,a){confirm("Are you sure you want to delete this device:"+b+" "+a+"   ?")&&delete_wifilocator_device(c)}
function delete_wifilocator_device(c){var b={};b.project_id=""+project_id;b.delete_wifilocator=1;b.macaddress=c;gl_editMode_count=0;jQuery.ajax({url:gl_target_server+"/php/nfclocator.php",type:"POST",data:b,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a));setTimeout(reload_wifidevice_device_info,300)},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}})}
function wifilocators_move_page_backward(){var c=document.getElementById("wifilocators_id_current_page_num");1>=wifilocators_glCurrentPage||(wifilocators_glCurrentPage--,c.textContent=wifilocators_glCurrentPage,reload_wifidevice_device_info())}function wifilocators_move_page_forward(){var c=document.getElementById("wifilocators_id_current_page_num");wifilocators_glCurrentPage++;c.textContent=wifilocators_glCurrentPage;reload_wifidevice_device_info()};var LOAD_PAGE_NUM=20,celllocators_PreLoadIndex=-1,celllocators_CurrentLoadIndex=0,LOAD_STATE_END=9999,celllocators_glCurrentPage=1,gl_notOnLinelist_celllocators=[],gl_OnLinelist_celllocators=[],gl_editMode_count=0;celllocators_loading_status();
function celllocators_loading_status(){switch(celllocators_CurrentLoadIndex){case 0:celllocators_PreLoadIndex!=celllocators_CurrentLoadIndex&&(celllocators_PreLoadIndex=celllocators_CurrentLoadIndex,load_celllocator());break;case 1:celllocators_PreLoadIndex!=celllocators_CurrentLoadIndex&&(celllocators_PreLoadIndex=celllocators_CurrentLoadIndex,draw_celllocator_table(),celllocators_CurrentLoadIndex+=1);break;case 2:celllocators_PreLoadIndex!=celllocators_CurrentLoadIndex&&(celllocators_PreLoadIndex=
celllocators_CurrentLoadIndex,celllocators_CurrentLoadIndex=LOAD_STATE_END)}celllocators_CurrentLoadIndex!=LOAD_STATE_END?setTimeout(celllocators_loading_status,100):setTimeout(reload_celllocator_device_info,1E4)}function reload_celllocator_device_info(){celllocators_PreLoadIndex=-1;celllocators_CurrentLoadIndex=0;celllocators_loading_status()}
function load_celllocator(){if("activetab_celllocators"===gl_activetab){var c=(celllocators_glCurrentPage-1)*LOAD_PAGE_NUM,b=LOAD_PAGE_NUM,a=gl_showfilter_showonline?1:0,e=gl_showfilter_showoffline?1:0;gl_notOnLinelist_celllocators=[];gl_OnLinelist_celllocators=[];$.getJSON(gl_target_server+"/php/nfclocator.php","loadcelllocator=1&s="+c+"&count="+b+"&project_id="+project_id+"&showonline="+a+"&showoffline="+e,function(a){$.each(a,function(a,b){"0"===b.alive?gl_notOnLinelist_celllocators.push(b):gl_OnLinelist_celllocators.push(b)})}).success(function(){celllocators_CurrentLoadIndex+=
1}).error(function(){}).complete(function(){})}else setTimeout(load_celllocator,1E3)}
function draw_celllocator_table(){if(0<gl_editMode_count)console.log("draw_celllocator_table() gl_notOnLinelist_celllocators.length:"+gl_notOnLinelist_celllocators.length+" gl_editMode_count:"+gl_editMode_count),console.log("draw_celllocator_table() gl_OnLinelist_celllocators.length:"+gl_OnLinelist_celllocators.length+" gl_editMode_count:"+gl_editMode_count);else{for(var c=document.getElementById("LOC_CELL_LOCATOR_NODE_TABLE");1<=c.rows.length;)c.deleteRow(0);var b=0;if(gl_showfilter_showonline){for(var a=
0;a<gl_OnLinelist_celllocators.length;++a){var e=gl_OnLinelist_celllocators[a],d=(celllocators_glCurrentPage-1)*LOAD_PAGE_NUM,e=celllocators_create_record_table_item(d+a,e);c.appendChild(e)}b=gl_OnLinelist_celllocators.length}if(gl_showfilter_showoffline)for(a=0;a<gl_notOnLinelist_celllocators.length;++a)e=gl_notOnLinelist_celllocators[a],d=(celllocators_glCurrentPage-1)*LOAD_PAGE_NUM+b,e=celllocators_create_record_table_item(d+a,e),c.appendChild(e)}}
function celllocators_create_record_table_item(c,b){if(null==b)return console.log("celllocators_create_record_table_item() device == null"),null;var a=document.createElement("tr");"0"===b.alive?a.setAttribute("bgcolor","#a3c2c2"):a.setAttribute("bgcolor","#FFFFFF");var e=0;a.appendChild(document.createElement("td"));a.cells[e].appendChild(document.createTextNode(""+(c+1)));e++;a.appendChild(document.createElement("td"));if("0"!=b.alive){var d=document.createElement("span");d.setAttribute("class",
"badge bg-fuchsia");d.textContent=b.alive;a.cells[e].appendChild(d)}e++;d=document.createElement("td");d.setAttribute("id","celllocator_uiid_name_"+b.macaddress);a.appendChild(d);var f=document.createElement("span");f.setAttribute("style","font-size:14px; font-weight:bold; color:#330033;");f.textContent=b.name;d.appendChild(f);e++;d=document.createElement("td");a.appendChild(d);d=document.createElement("span");d.textContent=b.verifykey;a.cells[e].appendChild(d);e++;d=document.createElement("td");
d.setAttribute("id","celllocator_uiid_macaddress_"+b.macaddress);a.appendChild(d);d=document.createElement("span");0<b.macaddress.length&&d.setAttribute("class","label label-primary");d.textContent=b.macaddress;a.cells[e].appendChild(d);e++;d=document.createElement("td");d.setAttribute("id","celllocator_uiid_version_"+b.macaddress);a.appendChild(d);d=document.createElement("span");0<b.version.length&&d.setAttribute("class","label label-warning");d.textContent=b.version;a.cells[e].appendChild(d);e++;
a.appendChild(document.createElement("td"));d="";0<b.version.length&&(d+=" V"+b.version);0<b.panid.length&&(d+=" panid:"+b.panid);0<b.mode.length&&(d+=" mode:"+b.mode);0<b.gwid.length&&(d+=" gwid:"+b.gwid);d+=" ";1<b.Longitude.length&&1<b.Latitude.length&&(d+=" \u7d93\u7def\u5ea6("+b.Longitude+","+b.Latitude+")");a.cells[e].appendChild(document.createTextNode(d));d=parseInt(b.Latitude);f=parseInt(b.Longitude);if(0!=d&&0!=f){d=document.createElement("button");f=document.createElement("a");f.setAttribute("href",
"javascript:;");f.setAttribute("onclick","open_gmap("+b.Latitude+","+b.Longitude+");return false;");var g=document.createElement("i");g.setAttribute("class","fa fa-map-marker");f.appendChild(g);d.appendChild(f);a.cells[e].appendChild(d)}d=document.createElement("td");a.appendChild(d);d=document.createElement("button");d.setAttribute("id","celllocator_uiid_editbtn_"+b.macaddress);d.setAttribute("title","Edit this device");d.setAttribute("href","javascript:;");d.setAttribute("onclick",'edit_celllocator_device("'+
b.alive+'", "'+b.macaddress+'","'+b.name+'");return false;');f=document.createElement("i");f.setAttribute("id","celllocator_uiid_editimg_"+b.macaddress);f.setAttribute("class","fa fa-edit");d.appendChild(f);a.cells[e].appendChild(d);d=document.createElement("button");d.setAttribute("style","display:none");d.setAttribute("id","celllocator_uiid_deletebtn_"+b.macaddress);d.setAttribute("title","Delete This Device");d.setAttribute("href","javascript:;");d.setAttribute("onclick",'confirm_delete_celllocator_device("'+
b.macaddress+'", "'+b.name+'");return false;');f=document.createElement("i");f.setAttribute("class","fa fa-user-times");d.appendChild(f);a.cells[e].appendChild(d);return a}
function edit_celllocator_device(c,b,a){console.log("edit_celllocator_device() macaddress:"+b);gl_editMode_count+=1;create_edit_ui("celllocator_uiid_name",b,a);a=document.getElementById("celllocator_uiid_editbtn_"+b);a.setAttribute("title","Save this Device");a.setAttribute("onclick",'save_celllocator_device("'+c+'","'+b+'");return false;');document.getElementById("celllocator_uiid_editimg_"+b).setAttribute("class","fa fa-save");document.getElementById("celllocator_uiid_deletebtn_"+b).setAttribute("style",
"display:block")}function create_edit_ui(c,b,a){var e=clearChildView(c+"_"+b);c=create_input_text(c+"_"+b+"_edit",a);e.appendChild(c)}function clearChildView(c){c=document.getElementById(c);if(null!=c)for(;c.firstChild;)c.removeChild(c.firstChild);return c}function save_celllocator_device(c,b){var a=document.getElementById("celllocator_uiid_name_"+b+"_edit").value;update_celllocator_device(c,b,a)}
function update_celllocator_device(c,b,a){console.log("update_celllocator_device() macaddress:"+b);console.log("update_celllocator_device() value_name:"+a);if(0==a.length)alert("\u8acb\u8f38\u5165\u540d\u7a31");else if(0==b.length)alert("\u8acb\u8f38\u5165\u786c\u9ad4\u4f4d\u5740");else{gl_editMode_count=0;var e={};e.project_id=""+project_id;e.update_celllocator=1;e.alive=c;e.macaddress=b;e.name=a;jQuery.ajax({url:gl_target_server+"/php/nfclocator.php",type:"POST",data:e,success:function(a){400==
a.status&&alert("update Error! response = "+JSON.stringify(a));setTimeout(reload_celllocator_device_info,300)},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}})}}function confirm_delete_celllocator_device(c,b){confirm("Are you sure you want to delete this device:"+b+" ?")&&delete_celllocator_device(c)}
function delete_celllocator_device(c){var b={};b.project_id=""+project_id;b.delete_celllocator=1;b.macaddress=c;gl_editMode_count=0;jQuery.ajax({url:gl_target_server+"/php/nfclocator.php",type:"POST",data:b,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a));setTimeout(reload_celllocator_device_info,300)},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}})}
function celllocators_move_page_backward(){var c=document.getElementById("celllocators_id_current_page_num");1>=celllocators_glCurrentPage||(celllocators_glCurrentPage--,c.textContent=celllocators_glCurrentPage,reload_celllocator_device_info())}function celllocators_move_page_forward(){var c=document.getElementById("celllocators_id_current_page_num");celllocators_glCurrentPage++;c.textContent=celllocators_glCurrentPage;reload_celllocator_device_info()};var LOAD_PAGE_NUM=20,edgecontrols_PreLoadIndex=-1,edgecontrols_CurrentLoadIndex=0,LOAD_STATE_END=9999,edgecontrols_glCurrentPage=1,gl_notOnLinelist_edgecontrols=[],gl_OnLinelist_edgecontrols=[],gl_editMode_count=0;edgecontrols_loading_status();
function edgecontrols_loading_status(){switch(edgecontrols_CurrentLoadIndex){case 0:edgecontrols_PreLoadIndex!=edgecontrols_CurrentLoadIndex&&(edgecontrols_PreLoadIndex=edgecontrols_CurrentLoadIndex,load_edgecontrol());break;case 1:edgecontrols_PreLoadIndex!=edgecontrols_CurrentLoadIndex&&(edgecontrols_PreLoadIndex=edgecontrols_CurrentLoadIndex,draw_edgecontrol_table(),edgecontrols_CurrentLoadIndex+=1);break;case 2:edgecontrols_PreLoadIndex!=edgecontrols_CurrentLoadIndex&&(edgecontrols_PreLoadIndex=
edgecontrols_CurrentLoadIndex,edgecontrols_CurrentLoadIndex=LOAD_STATE_END)}edgecontrols_CurrentLoadIndex!=LOAD_STATE_END?setTimeout(edgecontrols_loading_status,100):setTimeout(reload_edgecontrol_device_info,1E4)}function reload_edgecontrol_device_info(){edgecontrols_PreLoadIndex=-1;edgecontrols_CurrentLoadIndex=0;edgecontrols_loading_status()}
function load_edgecontrol(){if("activetab_edgecontrols"===gl_activetab){var c=(edgecontrols_glCurrentPage-1)*LOAD_PAGE_NUM,b=LOAD_PAGE_NUM,a=gl_showfilter_showonline?1:0,e=gl_showfilter_showoffline?1:0;gl_notOnLinelist_edgecontrols=[];gl_OnLinelist_edgecontrols=[];$.getJSON(gl_target_server+"/php/vilsnodes.php","loadedgecontrol=1&s="+c+"&count="+b+"&project_id="+project_id+"&showonline="+a+"&showoffline="+e,function(a){$.each(a,function(a,b){"0"===b.alive?gl_notOnLinelist_edgecontrols.push(b):gl_OnLinelist_edgecontrols.push(b)})}).success(function(){edgecontrols_CurrentLoadIndex+=
1}).error(function(){}).complete(function(){})}else setTimeout(load_edgecontrol,1E3)}
function draw_edgecontrol_table(){if(0<gl_editMode_count)console.log("draw_edgecontrol_table() gl_notOnLinelist_edgecontrols.length:"+gl_notOnLinelist_edgecontrols.length+" gl_editMode_count:"+gl_editMode_count),console.log("draw_edgecontrol_table() gl_OnLinelist_edgecontrols.length:"+gl_OnLinelist_edgecontrols.length+" gl_editMode_count:"+gl_editMode_count);else{for(var c=document.getElementById("LOC_EDGE_CONTROL_NODE_TABLE");1<=c.rows.length;)c.deleteRow(0);var b=0;if(gl_showfilter_showonline){for(var a=
0;a<gl_OnLinelist_edgecontrols.length;++a){var e=gl_OnLinelist_edgecontrols[a],d=(edgecontrols_glCurrentPage-1)*LOAD_PAGE_NUM,e=edgecontrols_create_record_table_item(d+a,e);c.appendChild(e)}b=gl_OnLinelist_edgecontrols.length}if(gl_showfilter_showoffline)for(a=0;a<gl_notOnLinelist_edgecontrols.length;++a)e=gl_notOnLinelist_edgecontrols[a],d=(edgecontrols_glCurrentPage-1)*LOAD_PAGE_NUM+b,e=edgecontrols_create_record_table_item(d+a,e),c.appendChild(e)}}
function edgecontrols_create_record_table_item(c,b){if(null==b)return console.log("edgecontrols_create_record_table_item() device == null"),null;var a=document.createElement("tr");"0"===b.alive?a.setAttribute("bgcolor","#a3c2c2"):a.setAttribute("bgcolor","#FFFFFF");var e=0;a.appendChild(document.createElement("td"));a.cells[e].appendChild(document.createTextNode(""+(c+1)));e++;a.appendChild(document.createElement("td"));if("0"!=b.alive){var d=document.createElement("span");d.setAttribute("class",
"badge bg-fuchsia");d.textContent=b.alive;a.cells[e].appendChild(d)}e++;d=document.createElement("td");d.setAttribute("id","edgecontrol_uiid_name_"+b.macaddress);a.appendChild(d);var f=document.createElement("span");f.setAttribute("style","font-size:14px; font-weight:bold; color:#330033;");f.textContent=b.name;d.appendChild(f);e++;d=document.createElement("td");d.setAttribute("id","edgecontrol_uiid_type_"+b.macaddress);a.appendChild(d);d=document.createElement("span");0<b.type.length&&d.setAttribute("style",
"font-size:14px; font-weight:bold; color:#330033;");d.textContent=b.type;a.cells[e].appendChild(d);e++;d=document.createElement("td");a.appendChild(d);d=document.createElement("span");d.textContent=b.verifykey;a.cells[e].appendChild(d);e++;d=document.createElement("td");d.setAttribute("id","edgecontrol_uiid_macaddress_"+b.macaddress);a.appendChild(d);d=document.createElement("span");0<b.macaddress.length&&d.setAttribute("class","label label-primary");d.textContent=b.macaddress;a.cells[e].appendChild(d);
e++;d=document.createElement("td");d.setAttribute("id","edgecontrol_uiid_LoRAMacaddress_"+b.macaddress);a.appendChild(d);d=document.createElement("span");0<b.LoRAMacaddress.length&&d.setAttribute("class","label label-warning");d.textContent=b.LoRAMacaddress;a.cells[e].appendChild(d);e++;d=document.createElement("td");d.setAttribute("id","edgecontrol_uiid_gwid_"+b.macaddress);a.appendChild(d);d=document.createElement("span");0<b.gwid.length&&d.setAttribute("class","label label-success");d.textContent=
b.gwid;a.cells[e].appendChild(d);e++;d=document.createElement("td");d.setAttribute("id","edgecontrol_uiid_ip_"+b.macaddress);a.appendChild(d);d=document.createElement("span");0<b.ip.length&&d.setAttribute("class","label label-warning");d.textContent=b.ip;a.cells[e].appendChild(d);e++;d=document.createElement("td");d.setAttribute("id","edgecontrol_uiid_version_"+b.macaddress);a.appendChild(d);d=document.createElement("span");0<b.version.length&&d.setAttribute("class","label label-warning");d.textContent=
b.version;a.cells[e].appendChild(d);e++;d=document.createElement("td");a.appendChild(d);d=document.createElement("button");d.setAttribute("id","edgecontrol_uiid_editbtn_"+b.macaddress);d.setAttribute("title","Edit this device");d.setAttribute("href","javascript:;");d.setAttribute("onclick",'edit_edgecontrol_device("'+b.alive+'", "'+b.macaddress+'","'+b.name+'");return false;');f=document.createElement("i");f.setAttribute("id","edgecontrol_uiid_editimg_"+b.macaddress);f.setAttribute("class","fa fa-edit");
d.appendChild(f);a.cells[e].appendChild(d);d=document.createElement("button");d.setAttribute("style","display:none");d.setAttribute("id","edgecontrol_uiid_deletebtn_"+b.macaddress);d.setAttribute("title","Delete This Device");d.setAttribute("href","javascript:;");d.setAttribute("onclick",'confirm_delete_edgecontrol_device("'+b.macaddress+'", "'+b.name+'");return false;');f=document.createElement("i");f.setAttribute("class","fa fa-user-times");d.appendChild(f);a.cells[e].appendChild(d);return a}
function edit_edgecontrol_device(c,b,a){console.log("edit_edgecontrol_device() macaddress:"+b);gl_editMode_count+=1;create_edit_ui("edgecontrol_uiid_name",b,a);a=document.getElementById("edgecontrol_uiid_editbtn_"+b);a.setAttribute("title","Save this Device");a.setAttribute("onclick",'save_edgecontrol_device("'+c+'","'+b+'");return false;');document.getElementById("edgecontrol_uiid_editimg_"+b).setAttribute("class","fa fa-save");document.getElementById("edgecontrol_uiid_deletebtn_"+b).setAttribute("style",
"display:block")}function create_edit_ui(c,b,a){var e=clearChildView(c+"_"+b);c=create_input_text(c+"_"+b+"_edit",a);e.appendChild(c)}function clearChildView(c){c=document.getElementById(c);if(null!=c)for(;c.firstChild;)c.removeChild(c.firstChild);return c}function save_edgecontrol_device(c,b){var a=document.getElementById("edgecontrol_uiid_name_"+b+"_edit").value;update_edgecontrol_device(c,b,a)}
function update_edgecontrol_device(c,b,a){console.log("update_edgecontrol_device() macaddress:"+b);console.log("update_edgecontrol_device() value_name:"+a);if(0==a.length)alert("\u8acb\u8f38\u5165\u540d\u7a31");else{gl_editMode_count=0;var e={};e.project_id=""+project_id;e.update_edgecontrol=1;e.alive=c;e.name=a;e.macaddress=b;jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:e,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a));setTimeout(reload_edgecontrol_device_info,
300)},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}})}}function confirm_delete_edgecontrol_device(c,b){confirm("Are you sure you want to delete this device:"+b+" ?")&&delete_edgecontrol_device(c)}
function delete_edgecontrol_device(c){var b={};b.project_id=""+project_id;b.delete_edgecontrol=1;b.macaddress=c;gl_editMode_count=0;jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:b,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a));setTimeout(reload_edgecontrol_device_info,300)},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}})}
function edgecontrols_move_page_backward(){var c=document.getElementById("edgecontrols_id_current_page_num");1>=edgecontrols_glCurrentPage||(edgecontrols_glCurrentPage--,c.textContent=edgecontrols_glCurrentPage,reload_edgecontrol_device_info())}function edgecontrols_move_page_forward(){var c=document.getElementById("edgecontrols_id_current_page_num");edgecontrols_glCurrentPage++;c.textContent=edgecontrols_glCurrentPage;reload_edgecontrol_device_info()};var LOAD_PAGE_NUM=20,sensors_PreLoadIndex=-1,sensors_CurrentLoadIndex=0,LOAD_STATE_END=9999,sensors_glCurrentPage=1,gl_notOnLinelist_sensors=[],gl_OnLinelist_sensors=[],gl_editMode_count=0;sensors_loading_status();
function sensors_loading_status(){switch(sensors_CurrentLoadIndex){case 0:sensors_PreLoadIndex!=sensors_CurrentLoadIndex&&(sensors_PreLoadIndex=sensors_CurrentLoadIndex,load_sensor());break;case 1:sensors_PreLoadIndex!=sensors_CurrentLoadIndex&&(sensors_PreLoadIndex=sensors_CurrentLoadIndex,draw_sensor_table(),sensors_CurrentLoadIndex+=1);break;case 2:sensors_PreLoadIndex!=sensors_CurrentLoadIndex&&(sensors_PreLoadIndex=sensors_CurrentLoadIndex,sensors_CurrentLoadIndex=LOAD_STATE_END)}sensors_CurrentLoadIndex!=
LOAD_STATE_END?setTimeout(sensors_loading_status,100):setTimeout(reload_sensor_device_info,1E4)}function reload_sensor_device_info(){sensors_PreLoadIndex=-1;sensors_CurrentLoadIndex=0;sensors_loading_status()}
function load_sensor(){if("activetab_sensors"===gl_activetab){var c=(sensors_glCurrentPage-1)*LOAD_PAGE_NUM,b=LOAD_PAGE_NUM,a=gl_showfilter_showonline?1:0,e=gl_showfilter_showoffline?1:0;gl_notOnLinelist_sensors=[];gl_OnLinelist_sensors=[];$.getJSON(gl_target_server+"/php/vilsnodes.php","loadsensordevice=1&s="+c+"&count="+b+"&project_id="+project_id+"&showonline="+a+"&showoffline="+e,function(a){$.each(a,function(a,b){"0"===b.alive?gl_notOnLinelist_sensors.push(b):gl_OnLinelist_sensors.push(b)})}).success(function(){}).error(function(){}).complete(function(){sensors_CurrentLoadIndex+=
1})}else setTimeout(load_sensor,1E3)}
function draw_sensor_table(){if(0<gl_editMode_count)console.log("draw_sensor_table() gl_notOnLinelist_sensors.length:"+gl_notOnLinelist_sensors.length+" gl_editMode_count:"+gl_editMode_count),console.log("draw_sensor_table() gl_OnLinelist_sensors.length:"+gl_OnLinelist_sensors.length+" gl_editMode_count:"+gl_editMode_count);else{for(var c=document.getElementById("SENSOR_DEVICE_TABLE");1<=c.rows.length;)c.deleteRow(0);var b=0;if(gl_showfilter_showonline){for(var a=0;a<gl_OnLinelist_sensors.length;++a){var e=
gl_OnLinelist_sensors[a],d=(sensors_glCurrentPage-1)*LOAD_PAGE_NUM,e=sensors_create_record_table_item(d+a,e);c.appendChild(e)}b=gl_OnLinelist_sensors.length}if(gl_showfilter_showoffline)for(a=0;a<gl_notOnLinelist_sensors.length;++a)e=gl_notOnLinelist_sensors[a],d=(sensors_glCurrentPage-1)*LOAD_PAGE_NUM+b,e=sensors_create_record_table_item(d+a,e),c.appendChild(e)}}
function sensors_create_record_table_item(c,b){if(null==b)return console.log("sensors_create_record_table_item() device == null"),null;var a=document.createElement("tr");"0"===b.alive?a.setAttribute("bgcolor","#a3c2c2"):a.setAttribute("bgcolor","#FFFFFF");var e=0;a.appendChild(document.createElement("td"));a.cells[e].appendChild(document.createTextNode(""+(c+1)));e++;a.appendChild(document.createElement("td"));if("0"!=b.alive){var d=document.createElement("span");d.setAttribute("class","badge bg-fuchsia");
d.textContent=b.alive;a.cells[e].appendChild(d)}e++;d=document.createElement("td");d.setAttribute("id","sensor_uiid_ID_"+b.id);a.appendChild(d);var f=document.createElement("span");f.setAttribute("style","font-size:14px; font-weight:bold; color:#330033;");f.textContent=b.id;d.appendChild(f);e++;d=document.createElement("td");d.setAttribute("id","sensor_uiid_name_"+b.id);a.appendChild(d);f=document.createElement("span");f.setAttribute("style","font-size:14px; font-weight:bold; color:#330033;");f.textContent=
b.name;d.appendChild(f);e++;d=document.createElement("td");d.setAttribute("id","sensor_uiid_type_"+b.id);a.appendChild(d);f=document.createElement("span");f.setAttribute("style","font-size:14px; font-weight:bold; color:#330033;");f.textContent=b.type;d.appendChild(f);e++;d=document.createElement("td");a.appendChild(d);d=document.createElement("span");d.textContent=b.verifykey;a.cells[e].appendChild(d);e++;d=document.createElement("td");d.setAttribute("id","sensor_uiid_LngLat_"+b.id);a.appendChild(d);
d=document.createElement("span");d.setAttribute("style","font-size:14px; font-weight:bold; color:#330033;");d.textContent=b.Longitude+" "+b.Latitude;a.cells[e].appendChild(d);d=parseInt(b.Latitude+"0");f=parseInt(b.Longitude+"0");0!=d&&0!=f&&(d=document.createElement("a"),d.setAttribute("href","javascript:;"),d.setAttribute("onclick","open_gmap("+b.Latitude+","+b.Longitude+");return false;"),f=document.createElement("i"),f.setAttribute("class","fa fa-map-marker"),d.appendChild(f),a.cells[e].appendChild(d));
e++;d=document.createElement("td");d.setAttribute("id","sensor_uiid_Battery_"+b.id);a.appendChild(d);d=document.createElement("span");d.setAttribute("class","label label-primary");d.textContent=b.Battery;a.cells[e].appendChild(d);e++;d=document.createElement("td");d.setAttribute("id","sensor_uiid_info_"+b.id);a.appendChild(d);d=check_heartbeat_and_oxy(b.jsonvalue);f=document.createElement("span");f.setAttribute("class",d);f.textContent=b.jsonvalue;a.cells[e].appendChild(f);e++;d=document.createElement("td");
d.setAttribute("id","sensor_uiid_Version_"+b.id);a.appendChild(d);d=document.createElement("span");0<b.Version.length&&d.setAttribute("class","label label-warning");d.textContent=b.Version;a.cells[e].appendChild(d);e++;d=document.createElement("td");a.appendChild(d);d=document.createElement("button");d.setAttribute("id","sensor_uiid_editbtn_"+b.id);d.setAttribute("title","Edit this device");d.setAttribute("href","javascript:;");d.setAttribute("onclick",'edit_sensor_device("'+b.alive+'", "'+b.id+'","'+
b.name+'","'+b.Longitude+'","'+b.Latitude+'");return false;');f=document.createElement("i");f.setAttribute("id","sensor_uiid_editimg_"+b.id);f.setAttribute("class","fa fa-edit");d.appendChild(f);a.cells[e].appendChild(d);d=document.createElement("button");d.setAttribute("style","display:none");d.setAttribute("id","sensor_uiid_deletebtn_"+b.id);d.setAttribute("title","Delete This Device");d.setAttribute("href","javascript:;");d.setAttribute("onclick",'confirm_delete_sensor_device("'+b.id+'", "'+b.name+
'");return false;');f=document.createElement("i");f.setAttribute("class","fa fa-user-times");d.appendChild(f);a.cells[e].appendChild(d);return a}
function check_heartbeat_and_oxy(c){var b="label label-success",a="success";c=JSON.parse(c);null!=c.HR&&0<c.HR.length&&"255"!=c.HR&&"0"!=c.HR&&("120"<=c.HR&&"180">=c.HR?(b="label label-warning",a="warning"):"180"<c.HR&&"254">=c.HR&&(b="label label-danger",a="danger"));if("danger"==a)return b;null!=c.SPO2&&0<c.SPO2.length&&"255"!=c.SPO2&&"0"!=c.SPO2&&("90"<=c.SPO2&&"95">=c.SPO2?b="label label-warning":"90">c.SPO2&&(b="label label-danger"));return b}
function edit_sensor_device(c,b,a,e,d){gl_editMode_count+=1;create_edit_sensor_ui("sensor_uiid_name",b,a);create_edit_sensor_ui("sensor_uiid_LngLat",b,e+","+d);a=document.getElementById("sensor_uiid_editbtn_"+b);a.setAttribute("title","Save this Device");a.setAttribute("onclick",'save_sensor_device("'+c+'","'+b+'");return false;');document.getElementById("sensor_uiid_editimg_"+b).setAttribute("class","fa fa-save");document.getElementById("sensor_uiid_deletebtn_"+b).setAttribute("style","display:block")}
function create_edit_sensor_ui(c,b,a){var e=clearChildView(c+"_"+b);c=create_input_text(c+"_"+b+"_edit",a);e.appendChild(c)}function clearChildView(c){c=document.getElementById(c);if(null!=c)for(;c.firstChild;)c.removeChild(c.firstChild);return c}function save_sensor_device(c,b){var a=document.getElementById("sensor_uiid_name_"+b+"_edit").value,e=document.getElementById("sensor_uiid_LngLat_"+b+"_edit").value;update_sensor_device(c,b,a,e)}
function update_sensor_device(c,b,a,e){console.log("update_sensor_device() id:"+b);console.log("update_sensor_device() value_name:"+a);console.log("update_sensor_device() value_LngLat:"+e);if(0==a.length)alert("\u8acb\u8f38\u5165\u540d\u7a31");else{var d="",f="";if(0<e.length){f=e.split(",");if(1>=f.length||2<f.length){alert("\u8acb\u8f38\u5165\u6b63\u78ba\u7d93\u7def\u5ea6\u683c\u5f0f, \u5982121.0445673,24.774457");return}d=f[0];f=f[1];if(1>d.length||1>f.length){alert("\u8acb\u8f38\u5165\u6b63\u78ba\u7d93\u7def\u5ea6\u683c\u5f0f, \u5982121.0445673,24.774457");
return}}gl_editMode_count=0;e={};e.project_id=""+project_id;e.update_sensor=1;e.alive=c;e.name=a;e.id=b;e.lat=f;e.lng=d;jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:e,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a));setTimeout(reload_sensor_device_info,300)},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}})}}
function confirm_delete_sensor_device(c,b){confirm("Are you sure you want to delete this device:"+b+" ?")&&delete_sensor_device(c)}
function delete_sensor_device(c){var b={};b.project_id=""+project_id;b.delete_sensor=1;b.id=c;gl_editMode_count=0;jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:b,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a));setTimeout(reload_sensor_device_info,300)},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}})}
function verify_new_sensor(){var c=document.getElementById("sensor_verifykey").value;if(8!=c.length)alert("\u8acb\u8f38\u5165\u6b63\u78ba\u6a5f\u5668\u9a57\u8b49\u78bc");else{var b={};b.project_id=""+project_id;b.verify_new_sensor=1;b.verifykey=c;jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:b,success:function(a){if(400==a.status)alert("update Error! response = "+JSON.stringify(a));else{a=JSON.parse(a);var b=document.getElementById("sensor_verify_error"),c=document.getElementById("sensor_verify_pass");
0<a.verify_error.length?(b.textContent=a.verify_error,c.setAttribute("style","display:none;"),b.setAttribute("style","display:block;")):0<a.verify_pass.length&&(c.textContent=a.verify_pass,c.setAttribute("style","display:block;"),b.setAttribute("style","display:none;"),reload_sensor_device_info())}},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}})}}
function sensors_move_page_backward(){var c=document.getElementById("sensors_id_current_page_num");1>=sensors_glCurrentPage||(sensors_glCurrentPage--,c.textContent=sensors_glCurrentPage,reload_sensor_device_info()())}function sensors_move_page_forward(){var c=document.getElementById("sensors_id_current_page_num");sensors_glCurrentPage++;c.textContent=sensors_glCurrentPage;reload_sensor_device_info()()};var LOAD_PAGE_NUM=20,rfidcards_PreLoadIndex=-1,rfidcards_CurrentLoadIndex=0,LOAD_STATE_END=9999,rfidcards_glCurrentPage=1,gl_notOnLinelist_rfidcards=[],gl_OnLinelist_rfidcards=[];check_rfidcards_loading_status();
function check_rfidcards_loading_status(){switch(rfidcards_CurrentLoadIndex){case 0:rfidcards_PreLoadIndex!=rfidcards_CurrentLoadIndex&&(rfidcards_PreLoadIndex=rfidcards_CurrentLoadIndex,load_rfidcard());break;case 1:rfidcards_PreLoadIndex!=rfidcards_CurrentLoadIndex&&(rfidcards_PreLoadIndex=rfidcards_CurrentLoadIndex,draw_rfidcard_table(),rfidcards_CurrentLoadIndex+=1);break;case 2:rfidcards_PreLoadIndex!=rfidcards_CurrentLoadIndex&&(rfidcards_PreLoadIndex=rfidcards_CurrentLoadIndex,rfidcards_CurrentLoadIndex=
LOAD_STATE_END)}rfidcards_CurrentLoadIndex!=LOAD_STATE_END?setTimeout(check_rfidcards_loading_status,100):setTimeout(reload_rficcard_info,1E4)}
function load_rfidcard(){if("activetab_uhfcards"===gl_activetab){var c=(rfidcards_glCurrentPage-1)*LOAD_PAGE_NUM,b=LOAD_PAGE_NUM,a=gl_showfilter_showonline?1:0,e=gl_showfilter_showoffline?1:0;gl_notOnLinelist_rfidcards=[];gl_OnLinelist_rfidcards=[];$.getJSON(gl_target_server+"/php/rfiddevice.php","loadcard=1&s="+c+"&count="+b+"&project_id="+project_id+"&showonline="+a+"&showoffline="+e,function(a){$.each(a,function(a,b){"0"===b.alive?gl_notOnLinelist_rfidcards.push(b):gl_OnLinelist_rfidcards.push(b)})}).success(function(){rfidcards_CurrentLoadIndex+=
1}).error(function(){}).complete(function(){})}else setTimeout(load_rfidcard,1E3)}function create_input_text(c,b){var a=document.createElement("textarea");a.setAttribute("rows","1");a.setAttribute("id",c);a.textContent=b;return a}
function draw_rfidcard_table(){for(var c=document.getElementById("RFID_CARD_TABLE");1<=c.rows.length;)c.deleteRow(0);if(gl_showfilter_showonline)for(var b=0;b<gl_OnLinelist_rfidcards.length;++b){var a=gl_OnLinelist_rfidcards[b],e=(rfidcards_glCurrentPage-1)*LOAD_PAGE_NUM,a=rfidcards_create_record_table_item(e+b,a);c.appendChild(a)}if(gl_showfilter_showoffline)for(b=0;b<gl_notOnLinelist_rfidcards.length;++b)a=gl_notOnLinelist_rfidcards[b],e=(rfidcards_glCurrentPage-1)*LOAD_PAGE_NUM,a=rfidcards_create_record_table_item(e+
b,a),c.appendChild(a)}
function rfidcards_create_record_table_item(c,b){if(null==b)return null;var a=document.createElement("tr");"0"===b.alive?a.setAttribute("bgcolor","#a3c2c2"):a.setAttribute("bgcolor","#FFFFFF");var e=b.cardid;"0"!==b.userid&&(e=findUserName(b.userid));var d=0;a.appendChild(document.createElement("td"));a.cells[d].appendChild(document.createTextNode(""+c));d++;a.appendChild(document.createElement("td"));if("0"!=b.alive){var f=document.createElement("span");f.setAttribute("class","badge bg-fuchsia");
f.textContent=b.alive;a.cells[d].appendChild(f)}d++;a.appendChild(document.createElement("td"));f=document.createElement("span");f.setAttribute("id","uiid_name_"+b.cardid);f.setAttribute("class","badge bg-yellow-active");f.textContent=0<b.name.length?b.name:e;a.cells[d].appendChild(f);if(edit_node_info){f=document.createElement("a");f.setAttribute("id","uiid_name_"+b.cardid+"_NODNAME_EDIT");f.setAttribute("href","javascript:;");f.setAttribute("onclick",'edit_rfidcard_name("'+b.cardid+'","'+e+'");return false;');
var g=document.createElement("i");g.setAttribute("class","fa fa-edit");f.appendChild(g);a.cells[d].appendChild(f)}d++;f=document.createElement("td");f.setAttribute("id","uiid_type_"+b.cardid);a.appendChild(f);g=document.createElement("span");g.setAttribute("class","badge bg-green-active");g.textContent="0"===b.userid?"\u5361\u7247":"\u4eba\u54e1\u914d\u6234";f.appendChild(g);d++;f=document.createElement("td");f.setAttribute("id","uiid_id_"+b.cardid);a.appendChild(f);g=document.createElement("span");
g.setAttribute("style","font-size:14px; font-weight:bold; color:#330033;");g.textContent=b.cardid;f.appendChild(g);d++;f=document.createElement("td");f.setAttribute("id","uiid_id_"+b.cardid);a.appendChild(f);"0"!==b.userid&&(g=document.createElement("span"),g.setAttribute("style","display:inline;padding:.2em .3em .3em;font-size:95%;font-weight:700;line-height:1;position:relative;top:-1px;color:#fff;border-radius:2px;white-space:nowrap;background-color:rgb(54, 127, 169);"),g.textContent=e,f.appendChild(g));
d++;a.appendChild(document.createElement("td"));e=document.createElement("span");e.setAttribute("id","uiid_maplayer_"+b.cardid);e.setAttribute("class","label label-primary");e.textContent=get_maplayer_name(b.maplayer);a.cells[d].appendChild(e);d++;e=document.createElement("td");a.appendChild(e);e=document.createElement("button");e.setAttribute("type","button");e.setAttribute("class","btn btn-default");e.setAttribute("data-toggle","modal");e.setAttribute("data-target","#modal-qrcode");e.setAttribute("onclick",
'device_card_qrcode_show("'+b.cardid+'");return false;');f=document.createElement("i");f.setAttribute("class","fa fa-qrcode");e.appendChild(f);a.cells[d].appendChild(e);edit_node_info&&(e=document.createElement("button"),e.setAttribute("id","uiid_deletebtn_"+b.cardid),e.setAttribute("title","Delete This Card"),e.setAttribute("href","javascript:;"),e.setAttribute("onclick",'confirm_delete_card("'+b.cardid+'");return false;'),f=document.createElement("i"),f.setAttribute("class","fa fa-user-times"),
e.appendChild(f),a.cells[d].appendChild(e));return a}function edit_rfidcard_name(c,b){console.log("edit_rfidcard_name() cardid:"+c+" cardname:"+b);var a=prompt("\u7de8\u8f2fUHF\u5361\u7247\u540d\u7a31:",b);a&&(document.getElementById("uiid_name_"+c).innerText=a,update_rfidcard_name(c,a))}
function device_card_qrcode_show(c){console.log("device_card_qrcode_show() cardid:"+c);document.getElementById("device_qrcode_type").textContent="Type: CARD";document.getElementById("device_qrcode_name").textContent="";document.getElementById("device_qrcode_macaddress").textContent="\u5361\u7247ID: "+c;jQuery.ajax({url:gl_target_server+"/php/configvils.php",type:"POST",data:"loadqrcode=1&type=CARD&accountid="+c+"&id="+c+"&project_id="+project_id,dataType:"text",success:function(b){b=JSON.parse(b);
document.getElementById("device_qrcode_ui").setAttribute("src",b.qrcode);document.getElementById("device_qrcode_target").textContent="target: "+b.target;document.getElementById("device_qrcode_topic").textContent="topic: "+b.topic;document.getElementById("device_qrcode_datetime").textContent="\u66f4\u65b0\u6642\u9593: "+b.datetime}})}
function update_rfidcard_name(c,b){if(0==b.length)alert("\u8acb\u8f38\u5165\u540d\u7a31");else{var a={};a.project_id=""+project_id;a.update_rfidcard_name=1;a.cardid=c;a.cardname=b;jQuery.ajax({url:gl_target_server+"/php/rfiddevice.php",type:"POST",data:a,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a))},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}})}}
function confirm_delete_card(c){confirm("Are you sure you want to delete this card:"+c+"   ?")&&delete_card(c)}function delete_card(c){var b={};b.project_id=""+project_id;b.delete_card=1;b.cardid=c;jQuery.ajax({url:gl_target_server+"/php/rfiddevice.php",type:"POST",data:b,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a))},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}})}
$("#scannewrfidcardbutton").click(function(){var c={};c.project_id=""+project_id;c.scan_rfidcard=1;jQuery.ajax({url:gl_target_server+"/php/rfiddevice.php",type:"POST",data:c,success:function(b){400==b.status&&alert("update Error! response = "+JSON.stringify(b))},error:function(b,a,c){alert("error = "+c);alert("xhr.responseText = "+b.responseText)}});return!1});function reload_rficcard_info(){rfidcards_PreLoadIndex=-1;rfidcards_CurrentLoadIndex=0;check_rfidcards_loading_status()}
function rfidcards_move_page_backward(){var c=document.getElementById("rfidcards_id_current_page_num");1>=rfidcards_glCurrentPage||(rfidcards_glCurrentPage--,c.textContent=rfidcards_glCurrentPage)}function rfidcards_move_page_forward(){var c=document.getElementById("rfidcards_id_current_page_num");rfidcards_glCurrentPage++;c.textContent=rfidcards_glCurrentPage}function open_rfidcards_page(){window.open("/index.php/vilsrfidcards/"+project_id,"_blank").focus()};var LOAD_PAGE_NUM=20,unknownrfidcards_PreLoadIndex=-1,unknownrfidcards_CurrentLoadIndex=0,LOAD_STATE_END=9999,unknownrfidcards_glCurrentPage=1,gl_notOnLinelist_unknownrfidcards=[],gl_OnLinelist_unknownrfidcards=[];check_unknownrfidcards_loading_status();
function check_unknownrfidcards_loading_status(){switch(unknownrfidcards_CurrentLoadIndex){case 0:unknownrfidcards_PreLoadIndex!=unknownrfidcards_CurrentLoadIndex&&(unknownrfidcards_PreLoadIndex=unknownrfidcards_CurrentLoadIndex,load_unknownrfidcard());break;case 1:unknownrfidcards_PreLoadIndex!=unknownrfidcards_CurrentLoadIndex&&(unknownrfidcards_PreLoadIndex=unknownrfidcards_CurrentLoadIndex,draw_unknownrfidcard_table(),unknownrfidcards_CurrentLoadIndex+=1);break;case 2:unknownrfidcards_PreLoadIndex!=
unknownrfidcards_CurrentLoadIndex&&(unknownrfidcards_PreLoadIndex=unknownrfidcards_CurrentLoadIndex,unknownrfidcards_CurrentLoadIndex=LOAD_STATE_END)}unknownrfidcards_CurrentLoadIndex!=LOAD_STATE_END?setTimeout(check_unknownrfidcards_loading_status,100):setTimeout(reload_unknownrfidcard_info,1E4)}
function load_unknownrfidcard(){if("activetab_unknown_uhfcards"===gl_activetab){var c=(unknownrfidcards_glCurrentPage-1)*LOAD_PAGE_NUM,b=LOAD_PAGE_NUM,a=gl_showfilter_showonline?1:0,e=gl_showfilter_showoffline?1:0;gl_notOnLinelist_unknownrfidcards=[];gl_OnLinelist_unknownrfidcards=[];$.getJSON(gl_target_server+"/php/rfiddevice.php","loadunknowncard=1&s="+c+"&count="+b+"&project_id="+project_id+"&showonline="+a+"&showoffline="+e,function(a){$.each(a,function(a,b){"0"===b.alive?gl_notOnLinelist_unknownrfidcards.push(b):
gl_OnLinelist_unknownrfidcards.push(b)})}).success(function(){unknownrfidcards_CurrentLoadIndex+=1}).error(function(){}).complete(function(){})}else setTimeout(load_unknownrfidcard,1E3)}
function draw_unknownrfidcard_table(){for(var c=document.getElementById("UNKNOWN_RFID_CARD_TABLE");1<=c.rows.length;)c.deleteRow(0);if(gl_showfilter_showonline)for(var b=0;b<gl_OnLinelist_unknownrfidcards.length;++b){var a=gl_OnLinelist_unknownrfidcards[b],e=(unknownrfidcards_glCurrentPage-1)*LOAD_PAGE_NUM,a=unknownrfidcards_create_record_table_item(e+b,a);c.appendChild(a)}if(gl_showfilter_showoffline)for(b=0;b<gl_notOnLinelist_unknownrfidcards.length;++b)a=gl_notOnLinelist_unknownrfidcards[b],e=
(unknownrfidcards_glCurrentPage-1)*LOAD_PAGE_NUM,a=unknownrfidcards_create_record_table_item(e+b,a),c.appendChild(a)}
function unknownrfidcards_create_record_table_item(c,b){if(null==b)return null;var a=document.createElement("tr");"0"===b.alive?a.setAttribute("bgcolor","#a3c2c2"):a.setAttribute("bgcolor","#FFFFFF");var e=0;a.appendChild(document.createElement("td"));a.cells[e].appendChild(document.createTextNode(""+c));e++;a.appendChild(document.createElement("td"));if("0"!=b.alive){var d=document.createElement("span");d.setAttribute("class","badge bg-fuchsia");d.textContent=b.alive;a.cells[e].appendChild(d)}e++;
a.appendChild(document.createElement("td"));d=document.createElement("span");d.setAttribute("id","uiid_name_"+b.cardid);d.setAttribute("style","font-size:14px; font-weight:bold; color:#330033;");d.textContent=b.cardid;a.cells[e].appendChild(d);e++;a.appendChild(document.createElement("td"));d=document.createElement("span");d.setAttribute("class","badge bg-aqua-active");d.textContent=getDeviceName(b.deviceid);a.cells[e].appendChild(d);e++;a.appendChild(document.createElement("td"));d=document.createElement("span");
d.setAttribute("class","badge bg-green-active");d.textContent=b.updatetime;a.cells[e].appendChild(d);e++;d=document.createElement("td");a.appendChild(d);if(edit_node_info){d=document.createElement("button");d.setAttribute("id","uiid_deletebtn_"+b.cardid);d.setAttribute("title","Delete This Card");d.setAttribute("href","javascript:;");d.setAttribute("onclick",'confirm_delete_unknownrfidcard("'+b.cardid+'");return false;');var f=document.createElement("i");f.setAttribute("class","fa fa-user-times");
d.appendChild(f);a.cells[e].appendChild(d);d=document.createElement("button");d.setAttribute("id","uiid_registerbtn_"+b.cardid);d.setAttribute("title","\u8a3b\u518a\u5361\u7247");d.setAttribute("href","javascript:;");d.setAttribute("onclick",'confirm_register_unknownrfidcard("'+b.cardid+'");return false;');f=document.createElement("i");f.setAttribute("class","fa fa-check-square-o");d.appendChild(f);a.cells[e].appendChild(d)}return a}
function confirm_delete_unknownrfidcard(c){confirm("Are you sure you want to delete this card:"+c+"   ?")&&delete_unknownrfidcard(c)}function delete_unknownrfidcard(c){var b={};b.project_id=""+project_id;b.delete_card=1;b.cardid=c;jQuery.ajax({url:gl_target_server+"/php/rfiddevice.php",type:"POST",data:b,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a))},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}})}
function confirm_register_unknownrfidcard(c){confirm("\u8a3b\u518a\u5361\u7247, \u8a2d\u5b9a\u9019\u5f35\u5361\u7247\u5230\u5df2\u8a3b\u518a\u5340? "+c+"   ?")&&register_unknownrfidcard(c)}
function register_unknownrfidcard(c){var b={};b.project_id=""+project_id;b.register_card=1;b.cardid=c;jQuery.ajax({url:gl_target_server+"/php/rfiddevice.php",type:"POST",data:b,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a))},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}})}
function delete_all_unknownrfidcard(){var c={};c.project_id=""+project_id;c.delete_all_unknowncard=1;jQuery.ajax({url:gl_target_server+"/php/rfiddevice.php",type:"POST",data:c,success:function(b){400==b.status&&alert("update Error! response = "+JSON.stringify(b))},error:function(b,a,c){alert("error = "+c);alert("xhr.responseText = "+b.responseText)}})}
function create_unknown_uhfcards_xlsx_report(){document.getElementById("unknown_uhfcards_xlsxreport_status").textContent="\u7522\u751f\u5831\u8868\u4e2d...";jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:"loadunknownuhfcardsxlsxreport=1&project_id="+project_id,dataType:"text",success:function(c){var b=JSON.parse(c);console.log("create_user_xlsx_report() success:"+b.success+" xlsxreport:"+b.xlsxreport);for(var a=document.getElementById("unknown_uhfcards_xlsxreport_status");a.firstChild;)a.removeChild(a.firstChild);
"true"===b.success?(c=document.createElement("button"),c.setAttribute("type","button"),c.setAttribute("class","btn btn-app"),c.setAttribute("style","width:90px;height:100px"),c.setAttribute("onclick","open_new_page('"+b.xlsxreport+"');"),a.appendChild(c),b=document.createElement("img"),b.setAttribute("src","/images/xlsx-dl-icon-1.png"),b.setAttribute("alt","Download report"),b.setAttribute("title","Download report"),b.setAttribute("height","80"),b.setAttribute("width","80"),c.appendChild(b)):(a=document.getElementById("unknown_uhfcards_xlsxreport_status"),
a.textContent="\u7522\u751f\u5831\u8868\u5931\u6557!")}});return!1}function open_new_page(c){window.open(c,"_blank").focus()}function reload_unknownrfidcard_info(){unknownrfidcards_PreLoadIndex=-1;unknownrfidcards_CurrentLoadIndex=0;check_unknownrfidcards_loading_status()}
function unknown_rfidcards_move_page_backward(){var c=document.getElementById("unknown_rfidcards_id_current_page_num");1>=unknownrfidcards_glCurrentPage||(unknownrfidcards_glCurrentPage--,c.textContent=unknownrfidcards_glCurrentPage)}function unknown_rfidcards_move_page_forward(){var c=document.getElementById("unknown_rfidcards_id_current_page_num");unknownrfidcards_glCurrentPage++;c.textContent=unknownrfidcards_glCurrentPage};var LOAD_PAGE_NUM=20,rfiddevices_PreLoadIndex=-1,rfiddevices_CurrentLoadIndex=0,LOAD_STATE_END=9999,rfiddevices_glCurrentPage=1,gl_notOnLinelist_rfiddevices=[],gl_OnLinelist_rfiddevices=[],gl_editMode_count=0;rfiddevices_id_check_loading_status();
function rfiddevices_id_check_loading_status(){switch(rfiddevices_CurrentLoadIndex){case 0:rfiddevices_PreLoadIndex!=rfiddevices_CurrentLoadIndex&&(rfiddevices_PreLoadIndex=rfiddevices_CurrentLoadIndex,load_rfiddevice());break;case 1:rfiddevices_PreLoadIndex!=rfiddevices_CurrentLoadIndex&&(rfiddevices_PreLoadIndex=rfiddevices_CurrentLoadIndex,draw_rfiddevice_table(),rfiddevices_CurrentLoadIndex+=1);break;case 2:rfiddevices_PreLoadIndex!=rfiddevices_CurrentLoadIndex&&(rfiddevices_PreLoadIndex=rfiddevices_CurrentLoadIndex,
rfiddevices_CurrentLoadIndex=LOAD_STATE_END)}rfiddevices_CurrentLoadIndex!=LOAD_STATE_END?setTimeout(rfiddevices_id_check_loading_status,100):setTimeout(reload_device_info,1E4)}
function load_rfiddevice(){if("activetab_uhfreaders"===gl_activetab){var c=(rfiddevices_glCurrentPage-1)*LOAD_PAGE_NUM,b=LOAD_PAGE_NUM,a=gl_showfilter_showonline?1:0,e=gl_showfilter_showoffline?1:0;gl_notOnLinelist_rfiddevices=[];gl_OnLinelist_rfiddevices=[];$.getJSON(gl_target_server+"/php/rfiddevice.php","loaddevice=1&s="+c+"&count="+b+"&project_id="+project_id+"&showonline="+a+"&showoffline="+e,function(a){$.each(a,function(a,b){"0"===b.alive?gl_notOnLinelist_rfiddevices.push(b):gl_OnLinelist_rfiddevices.push(b)})}).success(function(){rfiddevices_CurrentLoadIndex+=
1}).error(function(){}).complete(function(){})}else setTimeout(load_rfiddevice,1E3)}
function create_empty_record_table_item(c){if(null==document.getElementById("empty_record_table_item")){var b=document.getElementById("RFID_DEVICE_TABLE"),a=document.createElement("tr");a.setAttribute("id","empty_record_table_item");var e=0;a.appendChild(document.createElement("td"));a.cells[e].appendChild(document.createTextNode(""+c));e++;a.appendChild(document.createElement("td"));e++;a.appendChild(document.createElement("td"));a.cells[e].appendChild(create_input_text("input_name"));e++;a.appendChild(document.createElement("td"));
a.cells[e].appendChild(create_input_text("input_type"));e++;a.appendChild(document.createElement("td"));a.cells[e].appendChild(create_input_text("input_ip"));e++;a.appendChild(document.createElement("td"));a.cells[e].appendChild(create_input_text("input_macaddress"));e++;a.appendChild(document.createElement("td"));a.cells[e].appendChild(create_input_text("input_LoRAMacaddress"));e++;a.appendChild(document.createElement("td"));a.cells[e].appendChild(create_input_text("input_gwid"));e++;a.appendChild(document.createElement("td"));
c=document.createElement("button");c.setAttribute("class","btn btn-block btn-primary btn-lg");c.setAttribute("onclick","save_new_device();");c.textContent="\u5132\u5b58";a.cells[e].appendChild(c);b.appendChild(a)}}function create_input_text(c,b){var a=document.createElement("textarea");a.setAttribute("rows","1");a.setAttribute("id",c);a.textContent=b;return a}
function draw_rfiddevice_table(){if(0<gl_editMode_count)console.log("draw_table() gl_notOnLinelist_rfiddevices.length:"+gl_notOnLinelist_rfiddevices.length+" gl_editMode_count:"+gl_editMode_count),console.log("draw_table() gl_OnLinelist_rfiddevices.length:"+gl_OnLinelist_rfiddevices.length+" gl_editMode_count:"+gl_editMode_count);else{for(var c=document.getElementById("RFID_DEVICE_TABLE");1<=c.rows.length;)c.deleteRow(0);if(gl_showfilter_showonline)for(var b=0;b<gl_OnLinelist_rfiddevices.length;++b){var a=
gl_OnLinelist_rfiddevices[b],a=rfiddevices_create_record_table_item(b,a);c.appendChild(a)}if(gl_showfilter_showoffline)for(b=0;b<gl_notOnLinelist_rfiddevices.length;++b)a=gl_notOnLinelist_rfiddevices[b],a=rfiddevices_create_record_table_item(b,a),c.appendChild(a)}}
function rfiddevices_create_record_table_item(c,b){if(null==b)return null;var a=document.createElement("tr");a.setAttribute("id",b.macaddress+"_TABLE_ROW");"0"===b.alive?a.setAttribute("bgcolor","#a3c2c2"):a.setAttribute("bgcolor","#FFFFFF");var e=0;a.appendChild(document.createElement("td"));a.cells[e].appendChild(document.createTextNode(""+(c+1)));e++;a.appendChild(document.createElement("td"));if("0"!=b.alive){var d=document.createElement("span");d.setAttribute("class","badge bg-fuchsia");d.textContent=
b.alive;a.cells[e].appendChild(d)}e++;d=document.createElement("td");d.setAttribute("id","uiid_name_"+b.deviceid);a.appendChild(d);var f=document.createElement("span");f.setAttribute("style","font-size:14px; font-weight:bold; color:#330033;");f.textContent=b.name;d.appendChild(f);e++;d=document.createElement("td");d.setAttribute("id","uiid_type_"+b.deviceid);a.appendChild(d);d=document.createElement("span");0<b.type.length&&d.setAttribute("style","font-size:14px; font-weight:bold; color:#330033;");
d.textContent=b.type;a.cells[e].appendChild(d);e++;d=document.createElement("td");d.setAttribute("id","uiid_ip_"+b.deviceid);a.appendChild(d);d=document.createElement("span");0<b.ip.length&&d.setAttribute("class","label label-info");d.textContent=b.ip;a.cells[e].appendChild(d);e++;d=document.createElement("td");a.appendChild(d);d=document.createElement("span");d.textContent=b.verifykey;a.cells[e].appendChild(d);e++;d=document.createElement("td");d.setAttribute("id","uiid_macaddress_"+b.deviceid);
a.appendChild(d);d=document.createElement("span");0<b.macaddress.length&&d.setAttribute("class","label label-primary");d.textContent=b.macaddress;a.cells[e].appendChild(d);e++;d=document.createElement("td");d.setAttribute("id","uiid_LoRAMacaddress_"+b.deviceid);a.appendChild(d);d=document.createElement("span");0<b.LoRAMacaddress.length&&d.setAttribute("class","label label-warning");d.textContent=b.LoRAMacaddress;a.cells[e].appendChild(d);e++;d=document.createElement("td");d.setAttribute("id","uiid_gwid_"+
b.deviceid);a.appendChild(d);d=document.createElement("span");0<b.gwid.length&&d.setAttribute("class","label label-success");d.textContent=b.gwid;a.cells[e].appendChild(d);e++;d=document.createElement("td");a.appendChild(d);d=document.createElement("button");d.setAttribute("id","uiid_editbtn_"+b.deviceid);d.setAttribute("title","Edit this User");d.setAttribute("href","javascript:;");d.setAttribute("onclick",'edit_device("'+b.deviceid+'");return false;');f=document.createElement("i");f.setAttribute("id",
"uiid_editimg_"+b.deviceid);f.setAttribute("class","fa fa-edit");d.appendChild(f);a.cells[e].appendChild(d);d=document.createElement("button");d.setAttribute("style","display:none");d.setAttribute("id","uiid_deletebtn_"+b.deviceid);d.setAttribute("title","Delete This Device");d.setAttribute("href","javascript:;");d.setAttribute("onclick",'confirm_delete_device("'+b.deviceid+'", "'+b.name+'", "'+b.type+'");return false;');f=document.createElement("i");f.setAttribute("class","fa fa-user-times");d.appendChild(f);
a.cells[e].appendChild(d);return a}
function edit_device(c){console.log("edit_device() deviceid:"+c);var b=getDevice(c);if(null!=b){gl_editMode_count+=1;create_edit_ui("uiid_name",c,b.name);create_edit_ui("uiid_ip",c,b.ip);create_edit_ui("uiid_macaddress",c,b.macaddress);create_edit_ui("uiid_LoRAMacaddress",c,b.LoRAMacaddress);create_edit_ui("uiid_gwid",c,b.gwid);var a=document.getElementById("uiid_editbtn_"+c);a.setAttribute("title","Save this Device");a.setAttribute("onclick",'save_device("'+b.alive+'","'+c+'");return false;');document.getElementById("uiid_editimg_"+
c).setAttribute("class","fa fa-save");document.getElementById("uiid_deletebtn_"+c).setAttribute("style","display:block")}}function create_edit_ui(c,b,a){var e=clearChildView(c+"_"+b);c=create_input_text(c+"_"+b+"_edit",a);e.appendChild(c)}function clearChildView(c){c=document.getElementById(c);if(null!=c)for(;c.firstChild;)c.removeChild(c.firstChild);return c}
function save_device(c,b){var a=document.getElementById("uiid_name_"+b+"_edit").value,e=document.getElementById("uiid_ip_"+b+"_edit").value,d=document.getElementById("uiid_macaddress_"+b+"_edit").value,f=document.getElementById("uiid_LoRAMacaddress_"+b+"_edit").value,g=document.getElementById("uiid_gwid_"+b+"_edit").value;update_device(c,b,a,e,d,f,g)}
function update_device(c,b,a,e,d,f,g){console.log("update_device() deviceid:"+b);if(0==a.length)alert("\u8acb\u8f38\u5165\u540d\u7a31");else{gl_editMode_count=0;var m={};m.project_id=""+project_id;m.update_device=1;m.deviceid=b;m.alive=c;m.macaddress=d;m.name=a;m.ip=e;m.gwid=g;m.LoRAMacaddress=f;jQuery.ajax({url:gl_target_server+"/php/rfiddevice.php",type:"POST",data:m,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a));setTimeout(reload_device_info,300)},error:function(a,
b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}})}}
function save_new_device(){var c=document.getElementById("input_name").value,b=document.getElementById("input_type").value,a=document.getElementById("input_ip").value,e=document.getElementById("input_macaddress").value;document.getElementById("input_LoRAMacaddress");var d=document.getElementById("input_gwid").value;if(0==c.length)alert("\u8acb\u8f38\u5165\u540d\u7a31");else{var f={};f.project_id=""+project_id;f.create_new_rfiddevice=1;f.macaddress=e;f.name=c;f.type=b;f.ip=a;f.gwid=d;f.LoRAMacaddress=
d;jQuery.ajax({url:gl_target_server+"/php/rfiddevice.php",type:"POST",data:f,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a));setTimeout(reload_device_info,300)},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}})}}function confirm_delete_device(c,b,a){confirm("Are you sure you want to delete this device:"+b+" "+a+"   ?")&&delete_device(c)}
function delete_device(c){var b={};b.project_id=""+project_id;b.delete_device=1;b.deviceid=c;gl_editMode_count=0;jQuery.ajax({url:gl_target_server+"/php/rfiddevice.php",type:"POST",data:b,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a));setTimeout(reload_device_info,300)},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}})}
$("#createnewrfiddevicebutton").click(function(){create_empty_record_table_item(gl_rfiddevices.length+1);return!1});function reload_device_info(){rfiddevices_PreLoadIndex=-1;rfiddevices_CurrentLoadIndex=0;rfiddevices_id_check_loading_status()}
function getDevice(c){for(var b=0;b<gl_OnLinelist_rfiddevices.length;++b){var a=gl_OnLinelist_rfiddevices[b];if(a.deviceid===c)return c=a}for(b=0;b<gl_notOnLinelist_rfiddevices.length;++b)if(a=gl_notOnLinelist_rfiddevices[b],a.deviceid===c)return c=a;return null}
function getDeviceName(c){for(var b=0;b<gl_OnLinelist_rfiddevices.length;++b){var a=gl_OnLinelist_rfiddevices[b];if(a.deviceid===c)return c=a.name}for(b=0;b<gl_notOnLinelist_rfiddevices.length;++b)if(a=gl_notOnLinelist_rfiddevices[b],a.deviceid===c){c=a.name;break}return c}
function rfiddevices_move_page_backward(){var c=document.getElementById("rfiddevices_id_current_page_num");1>=rfiddevices_glCurrentPage||(rfiddevices_glCurrentPage--,c.textContent=rfiddevices_glCurrentPage,reload_device_info())}function rfiddevices_move_page_forward(){var c=document.getElementById("rfiddevices_id_current_page_num");rfiddevices_glCurrentPage++;c.textContent=rfiddevices_glCurrentPage;reload_device_info()}
function open_rfiddevices_page(){window.open("/index.php/vilsrfiddevices/"+project_id,"_blank").focus()};
