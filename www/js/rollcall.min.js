var gl_all_tag=[],gl_area_tag=[],gl_none_tag=[],gl_tag_num=0,gl_tag_load_index=0,LOAD_DEVICE_NUM=20;load_Tags_Info();function load_Tags_Info(){$.getJSON(gl_target_server+"/php/vilsnodes.php","devicescount=1&project_id="+project_id,function(a){gl_tag_num=parseInt(a.LOC_TAG_NUM);gl_tag_load_index=0}).success(function(){setTimeout(load_Tags,10)}).error(function(){setTimeout(load_Tags_Info,1E3)}).complete(function(){})}
function load_Tags(){gl_tag_load_index>=gl_tag_num?gl_tag_load_index=0:$.getJSON(gl_target_server+"/php/vilsnodes.php","loadtagrollcall=1&s="+gl_tag_load_index+"&count="+LOAD_DEVICE_NUM+"&areaid="+rollcall_areaid+"&project_id="+project_id,function(a){for(var b=parseInt(a.LOC_TAG_NUM),e=gl_tag_load_index;e<gl_tag_load_index+b;++e){var f="LOC_TAG_INDEX_"+e;if(void 0!=a[f]&&null!=a[f]){var f=a[f].split(","),k=f[1],c=f[6],d=f[8],g=f[10];console.log("load_Tags() nodeid:"+f[3]+" areaid:"+c+" rollcall_areaid:"+
rollcall_areaid+", alive:"+k);gl_all_tag.push(f);c==rollcall_areaid&&"1"==d?"0"==k&&"0"==g?gl_none_tag.push(f):gl_area_tag.push(f):gl_none_tag.push(f)}}gl_tag_load_index+=b}).success(function(){gl_tag_load_index>=gl_tag_num?(gl_tag_load_index=0,draw_table()):setTimeout(load_Tags,10)}).error(function(){gl_tag_load_index=0;setTimeout(load_Tags,1E3)}).complete(function(){})}
function draw_table(){var a=document.getElementById("rollcall_sb"),b=document.getElementById("rollcall_rb"),e=document.getElementById("rollcall_nb"),f=document.getElementById("rollcall_time");a.textContent=gl_all_tag.length;b.textContent=gl_area_tag.length;e.textContent=gl_none_tag.length;f.textContent=(new Date).toLocaleString();for(a=document.getElementById("NODE_TABLE_BODY");1<=a.rows.length;)a.deleteRow(0);b=create_rollcall_table_item("\u5be6\u5230",1,gl_area_tag);a.appendChild(b);b=create_rollcall_table_item("\u672a\u5230",
2,gl_none_tag);a.appendChild(b)}
function create_rollcall_table_item(a,b,e){var f=document.createElement("tr"),k=0,c=document.createElement("td");c.setAttribute("style","height: 90px;");f.appendChild(c);c=document.createElement("span");c.setAttribute("style","font-size:14px; font-weight:bold; color:#330033;");c.textContent=a;f.cells[k].appendChild(c);k++;f.appendChild(document.createElement("td"));c=document.createElement("div");c.setAttribute("class","color-palette-set");f.cells[k].appendChild(c);var d=document.createElement("div");
d.setAttribute("style","text-align:center;");c.appendChild(d);var g=document.createElement("span");g.textContent=e.length;g.setAttribute("style","font-size:18px; font-weight:bold; color:#003300;");d.appendChild(g);k++;f.appendChild(document.createElement("td"));for(a=0;a<e.length;++a){var c=e[a],l=c[3],m=decodeURIComponent(c[4]),h="bg-green";1==b&&(h="bg-green");2==b&&(h="bg-red");d=document.createElement("div");d.setAttribute("class","col-sm-4 col-md-2");f.cells[k].appendChild(d);c=document.createElement("div");
c.setAttribute("class","color-palette-set");d.appendChild(c);d=document.createElement("div");d.setAttribute("class",h+" disabled color-palette");d.setAttribute("style","text-align:center;");c.appendChild(d);g=document.createElement("span");g.textContent=l;g.setAttribute("style","font-size:18px; font-weight:bold; color:#e6f5ff;");d.appendChild(g);d=document.createElement("div");d.setAttribute("class",h+" color-palette");d.setAttribute("style","text-align:center;");c.appendChild(d);g=document.createElement("span");
g.textContent=m;g.setAttribute("style","font-size:16px; font-weight:bold; color:#e6f5ff;");d.appendChild(g);m=document.createElement("div");m.setAttribute("class",h+"-active color-palette");m.setAttribute("style","text-align:center;");c.appendChild(m);h=document.createElement("span");h.textContent="";d=document.createElement("a");d.setAttribute("href","javascript:;");d.setAttribute("onclick",'show_on_2dmap("'+l+'");return false;');d.setAttribute("style","font-size:14px; color:#222222;");d.title="\u8df3\u8f49\u52302D\u5730\u5716";
d.textContent="\u67e5\u770b\u5730\u5716";h.appendChild(d);m.appendChild(h);l=document.createElement("div");l.setAttribute("style","text-align:center; color:#e6f5ff;");c.appendChild(l);c=document.createElement("span");c.textContent="-";c.setAttribute("style","font-size:14px; font-weight:bold; color:#e6f5ff;");l.appendChild(c)}return f}
function create_tag_pdf_report(){document.getElementById("pdfreport_status").textContent="\u7522\u751f\u5831\u8868\u4e2d...";jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:"loadtagrollcallpdfreport=1&areaid="+rollcall_areaid+"&project_id="+project_id,dataType:"text",success:function(a){var b=JSON.parse(a);console.log("create_tag_pdf_report() success:"+b.success+" pdfreport:"+b.pdfreport);for(var e=document.getElementById("pdfreport_status");e.firstChild;)e.removeChild(e.firstChild);
"true"===b.success?(a=document.createElement("button"),a.setAttribute("type","button"),a.setAttribute("class","btn btn-app"),a.setAttribute("onclick","open_new_page('"+b.pdfreport+"');"),e.appendChild(a),b=document.createElement("img"),b.setAttribute("src","/images/icons8-export-pdf-96.png"),b.setAttribute("alt","Download report"),b.setAttribute("title","Download report"),b.setAttribute("height","42"),b.setAttribute("width","42"),a.appendChild(b)):(e=document.getElementById("pdfreport_status"),e.textContent=
"\u7522\u751f\u5831\u8868\u5931\u6557!")}});return!1}
function create_tag_xlsx_report(){document.getElementById("xlsxreport_status").textContent="\u7522\u751f\u5831\u8868\u4e2d...";jQuery.ajax({url:gl_target_server+"/php/vilsnodes.php",type:"POST",data:"loadtagrollcallxlsxreport=1&areaid="+rollcall_areaid+"&project_id="+project_id,dataType:"text",success:function(a){var b=JSON.parse(a);console.log("create_tag_xlsx_report() success:"+b.success+" xlsxreport:"+b.xlsxreport);for(var e=document.getElementById("xlsxreport_status");e.firstChild;)e.removeChild(e.firstChild);"true"===
b.success?(a=document.createElement("button"),a.setAttribute("type","button"),a.setAttribute("class","btn btn-app"),a.setAttribute("style","width:90px;height:100px"),a.setAttribute("onclick","open_new_page('"+b.xlsxreport+"');"),e.appendChild(a),b=document.createElement("img"),b.setAttribute("src","/images/xlsx-dl-icon-1.png"),b.setAttribute("alt","Download report"),b.setAttribute("title","Download report"),b.setAttribute("height","80"),b.setAttribute("width","80"),a.appendChild(b)):(e=document.getElementById("xlsxreport_status"),
e.textContent="\u7522\u751f\u5831\u8868\u5931\u6557!")}});return!1}function show_on_2dmap(a){window.open("/index.php/vils2dmap/"+project_id+"?nodeid="+a,"_self")}function open_new_page(a){window.open(a,"_blank").focus()}function open_location_page(){window.open("/index.php/vilslocation/"+project_id,"_blank").focus()};
