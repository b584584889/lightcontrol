var LOAD_PAGE_NUM=20,rfiddevices_PreLoadIndex=-1,rfiddevices_CurrentLoadIndex=0,LOAD_STATE_END=9999,rfiddevices_glCurrentPage=1,gl_rfiddevices=[];rfiddevices_id_check_loading_status();
function rfiddevices_id_check_loading_status(){switch(rfiddevices_CurrentLoadIndex){case 0:rfiddevices_PreLoadIndex!=rfiddevices_CurrentLoadIndex&&(console.log("rfiddevices_id_check_loading_status() rfiddevices_PreLoadIndex:"+rfiddevices_PreLoadIndex+" != rfiddevices_CurrentLoadIndex:"+rfiddevices_CurrentLoadIndex),rfiddevices_PreLoadIndex=rfiddevices_CurrentLoadIndex,load_rfiddevice());break;case 1:rfiddevices_PreLoadIndex!=rfiddevices_CurrentLoadIndex&&(console.log("rfiddevices_id_check_loading_status() rfiddevices_PreLoadIndex:"+
rfiddevices_PreLoadIndex+" != rfiddevices_CurrentLoadIndex:"+rfiddevices_CurrentLoadIndex),rfiddevices_PreLoadIndex=rfiddevices_CurrentLoadIndex,draw_rfiddevice_table(),rfiddevices_CurrentLoadIndex+=1);break;case 2:rfiddevices_PreLoadIndex!=rfiddevices_CurrentLoadIndex&&(console.log("rfiddevices_id_check_loading_status() rfiddevices_PreLoadIndex:"+rfiddevices_PreLoadIndex+" != rfiddevices_CurrentLoadIndex:"+rfiddevices_CurrentLoadIndex),rfiddevices_PreLoadIndex=rfiddevices_CurrentLoadIndex,rfiddevices_CurrentLoadIndex=
LOAD_STATE_END)}rfiddevices_CurrentLoadIndex!=LOAD_STATE_END?setTimeout(rfiddevices_id_check_loading_status,100):(console.log("rfiddevices_id_check_loading_status() Stop."),setTimeout(reload_device_info,3E4))}
function load_rfiddevice(){var b=(rfiddevices_glCurrentPage-1)*LOAD_PAGE_NUM,a=LOAD_PAGE_NUM;gl_rfiddevices=[];$.getJSON(gl_target_server+"/php/rfiddevice.php","loaddevice=1&s="+b+"&count="+a+"&project_id="+project_id,function(a){var b=0;$.each(a,function(a,d){gl_rfiddevices.push(d);b++})}).success(function(){rfiddevices_CurrentLoadIndex+=1}).error(function(){}).complete(function(){})}
function create_empty_record_table_item(b){if(null==document.getElementById("empty_record_table_item")){var a=document.getElementById("RFID_DEVICE_TABLE"),d=document.createElement("tr");d.setAttribute("id","empty_record_table_item");var e=0;d.appendChild(document.createElement("td"));d.cells[e].appendChild(document.createTextNode(""+b));e++;d.appendChild(document.createElement("td"));e++;d.appendChild(document.createElement("td"));d.cells[e].appendChild(create_input_text("input_name"));e++;d.appendChild(document.createElement("td"));
d.cells[e].appendChild(create_input_text("input_type"));e++;d.appendChild(document.createElement("td"));d.cells[e].appendChild(create_input_text("input_ip"));e++;d.appendChild(document.createElement("td"));d.cells[e].appendChild(create_input_text("input_macaddress"));e++;d.appendChild(document.createElement("td"));d.cells[e].appendChild(create_input_text("input_LoRAMacaddress"));e++;d.appendChild(document.createElement("td"));d.cells[e].appendChild(create_input_text("input_gwid"));e++;d.appendChild(document.createElement("td"));
b=document.createElement("button");b.setAttribute("class","btn btn-block btn-primary btn-lg");b.setAttribute("onclick","save_new_device();");b.textContent="\u5132\u5b58";d.cells[e].appendChild(b);a.appendChild(d)}}function create_input_text(b,a){var d=document.createElement("textarea");d.setAttribute("rows","1");d.setAttribute("id",b);d.textContent=a;return d}
function draw_rfiddevice_table(){for(var b=document.getElementById("RFID_DEVICE_TABLE");1<=b.rows.length;)b.deleteRow(0);console.log("draw_table() gl_rfiddevices.length:"+gl_rfiddevices.length);for(var a=0;a<gl_rfiddevices.length;++a){var d=rfiddevices_create_record_table_item(a,gl_rfiddevices[a]);b.appendChild(d)}}
function rfiddevices_create_record_table_item(b,a){if(null==a)return null;var d=document.createElement("tr");d.setAttribute("id",a.macaddress+"_TABLE_ROW");"0"===a.alive?d.setAttribute("bgcolor","#a3c2c2"):d.setAttribute("bgcolor","#FFFFFF");var e=0;d.appendChild(document.createElement("td"));d.cells[e].appendChild(document.createTextNode(""+(b+1)));e++;d.appendChild(document.createElement("td"));if("0"!=a.alive){var c=document.createElement("span");c.setAttribute("class","badge bg-fuchsia");c.textContent=
a.alive;d.cells[e].appendChild(c)}e++;c=document.createElement("td");c.setAttribute("id","uiid_name_"+a.deviceid);d.appendChild(c);var f=document.createElement("span");f.setAttribute("style","font-size:14px; font-weight:bold; color:#330033;");f.textContent=a.name;c.appendChild(f);e++;c=document.createElement("td");c.setAttribute("id","uiid_type_"+a.deviceid);d.appendChild(c);c=document.createElement("span");0<a.type.length&&c.setAttribute("style","font-size:14px; font-weight:bold; color:#330033;");
c.textContent=a.type;d.cells[e].appendChild(c);e++;c=document.createElement("td");c.setAttribute("id","uiid_ip_"+a.deviceid);d.appendChild(c);c=document.createElement("span");0<a.ip.length&&c.setAttribute("class","label label-info");c.textContent=a.ip;d.cells[e].appendChild(c);e++;c=document.createElement("td");c.setAttribute("id","uiid_macaddress_"+a.deviceid);d.appendChild(c);c=document.createElement("span");0<a.macaddress.length&&c.setAttribute("class","label label-primary");c.textContent=a.macaddress;
d.cells[e].appendChild(c);e++;c=document.createElement("td");c.setAttribute("id","uiid_LoRAMacaddress_"+a.deviceid);d.appendChild(c);c=document.createElement("span");0<a.LoRAMacaddress.length&&c.setAttribute("class","label label-warning");c.textContent=a.LoRAMacaddress;d.cells[e].appendChild(c);e++;c=document.createElement("td");c.setAttribute("id","uiid_gwid_"+a.deviceid);d.appendChild(c);c=document.createElement("span");0<a.gwid.length&&c.setAttribute("class","label label-success");c.textContent=
a.gwid;d.cells[e].appendChild(c);e++;c=document.createElement("td");d.appendChild(c);c=document.createElement("button");c.setAttribute("id","uiid_editbtn_"+a.deviceid);c.setAttribute("title","Edit this User");c.setAttribute("href","javascript:;");c.setAttribute("onclick",'edit_device("'+a.deviceid+'");return false;');f=document.createElement("i");f.setAttribute("id","uiid_editimg_"+a.deviceid);f.setAttribute("class","fa fa-edit");c.appendChild(f);d.cells[e].appendChild(c);c=document.createElement("button");
c.setAttribute("style","display:none");c.setAttribute("id","uiid_deletebtn_"+a.deviceid);c.setAttribute("title","Delete This Device");c.setAttribute("href","javascript:;");c.setAttribute("onclick",'confirm_delete_device("'+a.deviceid+'", "'+a.name+'", "'+a.type+'");return false;');f=document.createElement("i");f.setAttribute("class","fa fa-user-times");c.appendChild(f);d.cells[e].appendChild(c);return d}
function edit_device(b){console.log("edit_device() deviceid:"+b);var a=getDevice(b);null!=a&&(create_edit_ui("uiid_name",b,a.name),create_edit_ui("uiid_type",b,a.type),create_edit_ui("uiid_ip",b,a.ip),create_edit_ui("uiid_macaddress",b,a.macaddress),create_edit_ui("uiid_LoRAMacaddress",b,a.LoRAMacaddress),create_edit_ui("uiid_gwid",b,a.gwid),a=document.getElementById("uiid_editbtn_"+b),a.setAttribute("title","Save this Device"),a.setAttribute("onclick",'save_device("'+b+'");return false;'),document.getElementById("uiid_editimg_"+
b).setAttribute("class","fa fa-save"),document.getElementById("uiid_deletebtn_"+b).setAttribute("style","display:block"))}function create_edit_ui(b,a,d){var e=clearChildView(b+"_"+a);b=create_input_text(b+"_"+a+"_edit",d);e.appendChild(b)}function clearChildView(b){b=document.getElementById(b);if(null!=b)for(;b.firstChild;)b.removeChild(b.firstChild);return b}
function save_device(b){var a=document.getElementById("uiid_name_"+b+"_edit").value,d=document.getElementById("uiid_type_"+b+"_edit").value,e=document.getElementById("uiid_ip_"+b+"_edit").value,c=document.getElementById("uiid_macaddress_"+b+"_edit").value,f=document.getElementById("uiid_LoRAMacaddress_"+b+"_edit").value,h=document.getElementById("uiid_gwid_"+b+"_edit").value;update_device(b,a,d,e,c,f,h)}
function update_device(b,a,d,e,c,f,h){console.log("update_device() deviceid:"+b);if(0==a.length)alert("\u8acb\u8f38\u5165\u540d\u7a31");else{var g={};g.project_id=""+project_id;g.update_device=1;g.deviceid=b;g.macaddress=c;g.name=a;g.type=d;g.ip=e;g.gwid=h;g.LoRAMacaddress=f;jQuery.ajax({url:gl_target_server+"/php/rfiddevice.php",type:"POST",data:g,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a));setTimeout(reload_device_info,300)},error:function(a,d,b){alert("error = "+
b);alert("xhr.responseText = "+a.responseText)}})}}
function save_new_device(){var b=document.getElementById("input_name").value,a=document.getElementById("input_type").value,d=document.getElementById("input_ip").value,e=document.getElementById("input_macaddress").value;document.getElementById("input_LoRAMacaddress");var c=document.getElementById("input_gwid").value;if(0==b.length)alert("\u8acb\u8f38\u5165\u540d\u7a31");else{var f={};f.project_id=""+project_id;f.create_new_rfiddevice=1;f.macaddress=e;f.name=b;f.type=a;f.ip=d;f.gwid=c;f.LoRAMacaddress=
c;jQuery.ajax({url:gl_target_server+"/php/rfiddevice.php",type:"POST",data:f,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a));setTimeout(reload_device_info,300)},error:function(a,d,b){alert("error = "+b);alert("xhr.responseText = "+a.responseText)}})}}function confirm_delete_device(b,a,d){confirm("Are you sure you want to delete this device:"+a+" "+d+"   ?")&&delete_device(b)}
function delete_device(b){var a={};a.project_id=""+project_id;a.delete_device=1;a.deviceid=b;jQuery.ajax({url:gl_target_server+"/php/rfiddevice.php",type:"POST",data:a,success:function(a){400==a.status&&alert("update Error! response = "+JSON.stringify(a));setTimeout(reload_device_info,300)},error:function(a,b,c){alert("error = "+c);alert("xhr.responseText = "+a.responseText)}})}$("#createnewrfiddevicebutton").click(function(){create_empty_record_table_item(gl_rfiddevices.length+1);return!1});
function reload_device_info(){rfiddevices_PreLoadIndex=-1;rfiddevices_CurrentLoadIndex=0;rfiddevices_id_check_loading_status()}function getDevice(b){for(var a=null,d=0;d<gl_rfiddevices.length;++d){var e=gl_rfiddevices[d];if(e.deviceid===b){a=e;break}}return a}function rfiddevices_move_page_backward(){var b=document.getElementById("rfiddevices_id_current_page_num");1>=rfiddevices_glCurrentPage||(rfiddevices_glCurrentPage--,b.textContent=rfiddevices_glCurrentPage,reload_device_info())}
function rfiddevices_move_page_forward(){var b=document.getElementById("rfiddevices_id_current_page_num");rfiddevices_glCurrentPage++;b.textContent=rfiddevices_glCurrentPage;reload_device_info()}function open_rfiddevices_page(){window.open("/index.php/vilsrfiddevices/"+project_id,"_blank").focus()};
